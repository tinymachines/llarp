
<h1 class="sectionedit1" id="filesystems">Filesystems</h1>
<div class="level1">

<p>
This page contains basic information about filesystems (file systems) and partitions. A filesystem is “how data is written in a partition of the storage device”. Windows, macOS, and Linux use different default filesystems, and not all filesystems work equally well across operating systems.<br/>

</p>

<p>
OpenWrt is a Linux-based operating system and thus typically works best with filesystems native to Linux. However it can also read/write data with many filesystems, albeit sometimes slower or less reliable than with native Linux filesystems. In case you wonder, the reason for this reduced performance is patents and other ways to impede the adoption of Microsoft or Apple filesystems by other parties.<br/>

</p>

<p>
Installing these additional filesystems in OpenWrt is commonly for file sharing using <a href="/docs/guide-user/storage/usb-drives-quickstart" class="wikilink1" title="docs:guide-user:storage:usb-drives-quickstart" data-wiki-id="docs:guide-user:storage:usb-drives-quickstart">USB 3.0 storage</a> and <a href="/docs/guide-user/services/nas/cifs.server" class="wikilink1" title="docs:guide-user:services:nas:cifs.server" data-wiki-id="docs:guide-user:services:nas:cifs.server">Samba</a>. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Filesystems&quot;,&quot;hid&quot;:&quot;filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-938&quot;} -->
<h3 class="sectionedit2" id="check_available_filesystems">Check available filesystems</h3>
<div class="level3">

<p>
To see what filesystems can be read currently, enter <code>cat /proc/filesystems</code>.<br/>

</p>

<p>
A full list of filesystems available in OpenWrt can be obtained by writing<br/>

<code>opkg update &amp;&amp; opkg list | grep kmod-fs</code>
</p>

<p>
The tools for the filesystem of your choosing can be found by writing<br/>

<code>opkg list | grep FILESYSTEM_NAME</code>
</p>

<p>
OpenWrt has drivers and filesystem tools available for ext2/3/4, f2fs, btrfs, and many other filesystems supported by Linux.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Check available filesystems&quot;,&quot;hid&quot;:&quot;check_available_filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;939-1419&quot;} -->
<h2 class="sectionedit3" id="openwrtlinux_filesystems">OpenWrt/Linux filesystems</h2>
<div class="level2">

<p>
The two most common Linux filesystems are <a href="https://en.wikipedia.org/wiki/ext4" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/ext4">ext4</a> and <a href="https://en.wikipedia.org/wiki/f2fs" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/f2fs">f2fs</a>, with <a href="https://en.wikipedia.org/wiki/btrfs" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/btrfs">btrfs</a> growing in popularity:<br/>

</p>
<ul>
<li class="level1"><div class="li"> ext4 is well suited for HDDs and SSDs (using TRIM) and is the default filesystem of most desktop Linux distributions.</div>
</li>
<li class="level1"><div class="li"> f2fs is well suited for flash (SSDs or USB thumbdrives). The format can be incompatible between kernel versions, requiring some time for “fsck” to upgrade the filesystem.</div>
</li>
<li class="level1"><div class="li"> btrfs is the default filesystem for more cutting-edge Linux distributions. It is considered the sucessor to ext4, with the author stating “there will be no ext5”. It has some more advanced features such as checksumming.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenWrt\/Linux filesystems&quot;,&quot;hid&quot;:&quot;openwrtlinux_filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1420-2095&quot;} -->
<h3 class="sectionedit4" id="ext4">ext4</h3>
<div class="level3">

<p>
This command will download the tools needed to create and fix ext4 (and older versions)<br/>

<code>opkg install e2fsprogs</code>
</p>

<p>
If in the list of supported filesystems in your device you don&#039;t see ext4, you must install also the driver itself<br/>

<code>opkg install kmod-fs-ext4</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ext4&quot;,&quot;hid&quot;:&quot;ext4&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2096-2377&quot;} -->
<h3 class="sectionedit5" id="f2fs">f2fs</h3>
<div class="level3">

<p>
This command will download the tools needed to create and fix f2fs<br/>

<code>opkg install f2fs-tools</code>
</p>

<p>
If in the list of supported filesystems in your device you don&#039;t see f2fs, you must install also the driver itself<br/>

<code>opkg install kmod-fs-f2fs</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;f2fs&quot;,&quot;hid&quot;:&quot;f2fs&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;2378-2638&quot;} -->
<h3 class="sectionedit6" id="btrfs">btrfs</h3>
<div class="level3">

<p>
This command will download the tools needed to create and fix btrfs<br/>

<code>opkg install btrfs-progs</code>
</p>

<p>
If in the list of supported filesystems in your device you don&#039;t see btrfs, you must install also the driver itself<br/>

<code>opkg install kmod-fs-btrfs</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;btrfs&quot;,&quot;hid&quot;:&quot;btrfs&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2639-2904&quot;} -->
<h2 class="sectionedit7" id="windows_filesystems">Windows filesystems</h2>
<div class="level2">

<p>
The two most common filesystems used by Windows are <a href="https://en.wikipedia.org/wiki/NTFS" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/NTFS">NTFS</a> and <a href="https://en.wikipedia.org/wiki/exFAT" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/exFAT">exFAT</a> as described below.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Windows filesystems&quot;,&quot;hid&quot;:&quot;windows_filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2905-3039&quot;} -->
<h3 class="sectionedit8" id="ntfs">NTFS</h3>
<div class="level3">

<p>
NTFS is the proprietary file system used in Windows. Two drivers are available with read/write support in Linux, <code>ntfs-3g</code>, and with kernel 5.15 onward the new in-kernel driver <code>ntfs3</code>. See <a href="/docs/guide-user/storage/writable_ntfs" class="wikilink1" title="docs:guide-user:storage:writable_ntfs" data-wiki-id="docs:guide-user:storage:writable_ntfs">Writable NTFS</a> for important information on mounting and features.
</p>

<p>
Download and install the NTFS3 driver<br/>

<code>opkg install kmod-fs-ntfs3</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;NTFS&quot;,&quot;hid&quot;:&quot;ntfs&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;3040-3430&quot;} -->
<h2 class="sectionedit9" id="apple_filesystems">Apple filesystems</h2>
<div class="level2">

<p>
In Apple land you have <a href="https://en.wikipedia.org/wiki/HFS" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/HFS">HFS</a>, <a href="https://en.wikipedia.org/wiki/HFS+" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/HFS+">HFS+</a> and <a href="https://en.wikipedia.org/wiki/APFS" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/APFS">APFS</a>. There is a driver available for HFS and HFS+ but it has low performance and does not support all features. APFS was introduced in 2017 but there is currently no support for it in OpenWrt (nor in Linux).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Apple filesystems&quot;,&quot;hid&quot;:&quot;apple_filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;3431-3728&quot;} -->
<h3 class="sectionedit10" id="hfs_and_hfs">HFS and HFS+</h3>
<div class="level3">

<p>
This command will download the tools needed to create and fix HFS and HFS+<br/>

<code>opkg install hfsfsck</code>
</p>

<p>
If in the list of supported filesystems in your device you don&#039;t see <strong>hfs</strong> and <strong>hfsplus</strong>, you must install also the drivers<br/>

<code>opkg install kmod-fs-hfs kmod-fs-hfsplus</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;HFS and HFS+&quot;,&quot;hid&quot;:&quot;hfs_and_hfs&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;3729-4031&quot;} -->
<h2 class="sectionedit11" id="multiplatform_filesystems">Multiplatform filesystems</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Multiplatform filesystems&quot;,&quot;hid&quot;:&quot;multiplatform_filesystems&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;4032-4070&quot;} -->
<h3 class="sectionedit12" id="fat32">FAT32</h3>
<div class="level3">

<p>
<a href="https://en.wikipedia.org/wiki/FAT32" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/FAT32">FAT32</a> was a common multiplatform file system. It can be read/write by Windows, macOS, Linux, and any other device you might have (smartTV, tablets, car audio with usb, etc). Its has two major drawbacks given its age: it cannot store files larger than 3.9 <abbr title="Gigabyte">GB</abbr>, and it lacks journaling support, meaning it&#039;s also prone to corruption if the device is disconnected while writing. This can lead to data loss if the device is written again without running a filesystem check.
</p>

<p>
This command will download the tools needed to create and fix FAT32 (and older versions)<br/>

<code>opkg install dosfstools</code> (The dosfstools package includes the <a href="https://linux.die.net/man/8/mkfs.vfat" class="urlextern" title="https://linux.die.net/man/8/mkfs.vfat" rel="ugc nofollow">mkfs.fat</a> and <a href="https://linux.die.net/man/8/fsck.vfat" class="urlextern" title="https://linux.die.net/man/8/fsck.vfat" rel="ugc nofollow">fsck.fat</a> utilities, which respectively make and check MS-DOS FAT filesystems.)
</p>

<p>
If in the list of supported filesystems in your device you don&#039;t see <strong>vfat</strong>, you must install also the driver itself<br/>

<code>opkg install kmod-fs-vfat</code>
</p>

</div>

<h4 id="available_nls_files">Available NLS files</h4>
<div class="level4">

<p>
Some filesystems, like FAT32, may need additional Native Language Support (NLS) packages (codepages / charsets) to handle the filenames. If your mount fails, look in dmesg - a message like<br/>

<code>FAT: codepage cp437 not found</code><br/>

means that you need NLS codepage 437, and a message like<br/>

<code>FAT: IO charset iso8859-1 not found</code><br/>

means that you need NLS ISO 8859-1.
</p>

<p>
Available NLS packages can be listed by writing <code>opkg update &amp;&amp; opkg list “kmod-nls*”</code>. There will be many available, below are a few examples.
</p>
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Name                </th><th class="col1 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> kmod-nls-cp1250     </td><td class="col1 leftalign"> Kernel module for NLS Codepage 1250 (Eastern Europe)       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> kmod-nls-cp1251     </td><td class="col1 leftalign"> Kernel module for NLS Codepage 1251 (Russian)              </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> kmod-nls-cp437      </td><td class="col1"> Kernel module for NLS Codepage 437 (United States, Canada) </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> kmod-nls-cp775      </td><td class="col1 leftalign"> Kernel module for NLS Codepage 775 (Baltic Rim)            </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> kmod-nls-cp850      </td><td class="col1 leftalign"> Kernel module for NLS Codepage 850 (Europe)                </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> kmod-nls-cp866      </td><td class="col1 leftalign"> Kernel module for NLS Codepage 866 (Cyrillic)              </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> kmod-nls-iso8859-1  </td><td class="col1 leftalign"> Kernel module for NLS ISO 8859-1 (Latin 1)                 </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> kmod-nls-koi8r      </td><td class="col1 leftalign"> Kernel module for NLS KOI8-R (Russian)                     </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> kmod-nls-utf8       </td><td class="col1 leftalign"> Kernel module for NLS UTF-8                                </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;5590-6393&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;FAT32&quot;,&quot;hid&quot;:&quot;fat32&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;4071-6394&quot;} -->
<h3 class="sectionedit14" id="exfat">exFAT</h3>
<div class="level3">

<p>
exFAT is commonly used by OEMs for external SSDs and SD cards. The downside to this filesystem is the lack of journaling support, which makes breakage during sudden poweroff more likely. exFAT will provide good performance while maintaining compatibility with Windows and macOS.
</p>

<p>
As of Linux kernel 5.4 there is a <a href="https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-5.4-Released" class="urlextern" title="https://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-5.4-Released" rel="ugc nofollow">new exFAT driver</a> this is available with low overhead. This new driver is quite performant and will max out gigabit <abbr title="Local Area Network">LAN</abbr> at 120 <abbr title="Megabyte">MB</abbr>/s using USB 3.0 external drives on some targets, as tested on the <a href="/toh/linksys/wrt_ac_series" class="wikilink1" title="toh:linksys:wrt_ac_series" data-wiki-id="toh:linksys:wrt_ac_series">wrt_ac_series</a>. 
</p>

<p>
This will install the driver to use exFAT and the tool to be able to run check disk if needed:<br/>

<code>opkg install kmod-fs-exfat exfat-fsck</code>
</p>

<p>
Under Windows, exFAT does not support TRIM; but under Linux/OpenWRT, it does.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;exFAT&quot;,&quot;hid&quot;:&quot;exfat&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:14,&quot;range&quot;:&quot;6395-7248&quot;} -->
<h2 class="sectionedit15" id="partitions">Partitions</h2>
<div class="level2">

<p>
A <a href="https://en.wikipedia.org/wiki/Disk_partitioning" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Disk_partitioning">partition</a> is a way to split the storage space in more different sections, each using its own independent filesystem.
</p>

<p>
This can be useful to separate different types of data, for example to keep your expanded firmware separate from the actual data you want to store and share, or data that must be easily accessible from Windows or macOS directly if you disconnect the external drive.
</p>

<p>
Discussing advanced partitioning is beyond the scope of this article, as OpenWrt uses the same commandline tools used by any other Linux system.
</p>
<ul>
<li class="level1"><div class="li"> <strong>fdisk</strong> tool is used to create/modify partitions on a drive initialized with MBR scheme; since version 2.23 (OpenWRT is on 2.37, as of 2024!), it also supports GPT just fine.</div>
</li>
<li class="level1"><div class="li"> <strong>gdisk</strong> tool is used to create/modify partitions on a drive initialized with GPT scheme.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Partitions&quot;,&quot;hid&quot;:&quot;partitions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:15,&quot;range&quot;:&quot;7249-&quot;} -->