
<h1 class="sectionedit1" id="secure_access_to_your_router">Secure access to your router</h1>
<div class="level1">

<p>
See also:
<a href="/docs/guide-user/security/sudo#goals" class="wikilink1" title="docs:guide-user:security:sudo" data-wiki-id="docs:guide-user:security:sudo">Elevating privileges with sudo</a>
</p>

<p>
There are some possibilities to grant access to the router (or to any PC/Server):
</p>
<ol>
<li class="level1"><div class="li"> ask for nothing: anybody who can establish a connection gets access</div>
</li>
<li class="level1"><div class="li"> ask for username and password on an unsecured connection (e.g. telnet)</div>
</li>
<li class="level1"><div class="li"> ask for username and password on an encrypted connection (e.g. <abbr title="Secure Shell">SSH</abbr>) (e.g. by following <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">walkthrough_login</a>)</div>
</li>
<li class="level1"><div class="li"> ask for username and merely a <strong><code>signature</code></strong> instead of a <strong><code>password</code></strong> (e.g. <abbr title="Secure Shell">SSH</abbr> with <a href="/docs/guide-user/security/dropbear.public-key.auth" class="wikilink1" title="docs:guide-user:security:dropbear.public-key.auth" data-wiki-id="docs:guide-user:security:dropbear.public-key.auth">dropbear.public-key.auth</a>)</div>
</li>
</ol>

<p>
If you ask for username/password, an attacker has to guess the combination.
If you use an unencrypted connection, they could eavesdrop on you and obtain your credentials.
</p>

<p>
If you use an encrypted connection, any eavesdropper would have to decrypt the packets first.
This is always possible.
How long it takes to decrypt the content, depends on the algorithm and key length you used.
</p>

<p>
Also, as long as an attacker has network access to the console, they can always run a brute-force attack to find out your username and password.
They does not have to do that themself: they can let their computer(s) do the guessing.
To render this option improbable or even impossible you can:
</p>
<ol>
<li class="level1 node"><div class="li"> not offer access from the Internet at all, or restrict it to certain <abbr title="Internet Protocol">IP</abbr> addresses or <abbr title="Internet Protocol">IP</abbr> address ranges</div>
<ol>
<li class="level2"><div class="li"> by letting the <abbr title="Secure Shell">SSH</abbr> server <a href="/docs/guide-user/base-system/dropbear" class="wikilink1" title="docs:guide-user:base-system:dropbear" data-wiki-id="docs:guide-user:base-system:dropbear">Dropbear</a> and the web server <a href="/docs/guide-user/services/webserver/uhttpd" class="wikilink1" title="docs:guide-user:services:webserver:uhttpd" data-wiki-id="docs:guide-user:services:webserver:uhttpd">uHTTPd</a> not listen on the external/<abbr title="Wide Area Network">WAN</abbr> port</div>
</li>
<li class="level2"><div class="li"> by blocking incoming connections to those ports (<abbr title="Transmission Control Protocol">TCP</abbr> 22, 80 and 443 by default) in your firewall</div>
</li>
</ol>
</li>
<li class="level1 node"><div class="li"> make it more difficult to guess:</div>
<ol>
<li class="level2"><div class="li"> don&#039;t use the username <code>root</code></div>
</li>
<li class="level2"><div class="li"> don&#039;t use a weak password with 8 or less characters</div>
</li>
<li class="level2"><div class="li"> don&#039;t let the <abbr title="Secure Shell">SSH</abbr> server Dropbear listen on the default port (22)</div>
</li>
</ol>
</li>
<li class="level1 node"><div class="li"> use the combination of</div>
<ol>
<li class="level2"><div class="li"> set up <a href="/docs/guide-user/security/dropbear.public-key.auth" class="wikilink1" title="docs:guide-user:security:dropbear.public-key.auth" data-wiki-id="docs:guide-user:security:dropbear.public-key.auth">Dropbear key-based authentication</a></div>
</li>
<li class="level2"><div class="li"> username different than <code>root</code></div>
</li>
<li class="level2"><div class="li"> tell Dropbear to listen on a random port (should be &gt;1024): System → Administration → Dropbear Instance → Port<a href="/_detail/media/doc/howtos/secure-access-02-ssh-port.png?id=docs%3Aguide-user%3Asecurity%3Asecure.access" class="media" title="media:doc:howtos:secure-access-02-ssh-port.png"><img src="/_media/media/doc/howtos/secure-access-02-ssh-port.png" class="mediacenter" loading="lazy" title="SSH Port" alt="SSH Port" /></a></div>
</li>
</ol>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Secure access to your router&quot;,&quot;hid&quot;:&quot;secure_access_to_your_router&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-2277&quot;} -->
<h2 class="sectionedit2" id="system_hardening">System hardening</h2>
<div class="level2">

<p>
If you have an external disk you may want to <a href="/docs/guide-user/storage/disk.encryption" class="wikilink1" title="docs:guide-user:storage:disk.encryption" data-wiki-id="docs:guide-user:storage:disk.encryption">encrypt it</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;System hardening&quot;,&quot;hid&quot;:&quot;system_hardening&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;2278-2408&quot;} -->
<h2 class="sectionedit3" id="network_hardening">Network hardening</h2>
<div class="level2">
<ol>
<li class="level1 node"><div class="li">  <a href="https://www.cipherdyne.org/fwknop/" class="urlextern" title="https://www.cipherdyne.org/fwknop/" rel="ugc nofollow">Fwknop</a> (FireWall KNock OPerator) implements an authorization scheme called <a href="https://en.wikipedia.org/wiki/Single Packet Authorization" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Single Packet Authorization">Single Packet Authorization</a> (SPA) alongwith <a href="https://secure.wphackedhelp.com/blog/wordpress-two-factor-authentication/" class="urlextern" title="https://secure.wphackedhelp.com/blog/wordpress-two-factor-authentication/" rel="ugc nofollow">setting up two factor authentication</a>. This method of authorization is based around a default-drop packet filter and libpcap. SPA is essentially next generation port knocking. For example: it can open the port for <abbr title="Secure Shell">SSH</abbr> on <abbr title="Wide Area Network">WAN</abbr>, but just for a short period of time, until you can establish a new connection through that port.</div>
<ul>
<li class="level2"><div class="li"> See detailed instructions at: <a href="/docs/guide-user/services/fwknop" class="wikilink1" title="docs:guide-user:services:fwknop" data-wiki-id="docs:guide-user:services:fwknop">Fwknop</a> <br/>
<br/>
</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li">  <a href="http://ingles.homeunix.net/software/ost/index.html" class="urlextern" title="http://ingles.homeunix.net/software/ost/index.html" rel="ugc nofollow">Ostiary</a>, like port knocking, adds an additional layer of security. It can be used to simply initiate a script or task remotely (without needing <abbr title="Secure Shell">SSH</abbr> access). See detailed instructions for configuring Server or Client by going to the corresponding links below.</div>
<ul>
<li class="level2"><div class="li"> <a href="/docs/guide-user/services/remote_control/ostiary.server" class="wikilink1" title="docs:guide-user:services:remote_control:ostiary.server" data-wiki-id="docs:guide-user:services:remote_control:ostiary.server">Ostiary Server</a></div>
</li>
<li class="level2"><div class="li"> <a href="/docs/guide-user/services/remote_control/ostiary.client" class="wikilink1" title="docs:guide-user:services:remote_control:ostiary.client" data-wiki-id="docs:guide-user:services:remote_control:ostiary.client">Ostiary Client</a> <br/>
<br/>
</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li">  To protect open ports against brute force attack, the attacker ip address can be banned via iptables configuration:</div>
<ul>
<li class="level2"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?id=7493" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=7493" rel="ugc nofollow">forum thread 7493</a></div>
</li>
<li class="level2"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?id=27103" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=27103" rel="ugc nofollow">forum thread 27103</a> <br/>
<br/>
</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Dependent on you situation you may want to employ an <a href="https://en.wikipedia.org/wiki/Intrusion prevention system" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Intrusion prevention system">Intrusion prevention system</a> like <a href="https://en.wikipedia.org/wiki/fail2ban" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/fail2ban">fail2ban</a> or better yet implement your own one based on <code>logtrigger</code>.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Network hardening&quot;,&quot;hid&quot;:&quot;network_hardening&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;2409-4036&quot;} -->
<h2 class="sectionedit4" id="protecting_web_interface">Protecting web interface</h2>
<div class="level2">

<p>
For secure web access, OpenWrt can be accessed via <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr> (<abbr title="Transport Layer Security">TLS</abbr>) instead of the unencrypted <abbr title="Hypertext Transfer Protocol">HTTP</abbr> protocol.
If <abbr title="Hypertext Transfer Protocol">HTTP</abbr> is not secure enough for you, you can disable the existing (unencrypted) web access and either
</p>
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/luci/luci.secure" class="wikilink1" title="docs:guide-user:luci:luci.secure" data-wiki-id="docs:guide-user:luci:luci.secure">Tunnel your connection via SSH</a></div>
</li>
<li class="level1 node"><div class="li"> Follow <a href="/docs/guide-user/luci/luci.essentials#providing_encryption" class="wikilink1" title="docs:guide-user:luci:luci.essentials" data-wiki-id="docs:guide-user:luci:luci.essentials">Providing encryption</a> to set up <abbr title="Secure Socket Layer">SSL</abbr> protected access</div>
<ol>
<li class="level2"><div class="li"> While luci-ssl automatically installs px5g that can be utilized, you can also use openssl to generate your own certificate authority and certs, then use that certificate authority to sign the certificate you use for uhttpd. Certificates can also be named or placed in whatever directory you wish by editing <strong>/etc/config/uhttpd</strong></div>
</li>
<li class="level2"><div class="li"> Optionally instruct the server to not listen on plain <abbr title="Hypertext Transfer Protocol">HTTP</abbr> anymore:<br/>
<pre class="code bash">uci <span class="re5">-q</span> delete uhttpd.main.listen_http
uci commit uhttpd
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd restart</pre>

<p>
 <strong>OR</strong> Rebind to <abbr title="Local Area Network">LAN</abbr> only and redirect all http requests to https:<br/>

</p>
<pre class="code bash">uci <span class="kw1">set</span> uhttpd.main.listen_http=<span class="st0">&quot;192.168.1.1:80&quot;</span>
uci <span class="kw1">set</span> uhttpd.main.listen_https=<span class="st0">&quot;192.168.1.1:443&quot;</span>
uci <span class="kw1">set</span> uhttpd.main.redirect_https=<span class="st0">&quot;1&quot;</span>
uci commit
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd restart</pre>
</div>
</li>
</ol>
</li>
</ul>

<p>
Can mandatory client certificate checking be set up with uhttpd? → <a href="http://lists.infradead.org/pipermail/lede-dev/2017-August/008692.html" class="urlextern" title="http://lists.infradead.org/pipermail/lede-dev/2017-August/008692.html" rel="ugc nofollow">not possible with uhttpd</a>
</p>

<p>
If you require remote <abbr title="Secure Shell">SSH</abbr> access, follow the hardening instructions on <abbr title="Secure Shell">SSH</abbr> mentioned above.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protecting web interface&quot;,&quot;hid&quot;:&quot;protecting_web_interface&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;4037-5520&quot;} -->
<h2 class="sectionedit5" id="protecting_ppp_credentials">Protecting PPP credentials</h2>
<div class="level2">

<p>
When using PPP, protect its credentials from unprivileged users.
</p>
<pre class="code bash"><span class="re2">PPP_IF</span>=<span class="st0">&quot;wan&quot;</span>
<span class="re2">PPP_USER</span>=<span class="st0">&quot;<span class="es4">$(uci -q get network.${PPP_IF}.username)</span>&quot;</span>
<span class="re2">PPP_PASS</span>=<span class="st0">&quot;<span class="es4">$(uci -q get network.${PPP_IF}.password)</span>&quot;</span>
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> EOF <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>options
user <span class="co1">${PPP_USER}</span>
EOF
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> EOF <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>chap-secrets
<span class="co1">${PPP_USER}</span> <span class="sy0">*</span> <span class="co1">${PPP_PASS}</span>
EOF
<span class="kw2">ln</span> <span class="re5">-f</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>chap-secrets <span class="sy0">/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>pap-secrets
<span class="kw2">chmod</span> <span class="re2">go</span>= <span class="sy0">/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>chap-secrets
uci <span class="re5">-q</span> delete network.<span class="co1">${PPP_IF}</span>.username
uci <span class="re5">-q</span> delete network.<span class="co1">${PPP_IF}</span>.password
uci commit network
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protecting PPP credentials&quot;,&quot;hid&quot;:&quot;protecting_ppp_credentials&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;5521-&quot;} -->