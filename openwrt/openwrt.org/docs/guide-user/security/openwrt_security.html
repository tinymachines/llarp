
<h1 class="sectionedit1" id="openwrt_security_hardening">OpenWrt security hardening</h1>
<div class="level1">

<p>
Good news, OpenWrt is secure on the <abbr title="Wide Area Network">WAN</abbr>/Internet side by default, such that no unsolicited traffic is allowed in by the <a href="/docs/guide-user/firewall/overview" class="wikilink1" title="docs:guide-user:firewall:overview" data-wiki-id="docs:guide-user:firewall:overview">firewall</a>. If you are inexperienced in Linux hardening, firewalls, and web security, there is little need to worry, inexperienced muggles may begin using it right away.
</p>

<p>
This page contains some best practices for security with OpenWrt and what you should do to keep your router in a properly secured state.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenWrt security hardening&quot;,&quot;hid&quot;:&quot;openwrt_security_hardening&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-507&quot;} -->
<h2 class="sectionedit2" id="setting_the_root_password">Setting the root password</h2>
<div class="level2">

<p>
First thing you should do is set your root password. Using LuCI:
</p>
<ol>
<li class="level1"><div class="li"> Navigate to LuCI → System → Administration page</div>
</li>
<li class="level1"><div class="li"> Enter the new password in the Router Password section</div>
</li>
<li class="level1"><div class="li"> Click <strong>Save &amp; Apply</strong></div>
</li>
</ol>

<p>
You can also set the root password using <abbr title="Secure Shell">SSH</abbr>/command-line with <code>passwd</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting the root password&quot;,&quot;hid&quot;:&quot;setting_the_root_password&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;508-827&quot;} -->
<h2 class="sectionedit3" id="a_word_about_high-value_weak_points_on_openwrt">A word about high-value weak points on OpenWrt</h2>
<div class="level2">

<p>
The OpenWrt firewall will drop packets on the <abbr title="Wide Area Network">WAN</abbr> by default, however the <abbr title="Local Area Network">LAN</abbr> side has several common services running, which can mark high-value targets for malware. While uncommon, any harmless looking web site you visit could use cross site request forgery tricks, abusing an unpatched security flaw in one of these services.
This could lead to malicious redirect attacks where a <a href="https://attack.mitre.org/techniques/T1189/" class="urlextern" title="https://attack.mitre.org/techniques/T1189/" rel="ugc nofollow">website redirects to a malware site</a> and so on. Below is a simple list of best practices for security.
</p>

<p>
Common high-value services in particular are:
</p>
<ul>
<li class="level1"><div class="li"> The webserver for LuCI web interface monitoring and configuration</div>
</li>
<li class="level1"><div class="li"> The Dropbear <abbr title="Secure Shell">SSH</abbr> server for command-line access</div>
</li>
<li class="level1"><div class="li"> WiFi access points that are unsecured can be used to gain access to your network</div>
</li>
<li class="level1"><div class="li"> Samba/Ksmbd share to provide user network file shares (only if manually activated, it&#039;s not there by default)</div>
</li>
<li class="level1"><div class="li"> The <abbr title="SSH File Transfer Protocol">SFTP</abbr> daemon for <abbr title="Graphical User Interface">GUI</abbr> file explorer admin access (only if manually activated, it&#039;s not there by default)</div>
</li>
</ul>

<p>
It is your responsibility to counter potential weak points on your OpenWrt device(s):
</p>
<ul>
<li class="level1"><div class="li"> Set a root password, <code>passwd</code> from command-line</div>
</li>
<li class="level1"><div class="li"> Keep your firmware up to date, read more about this in the section down below</div>
</li>
<li class="level1"><div class="li"> For WiFi enable the latest security features in LuCI: Network → Wireless → SSIDs, enable WPA2 and KRACK mitigation, or better yet WPA3 if your hardware supports it </div>
</li>
<li class="level1"><div class="li"> If you installed Samba/Ksmbd or <abbr title="SSH File Transfer Protocol">SFTP</abbr> packages: set a user password for access, and check regularly if there are package updates available and apply them</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;A word about high-value weak points on OpenWrt&quot;,&quot;hid&quot;:&quot;a_word_about_high-value_weak_points_on_openwrt&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;828-2449&quot;} -->
<h2 class="sectionedit4" id="setting_https_for_luci">Setting HTTPS for LuCI</h2>
<div class="level2">

<p>
It is good practice to <a href="/docs/guide-user/luci/luci.essentials#providing_encryption" class="wikilink1" title="docs:guide-user:luci:luci.essentials" data-wiki-id="docs:guide-user:luci:luci.essentials">activate HTTPS</a> encryption for your LuCI web interface. Install the package <code>luci-ssl</code> and tell the web server to redirect to <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr> with the command-line:
</p>
<pre class="code bash">uci <span class="kw1">set</span> uhttpd.main.redirect_https=<span class="nu0">1</span>
uci commit uhttpd <span class="sy0">&amp;&amp;</span> service uhttpd reload</pre>

<p>
Now when connecting to the LuCI web UI it will use <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr>.
</p>

<p>
If you don&#039;t wish to use LuCI web interface at all, you can <a href="/docs/guide-user/luci/luci.secure#more_secure_configuration" class="wikilink1" title="docs:guide-user:luci:luci.secure" data-wiki-id="docs:guide-user:luci:luci.secure">disable the webserver</a> entirely.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting HTTPS for LuCI&quot;,&quot;hid&quot;:&quot;setting_https_for_luci&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2450-3042&quot;} -->
<h2 class="sectionedit5" id="securing_tty_and_serial_console">Securing TTY and serial console</h2>
<div class="level2">

<p>
Enable password prompt for TTY and serial console.
</p>
<pre class="code bash">uci <span class="kw1">set</span> system.<span class="sy0">@</span>system<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.ttylogin=<span class="st0">&quot;1&quot;</span>
uci commit system
service system restart</pre>

<p>
Authentication for OpenWrt TTY and serial console is disabled by default.
Using TTY and serial console requires physical access to the device.
You can reduce the attack surface by enabling authentication.
</p>

<p>
Note that hardware attacks on serial console pins are also possible.
However, it requires physical access, time and skill.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Securing TTY and serial console&quot;,&quot;hid&quot;:&quot;securing_tty_and_serial_console&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;3043-3569&quot;} -->
<h2 class="sectionedit6" id="my_openwrt_web_interface_page_is_always_open_in_the_background_for_ease_of_access">My OpenWrt web interface page is always open in the background for ease of access...</h2>
<div class="level2">

<p>
...and that is a bad idea. Treat your root account with respect.
</p>

<p>
Do what every major company does with the root accounts of their Linux servers:
</p>
<ul>
<li class="level1"><div class="li"> Stay away from admin access (<abbr title="Secure Shell">SSH</abbr> and web interface) when you don&#039;t need it</div>
</li>
<li class="level1"><div class="li"> Log off your root admin sessions once your are done administrating</div>
</li>
<li class="level1"><div class="li"> Only connect as root when really in the need for administration</div>
</li>
<li class="level1"><div class="li"> Never share your root password with others</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;My OpenWrt web interface page is always open in the background for ease of access...&quot;,&quot;hid&quot;:&quot;my_openwrt_web_interface_page_is_always_open_in_the_background_for_ease_of_access&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:6,&quot;range&quot;:&quot;3570-4079&quot;} -->
<h2 class="sectionedit7" id="let_s_just_open_this_one_port_for_incoming_traffic_what_could_possibly_go_wrong">Let&#039;s just open this one port for incoming traffic, what could possibly go wrong?...</h2>
<div class="level2">

<p>
Handle adding firewall rules with care:
</p>
<ul>
<li class="level1"><div class="li"> Do not expose services on the <abbr title="Wide Area Network">WAN</abbr> port if you do not understand the security implications. Automatic scanners and script kids will find any open port on your <abbr title="Wide Area Network">WAN</abbr> side and could then run extensive intrusion software suits on such open ports, probing a lot of attack vectors without any manual effort. The Internet is always being scanned for careless people.</div>
</li>
<li class="level1"><div class="li"> If you want to access home services while being on the road, consider using a WireGuard <abbr title="Virtual Private Network">VPN</abbr> instead of opening service-related ports publicly on the <abbr title="Wide Area Network">WAN</abbr> side.</div>
</li>
<li class="level1"><div class="li"> A lot of online games have “recommended settings” to permanently open port ranges for the best gaming experience. Before blindly following these settings, check first, if any server connection problems are due to a <a href="/docs/guide-user/network/switch_router_gateway_and_nat" class="wikilink1" title="docs:guide-user:network:switch_router_gateway_and_nat" data-wiki-id="docs:guide-user:network:switch_router_gateway_and_nat">double NAT from cascaded routers</a> at your home.</div>
</li>
<li class="level1"><div class="li"> Always use reasonable comments, when you add your own custom firewall rules (e.g. “...that&#039;s the rule that a random nice guy on the Internet asked me to add, promising me some really hot skateboarding penguin pictures in return...”)</div>
</li>
</ul>

<p>
If you have already performed various firewall rule changes and are now concerned about your custom rules, you can always reset all your OpenWrt settings back to the to the initial default with the <code>firstboot &amp;&amp; reboot</code> command.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Let&#039;s just open this one port for incoming traffic, what could possibly go wrong?...&quot;,&quot;hid&quot;:&quot;let_s_just_open_this_one_port_for_incoming_traffic_what_could_possibly_go_wrong&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:7,&quot;range&quot;:&quot;4080-5535&quot;} -->
<h2 class="sectionedit8" id="so_i_ve_switched_from_insecure_vendor_firmware_to_openwrt_finally_i_am_safe">So I&#039;ve switched from insecure vendor firmware to OpenWrt. Finally, I am safe...</h2>
<div class="level2">

<p>
Initially yes, but not so fast... Did you notice that even OpenWrt firmware gets updated periodically?
</p>

<p>
As with your former vendor/OEM firmware, you should check regularly if OpenWrt has a new firmware release and apply this to your device. The good news with OpenWrt is that popular devices are often updated for many, many years. There is even a configuration backup and restore feature so you do not have to start from scratch after each update. Update your firmware via:
</p>
<ul>
<li class="level1"><div class="li"> For manually installing updates, download the latest sysupgrade builds from <a href="https://firmware-selector.openwrt.org/" class="urlextern" title="https://firmware-selector.openwrt.org/" rel="ugc nofollow">Firmware Selector</a> </div>
</li>
<li class="level1"><div class="li"> For an assisted process from <abbr title="Secure Shell">SSH</abbr>/command-line, install and use <code>owut</code></div>
</li>
<li class="level1"><div class="li"> For an assisted process from LuCI webUI, install and use <code>luci-app-attendedsysupgrade</code></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;So I&#039;ve switched from insecure vendor firmware to OpenWrt. Finally, I am safe...&quot;,&quot;hid&quot;:&quot;so_i_ve_switched_from_insecure_vendor_firmware_to_openwrt_finally_i_am_safe&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:8,&quot;range&quot;:&quot;5536-6416&quot;} -->
<h2 class="sectionedit9" id="dive_into_the_deep_end_with_selinux">Dive into the deep end with SELinux</h2>
<div class="level2">

<p>
OpenWrt supports Security-Enhanced Linux (SELinux) <a href="/docs/guide-developer/selinux_policy_development" class="wikilink1" title="docs:guide-developer:selinux_policy_development" data-wiki-id="docs:guide-developer:selinux_policy_development">selinux_policy_development</a>. This is a Linux security module that provides support for access control policies including mandatory access controls (MAC) and could be useful for advanced users with complex network setups.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dive into the deep end with SELinux&quot;,&quot;hid&quot;:&quot;dive_into_the_deep_end_with_selinux&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:9,&quot;range&quot;:&quot;6417-6762&quot;} -->
<h2 class="sectionedit10" id="i_have_extra_packages_installed">I have extra packages installed...</h2>
<div class="level2">

<p>
 <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This section is only recommended if you know there is a fix you need, otherwise do not use this as this could potentially break some functionality, wait for a firmware update to update packages.
</p>

<p>
As with the firmware you may also keep an eye on extra packages you installed.
</p>

<p>
If you are using custom packages, you can run a <code>opkg update; opkg list-upgradable</code> from time to time.
This shows your installed packages that have available updates.
You then install package upgrades manually by running <code>opkg upgrade &lt;package&gt;</code>.
Not every listed package upgrade is due to security issues, it can also be a harmless bug fix or feature extension.
Note that soon <code>opkg</code> packaging system will be replaced with <code>apk</code>.
</p>

<p>
An update will continue to use your existing configuration, but for critical OpenWrt environments, a manual config backup never hurts as precaution before upgrading packages. By default OpenWrt uses squashfs, a read-only root filesystem, plus a differential extension partition for all package installs and upgrades. When wanting to maximize usage of your precious flash space, it tends to be a better approach to applying firmware updates and then reinstalling your packages, instead of only upgrading packages.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;I have extra packages installed...&quot;,&quot;hid&quot;:&quot;i_have_extra_packages_installed&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;6763-&quot;} -->