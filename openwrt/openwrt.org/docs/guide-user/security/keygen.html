
<h1 class="sectionedit1" id="key_generation">Key Generation</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Key Generation&quot;,&quot;hid&quot;:&quot;key_generation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-30&quot;} -->
<h2 class="sectionedit2" id="generate_gpg_signing_key_pair">Generate GPG signing key pair</h2>
<div class="level2">

<p>
The guide will explain how to generate a new key pair, how to create a signing sub key and how to strip the secret master key to avoid leaking your primary secret key identity in case your signing key (or the entire <code>~/.gnupg/</code>) ever gets lost.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Generate GPG signing key pair&quot;,&quot;hid&quot;:&quot;generate_gpg_signing_key_pair&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;31-325&quot;} -->
<h3 class="sectionedit3" id="generate_new_fresh_key_pair_on_a_secure_machine">1) Generate new, fresh key pair on a secure machine</h3>
<div class="level3">
<pre class="code">$ mkdir /tmp/signing 
$ chmod 0700 /tmp/signing 
$ gpg --homedir /tmp/signing --gen-key 
gpg (GnuPG) 1.4.18; Copyright © 2014 Free Software Foundation, Inc. 
This is free software: you are free to change and redistribute it. 
There is NO WARRANTY, to the extent permitted by law.

gpg: keyring ‘/tmp/signing/secring.gpg’ created 
gpg: keyring ‘/tmp/signing/pubring.gpg’ created</pre>
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Pick 4 to generate an RSA-only key and choose a key size of 4096 bits. For this how-to I choose to set no expiry at all.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;792-918&quot;} --><pre class="code">Please select what kind of key you want: 
  (1) RSA and RSA (default) 
  (2) DSA and Elgamal 
  (3) DSA (sign only) 
  (4) RSA (sign only)
Your selection? 4 
RSA keys may be between 1024 and 4096 bits long. 
What keysize do you want? (2048) 4096 
Requested keysize is 4096 bits 
Please specify how long the key should be valid. 
     0 = key does not expire 
   &lt;n&gt; = key expires in n days 
  &lt;n&gt;w = key expires in n weeks 
  &lt;n&gt;m = key expires in n months 
  &lt;n&gt;y = key expires in n years 
Key is valid for? (0) 
Key does not expire at all 
Is this correct? (y/N) y</pre>
<div class="table sectionedit5"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">GPG will ask about your user identity now, provide your real name and the mail address you intend to use for your project communication. I also suggest to provide a meaningful comment, eg. “LEDE Signing Key”</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;1503-1716&quot;} --><pre class="code">You need a user ID to identify your key; the software constructs the user ID from the Real Name, Comment and Email Address in this form: 
    &quot;Heinrich Heine (Der Dichter) &lt;&lt;heinrichh@duesseldorf.de&gt;&gt;&quot;

Real name: Jo-Philipp Wich 
Email address: &lt;jo@mein.io&gt; 
Comment: LEDE Signing Key 
You selected this USER-ID: 
    &quot;Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;&quot;

Change (N)ame, ©omment, (E)mail or (O)kay/(Q)uit? O 
You need a Passphrase to protect your secret key.</pre>
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">At this point enter a good pass phrase twice to protect your secret key, the command will take a while to gather entropy and complete key until it’ll eventually print the key summary:</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;2210-2401&quot;} --><pre class="code">gpg: /tmp/signing/trustdb.gpg: trustdb created 
gpg: key 612A0E98 marked as ultimately trusted public and secret key created and signed.

gpg: checking the trustdb 
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model 
gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u 
pub   4096R/612A0E98 2016-04-05 
      Key fingerprint = 69B2 6A27 62D0 65E6 6F59 6755 C76F DE50 612A 0E98 
uid   Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;

Note that this key cannot be used for encryption. You may want to use 
the command &quot;--edit-key&quot; to generate a subkey for this purpose.</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1) Generate new, fresh key pair on a secure machine&quot;,&quot;hid&quot;:&quot;generate_new_fresh_key_pair_on_a_secure_machine&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;326-3013&quot;} -->
<h3 class="sectionedit7" id="generate_a_sub_key">2) Generate a sub key</h3>
<div class="level3">
<pre class="code">$ gpg --homedir /tmp/signing --edit-key &lt;jo@mein.io&gt; 
gpg (GnuPG) 1.4.18; Copyright © 2014 Free Software Foundation, Inc. 
This is free software: you are free to change and redistribute it. 
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

pub 4096R/612A0E98 created: 2016-04-05 expires: never usage: SC 
                   trust: ultimate validity: ultimate 
[ultimate] (1). Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;</pre>
<div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">In the now appearing interactive gpg prompt enter “addkey” to create a new signing subkey. GnuPG will ask your to unlock the master key using the passphrase you’ve given in the previous step.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;3522-3721&quot;} --><pre class="code">gpg&gt; addkey 
Key is protected.

You need a passphrase to unlock the secret key for 
user: &quot;Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;&quot; 
4096-bit RSA key, ID 612A0E98, created 2016-04-05

Please select what kind of key you want: 
    (3) DSA (sign only) 
    (4) RSA (sign only) 
    (5) Elgamal (encrypt only) 
    (6) RSA (encrypt only)</pre>
<div class="table sectionedit9"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">We’ll use a signing-only 4096bit RSA key with an validity of two years</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;4084-4162&quot;} --><pre class="code">Your selection? 4 
RSA keys may be between 1024 and 4096 bits long. 
What keysize do you want? (2048) 4096 
Requested keysize is 4096 bits Please specify how long the key should be valid. 
        0 = key does not expire 
      &lt;n&gt; = key expires in n days 
     &lt;n&gt;w = key expires in n weeks 
     &lt;n&gt;m = key expires in n months 
     &lt;n&gt;y = key expires in n years 
Key is valid for? (0) 730 
Key expires at Thu Apr 5 18:19:42 2018 CEST 
Is this correct? (y/N) y 
Really create? (y/N) y</pre>
<div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">At this point, GnuPG will start gathering entropy again, running an “find /” in the background is a good way to speed it up. When done it will print the sub key summary and return to the prompt. Note the ID “1584F206” of the subkey, we’ll need that in step 4.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;4667-4934&quot;} --><pre class="code">pub 4096R/612A0E98 created: 2016-04-05 expires: never usage: SC 
                   trust: ultimate validity: ultimate 
sub 4096R/1584F206 created: 2016-04-05 expires: 2018-04-05 usage: S 
[ultimate] (1). Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;</pre>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Enter “save” to commit the new key pair and its sub key to disk, the GnuPG will automatically exit to the shell.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;5207-5325&quot;} --><pre class="code">gpg&gt; save</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2) Generate a sub key&quot;,&quot;hid&quot;:&quot;generate_a_sub_key&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:7,&quot;range&quot;:&quot;3014-5352&quot;} -->
<h3 class="sectionedit12" id="put_the_key_into_a_vault">3) Put the key into a vault</h3>
<div class="level3">

<p>
At this point it is a good idea to make a <strong>reliable and secure</strong> backup of the <code>/tmp/signing/</code> directory, I suggest burning it onto a CDROM or copying it onto a thumb drive which you can safely lock away or hide in your apartment :)
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3) Put the key into a vault&quot;,&quot;hid&quot;:&quot;put_the_key_into_a_vault&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:12,&quot;range&quot;:&quot;5353-5632&quot;} -->
<h3 class="sectionedit13" id="export_the_private_sub_key_only">4) Export the private sub key only</h3>
<div class="level3">

<p>
We’ll now export just the secret sub key since that is all we’ll ever need to sign files. Use the sub key ID from step 2 followed by an exclamation mark to select the sub key to export:
</p>
<pre class="code">$ gpg --homedir /tmp/signing --export-secret-subkeys 1584F206! \ 
    &gt; /tmp/secret-signing-key.pgp 
$ file /tmp/secret-signing-key.pgp 
secret-signing-key.pgp: PGP\011Secret Key - 1024b created on Tue Apr 5 16:08:15 2016 - RSA (Encrypt or Sign)</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;4) Export the private sub key only&quot;,&quot;hid&quot;:&quot;export_the_private_sub_key_only&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:13,&quot;range&quot;:&quot;5633-6131&quot;} -->
<h3 class="sectionedit14" id="import_the_secret_signing_sub_key_into_your_actual_key_store">5) Import the secret signing sub key into your actual key store</h3>
<div class="level3">

<p>
You can now import the secret signing sub key on any machine you’ll use for signing files in the future. To import the sub key file, pass it to <code>gpg --import</code> and leave out the alternative homedir argument:
</p>
<pre class="code">$ gpg --import /tmp/secret-signing-key.pgp 
gpg: key 612A0E98: secret key imported 
gpg: key 612A0E98: public key &quot;Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt;&quot; imported 
gpg: Total number processed: 1 
gpg:               imported: 1 (RSA: 1) 
gpg:       secret keys read: 1 
gpg:   secret keys imported: 1</pre>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">You can now issue a “gpg -K” to list all secret keys in your key store, you should see the key you’ve imported with a leading “sec#”. The hash mark here indicates that the secret master key is missing, which is what we want.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table7&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;6751-6983&quot;} --><pre class="code">$ gpg -K 
/home/jow/.gnupg/secring.gpg
----------------------------
[...]
sec# 4096R/612A0E98 2016-04-05 
uid                 Jo-Philipp Wich (LEDE Signing Key) &lt;&lt;jo@mein.io&gt;&gt; 
ssb  4096R/1584F206 2016-04-05</pre>
<div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">It is time to upload your public key part to a key server now so that others can easily fetch it by its fingerprint or your chosen mail address later on. For uploading use the primary key ID printed after the “sec#” word in the previous command.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table8&quot;,&quot;secid&quot;:16,&quot;range&quot;:&quot;7209-7460&quot;} --><pre class="code">$ gpg --keyserver hkp:%%//%%pool.sks-keyservers.net --send-keys 612A0E98 
gpg: sending key 612A0E98 to hkp server pool.sks-keyservers.net</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;5) Import the secret signing sub key into your actual key store&quot;,&quot;hid&quot;:&quot;import_the_secret_signing_sub_key_into_your_actual_key_store&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:14,&quot;range&quot;:&quot;6132-7614&quot;} -->
<h3 class="sectionedit17" id="delete_original">6) Delete original</h3>
<div class="level3">

<p>
Make sure once again that your backup of the <code>/tmp/signing</code> directory is complete and readable, then remove the secret sub key file and the entire temporary signing directory:
</p>
<pre class="code">$ rm -r /tmp/signing/ 
$ rm /tmp/secret-signing-key.pgp</pre>
<div class="table sectionedit18"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">You’re now done setting up a suitable signing key pair.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table9&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;7900-7963&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;6) Delete original&quot;,&quot;hid&quot;:&quot;delete_original&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:17,&quot;range&quot;:&quot;7615-7964&quot;} -->
<h3 class="sectionedit19" id="finish">7) Finish</h3>
<div class="level3">

<p>
To export your public key in <abbr title="American Standard Code for Information Interchange">ASCII</abbr> format use the following command, again with the primary ID you’ve already used for uploading the pubkey.
</p>

<p>
Make sure to provide a meaningful comment so that people looking at the key file know who it belongs to without having to inspect it using GPG utilities:
</p>
<pre class="code">$ gpg --armor --export --no-version \ 
        --comment=&quot;Public key of Jo-Philipp Wich&quot; 612A0E98</pre>

<p>
In order to sign a file with your signing sub key, use the command below:
</p>
<pre class="code">$ gpg --no-version -a -b -u 612A0E98 \ 
        --comment=&quot;My signature for something&quot; -o output.sig input.file</pre>
<div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Use your key ID as filename when adding your public signing key to the repository:</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table10&quot;,&quot;secid&quot;:20,&quot;range&quot;:&quot;8602-8690&quot;} --><pre class="code">$ cd keyring/gpg/ 
$ gpg --armor --export --no-version \ 
  --comment=&quot;Public key of Me Myself&quot; 612A0E98 &gt; 612A0E98.asc 
$ git add 612A0E98.asc 
$ git commit -sm &quot;Add my public key&quot; 
$ git push origin master</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;7) Finish&quot;,&quot;hid&quot;:&quot;finish&quot;,&quot;codeblockOffset&quot;:14,&quot;secid&quot;:19,&quot;range&quot;:&quot;7965-8915&quot;} -->
<h2 class="sectionedit21" id="generate_usign_key_pair">Generate usign key pair</h2>
<div class="level2">

<p>
<code>usign</code> is a tiny <a href="https://www.openbsd.org/papers/bsdcan-signify.html" class="urlextern" title="https://www.openbsd.org/papers/bsdcan-signify.html" rel="ugc nofollow">OpenBSD signify</a> replacement. Clone In order to generate an <em>usign</em> key pair for use in OpenWrt release and package repositories, follow the steps below.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Generate usign key pair&quot;,&quot;hid&quot;:&quot;generate_usign_key_pair&quot;,&quot;codeblockOffset&quot;:17,&quot;secid&quot;:21,&quot;range&quot;:&quot;8916-9183&quot;} -->
<h3 class="sectionedit22" id="obtain_usign">1) Obtain usign</h3>
<div class="level3">

<p>
Clone the <em>usign</em> repository and compile it. Note that the compilation requires an installed <code>cmake</code> to succeed.
</p>
<pre class="code">$ git clone https://git.openwrt.org/project/usign.git 
$ cd usign/ 
$ cmake . 
$ make</pre>
<div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Run <code>./usign</code> to check that the binary works.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table11&quot;,&quot;secid&quot;:23,&quot;range&quot;:&quot;9435-9492&quot;} --><pre class="code">$ ./usign Usage: ./usign &lt;command&gt; &lt;options&gt; 
Commands: 
  -V:             verify (needs at least -m and -p|-P) 
  -S:             sign (needs at least -m and -s) 
  -F:             print key fingerprint of public/secret key or signature 
  -G:             generate a new keypair 
Options: 
  -c &lt;comment&gt;:   add comment to keys 
  -m &lt;file&gt;:      message file 
  -p &lt;file&gt;:      public key file (verify/fingerprint only) 
  -P &lt;path&gt;:      public key directory (verify only) 
  -q:             quiet (do not print verification result, use return code only) 
  -s &lt;file&gt;:      secret key file (sign/fingerprint only) 
  -x &lt;file&gt;:      signature file (defaults to &lt;message file&gt;.sig)</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1) Obtain usign&quot;,&quot;hid&quot;:&quot;obtain_usign&quot;,&quot;codeblockOffset&quot;:17,&quot;secid&quot;:22,&quot;range&quot;:&quot;9184-10193&quot;} -->
<h3 class="sectionedit24" id="generate_key_pair">2) Generate key pair</h3>
<div class="level3">

<p>
Instruct the <code>usign</code> executable to generate a new key pair and provide a suitable comment to be able to identify the key file later on.
</p>
<pre class="code">./usign -G -c &quot;LEDE usign key of Jo-Philipp Wich&quot; \
  -s secret.key -p public.key</pre>
<div class="table sectionedit25"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Store the <code>secret.key</code> file in a <strong>secure and reliable</strong> location, you’ll need it to sign package repositories in the future.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table12&quot;,&quot;secid&quot;:25,&quot;range&quot;:&quot;10467-10606&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2) Generate key pair&quot;,&quot;hid&quot;:&quot;generate_key_pair&quot;,&quot;codeblockOffset&quot;:19,&quot;secid&quot;:24,&quot;range&quot;:&quot;10194-10607&quot;} -->
<h3 class="sectionedit26" id="add_public_key_to_the_repository">3) Add public key to the repository</h3>
<div class="level3">

<p>
Obtain the fingerprint of your public key with the <code>usign -F</code> command and use it as filename for storing the pubkey in the <code>keyring.git</code> repository:
</p>
<pre class="code">$ ./usign -F -p public.key 
72a57f2191b211e0</pre>
<div class="table sectionedit27"><table class="inline">
	<tr class="row0">
		<td class="col0">Tip</td><td class="col1">Add the key to Git, using the fingerprint as filename:</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table13&quot;,&quot;secid&quot;:27,&quot;range&quot;:&quot;10878-10938&quot;} --><pre class="code">$ cd keyring/usign/ 
$ cp /some/where/public.key 72a57f2191b211e0 
$ git add 72a57f2191b211e0 
$ git commit -sm &quot;Add my public usign key&quot; 
$ git push origin master</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3) Add public key to the repository&quot;,&quot;hid&quot;:&quot;add_public_key_to_the_repository&quot;,&quot;codeblockOffset&quot;:20,&quot;secid&quot;:26,&quot;range&quot;:&quot;10608-&quot;} -->