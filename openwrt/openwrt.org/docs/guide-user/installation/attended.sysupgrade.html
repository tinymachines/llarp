
<h1 class="sectionedit1" id="upgrade_using_attended_sysupgrade">Upgrade using Attended Sysupgrade</h1>
<div class="level1">

<p>
The Attended SysUpgrade (ASU) facility allows an OpenWrt device to update to
new firmware while preserving the packages and settings.
This dramatically simplifies the upgrade process: just a couple clicks and
a short wait lets you retrieve and install a new image built with all your previous packages.
</p>

<p>
ASU eliminates the need to make a list of packages you installed manually,
or fuss with opkg just to upgrade your firmware.
</p>

<p>
Because it is initiated by a person who waits until it&#039;s complete,
it&#039;s called “attended” sysupgrade.
You can see Attended Sysupgrade in action in a video from OneMarcFifty
at: <a href="https://www.youtube.com/watch?v=FFTPA6GkJjg&amp;t=1034s" class="urlextern" title="https://www.youtube.com/watch?v=FFTPA6GkJjg&amp;t=1034s" rel="ugc nofollow">https://www.youtube.com/watch?v=FFTPA6GkJjg&amp;t=1034s</a>
</p>

<p>
There is both a LuCI (web page interface) and command-line package for Attended Sysupgrade.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Upgrade using Attended Sysupgrade&quot;,&quot;hid&quot;:&quot;upgrade_using_attended_sysupgrade&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-804&quot;} -->
<h2 class="sectionedit2" id="from_luci_web_page">From LuCI web page</h2>
<div class="level2">

<p>
The <a href="/packages/pkgdata/luci-app-attendedsysupgrade" class="wikilink1" title="packages:pkgdata:luci-app-attendedsysupgrade" data-wiki-id="packages:pkgdata:luci-app-attendedsysupgrade">luci-app-attendedsysupgrade</a>
package provides a page in the router&#039;s web interface.
It requests a new firmware image built with the current set of packages,
waits until it&#039;s ready, then downloads and flashes the image.
If “Keep Configuration” is checked in the <abbr title="Graphical User Interface">GUI</abbr>, the device preserves all the settings.
</p>

<p>
To install <code>luci-app-attendedsysupgrade</code>, go to <strong>System → Software</strong>,
update the package list, and search for <em>luci-app-attendedsysupgrade</em>.
Install it in the usual manner. 
</p>

<p>
To upgrade your firmware:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Make a backup!</strong> Go to <strong>System → Backup/Flash firmware</strong>. Click <strong>Generate archive</strong> <em>(Just do it. Every time...)</em></div>
</li>
<li class="level1"><div class="li"> Go to <strong>System → Attended Sysupgrade</strong>. You&#039;ll see the main Attended Sysupgrade window</div>
</li>
<li class="level1"><div class="li"> Click <strong>Search for sysupgrade</strong> You will see choices for the firmware version that are available. </div>
</li>
<li class="level1"><div class="li"> Select the desired version from the dropdown, and click <strong>Request Sysupgrade</strong></div>
</li>
<li class="level1"><div class="li"> There may be a wait as the server builds a custom image that includes all the packages that are currently installed.</div>
</li>
<li class="level1 node"><div class="li"> When that completes, you will see a window describing the new firmware: </div>
<ul>
<li class="level2"><div class="li"> If you wish to keep settings, check the box. Otherwise, settings will be erased and set to factory default.</div>
</li>
<li class="level2"><div class="li"> Click <strong>Install Sysupgrade</strong> and the router will download the new image, flash it, and reboot.</div>
</li>
<li class="level2"><div class="li"> You&#039;ll be running the new firmware, with all your packages and settings intact.</div>
</li>
</ul>
</li>
</ul>

<p>
<a href="/_detail/media/doc/asu-main.png?id=docs%3Aguide-user%3Ainstallation%3Aattended.sysupgrade" class="media" title="media:doc:asu-main.png"><img src="/_media/media/doc/asu-main.png?w=400&amp;tok=a7a7d2" class="media" loading="lazy" title="  " alt="  " width="400" /></a> This is the main window. Click <strong>Search for sysupgrade</strong>
</p>

<p>
<a href="/_detail/media/doc/asu-upgrade-choice.png?id=docs%3Aguide-user%3Ainstallation%3Aattended.sysupgrade" class="media" title="media:doc:asu-upgrade-choice.png"><img src="/_media/media/doc/asu-upgrade-choice.png?w=400&amp;tok=7ced13" class="media" loading="lazy" title="  " alt="  " width="400" /></a> Choose one of the available releases and click <strong>Request Sysupgrade</strong>
</p>

<p>
<a href="/_detail/media/doc/asu-sysupgrade-ready.png?id=docs%3Aguide-user%3Ainstallation%3Aattended.sysupgrade" class="media" title="media:doc:asu-sysupgrade-ready.png"><img src="/_media/media/doc/asu-sysupgrade-ready.png?w=400&amp;tok=27e976" class="media" loading="lazy" title="  " alt="  " width="400" /></a> Verify the parameters of the newly-generated image,<br/>

choose Keep Settings (or not) and click <strong>Install Sysupgrade</strong>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;From LuCI web page&quot;,&quot;hid&quot;:&quot;from_luci_web_page&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;805-2653&quot;} -->
<h2 class="sectionedit3" id="from_the_cli">From the CLI</h2>
<div class="level2">

<p>
For OpenWrt 24.10 and later, including snapshots, <a href="/docs/guide-user/installation/sysupgrade.owut" class="wikilink1" title="docs:guide-user:installation:sysupgrade.owut" data-wiki-id="docs:guide-user:installation:sysupgrade.owut">owut</a> package performs the same process as the <code>luci-app-attendedsysupgrade</code> package, but is run from <abbr title="Secure Shell">SSH</abbr>/the command line instead of the web <abbr title="Graphical User Interface">GUI</abbr>.
</p>

<p>
If you are using an older version of OpenWrt, 23.05 or before, then the <a href="/packages/pkgdata/auc" class="wikilink1" title="packages:pkgdata:auc" data-wiki-id="packages:pkgdata:auc">auc</a> package is available.  For detail on <code>auc</code>, continue on this page; for more on <code>owut</code>, go to the <a href="/docs/guide-user/installation/sysupgrade.owut" class="wikilink1" title="docs:guide-user:installation:sysupgrade.owut" data-wiki-id="docs:guide-user:installation:sysupgrade.owut">owut page</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;From the CLI&quot;,&quot;hid&quot;:&quot;from_the_cli&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;2654-3187&quot;} -->
<h3 class="sectionedit4" id="auc">auc</h3>
<div class="level3">

<p>
To install the <code>auc</code> package, ssh into the router and enter <code>opkg install auc</code> or
in the web interface, go to <strong>System → Software</strong>, update the package list,
and search for <em>auc</em>. Install it in the usual manner. 
</p>

<p>
To upgrade your device firmware, first <strong>Make A Backup</strong> <em>(see first step above)</em>
Then enter <code>auc</code> on the command line.
The default is to get the next version.
You can specify the following options on the command line.
</p>
<pre class="code">root@openwrt.lan:~# auc --help
auc (0.2.4-8)
auc: Attended sysUpgrade CLI client
Usage: auc [-b &lt;branch&gt;] [-B &lt;ver&gt;] [-c] [-f] [-h] [-r] [-y]
 -b &lt;branch&gt;	use specific release branch
 -B &lt;ver&gt;	use specific release version
 -c		only check if system is up-to-date
 -f		use force
 -h		output help
 -n		dry-run (don&#039;t download or upgrade)
 -r		check only for release upgrades
 -F &lt;fstype&gt;	override filesystem type
 -y		don&#039;t wait for user confirmation

Please report issues to improve the server:
https://github.com/aparcar/asu/issues</pre>

<p>
Here are the details of each option.
</p>
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Default </th><th class="col2"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>-b &lt;branch&gt;</code> </td><td class="col1"> installed branch </td><td class="col2 leftalign"> Search for updates on this specific branch.  The value is a string containing a release branch name, <code>19.07</code> or <code>23.05</code>, or the snapshot branch name, <code>SNAPSHOT</code>.  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>-B &lt;ver&gt;</code>    </td><td class="col1"> newest version on current branch </td><td class="col2"> Search for updates for this specific release version.  Must be on the branch specified with <code>-b</code> or an error will be reported.  If the branch is <code>SNAPSHOT</code>, then the only valid value for <code>-B</code> is again <code>SNAPSHOT</code>, and specifying the value is redundant. </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>-c</code>          </td><td class="col1"> false </td><td class="col2"> Perform all the steps to check if the system is up-to-date, then quit.  If changes are found, then a list of the detected differences is shown, color coded so that you can see if packages are upgrading or downgrading with the target branch and version.<br/>
<br/>
Since this is a completely non-destruction operation, running <code>auc -c</code> is a quick and safe way to see what changes have been released since your last sysupgrade. </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>-f</code>          </td><td class="col1"> false </td><td class="col2"> Force an upgrade, even when there are no changes detected. </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>-n</code>          </td><td class="col1"> false </td><td class="col2"> Perform a dry-run, by actually building the image, but then quit before download and install.  Since the image is never downloaded, this is very much like <code>-c</code> in its local effect, but since it builds the image, you see all the error checking performed by the build server, too. </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <code>-r</code>          </td><td class="col1"> false </td><td class="col2"> Check only for release upgrades.  Like <code>-c</code>, but ignores any package changes.  This is a quick way to see if there is a “dot” release on the branch currently installed. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>-F &lt;fstype&gt;</code> </td><td class="col1"> current installed fstype, usually <code>squashfs</code> </td><td class="col2"> Build the image to override the current filesystem type.  This is an advanced option, which can brick many devices, so use great care.  On generic devices, like <code>x86</code> or <code>armsr</code>, you can switch between <code>squashfs</code> and <code>ext4</code> without issues. </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> <code>-y</code>          </td><td class="col1"> false </td><td class="col2"> Assume &#039;yes&#039; for all the user confirmation prompts and run to completion. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;4232-6267&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;auc&quot;,&quot;hid&quot;:&quot;auc&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;3188-6268&quot;} -->
<h3 class="sectionedit6" id="example_use">Example use</h3>
<div class="level3">

<p>
To use <code>auc</code> to check for new packages, or newer versions of the current branch, simply use the <code>-c</code> option.  This is completely benign, as <code>auc</code> terminates after reporting what it sees without doing anything further.  Using <code>-c</code> to experiment with the other options is a safe way to explore how <code>auc</code> works.
</p>
<pre class="code bash">$ auc <span class="re5">-c</span>
auc<span class="sy0">/</span>0.3.2-<span class="nu0">1</span>
Server:    https:<span class="sy0">//</span>sysupgrade.openwrt.org
Running:   SNAPSHOT r24414-255d5c9bf8 on x86<span class="sy0">/</span><span class="nu0">64</span> <span class="br0">&#40;</span>generic<span class="br0">&#41;</span>
Available: SNAPSHOT r24414-255d5c9bf8
Requesting package lists...
 base-files: <span class="nu0">1548</span>-r24414-255d5c9bf8 -<span class="sy0">&gt;</span> <span class="nu0">1549</span>-r24427-c4fe1bfc65
 dnsmasq-full: <span class="nu0">2.89</span>-<span class="nu0">6</span> -<span class="sy0">&gt;</span> <span class="nu0">2.89</span>-<span class="nu0">7</span></pre>

<p>
By default, <code>auc</code> works on the branch currently installed on your device.  The <code>-b</code> option can be used to change this behavior, so that you can upgrade or downgrade between release branches (like <code>19.07</code> or <code>23.05</code>) or snapshot (where you just literally use <code>snapshot</code> as the value).  The <code>-B</code> option can be used to select a specific version within a branch, such as <code>22.03.1</code> or <code>23.05.0</code>.
</p>

<p>
This example detects that 23.05.2 is installed, and shows information related to downgrading to 22.03.4.
As indicated by the warning, this is probably not a good idea as the jump in versions is “too far”, but you *can* use <code>-B</code> to downgrade within a branch pretty safely.
</p>
<pre class="code bash">$ auc <span class="re5">-c</span> <span class="re5">-b</span> <span class="nu0">22.03</span> <span class="re5">-B</span> 22.03.4
auc<span class="sy0">/</span>0.3.2-<span class="nu0">1</span>
Server:    https:<span class="sy0">//</span>sysupgrade.openwrt.org
Running:   23.05.2 r23630-842932a63d on x86<span class="sy0">/</span><span class="nu0">64</span> <span class="br0">&#40;</span>generic<span class="br0">&#41;</span>
Available: 22.03.4 r20123-38ccc47687
WARNING: Downgrade to older branch may not work <span class="kw2">as</span> expected<span class="sy0">!</span>
Requesting package lists...
 kmod-usb-storage: 5.15.137-<span class="nu0">1</span> -<span class="sy0">&gt;</span> 5.10.176-<span class="nu0">1</span>
 terminfo: <span class="nu0">6.4</span>-<span class="nu0">2</span> -<span class="sy0">&gt;</span> <span class="nu0">6.3</span>-<span class="nu0">2</span>
 openssh-sftp-server: 9.5p1-<span class="nu0">1</span> -<span class="sy0">&gt;</span> 9.3p2-<span class="nu0">1</span>
 libopenssl: 3.0.12-<span class="nu0">1</span> -<span class="sy0">&gt;</span> 1.1.1w-<span class="nu0">1</span>
 luci-app-statistics: git-23.315.63824-5a81162 -<span class="sy0">&gt;</span> git-23.153.53801-38f5b55
...</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Example use&quot;,&quot;hid&quot;:&quot;example_use&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:6,&quot;range&quot;:&quot;6269-8104&quot;} -->
<h2 class="sectionedit7" id="asu_server">ASU Server</h2>
<div class="level2">

<p>
The ASU Server listens for image requests and, if valid, automatically generates them.
It coordinates several OpenWrt ImageBuilders and caches the resulting images in a Redis database.
If an image is cached, the server can provide it immediately without rebuilding.
</p>

<p>
The ASU Server provides an <abbr title="Application Programming Interface">API</abbr> to request custom firmware images with
any selection of packages pre-installed.
This avoids the need to set up a build environment, and makes it possible
to create a custom firmware image even using a mobile device.
</p>
<ul>
<li class="level1"><div class="li"> The current production ASU Server is <code>sysupgrade.openwrt.org</code> It provides released versions, release candidates, and the current nightly snapshot.</div>
</li>
<li class="level1"><div class="li"> There is an development server at <code>asu.aparcar.org</code> that may or may not always be running</div>
</li>
<li class="level1"><div class="li"> <del>chef.libremesh.org</del> is an old server name that currently is a CNAME to asu.aparcar.org</div>
</li>
<li class="level1"><div class="li"> The <a href="https://firmware-selector.openwrt.org/" class="urlextern" title="https://firmware-selector.openwrt.org/" rel="ugc nofollow">OpenWrt Firmware Selector</a> is a client of the ASU server, as are the LuCI web page and <code>auc</code>.</div>
</li>
</ul>

<p>
ASU relies on significant updates over the last several years to the ImageBuilder, primarily by @aparcar.
<a href="https://github.com/openwrt/asu" class="urlextern" title="https://github.com/openwrt/asu" rel="ugc nofollow">Github repo</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ASU Server&quot;,&quot;hid&quot;:&quot;asu_server&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:7,&quot;range&quot;:&quot;8105-9295&quot;} -->
<h3 class="sectionedit8" id="sysupgrade_with_extroot_configuration">Sysupgrade with Extroot configuration</h3>
<div class="level3">

<p>
Note that if your device is configured for Extroot, then you will need to reboot twice after any type of sysupgrade. The external root filesystem does not remount after the first boot. There is no need to modify or recreate extroot settings, just reboot again and the configuration will work as before and continue to do so.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Sysupgrade with Extroot configuration&quot;,&quot;hid&quot;:&quot;sysupgrade_with_extroot_configuration&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:8,&quot;range&quot;:&quot;9296-&quot;} -->