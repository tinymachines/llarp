
<h1 class="sectionedit1" id="upgrade_from_old_ar71xx_to_ath79">Upgrade from (old) ar71xx to ath79</h1>
<div class="level1">

<p>
Starting with <a href="/releases/19.07/start" class="wikilink1" title="releases:19.07:start" data-wiki-id="releases:19.07:start">OpenWrt 19.07</a>, there is a new device-tree-based target called <a href="/docs/techref/targets/ath79" class="wikilink1" title="docs:techref:targets:ath79" data-wiki-id="docs:techref:targets:ath79">ath79</a> that deprecates the <a href="/docs/techref/targets/ar71xx" class="wikilink1" title="docs:techref:targets:ar71xx" data-wiki-id="docs:techref:targets:ar71xx">ar71xx</a> target. For 19.07, both targets are still built, but future releases of OpenWrt will drop support for the <a href="/docs/techref/targets/ar71xx" class="wikilink1" title="docs:techref:targets:ar71xx" data-wiki-id="docs:techref:targets:ar71xx">ar71xx</a> target.
</p>

<p>
Upgrading from <a href="/docs/techref/targets/ar71xx" class="wikilink1" title="docs:techref:targets:ar71xx" data-wiki-id="docs:techref:targets:ar71xx">ar71xx</a> to <a href="/docs/techref/targets/ath79" class="wikilink1" title="docs:techref:targets:ath79" data-wiki-id="docs:techref:targets:ath79">ath79</a> is not always straightforward and depends on devices. This page lists instructions and pitfalls to upgrade a device as safely as possible.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Upgrade from (old) ar71xx to ath79&quot;,&quot;hid&quot;:&quot;upgrade_from_old_ar71xx_to_ath79&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-641&quot;} -->
<h2 class="sectionedit2" id="step_1check_support_for_your_device">Step 1: check support for your device</h2>
<div class="level2">

<p>
Approximately 50% of ar71xx devices have been ported to ath79 in 19.07. Check if your model is in the <a href="/docs/techref/targets/ath79" class="wikilink1" title="docs:techref:targets:ath79" data-wiki-id="docs:techref:targets:ath79">ath79 device status</a> page. You can also have a look at the <a href="/docs/techref/targets/ar71xx-ath79" class="wikilink1" title="docs:techref:targets:ar71xx-ath79" data-wiki-id="docs:techref:targets:ar71xx-ath79">ar71xx-ath79 device status</a> page.
</p>

<p>
Lastly, you can directly check the <a href="https://downloads.openwrt.org/releases/19.07.0/targets/ath79/" class="urlextern" title="https://downloads.openwrt.org/releases/19.07.0/targets/ath79/" rel="ugc nofollow">download page for ath79</a> (but be aware: images for some devices are <strong>not</strong> built for releases, because of issues with limited flash size)
</p>

<p>
<strong>If your device is not yet supported in ath79:</strong> somebody will need to add support for this device, and it could be <strong>you</strong>!  See <a href="/docs/techref/targets/ath79" class="wikilink1" title="docs:techref:targets:ath79" data-wiki-id="docs:techref:targets:ath79">ath79</a>, <a href="/docs/guide-developer/add.new.device" class="wikilink1" title="docs:guide-developer:add.new.device" data-wiki-id="docs:guide-developer:add.new.device">add.new.device</a>, <a href="/docs/guide-developer/adding_new_device" class="wikilink1" title="docs:guide-developer:adding_new_device" data-wiki-id="docs:guide-developer:adding_new_device">adding_new_device</a> and <a href="/submitting-patches" class="wikilink1" title="submitting-patches" data-wiki-id="submitting-patches">submitting-patches</a> for guidance.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 1: check support for your device&quot;,&quot;hid&quot;:&quot;step_1check_support_for_your_device&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;642-1490&quot;} -->
<h2 class="sectionedit3" id="step_2backup_your_configuration">Step 2: backup your configuration</h2>
<div class="level2">

<p>
You absolutely need to <strong>backup your configuration</strong> before making any change, unless you are fine starting with a default OpenWrt configuration from scratch.
</p>

<p>
See <a href="/docs/guide-user/troubleshooting/backup_restore" class="wikilink1" title="docs:guide-user:troubleshooting:backup_restore" data-wiki-id="docs:guide-user:troubleshooting:backup_restore">backup and restore</a> documentation.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 2: backup your configuration&quot;,&quot;hid&quot;:&quot;step_2backup_your_configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1491-1788&quot;} -->
<h2 class="sectionedit4" id="step_3download_sysupgrade_image">Step 3: download sysupgrade image</h2>
<div class="level2">

<p>
Download the ath79 sysupgrade image of 19.07 for your device, and copy it to <code>/tmp/</code> on your router if necessary.
</p>

<p>
Make <strong>really sure</strong> that you download the right image for your device!
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 3: download sysupgrade image&quot;,&quot;hid&quot;:&quot;step_3download_sysupgrade_image&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1789-2025&quot;} -->
<h2 class="sectionedit5" id="step_4upgrade_your_system_with_sysupgrade">Step 4: upgrade your system with sysupgrade</h2>
<div class="level2">

<p>
Flash the sysupgrade image <strong>without keeping settings</strong>.  You can either use the <a href="/docs/guide-quick-start/sysupgrade.luci" class="wikilink1" title="docs:guide-quick-start:sysupgrade.luci" data-wiki-id="docs:guide-quick-start:sysupgrade.luci">LuCI web interface</a> or the <a href="/docs/guide-user/installation/sysupgrade.cli" class="wikilink1" title="docs:guide-user:installation:sysupgrade.cli" data-wiki-id="docs:guide-user:installation:sysupgrade.cli">command-line interface</a>:
</p>
<ul>
<li class="level1"><div class="li"> for LuCI: <strong>uncheck “Keep settings and retain the current configuration”</strong></div>
</li>
<li class="level1"><div class="li"> for command-line sysupgrade: <strong>use <code>sysupgrade -n &lt;your-device-19.07-image-sysupgrade.bin&gt;</code></strong></div>
</li>
</ul>

<p>
At that point, there is little risk for your device: if the image is accepted, the upgrade will likely work as expected. Once the upgrade succeeded the device should be available on openwrt&#039;s default ip-address.
</p>

<p>
If the image check fails, <strong>don&#039;t force upgrade</strong> and continue reading below.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 4: upgrade your system with sysupgrade&quot;,&quot;hid&quot;:&quot;step_4upgrade_your_system_with_sysupgrade&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;2026-2779&quot;} -->
<h3 class="sectionedit6" id="if_your_device_is_not_supported_by_the_image">If your device is not supported by the image</h3>
<div class="level3">

<p>
You may encounter the error “Device not supported by this image” or “Image check failed”. In that case:
</p>
<ol>
<li class="level1"><div class="li"> first, check again that you selected the right image</div>
</li>
<li class="level1"><div class="li"> if so, please <a href="/bugs" class="wikilink1" title="bugs" data-wiki-id="bugs">report the issue</a> so that it can be fixed for the next 19.07.X minor release. In your bug report, make sure to give details about your device, which exact ar71xx image you were using, and which exact ath79 image you tried to flash.</div>
</li>
<li class="level1"><div class="li"> go to section <a href="#flashing_from_bootloadertftpserial" title="docs:guide-user:installation:ar71xx.to.ath79 ↵" class="wikilink1">Flashing from bootloader / TFTP / serial</a> or <a href="#forcing_sysupgrade_dangerous" title="docs:guide-user:installation:ar71xx.to.ath79 ↵" class="wikilink1">Forcing sysupgrade (dangerous!)</a> below</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;If your device is not supported by the image&quot;,&quot;hid&quot;:&quot;if_your_device_is_not_supported_by_the_image&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2780-3431&quot;} -->
<h2 class="sectionedit7" id="step_5check_that_the_upgrade_ran_successfully">Step 5: check that the upgrade ran successfully</h2>
<div class="level2">

<p>
Because settings were not saved in the upgrade the device is now on openwrt&#039;s default ip address.
Check basic functionality after rebooting: connect to device with <abbr title="Hypertext Transfer Protocol">HTTP</abbr> or <abbr title="Secure Shell">SSH</abbr>, connect the <abbr title="Wide Area Network">WAN</abbr> port to the Internet, enable Wi-Fi, etc. 
</p>

<p>
<strong>If your device stays unresponsive several minutes after upgrading:</strong> <a href="/bugs" class="wikilink1" title="bugs" data-wiki-id="bugs">report the issue</a> and go to section “Flashing from bootloader / <abbr title="Trivial File Transfer Protocol">TFTP</abbr> / serial”.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 5: check that the upgrade ran successfully&quot;,&quot;hid&quot;:&quot;step_5check_that_the_upgrade_ran_successfully&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;3432-3889&quot;} -->
<h2 class="sectionedit8" id="step_6import_your_configuration">Step 6: import your configuration</h2>
<div class="level2">

<p>
First, check that <a href="/docs/guide-user/troubleshooting/failsafe_and_factory_reset" class="wikilink1" title="docs:guide-user:troubleshooting:failsafe_and_factory_reset" data-wiki-id="docs:guide-user:troubleshooting:failsafe_and_factory_reset">generic failsafe</a> works so that you can always fix configs if anything goes wrong.
</p>

<p>
Then you can import your configuration:
</p>
<ol>
<li class="level1"><div class="li"> If your configuration is simple enough, redo it manually and you&#039;re done upgrading, else follow the next steps;</div>
</li>
<li class="level1"><div class="li"> Manually compare configs you backed up to the ones generated by an ath79 image on first boot. Pay specific attention to <strong>device path</strong> in <code>wireless</code>, <strong>interface names</strong> in <code>network</code> and <strong>LEDs</strong> in <code>system</code>;</div>
</li>
<li class="level1"><div class="li"> If deemed reasonable, prepare new configs taking the comparison results into account and try restoring using them;</div>
</li>
<li class="level1"><div class="li"> In case you have any specific issues, <a href="/bugs" class="wikilink1" title="bugs" data-wiki-id="bugs">report bugs</a>.</div>
</li>
</ol>

<p>
Congratulations, your upgrade was successful!
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Step 6: import your configuration&quot;,&quot;hid&quot;:&quot;step_6import_your_configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;3890-4709&quot;} -->
<h2 class="sectionedit9" id="alternative_methods">Alternative methods</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Alternative methods&quot;,&quot;hid&quot;:&quot;alternative_methods&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;4710-4742&quot;} -->
<h3 class="sectionedit10" id="flashing_from_bootloadertftpserial">Flashing from bootloader / TFTP / serial</h3>
<div class="level3">

<p>
You can use support from the bootloader to flash the new image. Find your device page from <a href="/toh/start" class="wikilink1" title="toh:start" data-wiki-id="toh:start">Table of Hardware</a> and proceed with whatever device-specific flashing methods are available.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Flashing from bootloader \/ TFTP \/ serial&quot;,&quot;hid&quot;:&quot;flashing_from_bootloadertftpserial&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;4743-4992&quot;} -->
<h3 class="sectionedit11" id="forcing_sysupgrade_dangerous">Forcing sysupgrade (dangerous!)</h3>
<div class="level3">

<p>
Forcing the upgrade will allow you to upgrade with an image that is not matching your device: <strong>do this at your own risk!</strong>
</p>

<p>
If you decide to do it anyway, make <strong>really really sure</strong> again that you downloaded the right image for your device!
</p>
<ul>
<li class="level1"><div class="li"> for LuCI: <strong>check “Force upgrade”</strong></div>
</li>
<li class="level1"><div class="li"> for command-line sysupgrade: <strong>use <code>sysupgrade -F -n &lt;your-device-19.07-image-sysupgrade.bin&gt;</code></strong></div>
</li>
</ul>

<p>
<strong>If the device is unresponsive several minutes after upgrade:</strong> you were warned! Your last resort is “Flashing from bootloader / <abbr title="Trivial File Transfer Protocol">TFTP</abbr> / serial”.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Forcing sysupgrade (dangerous!)&quot;,&quot;hid&quot;:&quot;forcing_sysupgrade_dangerous&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;4993-5570&quot;} -->
<h2 class="sectionedit12" id="incompatible_changes">Incompatible changes</h2>
<div class="level2">

<p>
Potential incompatible changes between ar71xx and ath79:
</p>
<ul>
<li class="level1"><div class="li"> Wi-Fi device paths in <code>/etc/config/wireless</code></div>
</li>
<li class="level1"><div class="li"> network interface names and switch configuration in <code>/etc/config/network</code></div>
</li>
<li class="level1"><div class="li"> LEDs in <code>/etc/config/system</code></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Incompatible changes&quot;,&quot;hid&quot;:&quot;incompatible_changes&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;5571-5830&quot;} -->
<h2 class="sectionedit13" id="devices_with_known_config_changes_without_migration_available">Devices with known config changes (without migration available)</h2>
<div class="level2">

<p>
Devices listed here will have config changes that are not treated by any migration scripts, so using sysupgrade without “-n” option will definitely lead to a configuration not matching the rest any more. So, be sure to stick to the guide above for these devices in particular.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Devices with known config changes (without migration available)&quot;,&quot;hid&quot;:&quot;devices_with_known_config_changes_without_migration_available&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:13,&quot;range&quot;:&quot;5831-6185&quot;} -->
<h3 class="sectionedit14" id="eth1eth0_swap">eth1/eth0 swap</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> AVM FritzBox4020</div>
</li>
<li class="level1"><div class="li"> TP-Link Archer C25 v1, C58 v1, C59 v1/v2, C60 v1/v2</div>
</li>
<li class="level1"><div class="li"> TP-Link TL-WR841N/ND v8 (not for v7 and v9 to v12)</div>
</li>
<li class="level1"><div class="li"> ...</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;eth1\/eth0 swap&quot;,&quot;hid&quot;:&quot;eth1eth0_swap&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:14,&quot;range&quot;:&quot;6186-6352&quot;} -->
<h3 class="sectionedit15" id="switch_configuration_change">switch configuration change</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> TP-Link TL-WR741N/ND v4</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;switch configuration change&quot;,&quot;hid&quot;:&quot;switch_configuration_change&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:15,&quot;range&quot;:&quot;6353-&quot;} -->