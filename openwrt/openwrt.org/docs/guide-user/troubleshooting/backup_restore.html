
<h1 class="sectionedit1" id="backup_and_restore">Backup and restore</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Backup and restore&quot;,&quot;hid&quot;:&quot;backup_and_restore&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-115&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for using OpenWrt file-level backup/restore.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/installation/sysupgrade.packages" class="wikilink1" title="docs:guide-user:installation:sysupgrade.packages" data-wiki-id="docs:guide-user:installation:sysupgrade.packages">Preserving packages</a> to back up user-removed/installed packages.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-quick-start/admingui_sysupgrade_keepsettings" class="wikilink1" title="docs:guide-quick-start:admingui_sysupgrade_keepsettings" data-wiki-id="docs:guide-quick-start:admingui_sysupgrade_keepsettings">Preserving configuration</a> to determine whether to keep the settings.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/installation/generic.backup" class="wikilink1" title="docs:guide-user:installation:generic.backup" data-wiki-id="docs:guide-user:installation:generic.backup">Generic backup</a> for block-level backup/restore.</div>
</li>
<li class="level1"><div class="li"> Extroot or additional overlay setups require extra measures.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;116-661&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Back up and restore OpenWrt configuration.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;662-727&quot;} -->
<h2 class="sectionedit8" id="web_interface_instructions">Web interface instructions</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web interface instructions&quot;,&quot;hid&quot;:&quot;web_interface_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;728-766&quot;} -->
<h3 class="sectionedit9" id="customize_and_verify">1. Customize and verify</h3>
<div class="level3">

<p>
Customize your backup configuration.
</p>
<ol>
<li class="level1"><div class="li"> Navigate to <strong>LuCI → System → Backup / Flash Firmware → Configuration</strong>.</div>
</li>
<li class="level1"><div class="li"> Add/remove files/directories and click <strong>Submit</strong> when done editing.</div>
</li>
<li class="level1"><div class="li"> Click <strong>Open list...</strong> button to view the list of files for backup.</div>
</li>
</ol>

<p>
Make sure the list contains all the files you want to save.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Customize and verify&quot;,&quot;hid&quot;:&quot;customize_and_verify&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;767-1123&quot;} -->
<h3 class="sectionedit10" id="back_up">2. Back up</h3>
<div class="level3">

<p>
Back up OpenWrt configuration to local PC.
</p>
<ol>
<li class="level1"><div class="li"> Navigate to <strong>LuCI → System → Backup / Flash Firmware → Actions: Backup</strong>.</div>
</li>
<li class="level1"><div class="li"> Click <strong>Generate archive</strong> button to download the archive.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Back up&quot;,&quot;hid&quot;:&quot;back_up&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;1124-1333&quot;} -->
<h3 class="sectionedit11" id="restore">3. Restore</h3>
<div class="level3">

<p>
Restore previously saved OpenWrt configuration from local PC.
</p>
<ol>
<li class="level1"><div class="li"> Navigate to <strong>LuCI → System → Backup / Flash Firmware → Actions: Restore</strong>.</div>
</li>
<li class="level1"><div class="li"> Click <strong>Choose File</strong> button to select the archive.</div>
</li>
<li class="level1"><div class="li"> Click <strong>Upload archive...</strong> button to upload the archive.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3. Restore&quot;,&quot;hid&quot;:&quot;restore&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;1334-1618&quot;} -->
<h2 class="sectionedit12" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

<p>
OpenWrt provides <a href="/docs/techref/sysupgrade" class="wikilink1" title="docs:techref:sysupgrade" data-wiki-id="docs:techref:sysupgrade">Sysupgrade</a> utility for file-level backup/restore.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;1619-1752&quot;} -->
<h3 class="sectionedit13" id="customize_and_verify1">1. Customize and verify</h3>
<div class="level3">

<p>
Customize and verify your backup configuration.
</p>
<pre class="code bash"><span class="co0"># Add files/directories</span>
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> EOF <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>sysupgrade.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>sudoers
<span class="sy0">/</span>etc<span class="sy0">/</span>sudoers.d
EOF
&nbsp;
<span class="co0"># Edit backup configuration</span>
<span class="kw2">vi</span> <span class="sy0">/</span>etc<span class="sy0">/</span>sysupgrade.conf
&nbsp;
<span class="co0"># Verify backup configuration</span>
sysupgrade <span class="re5">-l</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Customize and verify&quot;,&quot;hid&quot;:&quot;customize_and_verify1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:13,&quot;range&quot;:&quot;1753-2045&quot;} -->
<h3 class="sectionedit14" id="back_up1">2. Back up</h3>
<div class="level3">

<p>
Back up OpenWrt configuration to local PC.
</p>
<pre class="code bash"><span class="co0"># Generate backup</span>
<span class="kw3">umask</span> <span class="re2">go</span>=
sysupgrade <span class="re5">-b</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="co1">${HOSTNAME}</span>-$<span class="br0">&#40;</span><span class="kw2">date</span> +<span class="sy0">%</span>F<span class="br0">&#41;</span>.tar.gz
<span class="kw2">ls</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="sy0">*</span>.tar.gz
&nbsp;
<span class="co0"># From the client, download backup </span>
<span class="kw2">scp</span> root<span class="sy0">@</span>openwrt.lan:<span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="sy0">*</span>.tar.gz .
<span class="co0"># On recent clients, it may be necessary to use the -O flag for compatibility reasons</span>
<span class="kw2">scp</span> <span class="re5">-O</span> root<span class="sy0">@</span>openwrt.lan:<span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="sy0">*</span>.tar.gz .</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Back up&quot;,&quot;hid&quot;:&quot;back_up1&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:14,&quot;range&quot;:&quot;2046-2454&quot;} -->
<h3 class="sectionedit15" id="restore1">3. Restore</h3>
<div class="level3">

<p>
Restore previously saved OpenWrt configuration from local PC.
Reboot to apply changes.
</p>
<pre class="code bash"><span class="co0"># Upload backup</span>
<span class="kw2">scp</span> backup-<span class="sy0">*</span>.tar.gz root<span class="sy0">@</span>openwrt.lan:<span class="sy0">/</span>tmp
&nbsp;
<span class="co0"># Restore backup</span>
<span class="kw2">ls</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="sy0">*</span>.tar.gz
sysupgrade <span class="re5">-r</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>backup-<span class="sy0">*</span>.tar.gz
reboot</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3. Restore&quot;,&quot;hid&quot;:&quot;restore1&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:15,&quot;range&quot;:&quot;2455-2726&quot;} -->
<h2 class="sectionedit16" id="extras">Extras</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;2727-2745&quot;} -->
<h3 class="sectionedit17" id="configuration">Configuration</h3>
<div class="level3">

<p>
Backup combines multiple sources and covers most configurations by default.
</p>
<pre class="code bash"><span class="co0"># Automatically detected modifications</span>
opkg list-changed-conffiles
&nbsp;
<span class="co0"># System configurations supplied by individual packages</span>
<span class="kw2">grep</span> <span class="re5">-r</span> <span class="re5">-e</span> . <span class="sy0">/</span>lib<span class="sy0">/</span>upgrade<span class="sy0">/</span>keep.d
&nbsp;
<span class="co0"># User configuration to edit if necessary</span>
<span class="kw2">grep</span> <span class="re5">-e</span> . <span class="sy0">/</span>etc<span class="sy0">/</span>sysupgrade.conf
&nbsp;
<span class="co0"># Obsolete settings no longer supported</span>
uci show luci.flash_keep</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:17,&quot;range&quot;:&quot;2746-&quot;} -->