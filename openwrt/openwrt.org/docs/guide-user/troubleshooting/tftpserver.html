
<h2 class="sectionedit1" id="what_is_tftp_recovery_over_ethernet">What is TFTP Recovery over Ethernet?</h2>
<div class="level2">

<p>
On most devices, the vendor provides a bootloader on a discreet partition that is untouched by firmware updates. In case of a failed flash process or a misconfiguration, the device&#039;s bootloader usually remains untouched and can therefore be used to reflash the firmware and recover the device.
</p>

<p>
There are two potential modes of operation:
</p>

<p>
<strong>1. <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery client</strong>
</p>

<p>
For many routers, the recovery process requires you to host the firmware image on a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server on your computer. The device with the broken firmware then has to be started up in <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery mode. Some devices will then automatically pull the network-provided firmware file over <abbr title="Trivial File Transfer Protocol">TFTP</abbr> network protocol to the bootloader, and hopefully recover with a successful emergency flash process.
</p>

<p>
Other devices do not have an automatic pull function and they need you to manually issue commands in recovery mode, to download the firmware via <abbr title="Trivial File Transfer Protocol">TFTP</abbr>, and initiate the install.
</p>

<p>
<strong>2. <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery server</strong>
</p>

<p>
Some other routers, e.g. many Netgear routers, run a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server in recovery mode, and you need to upload the firmware to the device using a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> client.
</p>

<p>
The below article mainly advises on the first mode of recovery, i.e. the router runs a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> client and you need to host the firmware image on a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server.
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;What is TFTP Recovery over Ethernet?&quot;,&quot;hid&quot;:&quot;what_is_tftp_recovery_over_ethernet&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1329&quot;} -->
<h2 class="sectionedit2" id="is_tftp_recovery_over_ethernet_supported_by_my_device">Is TFTP Recovery over Ethernet supported by my device?</h2>
<div class="level2">

<p>
<abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery over Ethernet is not supported by every router model. <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery is based on a device- and vendor-specific boot loader that may or may not be present on your device. Check the OpenWrt device page for your precise model to find out, if your device has a boot loader supporting <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery. If your device supports it, then this recovery function will still be present in your device boot loader, after OpenWrt firmware has been flashed onto the device.
</p>

<p>
Note:
● Your device boot loader could alternatively have implemented <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery over <a href="/docs/techref/hardware/port.serial.cables" class="wikilink1" title="docs:techref:hardware:port.serial.cables" data-wiki-id="docs:techref:hardware:port.serial.cables">serial cable</a>, which is not covered on this page.
● Your device could also have <a href="/docs/guide-user/troubleshooting/vendor_specific_rescue" class="wikilink1" title="docs:guide-user:troubleshooting:vendor_specific_rescue" data-wiki-id="docs:guide-user:troubleshooting:vendor_specific_rescue">other means of recovery</a>.
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Is TFTP Recovery over Ethernet supported by my device?&quot;,&quot;hid&quot;:&quot;is_tftp_recovery_over_ethernet_supported_by_my_device&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1330-2173&quot;} -->
<h2 class="sectionedit3" id="setting_up_tftp_recovery">Setting up TFTP Recovery</h2>
<div class="level2">

<p>
Information on using <abbr title="Trivial File Transfer Protocol">TFTP</abbr> to install OpenWrt is also available here: <a href="/docs/guide-user/installation/generic.flashing.tftp" class="wikilink1" title="docs:guide-user:installation:generic.flashing.tftp" data-wiki-id="docs:guide-user:installation:generic.flashing.tftp">generic.flashing.tftp</a>.
</p>

<p>
The following procedure only describes how to set up a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server over Ethernet for the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> recovery preparation process, it does not describe the device-specific flash recovery process. For the actual flash process you should consult the vendor provided documentation, the Internet, the OpenWrt Forum, or the OpenWrt device pages.
</p>
<ol>
<li class="level1"><div class="li"> Download the desired OpenWrt (or stock) firmware image to the designated <abbr title="Trivial File Transfer Protocol">TFTP</abbr> directory on your computer (and rename it if needed).</div>
</li>
<li class="level1"><div class="li"> Set the <abbr title="Internet Protocol">IP</abbr> address of your computer&#039;s Ethernet interface as described in the Device Page for your model.</div>
</li>
<li class="level1"><div class="li"> Start the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server on your computer.</div>
</li>
<li class="level1"><div class="li"> Connect your computer and your device with Ethernet cable.</div>
</li>
<li class="level1"><div class="li"> Power up the router and press a device-specific button to start firmware recovery, or access bootloader recovery options, and install recovery firmware over <abbr title="Trivial File Transfer Protocol">TFTP</abbr>.</div>
</li>
<li class="level1"><div class="li"> Stop the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server on your computer.</div>
</li>
</ol>

<p>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting up TFTP Recovery&quot;,&quot;hid&quot;:&quot;setting_up_tftp_recovery&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;2174-3259&quot;} -->
<h3 class="sectionedit4" id="setting_up_a_tftp_server_for_tftp_recovery">Setting up a TFTP server for TFTP Recovery</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:tftp_warning&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:tftp_warning" id="plugin_include__meta__infobox__tftp_warning">
<div class="level3">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_important plugin_wrap" style="width: 70%;">
<p>
<strong>Important Information!</strong><br/>

<abbr title="Trivial File Transfer Protocol">TFTP</abbr> server &amp; client tools (based on the <a href="https://en.wikipedia.org/wiki/wiki/Trivial_File_Transfer_Protocol" class="urlextern" title="https://en.wikipedia.org/wiki/wiki/Trivial_File_Transfer_Protocol" rel="ugc nofollow">TFTP</a> protocol) employ no access controls while allowing light-weight file transfer between networked devices.<br/>

Do not leave <abbr title="Trivial File Transfer Protocol">TFTP</abbr> services running longer than needed and use a firewall to restrict access to the local subnet.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:tftp_warning&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

<p>
Access to <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-client (<code>tftp</code>) and <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server (<code>tftpd</code>) tool/app must be made secure, from <em>(primarily)</em> hackers in internet <em>(and <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server &amp; client both must also be kept securely isolated from harmful/ignorant internal users or from hijacked computers, inside your own <abbr title="Local Area Network">LAN</abbr> network)</em>. If necessary, create a separate subnet under a 2nd level router, then work / develop / troubleshoot under that separate subnet with network devices which will handle <abbr title="Trivial File Transfer Protocol">TFTP</abbr> client/server protocols.
</p>

<p>
If your computer is also used as a desktop computer for general purpose or for other purpose than build/compile, then make sure <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-client &amp; <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server, are both placed behind a firewall <em>(<code>frwl</code>)</em> system or rules<sup><a href="https://unix.stackexchange.com/questions/99270/" class="urlextern" title="https://unix.stackexchange.com/questions/99270/" rel="ugc nofollow">1</a>, <a href="https://www.cyberciti.biz/faq/install-configure-tftp-server-ubuntu-debian-howto/" class="urlextern" title="https://www.cyberciti.biz/faq/install-configure-tftp-server-ubuntu-debian-howto/" rel="ugc nofollow">2</a></sup>. Firewall rules should be:
</p>
<ul>
<li class="level1"><div class="li"> <em>(frwl rule # 1)</em> allow <abbr title="Trivial File Transfer Protocol">TFTP</abbr> traffic (<abbr title="User Datagram Protocol">UDP</abbr> 69) only when connections originate from a local <abbr title="Local Area Network">LAN</abbr> ip.address range and also end in the local <abbr title="Local Area Network">LAN</abbr> ip.address range</div>
</li>
<li class="level1"><div class="li"> <em>(frwl rule # 2)</em> <abbr title="Trivial File Transfer Protocol">TFTP</abbr> traffic is Not-Allowed when it is from/to <code>127.0.0.1</code> or <code>lo</code></div>
</li>
<li class="level1"><div class="li"> <em>(frwl rule # 3)</em> <abbr title="Trivial File Transfer Protocol">TFTP</abbr> traffic is Not-Allowed when originated from Internet-ip-address <em>(aka: NON private-<abbr title="Local Area Network">LAN</abbr> ip-address ranges)</em></div>
</li>
</ul>

<p>
And you must also make sure to do this: after your develop / troubleshooting etc work is done or when you pause to goto other work, then make sure the <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server and <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-client both are completely disabled in your <abbr title="Operating System">OS</abbr>/distro : turn off <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server service / process, disable <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server startup script file, and <strong>move</strong> the <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-client (<code>tftp</code>) &amp; the <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server (<code>tftpd</code>) executable / binary <em>(<code>bin</code>)</em> files out of all folders mentioned in your PATH variable, into a different folder (which is NOT in the PATH variable), and also move bin files out of the folder which is mentioned in startup-script <em>(if such is used)</em>.
</p>

<p>
<strong><span style='color:#ed1c24; '>If you keep <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-server running or if you keep the <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-client tool available to run anytime, then abusive hackers can abuse/exploit it, to load harmful firmware and/or to change sensitive security settings inside your existing router firmware<sup><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-26130" class="urlextern" title="https://nvd.nist.gov/vuln/detail/CVE-2020-26130" rel="ugc nofollow">1</a>, <a href="https://www.cvedetails.com/vulnerability-list.php?vendor_id=98&amp;product_id=0&amp;version_id=0&amp;page=1&amp;hasexp=0&amp;opdos=0&amp;opec=0&amp;opov=0&amp;opcsrf=0&amp;opgpriv=0&amp;opsqli=0&amp;opxss=0&amp;opdirt=0&amp;opmemc=0&amp;ophttprs=0&amp;opbyp=0&amp;opfileinc=0&amp;opginf=0&amp;cvssscoremin=0&amp;cvssscoremax=0&amp;year=0&amp;cweid=0&amp;order=1&amp;trc=4" class="urlextern" title="https://www.cvedetails.com/vulnerability-list.php?vendor_id=98&amp;product_id=0&amp;version_id=0&amp;page=1&amp;hasexp=0&amp;opdos=0&amp;opec=0&amp;opov=0&amp;opcsrf=0&amp;opgpriv=0&amp;opsqli=0&amp;opxss=0&amp;opdirt=0&amp;opmemc=0&amp;ophttprs=0&amp;opbyp=0&amp;opfileinc=0&amp;opginf=0&amp;cvssscoremin=0&amp;cvssscoremax=0&amp;year=0&amp;cweid=0&amp;order=1&amp;trc=4" rel="ugc nofollow">2</a>, <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-7940/Tftp-server.html" class="urlextern" title="https://www.cvedetails.com/vulnerability-list/vendor_id-7940/Tftp-server.html" rel="ugc nofollow">3</a>, <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-1305/product_id-2282/Solarwinds-Tftp-Server.html" class="urlextern" title="https://www.cvedetails.com/vulnerability-list/vendor_id-1305/product_id-2282/Solarwinds-Tftp-Server.html" rel="ugc nofollow">4</a>, <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-16/product_id-1628/Cisco-Tftp-Server.html" class="urlextern" title="https://www.cvedetails.com/vulnerability-list/vendor_id-16/product_id-1628/Cisco-Tftp-Server.html" rel="ugc nofollow">5</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-0603" class="urlextern" title="https://nvd.nist.gov/vuln/detail/CVE-2019-0603" rel="ugc nofollow">6</a></sup>, etc.</span></strong>
<br/>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting up a TFTP server for TFTP Recovery&quot;,&quot;hid&quot;:&quot;setting_up_a_tftp_server_for_tftp_recovery&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;3260-6295&quot;} -->
<h3 class="sectionedit9" id="setting_up_a_tftp_server_on_macos">Setting up a TFTP server on macOS</h3>
<div class="level3">

<p>
macOS provides a native tftpd server that runs the command line. However, it is not verified to work on recent versions (10.15.x). So alternative option-1 is: use <code>dnsmasq</code> instead. Alternative option-2 is: use MacPorts <em>(or other)</em> package-manager &amp; obtain tftpd server &amp; dnsmasq, more info is here: <a href="/docs/guide-developer/toolchain/buildroot.exigence.macosx" class="wikilink1" title="docs:guide-developer:toolchain:buildroot.exigence.macosx" data-wiki-id="docs:guide-developer:toolchain:buildroot.exigence.macosx">buildroot.exigence.macosx</a>. There are also <abbr title="Graphical User Interface">GUI</abbr> <em>(frontend/wrapper)</em> applications <em>(for CLI based tftp, tftpd tools)</em> that are available for users who prefer such, <em>(in example: <code>TftpServer<strong>.</strong>app</code>)</em>. There are also <abbr title="Graphical User Interface">GUI</abbr> based tftp &amp; tftpd app, <em>(in example: <code>PumpKIN<strong>.</strong>app</code>)</em>.
<br/>
<br/>

</p>

</div>

<h4 id="dnsmasq_on_macos">dnsmasq (on macOS):</h4>
<div class="level4">

<p>
Dnsmasq can be installed easily via <a href="https://brew.sh" class="urlextern" title="https://brew.sh" rel="ugc nofollow">Homebrew</a> or <a href="https://www.macports.org/" class="urlextern" title="https://www.macports.org/" rel="ugc nofollow">MacPorts</a> and has the advantage of being able to offer a <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> server if necessary.
</p>

<p>
● Launch it in this way (if you use Homebrew pkg-mngr): 
</p>
<pre class="code bash"> $ <span class="kw2">sudo</span> <span class="sy0">/</span>usr<span class="sy0">/</span>local<span class="sy0">/</span>opt<span class="sy0">/</span>dnsmasq<span class="sy0">/</span>sbin<span class="sy0">/</span>dnsmasq <span class="re5">-i</span> enX <span class="re5">-p</span> <span class="nu0">0</span> <span class="re5">-z</span> <span class="re5">--enable-tftp</span> <span class="re5">--tftp-root</span> <span class="sy0">/</span>tmp </pre>

<p>
● Launch it in this way (if you use MacPorts pkg-mngr): 
</p>
<pre class="code bash"> $ <span class="kw2">sudo</span> <span class="sy0">/</span>opt<span class="sy0">/</span>local<span class="sy0">/</span>sbin<span class="sy0">/</span>dnsmasq <span class="re5">-i</span> enX <span class="re5">-p</span> <span class="nu0">0</span> <span class="re5">-z</span> <span class="re5">--enable-tftp</span> <span class="re5">--tftp-root</span> <span class="sy0">/</span>tmp </pre>

<p>
Replace <code>enX</code> with the interface identifier of your Ethernet adapter (use <code>ifconfig</code> to find it out) and <code>/tmp</code> to the directory containing the image you want to serve. Don&#039;t forget to kill the process (e.g. using the <code>Activity Monitor</code>) before you want to start a new instance of <code>dnsmasq</code>.
<br/>
<br/>

</p>

</div>

<h4 id="macos_command-line_native_tftpd">macOS Command-Line Native tftpd:</h4>
<div class="level4">

<p>
For recent versions of macOS, the system-supplied <code>tftpd</code> is managed with <code>launchctl</code>. Users should be comfortable with command-line usage and <code>sudo</code> to take this approach. As confirmed on macOS Sierra 10.12.6 and macOS Mojave 10.14.2, the general steps involved are
</p>

<p>
● Configure your network interface for the proper server address for your device. Using System Preferences &gt; Network is perhaps the easiest.
● Connect your device to the network interface.
● Start <code>tftpd</code> 
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> <span class="kw2">cp</span> path<span class="sy0">/</span>to<span class="sy0">/</span>file<span class="sy0">/</span>to<span class="sy0">/</span>serve.bin <span class="sy0">/</span>private<span class="sy0">/</span>tftpboot<span class="sy0">/</span>the_name_the_device_is_looking_for.bin
$ <span class="kw2">sudo</span> launchctl load <span class="re5">-F</span> <span class="sy0">/</span>System<span class="sy0">/</span>Library<span class="sy0">/</span>LaunchDaemons<span class="sy0">/</span>tftp.plist </pre>

<p>
● Confirm <code>tfptd</code> is running by looking for the <abbr title="User Datagram Protocol">UDP</abbr> listener on port 69 
</p>
<pre class="code bash">$ <span class="kw2">netstat</span> <span class="re5">-an</span> <span class="sy0">|</span> <span class="kw2">fgrep</span> \<span class="sy0">*</span>.69    
udp4       <span class="nu0">0</span>      <span class="nu0">0</span>  <span class="sy0">*</span>.69                   <span class="sy0">*</span>.<span class="sy0">*</span>                               </pre>

<p>
● Activate your device&#039;s recovery/<abbr title="Trivial File Transfer Protocol">TFTP</abbr> mode
</p>
<ul>
<li class="level1"><div class="li"> When done with <code>tftpd</code>, shut it down with <pre class="code bash"> $ <span class="kw2">sudo</span> launchctl unload <span class="re5">-F</span> <span class="sy0">/</span>System<span class="sy0">/</span>Library<span class="sy0">/</span>LaunchDaemons<span class="sy0">/</span>tftp.plist </pre>
</div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h4 id="tftpserverapp_on_macos">TftpServer.app (on macOS):</h4>
<div class="level4">

<p>
As an example of a <abbr title="Graphical User Interface">GUI</abbr> wrapper (aka: frontend) based <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server, the <code>TftpServer<strong>.</strong>app</code> from <a href="http://ww2.unime.it/flr/tftpserver/" class="urlextern" title="http://ww2.unime.it/flr/tftpserver/" rel="ugc nofollow">http://ww2.unime.it/flr/tftpserver/</a> provides a pleasant <abbr title="Graphical User Interface">GUI</abbr> frontend / wrapper around macOS native command that makes the process less error prone. Info from older site on usage of this app is <a href="https://web.archive.org/web/20200427215239/http://ww2.unime.it/flr/tftpserver/" class="urlextern" title="https://web.archive.org/web/20200427215239/http://ww2.unime.it/flr/tftpserver/" rel="ugc nofollow">here</a>.
</p>
<ul>
<li class="level1"><div class="li"> This procedure was tested with <code>TftpServer.app</code> v 3.4.1 on OSX 10.10.5 in December 2016.</div>
</li>
<li class="level1"><div class="li"> The v3.4.1 <code>TftpServer.dmg</code> file has SHA256: eb71d62da9c0dd6cdf54d604e87083e1a4e7084f8da4bc4e8c196da19e012583 &amp; size: 656,775 bytes, and the “TftpServer<strong>.</strong>app” has 731,378 bytes. DMG file contains APP file. We found mention of updated version v3.5.1 on author&#039;s older website via <code>Internet Archive Wayback Machine</code>, obtained on April 27, 2020<sup><a href="https://web.archive.org/web/20200427215239/http://ww2.unime.it/flr/tftpserver/" class="urlextern" title="https://web.archive.org/web/20200427215239/http://ww2.unime.it/flr/tftpserver/" rel="ugc nofollow">1</a></sup>.</div>
</li>
<li class="level1"><div class="li"> Author&#039;s contact info: <em>fabrizio.larosa.nospam<strong>@</strong>unime5<strong>.</strong>it</em> (<em>remove the <code>.nospam</code> portion &amp; remove the <code>5</code>, to get author&#039;s actual email address</em>) or <em>fab.larosa.spamnotallowed<strong>@</strong>gmail1<strong>.</strong>com</em> (<em>remove the <code>.spamnotallowed</code> portion &amp; remove the <code>1</code>, to get author&#039;s actual email address</em>).</div>
</li>
</ul>
<ol>
<li class="level1"><div class="li"> Download <code>dmg</code> file from the <abbr title="Uniform Resource Locator">URL</abbr><sup><a href="http://ww2.unime.it/flr/tftpserver/" class="urlextern" title="http://ww2.unime.it/flr/tftpserver/" rel="ugc nofollow">1</a></sup> mentioned above, and install the <code>TftpServer.app</code> inside that <code>dmg</code> file. Do not download this app or dmg file from any untrustworthy websites. Do not download unknown version or “new” versions, that is not-shared or not-mentioned by actual author.</div>
</li>
<li class="level1"><div class="li"> Move the application to a convenient directory.</div>
</li>
<li class="level1"><div class="li"> In the same directory, create another folder named &#039;tftpfiles&#039;. This is the &#039;designated <abbr title="Trivial File Transfer Protocol">TFTP</abbr> directory&#039;. <em>TftpServer.app and tftpfiles will be in the same directory.</em></div>
</li>
<li class="level1"><div class="li"> Set the OSX <abbr title="Internet Protocol">IP</abbr> address as specified in the Device Page&#039;s <abbr title="Trivial File Transfer Protocol">TFTP</abbr> Recovery section.</div>
</li>
<li class="level1"><div class="li"> Launch TftpServer.app. The window is shown here. <em>You should confirm that you see the desired file named in the window.</em> <br/>
:<a href="/_detail/media/tftpserver-osx.png?id=docs%3Aguide-user%3Atroubleshooting%3Atftpserver" class="media" title="media:tftpserver-osx.png"><img src="/_media/media/tftpserver-osx.png?w=200&amp;tok=faa3d8" class="media" loading="lazy" alt="" width="200" /></a> </div>
</li>
<li class="level1"><div class="li"> Click “Start <abbr title="Trivial File Transfer Protocol">TFTP</abbr>” (upper left). <em>You should see the “Server Status:” change to “Running”.</em></div>
</li>
<li class="level1"><div class="li"> Start your router and press the button. <em>The file will transfer.</em></div>
</li>
<li class="level1"><div class="li"> <em>Note:</em> TftpServer.app may give warnings about file permissions. Use the “Fix” buttons at the bottom of the window to set the permissions properly.</div>
</li>
<li class="level1"><div class="li"> Click “Stop <abbr title="Trivial File Transfer Protocol">TFTP</abbr>” or quit the application to stop the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server.</div>
</li>
<li class="level1"><div class="li"> Precautions : keep this app firewalled <em>(and allow only <abbr title="Local Area Network">LAN</abbr> based <abbr title="Trivial File Transfer Protocol">TFTP</abbr>)</em>, or disable this app when you are done working with <abbr title="Trivial File Transfer Protocol">TFTP</abbr>, or disable this app when you pause to goto other work. Do not keep this app continuously running.</div>
</li>
</ol>

<p>
<br/>

</p>

</div>

<h4 id="pumpkinapp_on_macos">PumpKIN.app (on macOS):</h4>
<div class="level4">

<p>
This app <code>PumpKIN.app</code> has <abbr title="Graphical User Interface">GUI</abbr> interface and also contains builtin <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server &amp; client functionalities, it can be obtained from <a href="https://kin.klever.net/pumpkin/" class="urlextern" title="https://kin.klever.net/pumpkin/" rel="ugc nofollow">https://kin.klever.net/pumpkin/</a> website. <a href="https://kin.klever.net/pumpkin/binaries/" class="urlextern" title="https://kin.klever.net/pumpkin/binaries/" rel="ugc nofollow">Dnld</a>, <a href="https://kin.klever.net/pumpkin/repository/" class="urlextern" title="https://kin.klever.net/pumpkin/repository/" rel="ugc nofollow">Src</a>, Tech description <a href="https://kin.klever.net/pumpkin/description/" class="urlextern" title="https://kin.klever.net/pumpkin/description/" rel="ugc nofollow">here</a>, Help file <a href="https://kin.klever.net/pumpkin/help/" class="urlextern" title="https://kin.klever.net/pumpkin/help/" rel="ugc nofollow">here</a>.
</p>
<ul>
<li class="level1"><div class="li"> It is developed by Michael Krelin ( <em>hacker.nospam<strong>@</strong>klever5<strong>.</strong>net</em> , <em>remove the <code>.nospam</code> portion &amp; remove the <code>5</code>, to get author&#039;s actual contact info</em> ).</div>
</li>
<li class="level1"><div class="li"> The <code>pumpkin-0.0.1-osx.dmg</code> file has SHA256: 0f857db4ae91907946cfc050f72a17714524d3380fb1e8bc8cb25acfd5f83a67 &amp; size: 796,711 bytes, and the <code>PumpKIN.app</code> size: 876,994 bytes.</div>
</li>
<li class="level1"><div class="li"> Precautions : keep this app firewalled <em>(and allow only <abbr title="Local Area Network">LAN</abbr> based <abbr title="Trivial File Transfer Protocol">TFTP</abbr>)</em>, or disable this app when you are done working with <abbr title="Trivial File Transfer Protocol">TFTP</abbr>, or disable this app when you pause to goto other work. Do not keep this app continuously running.</div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h4 id="toolspkgs_via_pkg-mngr_on_macos">Tools/Pkgs via Pkg-Mngr (on macOS):</h4>
<div class="level4">

<p>
macOS compatible <em>(3rd-party)</em> pkg-mngr <em>(package-manager)</em> info is displayed in <a href="/docs/guide-developer/toolchain/buildroot.exigence.macosx" class="wikilink1" title="docs:guide-developer:toolchain:buildroot.exigence.macosx" data-wiki-id="docs:guide-developer:toolchain:buildroot.exigence.macosx">buildroot.exigence.macosx</a> page, inside <code>Install Package Manager</code> section.
</p>

<p>
if you have MacPorts pkg-mngr, then run<strong>:</strong> 
</p>
<pre class="code bash"> $ <span class="kw2">sudo</span> port <span class="kw2">install</span> inetutils dnsmasq </pre>
<ul>
<li class="level1"><div class="li"> the <code>inetutils</code> pkg includes <code>telnet</code>, <code>ftp</code>, <code>rsh</code>, <code>rlogin</code>, <code>tftp</code> client tools, and also includes corresponding daemons/servers, as bundle<sup><a href="https://ports.macports.org/search/?q=utils&amp;name=on" class="urlextern" title="https://ports.macports.org/search/?q=utils&amp;name=on" rel="ugc nofollow">1</a></sup>.</div>
</li>
</ul>

<p>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting up a TFTP server on macOS&quot;,&quot;hid&quot;:&quot;setting_up_a_tftp_server_on_macos&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;6296-13314&quot;} -->
<h3 class="sectionedit10" id="setting_up_a_tftp_server_on_windows">Setting up a TFTP server on Windows</h3>
<div class="level3">

<p>
While there is a command line <abbr title="Trivial File Transfer Protocol">TFTP</abbr> <strong>client</strong> feature in Windows, Microsoft has stopped shipping a tftp <strong>server</strong> for security reasons. A third party tftp server will therefore be required.
</p>

<p>
The built-in client tftp feature can be installed from an administrator cmd.exe command prompt as follows: 
</p>
<pre class="code">Dism /online /Enable-Feature /FeatureName:TFTP /All</pre>

<p>
 (You can use the client to test if your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is working.)
<br/>

Regardless of which <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server below that you choose to use, you will need to open a local firewall rule to allow inbound client <abbr title="Trivial File Transfer Protocol">TFTP</abbr> connections from the local subnet. For security reasons, only traffic from the local <abbr title="Local Area Network">LAN</abbr> subnet should be allowed. Start a cmd.exe prompt as admin then run:
</p>
<pre class="code">netsh advfirewall firewall add rule name=&quot;TFTP&quot; dir=in action=allow protocol=udp localport=69 remoteip=localsubnet interfacetype=lan profile=private,public</pre>

<p>
<br/>

</p>

</div>

<h4 id="tftpd64_on_windows">Tftpd64 (on Windows):</h4>
<div class="level4">

<p>
A simple and free <abbr title="Trivial File Transfer Protocol">TFTP</abbr> application is <strong>Tftpd64</strong>, available <a href="http://tftpd32.jounin.net/" class="urlextern" title="http://tftpd32.jounin.net/" rel="ugc nofollow">here</a>.
</p>

<p>
Download the portable version, and unzip it in a folder. You should see the manual, a license in a PDF file, a configuration file, and the application executable itself.
</p>

<p>
Place the file you want to send (the firmware file usually) in the same folder where you find the <strong>Tftpd64</strong> program file. The folder exposed through <abbr title="Trivial File Transfer Protocol">TFTP</abbr> can be changed by clicking on Browse button, but in most situations you don&#039;t need to do that.
</p>

<p>
Configure your Ethernet port according to your device&#039;s own recovery method as detailed in <a href="/docs/guide-user/troubleshooting/vendor_specific_rescue" class="wikilink1" title="docs:guide-user:troubleshooting:vendor_specific_rescue" data-wiki-id="docs:guide-user:troubleshooting:vendor_specific_rescue">Rescue from failed firmware upgrade</a>, note that in most cases you can&#039;t use that port to connect to the internet until you reconfigure it back like it was before.
</p>

<p>
This application might stop listening on the local <abbr title="User Datagram Protocol">UDP</abbr> port at the very moment that you need it, i.e. when the router at the other end of the network connection restarts. To work around this issue, do one of the following:
</p>
<ul>
<li class="level1"><div class="li"> Disable <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/disable-media-sensing-feature-for-tcpip" class="urlextern" title="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/disable-media-sensing-feature-for-tcpip" rel="ugc nofollow">media sensing</a>:<pre class="code">netsh interface ipv4 set global dhcpmediasense=disabled
netsh interface ipv6 set global dhcpmediasense=disabled</pre>
</div>
</li>
<li class="level1"><div class="li"> Use a switch between the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> host and the client router so that the network link of the Windows machine remains up while the router is rebooting.</div>
</li>
</ul>

<p>
Double-click on the <strong>Tftpd64</strong> program file and you should get a Windows Firewall popup asking you to grant access. Check both options, to allow <strong>Tftpd64</strong> to communicate over both home/work but <em>not</em> public networks. This is very important, if the Windows Firewall blocks your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server you won&#039;t be able to access it from the device you want to recover.
</p>

<p>
Click on the drop-down menu called <strong>Server Interfaces</strong> and select your PC&#039;s Ethernet port.
</p>

<p>
Now the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is online and ready, and the file(s) in it can be accessed as normal.
<br/>
<br/>

</p>

</div>

<h4 id="tiny_pxe_on_windows">Tiny PXE (on Windows):</h4>
<div class="level4">

<p>
<a href="http://reboot.pro/files/file/303-tiny-pxe-server/" class="urlextern" title="http://reboot.pro/files/file/303-tiny-pxe-server/" rel="ugc nofollow">Tiny PXE</a> seems to do the same as Tftpd64 plus BOOTP support (particularly useful for <a href="/toh/mikrotik/common" class="wikilink1" title="toh:mikrotik:common" data-wiki-id="toh:mikrotik:common">MikroTik devices</a>).
<br/>
<br/>

</p>

</div>

<h4 id="solarwinds_tftp_server">Solarwinds TFTP Server</h4>
<div class="level4">

<p>
A free <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server for Windows can be downloaded <a href="https://www.solarwinds.com/free-tools/free-tftp-server" class="urlextern" title="https://www.solarwinds.com/free-tools/free-tftp-server" rel="ugc nofollow">here</a> (registration is required).
</p>
<ul>
<li class="level1"><div class="li"> The default install will use the directory <code>C:\<abbr title="Trivial File Transfer Protocol">TFTP</abbr>-Root</code> - place your firmware file in this directory and rename it per the instructions for your specific device.</div>
</li>
<li class="level1"><div class="li"> Under File | Configure | Security, set “Send files” as the only permissible action.</div>
</li>
<li class="level1"><div class="li"> Change the local <abbr title="Local Area Network">LAN</abbr> <abbr title="Internet Protocol">IP</abbr> address of your computer to the static <abbr title="Internet Protocol">IP</abbr> that your router expects.</div>
</li>
<li class="level1"><div class="li"> Follow the procedure for your specific router to trigger its <abbr title="Trivial File Transfer Protocol">TFTP</abbr> client to download the firmware image you are hosting.</div>
</li>
<li class="level1"><div class="li"> Watch the Solarwinds console to ensure that the router has downloaded the firmware file.</div>
</li>
</ul>

<p>
<span style='color:#ed1c24; '><strong>Important: Stop the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> service and prevent it from auto-restarting as soon as you are done so your machine is not left in an insecure configuration:</strong></span>
</p>
<pre class="code">sc config &quot;Solarwinds TFTP Server&quot; start=demand
sc stop &quot;Solarwinds TFTP Server&quot;</pre>

<p>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting up a TFTP server on Windows&quot;,&quot;hid&quot;:&quot;setting_up_a_tftp_server_on_windows&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:10,&quot;range&quot;:&quot;13315-17563&quot;} -->
<h3 class="sectionedit11" id="setting_up_a_tftp_server_on_linux">Setting up a TFTP server on Linux</h3>
<div class="level3">

</div>

<h4 id="dnsmasq_on_linux">dnsmasq (on Linux):</h4>
<div class="level4">

<p>
<strong>dnsmasq</strong> is pre-installed in most distributions.
</p>

<p>
Create directory where you want to put the recovery image file: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">mkdir</span> <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Put an image file into your directory - actual name will vary: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">cp</span> ~<span class="sy0">/</span>tp_recovery.bin <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Run <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server: 
</p>
<pre class="code bash"><span class="co4">bash# </span> dnsmasq <span class="re5">--listen-address</span>=0.0.0.0 <span class="re5">--port</span>=<span class="nu0">0</span> <span class="re5">--enable-tftp</span> <span class="re5">--tftp-root</span>=<span class="sy0">/</span>srv<span class="sy0">/</span>tftp <span class="re5">--tftp-no-blocksize</span> <span class="re5">--user</span>=root <span class="re5">--group</span>=root </pre>

<p>
Check if your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is listening: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">netstat</span> <span class="re5">-lunp</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="nu0">69</span> </pre>

<p>
<br/>

</p>

</div>

<h4 id="atftpd_on_linux">atftpd (on Linux):</h4>
<div class="level4">

<p>
You can also use <strong>atftpd</strong>:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">

<p>
Install atftpd from repository on Debian/Ubuntu/Mint: 
</p>
<pre class="code bash"><span class="co4">bash# </span> apt <span class="kw2">install</span> atftpd </pre>
</td><td class="columns-plugin last">

<p>
Install atftpd from repository on RedHat/Fedora/Centos: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">yum install</span> atftpd </pre>
</td></tr></table>

<p>
Create directory where you want to put the recovery image file: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">mkdir</span> <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Put an image file into your directory - actual name will vary: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">cp</span> ~<span class="sy0">/</span>tp_recovery.bin <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Change the ownership of the folder and the file in it: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">chown</span> nobody:nogroup <span class="re5">-R</span> <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Run <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server (run as daemon, do not fork, log events to stdout): 
</p>
<pre class="code bash"><span class="co4">bash# </span> atftpd <span class="re5">--daemon</span> <span class="re5">--no-fork</span> <span class="re5">--logfile</span> - <span class="sy0">/</span>srv<span class="sy0">/</span>tftp </pre>

<p>
Check if your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is listening: 
</p>
<pre class="code bash"><span class="co4">bash# </span> <span class="kw2">netstat</span> <span class="re5">-lunp</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="nu0">69</span> </pre>

<p>
Or if netstat is not available: 
</p>
<pre class="code bash"><span class="co4">bash# </span> ss <span class="re5">-lunp</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="nu0">69</span> </pre>
<ul>
<li class="level1"><div class="li"> <em>If not set, you should try running <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server as superuser.</em></div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h4 id="testing_tftp_server_on_linux">Testing TFTP server (on Linux):</h4>
<div class="level4">

<p>
<strong>Check that you can in fact pull the file from your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server.</strong>
Preferably from another computer call your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server <abbr title="Internet Protocol">IP</abbr>: (<em>or if not possible, in same server call <abbr title="Internet Protocol">IP</abbr> 127.0.0.1</em>): 
</p>
<pre class="code bash"><span class="co4">bash# </span> tftp 192.168.0.66
tftp<span class="sy0">&gt;</span> get tp_recovery.bin
Received <span class="nu0">8152633</span> bytes <span class="kw1">in</span> <span class="nu0">0.8</span> seconds
tftp<span class="sy0">&gt;</span> quit </pre>

<p>
If you have received the file, congratulations, it&#039;s ready.
<br/>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting up a TFTP server on Linux&quot;,&quot;hid&quot;:&quot;setting_up_a_tftp_server_on_linux&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:11,&quot;range&quot;:&quot;17564-19633&quot;} -->
<h2 class="sectionedit12" id="troubleshooting_steps">Troubleshooting steps</h2>
<div class="level2">

<p>
<abbr title="Trivial File Transfer Protocol">TFTP</abbr> file transfer doesn&#039;t work from local computer
</p>
<ul>
<li class="level1"><div class="li"> Check if your <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is running and listening</div>
</li>
<li class="level1"><div class="li"> Check if <abbr title="Trivial File Transfer Protocol">TFTP</abbr> folder is set up correctly (location, access rights)</div>
</li>
<li class="level1"><div class="li"> Check if firmware file is set up correctly (location, access rights)</div>
</li>
</ul>

<p>
<abbr title="Trivial File Transfer Protocol">TFTP</abbr> file transfer works from local computer, but not from another computer:
</p>
<ul>
<li class="level1"><div class="li"> Check if network cable is connected properly</div>
</li>
<li class="level1"><div class="li"> Check if server <abbr title="Internet Protocol">IP</abbr> is set correctly</div>
</li>
<li class="level1"><div class="li"> Check that you have opened up <abbr title="User Datagram Protocol">UDP</abbr> 69 traffic from the local subnet in the host firewall.</div>
</li>
<li class="level1"><div class="li"> Restart the server if you have just changed the local host <abbr title="Internet Protocol">IP</abbr> address.</div>
</li>
<li class="level1"><div class="li"> Run a packet sniffing tool like <a href="https://www.wireshark.org/" class="urlextern" title="https://www.wireshark.org/" rel="ugc nofollow">Wireshark</a>, while using “tftp” as the display filter.</div>
</li>
</ul>

<p>
<abbr title="Trivial File Transfer Protocol">TFTP</abbr> file transfer works from another computer, but not from router:
</p>
<ul>
<li class="level1"><div class="li"> Check if server <abbr title="Internet Protocol">IP</abbr> is set correctly (same as router is searching for)</div>
</li>
<li class="level1"><div class="li"> Check that the host running the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server is using the specific fixed <abbr title="Internet Protocol">IP</abbr> address and subnet mask that your router is expecting to use.</div>
</li>
<li class="level1"><div class="li"> Try using alternate cable, a crossover cable or alternate switch/speed</div>
</li>
<li class="level1"><div class="li"> Try connecting to an alternate port on the router / routers switch</div>
</li>
<li class="level1"><div class="li"> Pay attention to any output or verbosity from the router console or led activity if available</div>
</li>
<li class="level1"><div class="li"> Verify the arp cache on either host... server side is easier... </div>
</li>
<li class="level1"><div class="li"> Use arp -s to add a static mapping or arp -d to delete stale entries...</div>
</li>
<li class="level1"><div class="li"> Use a third host to simply ping the router, both with static addresses if possible</div>
</li>
<li class="level1"><div class="li"> Try an alternate server software, client software or <abbr title="Trivial File Transfer Protocol">TFTP</abbr> transfer mode</div>
</li>
<li class="level1"><div class="li"> If you get some activity, timing can often yield results, power cycle the router and start the transfer earlier or later...</div>
</li>
<li class="level1"><div class="li"> Check that you have downloaded a firmware image that contains “tftp” in its filename, and that you have renamed this file to the specific OEM filename that your router is expecting.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting steps&quot;,&quot;hid&quot;:&quot;troubleshooting_steps&quot;,&quot;codeblockOffset&quot;:23,&quot;secid&quot;:12,&quot;range&quot;:&quot;19634-&quot;} -->