
<h1 class="sectionedit1" id="ipv4_benchmark_network_address_translation">IPv4 Benchmark Network Address Translation</h1>
<div class="level1">

<p>
After you install OpenWrt on your Router you should do a <em>Network Address Translation Benchmark</em> to know how well it performs address translation of network packets between your local network (<abbr title="Local Area Network">LAN</abbr>) to your internet service provider (<abbr title="Wide Area Network">WAN</abbr>).
</p>

<p>
The diagram below shows the general layout of the benchmark test described below:
</p>

<p>
<a href="/_detail/media/jperf-ipv4-setup.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:jperf-ipv4-setup.png"><img src="/_media/media/jperf-ipv4-setup.png?w=600&amp;tok=199f04" class="media" loading="lazy" alt="" width="600" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv4 Benchmark Network Address Translation&quot;,&quot;hid&quot;:&quot;ipv4_benchmark_network_address_translation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-421&quot;} -->
<h2 class="sectionedit2" id="rationale">Rationale</h2>
<div class="level2">

<p>
It is important to know the performance of the router in order to maximise the subscription you are paying to your internet service provider for the bandwidth allocated.
</p>

<p>
In order to make full use of the bandwidth you are paying for, the router has to be able to process network packets at rates that exceed the bandwidth of the subscription you are paying for.
</p>

<p>
You should not take benchmarks found online as a reference because it is now using OpenWrt iptables (Masquerade) to perform translation of ip address of network packets instead of the factory firmware network stack implementation.
</p>

<p>
For a graphical approach to testing you can follow the methods to utilise jperf to benchmark Network Address Translation performance as described below:
</p>

<p>
<a href="http://code.google.com/p/xjperf/‎" class="urlextern" title="http://code.google.com/p/xjperf/‎" rel="ugc nofollow">Jperf</a> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> (as of Jun-2020 the link seems not to be correct) is <a href="http://en.wikipedia.org/wiki/Iperf‎" class="urlextern" title="http://en.wikipedia.org/wiki/Iperf‎" rel="ugc nofollow">Iperf</a> with a Java graphical frontend.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Rationale&quot;,&quot;hid&quot;:&quot;rationale&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;422-1379&quot;} -->
<h2 class="sectionedit3" id="prerequisites">Prerequisites</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Jperf requires the installation of a Java Runtime before it can be used.</div>
</li>
<li class="level1"><div class="li"> You can obtain Java Runtime by using OpenJRE on Linux or you can download and install JRE from Oracle Website.</div>
</li>
<li class="level1"><div class="li"> You need 2 gigabit capable computers, one as a server, the other as the client both with Java Runtime installed.</div>
</li>
<li class="level1"><div class="li"> You should do this on an isolated network to ensure accurate results with minimal disruptions also because some settings used for benchmarking may not be secure.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prerequisites&quot;,&quot;hid&quot;:&quot;prerequisites&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1380-1882&quot;} -->
<h2 class="sectionedit4" id="method">Method</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> Download Jperf on both the client and the server.</div>
</li>
<li class="level1"><div class="li"> Plug the Server&#039;s gigabit Port to the <abbr title="Wide Area Network">WAN</abbr> port on the Router.</div>
</li>
<li class="level1"><div class="li"> Plug the Client&#039;s gigabit to any <abbr title="Local Area Network">LAN</abbr> port on the Router.</div>
</li>
<li class="level1"><div class="li"> In order to simplify the steps involved we will use 10.1.1.0/24 as the <abbr title="Wide Area Network">WAN</abbr> Network and the default 192.168.1.0/24 as the <abbr title="Local Area Network">LAN</abbr> Network</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Method&quot;,&quot;hid&quot;:&quot;method&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1883-2222&quot;} -->
<h3 class="sectionedit5" id="wan_network_settings">WAN Network Settings</h3>
<div class="level3">

<p>
On the Client Computer using Web Browser,Telnet or <abbr title="Secure Shell">SSH</abbr> get to the Router Configuration Page at <abbr title="Internet Protocol">IP</abbr> Address 192.168.1.1 and set the network settings on the Router <abbr title="Wide Area Network">WAN</abbr> Interface to
</p>
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Protocol          </th><td class="col1 leftalign"> Static          </td>
	</tr>
	<tr class="row1">
		<th class="col0 leftalign"> <abbr title="Internet Protocol">IP</abbr> Address        </th><td class="col1 leftalign"> 10.1.1.1        </td>
	</tr>
	<tr class="row2">
		<th class="col0 leftalign"> Subnet Mask       </th><td class="col1 leftalign"> 255.255.255.0   </td>
	</tr>
	<tr class="row3">
		<th class="col0 leftalign"> Default Gateway   </th><td class="col1 leftalign">                 </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;2434-2593&quot;} -->
<p>
<a href="/_detail/media/doc/howtos/openwrt_server_wan.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:doc:howtos:openwrt_server_wan.png"><img src="/_media/media/doc/howtos/openwrt_server_wan.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
Click Save and Apply.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;WAN Network Settings&quot;,&quot;hid&quot;:&quot;wan_network_settings&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;2223-2663&quot;} -->
<h3 class="sectionedit7" id="server_network_settings">Server Network Settings</h3>
<div class="level3">

<p>
On the Server use its own network configuration tool to set the network settings to
</p>
<div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Protocol          </th><td class="col1 leftalign"> Static          </td>
	</tr>
	<tr class="row1">
		<th class="col0 leftalign"> <abbr title="Internet Protocol">IP</abbr> Address        </th><td class="col1 leftalign"> 10.1.1.2        </td>
	</tr>
	<tr class="row2">
		<th class="col0 leftalign"> Subnet Mask       </th><td class="col1 leftalign"> 255.255.255.0   </td>
	</tr>
	<tr class="row3">
		<th class="col0 leftalign"> Default Gateway   </th><td class="col1 leftalign"> 10.1.1.1        </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;2784-2943&quot;} -->
<p>
<a href="/_detail/media/doc/howtos/server.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:doc:howtos:server.png"><img src="/_media/media/doc/howtos/server.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
Click Save and Apply.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Server Network Settings&quot;,&quot;hid&quot;:&quot;server_network_settings&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2664-3001&quot;} -->
<h3 class="sectionedit9" id="network_settings_verification">Network Settings Verification</h3>
<div class="level3">

<p>
By this step your client should be able to ping the server successfully by the command:
</p>
<pre class="code">ping 10.1.1.2 </pre>

<p>
You should get a series of ping echo response if not recheck your network settings or turn off your firewall on both the Client and the Server.
There is no need to change the <abbr title="Local Area Network">LAN</abbr> Settings as by default OpenWrt sets <abbr title="Local Area Network">LAN</abbr> to 192.168.1.0/24 in <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> Mode.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Network Settings Verification&quot;,&quot;hid&quot;:&quot;network_settings_verification&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;3002-3410&quot;} -->
<h2 class="sectionedit10" id="setting_up_jperf">Setting Up Jperf</h2>
<div class="level2">

<p>
Extract the compressed files in Jperf to a folder.
If you are running Linux you might need to set the execute bit on jperf.sh.
Open a Terminal in that directory and run 
</p>
<pre class="code">chmod +x jperf.sh</pre>

<p>
In Windows you run Jperf by double clicking jperf.bat.
In UNIX you run Jperf by executing jperf.sh.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Setting Up Jperf&quot;,&quot;hid&quot;:&quot;setting_up_jperf&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;3411-3741&quot;} -->
<h3 class="sectionedit11" id="set_server_to_listen">Set Server To Listen</h3>
<div class="level3">

<p>
You should be able to see the jperf main screen.
</p>

<p>
You need to set the Jperf on the Server to listen first before we can run the Client.
</p>

<p>
For the Server, simply select Server and change the metric to Mbits for easy reference and comparison as shown below.
</p>

<p>
Then click run Iperf to set the Server to listening mode.
</p>

<p>
For <abbr title="Transmission Control Protocol">TCP</abbr> select <abbr title="Transmission Control Protocol">TCP</abbr> as shown below, for <abbr title="User Datagram Protocol">UDP</abbr> select <abbr title="User Datagram Protocol">UDP</abbr>
</p>

<p>
<a href="/_detail/media/doc/howtos/jperf_server.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:doc:howtos:jperf_server.png"><img src="/_media/media/doc/howtos/jperf_server.png" class="media" loading="lazy" alt="" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Set Server To Listen&quot;,&quot;hid&quot;:&quot;set_server_to_listen&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:11,&quot;range&quot;:&quot;3742-4183&quot;} -->
<h3 class="sectionedit12" id="start_benchmark_on_client">Start Benchmark On Client</h3>
<div class="level3">

<p>
For the Client Computer, simply select Client and enter the Server Address 10.1.1.2 and change the metric to Mbits as well.
</p>

<p>
<a href="/_detail/media/doc/howtos/jperf_client.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:doc:howtos:jperf_client.png"><img src="/_media/media/doc/howtos/jperf_client.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
For <abbr title="User Datagram Protocol">UDP</abbr>, you need to set the bandwidth to line rate eg. 900Mbits and observe the actual throughput on the receiver Server as shown below
</p>

<p>
<a href="/_detail/media/jperf-udp.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:jperf-udp.png"><img src="/_media/media/jperf-udp.png?w=1000&amp;tok=6e2be0" class="media" loading="lazy" alt="" width="1000" /></a>
</p>

<p>
When you are ready click run Iperf to start the test.
After the test ends you should ALWAYS analyse the result on the Server for accuracy instead of the Client since only the network packets that get through matters not the packets generated.
</p>

<p>
<a href="/_detail/media/doc/howtos/jperf_result.png?id=docs%3Aguide-user%3Aperf_and_log%3Abenchmark.nat" class="media" title="media:doc:howtos:jperf_result.png"><img src="/_media/media/doc/howtos/jperf_result.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
For the above picture it indicates that the Router will be generally sufficiently powerful enough for a &lt; 250Mbps Internet Subscription Plan.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_important plugin_wrap" style="width: 80%;">
<p>
Note that OpenWrt does Network Address Translation in Software so any activities that taxes the router&#039;s processor will affect the Network Address Translation performance including accessing the router web server LuCI, Telnet sessions, <abbr title="Secure Shell">SSH</abbr> sessions, Samba file copy etc. Running Network Congestion Control software like SQM also reduces the network throughput performance.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Start Benchmark On Client&quot;,&quot;hid&quot;:&quot;start_benchmark_on_client&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:12,&quot;range&quot;:&quot;4184-&quot;} -->