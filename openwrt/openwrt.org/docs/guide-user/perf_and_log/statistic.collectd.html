
<h1 class="sectionedit1" id="collectd">Collectd</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Collectd&quot;,&quot;hid&quot;:&quot;collectd&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-105&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">

<p>
<a href="/packages/pkgdata/collectd" class="wikilink1" title="packages:pkgdata:collectd" data-wiki-id="packages:pkgdata:collectd">collectd</a> is a small daemon which collects system information periodically and provides mechanisms to store the values in a variety of ways.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;106-292&quot;} -->
<h2 class="sectionedit7" id="installation">Installation</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;293-317&quot;} -->
<h3 class="sectionedit8" id="web_interface_instructions">Web interface instructions</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Install the packagee <a href="/packages/pkgdata/luci-app-statistics" class="wikilink1" title="packages:pkgdata:luci-app-statistics" data-wiki-id="packages:pkgdata:luci-app-statistics">luci-app-statistics</a>.</div>
</li>
<li class="level1"><div class="li"> Configure collectd using the tools in <strong>Statistics → Setup</strong> section of the LuCI web interface.</div>
</li>
</ol>

<p>
By default, collectd saves its RRD data in <code>/tmp/rrd</code> which is a RAM-based directory, so its contents will be lost when the device reboots.
To save the data across power failure/restarts, consider <a href="/docs/guide-user/storage/usb-drives-quickstart" class="wikilink1" title="docs:guide-user:storage:usb-drives-quickstart" data-wiki-id="docs:guide-user:storage:usb-drives-quickstart">adding an external USB Drive</a> and then configuring collectd to save the data to that new storage.
Do this using the <strong>Output plugins → RRDTool</strong> tab in LuCI, configure the <em>Storage directory</em>, or the <em>DataDir</em> command of the <code>&lt;Plugin rrdtool&gt;</code> section of the collectd configuration file at <code>/etc/collectd.conf</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web interface instructions&quot;,&quot;hid&quot;:&quot;web_interface_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;318-1093&quot;} -->
<h3 class="sectionedit9" id="command-line_instructions">Command-line instructions</h3>
<div class="level3">
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> collectd
<span class="kw2">vi</span> <span class="sy0">/</span>etc<span class="sy0">/</span>collectd.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>collectd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;1094-1235&quot;} -->
<h2 class="sectionedit10" id="examples">Examples</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;1236-1256&quot;} -->
<h3 class="sectionedit11" id="minimal">Minimal</h3>
<div class="level3">
<pre class="code bash"><span class="co0"># /etc/collectd.conf</span>
BaseDir <span class="st0">&quot;/var/lib/collectd&quot;</span>
PIDFile <span class="st0">&quot;/var/run/collectd.pid&quot;</span>
Interval <span class="nu0">30</span>
ReadThreads <span class="nu0">2</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Minimal&quot;,&quot;hid&quot;:&quot;minimal&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:11,&quot;range&quot;:&quot;1257-1402&quot;} -->
<h3 class="sectionedit12" id="simple">Simple</h3>
<div class="level3">
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> collectd-mod-rrdtool collectd-mod-processes collectd-mod-interface
&nbsp;
<span class="co0"># /etc/collectd.conf</span>
BaseDir <span class="st0">&quot;/var/run/collectd&quot;</span>
Include <span class="st0">&quot;/etc/collectd/conf.d&quot;</span>
PIDFile <span class="st0">&quot;/var/run/collectd.pid&quot;</span>
PluginDir <span class="st0">&quot;/usr/lib/collectd&quot;</span>
TypesDB <span class="st0">&quot;/usr/share/collectd/types.db&quot;</span>
Interval <span class="nu0">30</span>
ReadThreads <span class="nu0">2</span>
&nbsp;
LoadPlugin cpu
LoadPlugin interface
LoadPlugin load
LoadPlugin memory
LoadPlugin processes
LoadPlugin rrdtool
LoadPlugin <span class="kw2">uptime</span>
&nbsp;
<span class="sy0">&lt;</span>Plugin interface<span class="sy0">&gt;</span>
	IgnoreSelected <span class="kw2">false</span>
	Interface eth0
	Interface eth1
	Interface eth2
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;</span>Plugin processes<span class="sy0">&gt;</span>
	Process uhttpd
	Process dnsmasq
	Process dropbear
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;</span>Plugin rrdtool<span class="sy0">&gt;</span>
	DataDir <span class="st0">&quot;/tmp/rrd&quot;</span>
	RRARows <span class="nu0">100</span>
	RRASingle <span class="kw2">true</span>
	RRATimespan <span class="nu0">3600</span>
	RRATimespan <span class="nu0">86400</span>
	RRATimespan <span class="nu0">604800</span>
	RRATimespan <span class="nu0">2678400</span>
	RRATimespan <span class="nu0">31622400</span>
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Simple&quot;,&quot;hid&quot;:&quot;simple&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:12,&quot;range&quot;:&quot;1403-2227&quot;} -->
<h3 class="sectionedit13" id="advanced">Advanced</h3>
<div class="level3">
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> collectd-mod-rrdtool collectd-mod-iptables collectd-mod-netlink
&nbsp;
<span class="co0"># /etc/collectd.conf</span>
BaseDir <span class="st0">&quot;/var/lib/collectd&quot;</span>
PIDFile <span class="st0">&quot;/var/run/collectd.pid&quot;</span>
Interval <span class="nu0">30</span>
ReadThreads <span class="nu0">2</span>
&nbsp;
LoadPlugin iptables
LoadPlugin netlink
LoadPlugin rrdtool
&nbsp;
<span class="co0"># Use only iptables filter</span>
<span class="sy0">&lt;</span>Plugin iptables<span class="sy0">&gt;</span>
	chain mangle TC_USER1
	chain mangle TC_USER2
	chain mangle TC_USER3
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;</span>Plugin netlink<span class="sy0">&gt;</span>
	VerboseInterface pppoe-dsl
	QDisc <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:0&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:1&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:10&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:101&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:102&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:103&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:20&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:201&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:202&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:203&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:30&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:301&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:302&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:303&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:40&quot;</span>
	Class <span class="st0">&quot;pppoe-dsl&quot;</span> <span class="st0">&quot;hfsc-1:50&quot;</span>
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span>
&nbsp;
<span class="sy0">&lt;</span>Plugin rrdtool<span class="sy0">&gt;</span>
	DataDir <span class="st0">&quot;/mnt/storage/rrd&quot;</span>
	CacheTimeout <span class="nu0">120</span>
	CacheFlush <span class="nu0">900</span>
<span class="sy0">&lt;/</span>Plugin<span class="sy0">&gt;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Advanced&quot;,&quot;hid&quot;:&quot;advanced&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:13,&quot;range&quot;:&quot;2228-3297&quot;} -->
<h3 class="sectionedit14" id="ping_check">Ping check</h3>
<div class="level3">

<p>
A simple ping check by <abbr title="Internet Protocol">IP</abbr> address.
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> luci-app-statistics collectd-mod-ping
uci <span class="kw1">set</span> luci_statistics.collectd_network.enable=<span class="st0">&quot;1&quot;</span>
uci <span class="kw1">set</span> luci_statistics.collectd_ping.enable=<span class="st0">&quot;1&quot;</span>
uci <span class="kw1">set</span> luci_statistics.collectd_ping.Hosts=<span class="st0">&quot;8.8.8.8 8.8.4.4&quot;</span>
uci commit luci_statistics
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>luci_statistics restart
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>collectd restart
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>rpcd restart</pre>

<p>
Ping check by domain name.
Note that collectd <a href="https://forum.openwrt.org/t/collectd-network-plugin-getaddrinfo-failed-system-error/90546" class="urlextern" title="https://forum.openwrt.org/t/collectd-network-plugin-getaddrinfo-failed-system-error/90546" rel="ugc nofollow">always prefers IPv6</a> if not specified otherwise.
</p>
<pre class="code bash">uci <span class="kw1">set</span> luci_statistics.collectd_ping.Hosts=<span class="st0">&quot;openwrt.org&quot;</span>
uci <span class="kw1">set</span> luci_statistics.collectd_ping.AddressFamily=<span class="st0">&quot;ipv4&quot;</span>
uci commit luci_statistics
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>luci_statistics restart</pre>

<p>
Navigate to <strong>LuCI → Statistics → Graphs → Ping</strong> to see visualization results.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Ping check&quot;,&quot;hid&quot;:&quot;ping_check&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:14,&quot;range&quot;:&quot;3298-4192&quot;} -->
<h2 class="sectionedit15" id="graphs_and_visualization">Graphs and visualization</h2>
<div class="level2">

<p>
collectd is strictly a statistics collection service and does not provide any way to visualize the gathered data.
To enable visualization of the gathered data, install and configure the packages <a href="/packages/pkgdata/luci-app-statistics" class="wikilink1" title="packages:pkgdata:luci-app-statistics" data-wiki-id="packages:pkgdata:luci-app-statistics">luci-app-statistics</a> and <a href="/packages/pkgdata/collectd-mod-rrdtool" class="wikilink1" title="packages:pkgdata:collectd-mod-rrdtool" data-wiki-id="packages:pkgdata:collectd-mod-rrdtool">collectd-mod-rrdtool</a>.
The statistics gathered by collectd should then be viewable in the LuCI web interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Graphs and visualization&quot;,&quot;hid&quot;:&quot;graphs_and_visualization&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:15,&quot;range&quot;:&quot;4193-4600&quot;} -->
<h2 class="sectionedit16" id="persistent_data_storage">Persistent data storage</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/save-luci-statistics-collectd-across-reboot/75785/16?u=tmomas" class="urlextern" title="https://forum.openwrt.org/t/save-luci-statistics-collectd-across-reboot/75785/16?u=tmomas" rel="ugc nofollow">Script for periodic data backup</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/collectd-a-good-place-to-save-rrd-file/105113/2?u=tmomas" class="urlextern" title="https://forum.openwrt.org/t/collectd-a-good-place-to-save-rrd-file/105113/2?u=tmomas" rel="ugc nofollow">Where data can be stored and where not</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Persistent data storage&quot;,&quot;hid&quot;:&quot;persistent_data_storage&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:16,&quot;range&quot;:&quot;4601-4900&quot;} -->
<h2 class="sectionedit17" id="references">References</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://www.collectd.org/" class="urlextern" title="https://www.collectd.org/" rel="ugc nofollow">https://www.collectd.org/</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://collectd.org/documentation/manpages/collectd.1.shtml" class="urlextern" title="http://collectd.org/documentation/manpages/collectd.1.shtml" rel="ugc nofollow">collectd(1)</a>, <a href="http://collectd.org/documentation/manpages/collectd.conf.5.shtml" class="urlextern" title="http://collectd.org/documentation/manpages/collectd.conf.5.shtml" rel="ugc nofollow">collectd.conf(5)</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://oss.oetiker.ch/rrdtool/" class="urlextern" title="https://oss.oetiker.ch/rrdtool/" rel="ugc nofollow">https://oss.oetiker.ch/rrdtool/</a></div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/perf_and_log/statistic.rrdtool" class="wikilink1" title="docs:guide-user:perf_and_log:statistic.rrdtool" data-wiki-id="docs:guide-user:perf_and_log:statistic.rrdtool">statistic.rrdtool</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;References&quot;,&quot;hid&quot;:&quot;references&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:17,&quot;range&quot;:&quot;4901-&quot;} -->