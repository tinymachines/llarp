
<h1 class="sectionedit1" id="watchcat_-_network_watchdog_utility">Watchcat - network watchdog utility</h1>
<div class="level1">

<p>
Install the packages <a href="/packages/pkgdata/watchcat" class="wikilink1" title="packages:pkgdata:watchcat" data-wiki-id="packages:pkgdata:watchcat">watchcat</a> and <a href="/packages/pkgdata/luci-app-watchcat" class="wikilink1" title="packages:pkgdata:luci-app-watchcat" data-wiki-id="packages:pkgdata:luci-app-watchcat">luci-app-watchcat</a>.
</p>

<p>
Watchcat is a ping-watchdog utility that allows you to set up rules for when a ping to a particular host fails.
</p>

<p>
The following modes of operation are available
</p>
<ul>
<li class="level1"><div class="li"> <strong>Ping Reboot</strong>: reboot the OpenWrt device if a ping to a specific host fails</div>
</li>
<li class="level1"><div class="li"> <strong>Restart Interface</strong>: restart a network interface if a ping to a host over that interface fails</div>
</li>
<li class="level1"><div class="li"> <strong>Periodic Reboot</strong>: reboot at a set period of time, such as every 24h.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Watchcat - network watchdog utility&quot;,&quot;hid&quot;:&quot;watchcat_-_network_watchdog_utility&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-566&quot;} -->
<h2 class="sectionedit2" id="parameters">Parameters</h2>
<div class="level2">

<p>
<code>mode</code> - the mode this watchcat instance is in.
</p>
<ul>
<li class="level1"><div class="li"> <code>ping_reboot</code></div>
</li>
<li class="level1"><div class="li"> <code>restart_iface</code></div>
</li>
<li class="level1"><div class="li"> <code>periodic_reboot</code></div>
</li>
</ul>

<p>
<code>period</code> - the way this parameter is used depends on the mode watchcat is in:
</p>
<ul>
<li class="level1"><div class="li"> Periodic Reboot: the interval of time at which to perform the reboot, such as every 24h</div>
</li>
<li class="level1"><div class="li"> Ping Reboot: the longest interval of time without a successful ping before the rule is activated</div>
</li>
<li class="level1"><div class="li"> Restart Interface: the longest interval of time without a successful ping before the rule is activated</div>
</li>
</ul>

<p>
<strong>Period examples</strong>
</p>
<ul>
<li class="level1"><div class="li"> 10 seconds would be: <code>10</code> or <code>10s</code></div>
</li>
<li class="level1"><div class="li"> 5 minutes would be: <code>5m</code></div>
</li>
<li class="level1"><div class="li"> 1 hour would be: <code>1h</code></div>
</li>
<li class="level1"><div class="li"> 1 week would be: <code>7d</code></div>
</li>
</ul>

<p>
<code>pinghosts</code> - In Ping Reboot and Restart Interface modes, the host(s) to ping/monitor
</p>

<p>
<code>pingperiod</code> - how often to ping
</p>

<p>
<strong>Ping Period examples</strong>
</p>
<ul>
<li class="level1"><div class="li"> every 10 seconds would be: <code>10</code> or <code>10s</code></div>
</li>
<li class="level1"><div class="li"> every 5 minutes would be: <code>5m</code></div>
</li>
<li class="level1"><div class="li"> every 1 hour would be: <code>1h</code></div>
</li>
<li class="level1"><div class="li"> every week would be: <code>7d</code></div>
</li>
</ul>

<p>
<code>pingsize</code> - the size of packet to use for pings.
</p>

<p>
<strong>Supported ping size values</strong>
</p>
<ul>
<li class="level1"><div class="li"> <code>small</code> - 1 byte</div>
</li>
<li class="level1"><div class="li"> <code>windows</code> - 32 bytes</div>
</li>
<li class="level1"><div class="li"> <code>standard</code> - 56 bytes</div>
</li>
<li class="level1"><div class="li"> <code>big</code> - 248 bytes</div>
</li>
<li class="level1"><div class="li"> <code>huge</code> - 1492 bytes</div>
</li>
<li class="level1"><div class="li"> <code>jumbo</code> - 9000 bytes</div>
</li>
</ul>

<p>
<code>interface</code> - the interface to ping via, and also, in Restart Interface mode the one to restart.
If unset, it will use the default route&#039;s interface.
</p>

<p>
<strong>Interface examples</strong>
</p>
<ul>
<li class="level1"><div class="li"> <code>eth1</code></div>
</li>
<li class="level1"><div class="li"> <code>wwan0</code></div>
</li>
</ul>

<p>
<code>forcedelay</code> - in Ping Reboot and Periodic Reboot modes, the amount of time to try a graceful reboot before a sysreq reboot is activated as a fail safe.
</p>

<p>
<code>mmifacename</code> - name of a ModemManager interface to restart - if set it will restart the ModemManager service when that interface goes down.
</p>

<p>
<strong>Modem Manager Interface Name example</strong>
</p>
<ul>
<li class="level1"><div class="li"> <code>mobiledata</code></div>
</li>
</ul>

<p>
<code>unlockbands</code> - if set to 1 it will issue <code>mmcli -m any --set-current-bands=any</code> when the rule is activated
</p>

<p>
<strong>Possible unlockbands values</strong>
</p>
<ul>
<li class="level1"><div class="li"> <code>0</code> - disabled (default)</div>
</li>
<li class="level1"><div class="li"> <code>1</code> - enabled </div>
</li>
</ul>

<p>
Note <code>restart_iface</code> mode, <code>interface</code>, <code>pingsize</code>, <code>mmifacename</code> <code>unlockbands</code> parameters are available after commit: <a href="https://github.com/openwrt/packages/commit/d5047303d6ad052f0249350a205015d149882e0e" class="urlextern" title="https://github.com/openwrt/packages/commit/d5047303d6ad052f0249350a205015d149882e0e" rel="ugc nofollow">https://github.com/openwrt/packages/commit/d5047303d6ad052f0249350a205015d149882e0e</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Parameters&quot;,&quot;hid&quot;:&quot;parameters&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;567-2762&quot;} -->
<h2 class="sectionedit3" id="configuration_examples">Configuration Examples</h2>
<div class="level2">

<p>
The following are examples of a <code>config watchcat</code> stanza for a rule in the <code>/etc/config/watchcat</code> configuration file:
</p>

<p>
- Ping host <code>192.168.1.1</code> (gateway) every <code>30s</code> (30 seconds) via the interface <code>eth1.1</code> and reboot if it fails for <code>5m</code> (5 minutes) or longer and wait up to <code>1m</code> (1 minute) for a soft reboot before requesting a hard reboot:
</p>
<pre class="code">config watchcat
  option interface &#039;eth1.1&#039;
  option period &#039;5m&#039;
  option mode &#039;ping_reboot&#039;
  option pinghosts &#039;192.168.1.1&#039;
  option pingperiod &#039;30s&#039;
  option forcedelay &#039;1m&#039;</pre>

<p>
- Reboot the device every <code>3d</code> (3 days) and wait up to <code>2m</code> (2 minutes) for a soft reboot before requesting a hard reboot:
</p>
<pre class="code">config watchcat
  option mode &#039;periodic_reboot&#039;
  option period &#039;3d&#039;
  option forcedelay &#039;2m&#039;</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration Examples&quot;,&quot;hid&quot;:&quot;configuration_examples&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;2763-&quot;} -->