
<h1 class="sectionedit1" id="ntp">NTP</h1>
<div class="level1">

<p>
See also <a href="/docs/guide-user/services/ntp/client-server" class="wikilink1" title="docs:guide-user:services:ntp:client-server" data-wiki-id="docs:guide-user:services:ntp:client-server">NTP client / NTP server</a>
</p>

<p>
<abbr title="Network Time Protocol">NTP</abbr> provides time synchronization based on a network of reference clocks located around the world.
OpenWrt supports both <strong><abbr title="Network Time Protocol">NTP</abbr> client</strong> protocol (to synchronize local time with a distant clock) and <strong><abbr title="Network Time Protocol">NTP</abbr> server</strong> protocol (to deliver time to your local network).
</p>

<p>
The ntp configuration is located in <strong>system</strong> uci subsystem, and found in file <strong><em>/etc/config/system</em></strong>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;NTP&quot;,&quot;hid&quot;:&quot;ntp&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-472&quot;} -->
<h2 class="sectionedit2" id="timeserver_section">Timeserver section</h2>
<div class="level2">

<p>
The <abbr title="Network Time Protocol">NTP</abbr> configuration is found in <strong>timeserver</strong> section of <strong>system</strong> uci subsystem.
</p>
<pre class="code bash"><span class="co0"># uci show system</span>
system.ntp=timeserver
system.ntp.enabled=<span class="st_h">'1'</span>
system.ntp.enable_server=<span class="st_h">'0'</span>
system.ntp.server=<span class="st_h">'0.openwrt.pool.ntp.org'</span> <span class="st_h">'1.openwrt.pool.ntp.org'</span> <span class="st_h">'2.openwrt.pool.ntp.org'</span> <span class="st_h">'3.openwrt.pool.ntp.org'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Timeserver section&quot;,&quot;hid&quot;:&quot;timeserver_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;473-821&quot;} -->
<h2 class="sectionedit3" id="timeserver_section_options">Timeserver section options</h2>
<div class="level2">

<p>
These are the options defined for the <strong>timeserver ntp</strong> section:
</p>
<div class="table sectionedit4"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <em>server</em> </td><td class="col1"> list of hostnames </td><td class="col2"> no </td><td class="col3"> (openwrt ntp servers) </td><td class="col4"> Pool of <abbr title="Network Time Protocol">NTP</abbr> servers to poll the time from.<br/>
If empty, ntpd disables client mode, and system time won&#039;t be set automatically. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <em>enable_server</em> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> setting this to 1 enables the time server on this device, ntpd will answer with the time of the router.<br/>
(busybox-ntpd listens to <abbr title="User Datagram Protocol">UDP</abbr> 123 by default) </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <em>interface</em> </td><td class="col1"> interface name </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Bind timeserver only to specified interface. Available in snapshot since <a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=e12fcf0fe5597467f7cc21144e5f4da60500ebd2" class="interwiki iw_commit" title="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=e12fcf0fe5597467f7cc21144e5f4da60500ebd2">e12fcf0</a> and in 21.02.0-rc4 since <a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=a75928d1259e52e52b1991a4dc39df61ba3c9206" class="interwiki iw_commit" title="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=a75928d1259e52e52b1991a4dc39df61ba3c9206">a75928d</a>. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <em>use_dhcp</em> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> 1 </td><td class="col4"> setting this to 0 disables the use of <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>-provided <abbr title="Network Time Protocol">NTP</abbr> servers. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;928-1809&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Timeserver section options&quot;,&quot;hid&quot;:&quot;timeserver_section_options&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;822-1810&quot;} -->
<h2 class="sectionedit5" id="legacy_information">Legacy information</h2>
<div class="level2">

<p>
In <em>/etc/config/system</em> <em>busybox-rdate</em> (was invoked by scripts) has been replaced with <em>busybox-nptd</em> (can run as a daemon) to avoid race condition and also to use current <abbr title="Network Time Protocol">NTP</abbr>. The remote time is since configured in <em>/etc/config/system</em> and not in <em>/etc/config/timeserver</em> any longer.
</p>
<ul>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Old scripts first checked if a lease time server is defined for the interface in the network config.</div>
</li>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If not available or syncing fails, then it searches for time servers in the timeserver config that are either explicitly defined for that interface or via the global setting in the system config.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Legacy information&quot;,&quot;hid&quot;:&quot;legacy_information&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;1811-2451&quot;} -->
<h2 class="sectionedit6" id="ntp_server">NTP server</h2>
<div class="level2">

<p>
By default, <abbr title="Network Time Protocol">NTP</abbr> client is enabled and <abbr title="Network Time Protocol">NTP</abbr> server is disabled.
Enable server mode:
</p>
<pre class="code bash">uci <span class="kw1">set</span> system.ntp.enable_server=<span class="st0">&quot;1&quot;</span>
uci commit system
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>sysntpd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;NTP server&quot;,&quot;hid&quot;:&quot;ntp_server&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:6,&quot;range&quot;:&quot;2452-2661&quot;} -->
<h2 class="sectionedit7" id="regional_ntp_pulls">Regional NTP pulls</h2>
<div class="level2">

<p>
In theory, OpenWrt pull zone provide the closest available servers.
Practically, this may result in distant connections.
To use <abbr title="Network Time Protocol">NTP</abbr> servers located in your country, it is possible to use regional pull zone.
For example, in France, here is a sample configuration (notice the &#039;fr&#039; for France and adapt it):
</p>
<pre class="code bash">uci <span class="re5">-q</span> delete system.ntp.server
uci add_list system.ntp.server=<span class="st0">&quot;0.fr.pool.ntp.org&quot;</span>
uci add_list system.ntp.server=<span class="st0">&quot;1.fr.pool.ntp.org&quot;</span>
uci add_list system.ntp.server=<span class="st0">&quot;2.fr.pool.ntp.org&quot;</span>
uci add_list system.ntp.server=<span class="st0">&quot;3.fr.pool.ntp.org&quot;</span>
uci commit system
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>sysntpd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Regional NTP pulls&quot;,&quot;hid&quot;:&quot;regional_ntp_pulls&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:7,&quot;range&quot;:&quot;2662-3301&quot;} -->
<h2 class="sectionedit8" id="ntp_tools">NTP tools</h2>
<div class="level2">

<p>
By default, <abbr title="Network Time Protocol">NTP</abbr> server analysis tools are not installed (and not needed).
You may want to install ntp-utils package, which is a collection of tools used to synchronize the system clock with remote <abbr title="Network Time Protocol">NTP</abbr> time servers and run/monitor local <abbr title="Network Time Protocol">NTP</abbr> servers.
This package contains ntpdc, ntpq and ntptime.
</p>
<pre class="code bash">opkg <span class="kw2">install</span> ntp-utils</pre>

<p>
Enter &#039;ntpq&#039; to query the <abbr title="Network Time Protocol">NTP</abbr> subsystem and &#039;peers&#039; to display <abbr title="Network Time Protocol">NTP</abbr> peers used by your OpenWrt appliance:
</p>
<pre class="code"># ntpq
ntpq&gt; peer
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 0.fr.pool.ntp.o .POOL.          16 p    -   64    0    0.000    0.000   0.000
 1.fr.pool.ntp.o .POOL.          16 p    -   64    0    0.000    0.000   0.000
 2.fr.pool.ntp.o .POOL.          16 p    -   64    0    0.000    0.000   0.000
 3.fr.pool.ntp.o .POOL.          16 p    -   64    0    0.000    0.000   0.000
+ntp-3.arkena.ne 138.96.64.10     2 u  134  256  375   11.838   -1.119   1.194
 nsr2.neoserveur 172.2.53.81      2 u 1520  512    2   17.462   -0.064   2.688
+62.210.28.176 ( 84.255.209.79    4 u  222  256  377   12.241    1.094   1.620
-time1.agiri.nin 213.246.39.118   3 u   28  256  377   12.385    2.388   0.767
*ns3.stoneartpro 193.52.184.106   2 u  107  256  377   11.448    0.467   1.243</pre>

<p>
Type &#039;q&#039; to exit this display.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;NTP tools&quot;,&quot;hid&quot;:&quot;ntp_tools&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:8,&quot;range&quot;:&quot;3302-&quot;} -->