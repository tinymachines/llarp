
<h1 class="sectionedit1" id="snippets">Snippets</h1>
<div class="level1">

<p>
On this page you will find script and config snippets that didn&#039;t fit in other articles. Some snippets have nature of tweaks or one-line HOWTOs, while others are just fun to run.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Snippets&quot;,&quot;hid&quot;:&quot;snippets&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-203&quot;} -->
<h2 class="sectionedit2" id="system">System</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;System&quot;,&quot;hid&quot;:&quot;system&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;204-222&quot;} -->
<h3 class="sectionedit3" id="generate_100_cpu_load">Generate 100% CPU load</h3>
<div class="level3">

<p>
There is bunch of reasons why you would like to stress your CPU, one of the less serious is to play with <a href="/docs/guide-user/base-system/led_configuration#heartbeat" class="wikilink1" title="docs:guide-user:base-system:led_configuration" data-wiki-id="docs:guide-user:base-system:led_configuration">heartbeat trigger</a>.
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>dev<span class="sy0">/</span>urandom <span class="sy0">|</span> <span class="kw2">gzip</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null</pre>

<p>
Note: <em>This will compress infinite stream of random bits and discard them. The compress level can&#039;t be changed, so you may want to run more than one instance of the script to get your average CPU load high.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Generate 100% CPU load&quot;,&quot;hid&quot;:&quot;generate_100_cpu_load&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;223-704&quot;} -->
<h3 class="sectionedit4" id="show_command_line_with_parameters_of_a_process">Show command line with parameters of a process</h3>
<div class="level3">

<p>
Traditionally you would use <code>top</code> or <code>ps</code> command to get parameters of running processes. However if the command line is too long <a href="http://www.busybox.net/" class="urlextern" title="http://www.busybox.net/" rel="ugc nofollow">busybox&#039;s</a> version of those commands will truncate it to fit your terminal window.
</p>
<pre class="code bash"><span class="kw2">ps</span> <span class="kw2">w</span></pre>

<p>
or
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/&lt;</span>PID<span class="sy0">&gt;/</span>cmdline</pre>

<p>
Note: <em>Substitute &lt;PID&gt; with the <a href="https://en.wikipedia.org/wiki/Process_identifier" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Process_identifier">process identifier</a> of your process.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Show command line with parameters of a process&quot;,&quot;hid&quot;:&quot;show_command_line_with_parameters_of_a_process&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;705-1172&quot;} -->
<h3 class="sectionedit5" id="prompt">Prompt</h3>
<div class="level3">

</div>

<h4 id="colors">Colors</h4>
<div class="level4">

<p>
Edit <code>PS1</code> variable in <code>/etc/profile</code> file:
</p>
<pre class="code">export PS1=&#039;\[\e[1;31m\]\u@\h:\w\$ \[\e[0m\]&#039;</pre>

<p>
<em>This gives you normal text and background color, but red prompt, which reminds you that you are root. Other users (if exist) could get green prompt.</em> <a href="https://wiki.archlinux.org/index.php/Color_Bash_Prompt#List_of_colors_for_prompt_and_Bash" class="urlextern" title="https://wiki.archlinux.org/index.php/Color_Bash_Prompt#List_of_colors_for_prompt_and_Bash" rel="ugc nofollow">Color codes</a>.
</p>

</div>

<h4 id="screen_session">Screen session</h4>
<div class="level4">

<p>
It may be useful to display name of <code>screen</code> session if you are in one. <em>Tip: mix some colors in.</em> In the example the <code>screen</code> session has name <code>pts-0</code>:
</p>
<pre class="code">root@tsunami/pts-0:~# </pre>
<pre class="code bash"><span class="kw3">local</span> <span class="re2">SCREEN_SESSION_NAME</span>=$<span class="br0">&#40;</span><span class="kw2">screen</span> <span class="re5">-ls</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="re5">-n</span> <span class="st_h">'s|[^a-z]*[0-9][0-9]*\.\([a-zA-Z][a-zA-Z0-9-]*\).*Attached.*|/\1|p'</span><span class="br0">&#41;</span>
<span class="kw3">export</span> <span class="re2">PS1</span>=<span class="st0">&quot;\u@\h<span class="es3">${SCREEN_SESSION_NAME}</span>:\w\<span class="es1">\$</span> &quot;</span></pre>

</div>

<h4 id="red_background_if_last_command_failed">Red background if last command failed</h4>
<div class="level4">

<p>
Changes background color of prompt to red, when last command failed, i.e. its exit code is not equal to zero.
</p>
<pre class="code bash"><span class="kw3">export</span> <span class="re2">PS1</span>=<span class="st0">&quot;<span class="es1">\$</span>([ <span class="es1">\$</span>? -ne 0 ] &amp;&amp; echo \\\[\\\e[41m\\\])\u@\h:\w\<span class="es1">\$</span>\[\e[0m\] &quot;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prompt&quot;,&quot;hid&quot;:&quot;prompt&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:5,&quot;range&quot;:&quot;1173-2210&quot;} -->
<h3 class="sectionedit6" id="paste_file_on_web_from_cli">Paste file on web from CLI</h3>
<div class="level3">
<pre class="code">cat /etc/config/some.conf | nc paste.dyndns.org 1234</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Paste file on web from CLI&quot;,&quot;hid&quot;:&quot;paste_file_on_web_from_cli&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:6,&quot;range&quot;:&quot;2211-2303&quot;} -->
<h3 class="sectionedit7" id="get_bridge_status">Get bridge status</h3>
<div class="level3">
<pre class="code bash">devstatus br-lan</pre>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>sbin<span class="sy0">/</span>devstatus
<span class="co0">#!/bin/sh</span>
. <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>libubox<span class="sy0">/</span>jshn.sh
<span class="re2">DEVICE</span>=<span class="st0">&quot;$1&quot;</span>
&nbsp;
<span class="br0">&#91;</span> <span class="re5">-n</span> <span class="st0">&quot;<span class="es2">$DEVICE</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="br0">&#123;</span>
	<span class="kw3">echo</span> <span class="st0">&quot;Usage: $0 &lt;device&gt;&quot;</span>
	<span class="kw3">exit</span> <span class="nu0">1</span>
<span class="br0">&#125;</span>
&nbsp;
json_init
json_add_string name <span class="st0">&quot;<span class="es2">$DEVICE</span>&quot;</span>
ubus call network.device status <span class="st0">&quot;<span class="es4">$(json_dump)</span>&quot;</span></pre>

<p>
Here you may see that it uses <a href="/docs/guide-developer/jshn" class="wikilink1" title="docs:guide-developer:jshn" data-wiki-id="docs:guide-developer:jshn">jshn library</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Get bridge status&quot;,&quot;hid&quot;:&quot;get_bridge_status&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:7,&quot;range&quot;:&quot;2304-2681&quot;} -->
<h2 class="sectionedit8" id="wireless">Wireless</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Wireless&quot;,&quot;hid&quot;:&quot;wireless&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:8,&quot;range&quot;:&quot;2682-2702&quot;} -->
<h3 class="sectionedit9" id="toggle_button_for_wifi">Toggle button for WiFi</h3>
<div class="level3">
<pre class="code">[ -s /var/state/wireless ] &amp;&amp; wifi down || wifi up</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Toggle button for WiFi&quot;,&quot;hid&quot;:&quot;toggle_button_for_wifi&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:9,&quot;range&quot;:&quot;2703-2789&quot;} -->
<h3 class="sectionedit10" id="unlock_all_wifi_regulatory_domains_on_atheros">Unlock all WiFi regulatory domains on Atheros</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-developer/toolchain/start" class="wikilink1" title="docs:guide-developer:toolchain:start" data-wiki-id="docs:guide-developer:toolchain:start">build your own image</a> and set <code>CONFIG_ATH_USER_REGD</code> flag.</div>
</li>
<li class="level1"><div class="li"> see the whole <a href="http://git.kernel.org/cgit/linux/kernel/git/linville/wireless-regdb.git/tree/db.txt?id=HEAD" class="urlextern" title="http://git.kernel.org/cgit/linux/kernel/git/linville/wireless-regdb.git/tree/db.txt?id=HEAD" rel="ugc nofollow">regulatory database</a> to find out what regulations apply.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Unlock all WiFi regulatory domains on Atheros&quot;,&quot;hid&quot;:&quot;unlock_all_wifi_regulatory_domains_on_atheros&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:10,&quot;range&quot;:&quot;2790-3121&quot;} -->
<h2 class="sectionedit11" id="packages">Packages</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Packages&quot;,&quot;hid&quot;:&quot;packages&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:11,&quot;range&quot;:&quot;3122-3142&quot;} -->
<h3 class="sectionedit12" id="make_local_copy_of_packages">Make local copy of packages</h3>
<div class="level3">

<p>
If you use trunk version it may be useful to make local copy of packages, because new trunk version may prevent you to install kernel-related packages from official sources.
</p>
<pre class="code">wget -r -np http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/</pre>

<p>
<em>Assuming your architecture is <code>ar71xx</code>. This may require around 300 <abbr title="Megabyte">MB</abbr> of free disk space.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Make local copy of packages&quot;,&quot;hid&quot;:&quot;make_local_copy_of_packages&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:12,&quot;range&quot;:&quot;3143-3530&quot;} -->
<h3 class="sectionedit13" id="elliptic_curves_in_openssh">Elliptic curves in OpenSSH</h3>
<div class="level3">

<p>
<a href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">ECC</a> is especially favourable on low performance system like mobile phones or routers. For example, 15360 bit <a href="https://en.wikipedia.org/wiki/RSA_(algorithm)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/RSA_(algorithm)">RSA</a> key took 9.1 seconds to login and <a href="http://www.keylength.com/en/4/" class="urlextern" title="http://www.keylength.com/en/4/" rel="ugc nofollow">equally strong</a> (actually little bit stronger) 521 bit <a href="https://en.wikipedia.org/wiki/ECDSA" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/ECDSA">ECDSA</a> key took only 1.7 seconds to login. However the difference won&#039;t be really noticeble with shorter keys. To get it working, you need to:
</p>
<ol>
<li class="level1"><div class="li"> compile <code>libopenssl</code> without <code>NO-EC</code> option</div>
</li>
<li class="level1"><div class="li"> compile <code>openssh-server</code> and <code>openssh-keygen</code> with the new <code>libopenssl</code> in <code>build_dir</code></div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="kw2">ssh-keygen</span> <span class="re5">-t</span> ecdsa <span class="re5">-b</span> <span class="nu0">521</span></pre>
</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Elliptic curves in OpenSSH&quot;,&quot;hid&quot;:&quot;elliptic_curves_in_openssh&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:13,&quot;range&quot;:&quot;3531-4211&quot;} -->
<h3 class="sectionedit14" id="reinstalling_packages_after_firmware_upgrade">Reinstalling Packages after Firmware Upgrade</h3>
<div class="level3">

<p>
If you save the list of installed packages before a firmware upgrade, you can reinstall all packages that are not part of the firwmare with the script suggested in <a href="https://forum.openwrt.org/viewtopic.php?id=42739" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=42739" rel="ugc nofollow">this thread</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Reinstalling Packages after Firmware Upgrade&quot;,&quot;hid&quot;:&quot;reinstalling_packages_after_firmware_upgrade&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:14,&quot;range&quot;:&quot;4212-4498&quot;} -->
<h2 class="sectionedit15" id="usb">USB</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;USB&quot;,&quot;hid&quot;:&quot;usb&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:15,&quot;range&quot;:&quot;4499-4514&quot;} -->
<h3 class="sectionedit16" id="benchmark_your_drive">Benchmark your drive</h3>
<div class="level3">

<p>
Firstly, you will need <code>hdparm</code> program. Then locate your attached drive in <code>/dev</code> directory - typically <code>/dev/sda1</code> or <code>/dev/sda2</code> etc.
</p>
<pre class="code bash">opkg update <span class="sy0">&amp;&amp;</span> opkg <span class="kw2">install</span> hdparm
hdparm <span class="re5">-t</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sda1</pre>

<p>
See also <a href="/docs/guide-user/perf_and_log/benchmark.usb" class="wikilink1" title="docs:guide-user:perf_and_log:benchmark.usb" data-wiki-id="docs:guide-user:perf_and_log:benchmark.usb">USB Benchmarks</a> and <a href="/docs/techref/hardware/performance" class="wikilink1" title="docs:techref:hardware:performance" data-wiki-id="docs:techref:hardware:performance">Filesystems performance</a> page.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Benchmark your drive&quot;,&quot;hid&quot;:&quot;benchmark_your_drive&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:16,&quot;range&quot;:&quot;4515-4910&quot;} -->
<h2 class="sectionedit17" id="led">LED</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LED&quot;,&quot;hid&quot;:&quot;led&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:17,&quot;range&quot;:&quot;4911-4926&quot;} -->
<h3 class="sectionedit18" id="ipv6_activity_led">IPv6 activity LED</h3>
<div class="level3">

<p>
Flashes on activity in <a href="http://tunnelbroker.net" class="urlextern" title="http://tunnelbroker.net" rel="ugc nofollow">Hurricane Electric</a> <a href="/docs/guide-user/network/tunneling_interface_protocols#static_ipv6-in-ipv4_tunnel" class="wikilink1" title="docs:guide-user:network:tunneling_interface_protocols" data-wiki-id="docs:guide-user:network:tunneling_interface_protocols">6in4 tunnel</a>. Taken from <code>/etc/config/system</code> file:
</p>
<div class="table sectionedit19"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>config &#039;led&#039; &#039;6in4_led&#039;
        option &#039;name&#039; &#039;6in4&#039;
        option &#039;sysfs&#039; &#039;tl-wr1043nd:green:qss&#039;
        option &#039;trigger&#039; &#039;netdev&#039;
        option &#039;mode&#039; &#039;link tx rx&#039;
        option &#039;dev&#039; &#039;6in4-wan6&#039;
</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;5164-5372&quot;} -->
<p>
Note:<em>detailed configuration is <a href="/docs/guide-user/base-system/led_configuration#networkactivity" class="wikilink1" title="docs:guide-user:base-system:led_configuration" data-wiki-id="docs:guide-user:base-system:led_configuration">here</a>.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv6 activity LED&quot;,&quot;hid&quot;:&quot;ipv6_activity_led&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:18,&quot;range&quot;:&quot;4927-5482&quot;} -->
<h2 class="sectionedit20" id="banner_customization">Banner customization</h2>
<div class="level2">

<p>
All edits take place in <code>/etc/profile</code> file. We place the scripts in this section below the <code>cat /etc/banner</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Banner customization&quot;,&quot;hid&quot;:&quot;banner_customization&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:20,&quot;range&quot;:&quot;5483-5631&quot;} -->
<h3 class="sectionedit21" id="show_screen_sessions">Show screen sessions</h3>
<div class="level3">

<p>
For those who uses the <code>screen</code> command. This will print for example this:
</p>
<div class="table sectionedit22"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>3 Screen sessions: pts-0, snort, iperf</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:22,&quot;range&quot;:&quot;5740-5784&quot;} -->
<p>
And the script for it:
</p>
<pre class="code bash"><span class="kw3">local</span> <span class="re2">screenlabel</span>=$<span class="br0">&#40;</span><span class="kw2">screen</span> <span class="re5">-ls</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="re5">-n</span> <span class="st_h">'s|^\([0-9][0-9]*\) Socket.*| \1 Screen sessions: |p'</span><span class="br0">&#41;</span>
<span class="kw2">screen</span> <span class="re5">-ls</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="re5">-n</span> <span class="st_h">'s|[^a-z]*[0-9][0-9]*\.\([a-zA-Z][a-zA-Z0-9-]*\).*|\1|p'</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="re5">-e</span> <span class="st0">&quot;s|^|<span class="es3">${screenlabel}</span>|&quot;</span> <span class="re5">-e</span> :a <span class="re5">-e</span> N <span class="re5">-e</span> <span class="st_h">'s|\n|, |'</span> <span class="re5">-e</span> ta</pre>

<p>
<em>Note: <code>screenlabel</code> variable just contain number of sessoins and static text, so if you are ok with just list of screen sessions you can skip it and make it little bit more clear. Second line first get names of sessions, then add <code>screenlabel</code> variable in front of it and then put it all in one line.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Show screen sessions&quot;,&quot;hid&quot;:&quot;show_screen_sessions&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:21,&quot;range&quot;:&quot;5632-6373&quot;} -->
<h3 class="sectionedit23" id="show_available_entropy">Show available entropy</h3>
<div class="level3">

<p>
Less useful script, but anyway ;)
</p>
<div class="table sectionedit24"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>Entropy: 143/4096</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:24,&quot;range&quot;:&quot;6442-6465&quot;} --><pre class="code bash"><span class="kw3">echo</span> <span class="st0">&quot; Entropy:&quot;</span> $<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>sys<span class="sy0">/</span>kernel<span class="sy0">/</span>random<span class="sy0">/</span>entropy_avail<span class="br0">&#41;</span><span class="sy0">/</span>$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>sys<span class="sy0">/</span>kernel<span class="sy0">/</span>random<span class="sy0">/</span>poolsize<span class="br0">&#41;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Show available entropy&quot;,&quot;hid&quot;:&quot;show_available_entropy&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:23,&quot;range&quot;:&quot;6374-&quot;} -->