
<h1 class="sectionedit1" id="openwrt_running_as_metarouter_on_mikrotik_routeros">OpenWrt running as metarouter on mikrotik routerOS</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenWrt running as metarouter on mikrotik routerOS&quot;,&quot;hid&quot;:&quot;openwrt_running_as_metarouter_on_mikrotik_routeros&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-66&quot;} -->
<h2 class="sectionedit2" id="premises">Premises</h2>
<div class="level2">

<p>
Openwrt as metarouter is highly experimental but is also very promising,
therefore if someone knows useful resources, please contribute!
This should be valid for the entire openwrt wiki in general.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Premises&quot;,&quot;hid&quot;:&quot;premises&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;67-287&quot;} -->
<h2 class="sectionedit3" id="resources">Resources</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Resources&quot;,&quot;hid&quot;:&quot;resources&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;288-309&quot;} -->
<h3 class="sectionedit4" id="discussion_forums">Discussion forums</h3>
<div class="level3">

<p>
One obvious resource is the mikrotik forum and related searches
on it. For example with google <code>site:miktrotik.com openwrt metarouter</code>.
</p>

<p>
Discussion about patching the openwrt sources to get the metarouter image working:
<a href="http://forum.mikrotik.com/viewtopic.php?t=75849" class="urlextern" title="http://forum.mikrotik.com/viewtopic.php?t=75849" rel="ugc nofollow">http://forum.mikrotik.com/viewtopic.php?t=75849</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Discussion forums&quot;,&quot;hid&quot;:&quot;discussion_forums&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;310-608&quot;} -->
<h3 class="sectionedit5" id="articles">Articles</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://naberius.de/2015/01/10/openwrt-barrier-breaker-metarouter-instance-on-mikrotik-rb-2011/" class="urlextern" title="http://naberius.de/2015/01/10/openwrt-barrier-breaker-metarouter-instance-on-mikrotik-rb-2011/" rel="ugc nofollow">http://naberius.de/2015/01/10/openwrt-barrier-breaker-metarouter-instance-on-mikrotik-rb-2011/</a></div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/virtualization/metarouter" class="wikilink1" title="docs:guide-user:virtualization:metarouter" data-wiki-id="docs:guide-user:virtualization:metarouter">metarouter</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Articles&quot;,&quot;hid&quot;:&quot;articles&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;609-777&quot;} -->
<h3 class="sectionedit6" id="openwrt_metarouter_images_and_repositories">Openwrt metarouter images and repositories</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> A resource is provided by a user of the mikrotik forum, <strong>liquidcz</strong>, that is providing patched metarouter images with openwrt for mips and pppc architectures, here: <a href="http://forum.mikrotik.com/viewtopic.php?p=414386#p414386" class="urlextern" title="http://forum.mikrotik.com/viewtopic.php?p=414386#p414386" rel="ugc nofollow">http://forum.mikrotik.com/viewtopic.php?p=414386#p414386</a> . Thanks a ton to this guy.</div>
</li>
<li class="level1"><div class="li"> Mirror based on the liquicz&#039;s work: <a href="http://download.bmsoft.de/mikrotik/12.09/metarouter/" class="urlextern" title="http://download.bmsoft.de/mikrotik/12.09/metarouter/" rel="ugc nofollow">http://download.bmsoft.de/mikrotik/12.09/metarouter/</a></div>
</li>
<li class="level1"><div class="li"> Repository for openwrt metarouter: <a href="https://github.com/TheSkorm/openwrt-metarouter-cjdns" class="urlextern" title="https://github.com/TheSkorm/openwrt-metarouter-cjdns" rel="ugc nofollow">https://github.com/TheSkorm/openwrt-metarouter-cjdns</a></div>
</li>
</ul>

</div>

<h4 id="providing_alternatives_mirrors">Providing alternatives mirrors</h4>
<div class="level4">

<p>
The metarouter image is based on a &#039;proper patch&#039; for building the openwrt sources,
so everyone can build its own version. The point is that (a) publishing the compiled packages
online is not for everyone (b) providing the right procedure to build a mips/ppc version of openwrt
is not for everyone. Therefore providing mirror of already compiled packages or
informations (for example in this wiki) is highly reccomended - as in every open source/community project.
</p>

</div>

<h5 id="use_alternative_mirrors">Use alternative mirrors</h5>
<div class="level5">

<p>
Editing <code>/etc/opkg.conf</code> like
</p>
<pre class="code">src/gz packages http://download.bmsoft.de/mikrotik/12.09/metarouter/mr-mips/packages
#src/gz packages http://openwrt.wk.cz/attitude_adjustment/mr-mips/packages
dest root /
dest ram /tmp
lists_dir ext /var/opkg-lists
option overlay_root /overlay</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Openwrt metarouter images and repositories&quot;,&quot;hid&quot;:&quot;openwrt_metarouter_images_and_repositories&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;778-2100&quot;} -->
<h2 class="sectionedit7" id="experiences">Experiences</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Experiences&quot;,&quot;hid&quot;:&quot;experiences&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:7,&quot;range&quot;:&quot;2101-2124&quot;} -->
<h3 class="sectionedit8" id="routerboard_r493g_routeros_627_openwrt_1209_mips_compiled_by_liquidcz">Routerboard r493g , routerOS 6.27 , openwrt 12.09 mips compiled by liquidcz</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> CPU usage when idle, checked by winbox and routerOS: Around 15%. Around 8% if winbox shows few information.</div>
</li>
<li class="level1"><div class="li"> Ping answers when idle, direct connection: around 3000 ms.</div>
</li>
<li class="level1"><div class="li"> mwan3 version 1.4-24 works.</div>
</li>
<li class="level1"><div class="li"> With 2 wan connections: each wan connection seems to achieve an quite stable average of 25 Mbit/s using mwan3 (100+ firewall rules shown by <code>iptables-save</code>), and the CPU stays on an average of 40%. Could be that the test setup was limiting the system somehow, maybe due to the overhead in processing the IRQ request, like: when the IRQ is processed natively one can send more data, while with the hypervisor one can send less data, but then it is strange that both the flow from 2 wan connections goes through one lan connection without problems.</div>
</li>
<li class="level1"><div class="li"> Openvpn connection able to send or receive (not made synchronous tests) 6.5 ~ 7 Mbit/s of data. used by a system that use a metarouter as gateway. Could be the same problem of the speed through wan connections, that is the IRQ processing is the bottleneck.</div>
</li>
<li class="level1"><div class="li"> The system can be shut down like a normal openwrt or the metarouter can be shut down (via &#039;disable&#039;) or started (via &#039;enable&#039;) forcefully. On the mikrotik terminal a way to disable/enable is: <code>metarouter disable &lt;metarouter_name&gt; ; ping count=2 127.0.0.1 ; metarouter enable &lt;metarouter_name&gt;</code></div>
</li>
<li class="level1"><div class="li"> When the mikrotik (re)starts, if the metatarouter is enabled, it starts too, finishing the start procedure in 4-5 minutes.</div>
</li>
<li class="level1"><div class="li"> Long time &#039;30s+&#039; to restart single services (firewall, dropbear, etc...)</div>
</li>
<li class="level1"><div class="li"> Software reboot of the metarouter itself takes 4-5 minutes to show up the system again (except for ping, that replies way earlier. Note that the openwrt is almost a basic installation).</div>
</li>
<li class="level1"><div class="li"> &#039;Forced&#039; reboot (disable-enable in the RouterOS) takes 4-5 minutes to be completed.</div>
</li>
<li class="level1"><div class="li"> Long term usage (+ 30 days) has to be tested.</div>
</li>
<li class="level1"><div class="li"> Rebooting/power outage tests has to be done.</div>
</li>
<li class="level1"><div class="li"> The &#039;console&#039; management, using winbox, is way better through the terminal. New terminal â†’ metarouter console &lt;metarouter_name&gt; . But remember that openwrt offer one global console therefore opening two console is not possible, in that case try to go by ssh.</div>
</li>
<li class="level1"><div class="li"> It seems possible to assign a miximum of 7 interfaces out of 9, over 7 openwrt won&#039;t recognize the other interface.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Routerboard r493g , routerOS 6.27 , openwrt 12.09 mips compiled by liquidcz&quot;,&quot;hid&quot;:&quot;routerboard_r493g_routeros_627_openwrt_1209_mips_compiled_by_liquidcz&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:8,&quot;range&quot;:&quot;2125-&quot;} -->