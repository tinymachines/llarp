
<h1 class="sectionedit1" id="olsr_mesh">OLSR Mesh</h1>
<div class="level1">

<p>
<a href="https://en.wikipedia.org/wiki/Optimized Link State Routing Protocol" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Optimized Link State Routing Protocol">OLSR</a>, <a href="https://en.wikipedia.org/wiki/Mesh_networking" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Mesh_networking">Mesh networking</a> and <a href="http://www.olsr.org/" class="urlextern" title="http://www.olsr.org/" rel="ugc nofollow">http://www.olsr.org/</a> (no longer available)
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:outdated&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:outdated" id="plugin_include__meta__infobox__outdated">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_outdated wrap_center plugin_wrap" style="width: 70%;">
<p>
<strong>Outdated Information!</strong><br/>

This article contains information that is outdated or no longer valid. You can edit this page to update it. 
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:outdated&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

<p>
<em>OLSR has been changed significantly since this article was written, Notably, there is a “v2” that is IETF Standards Track that is described at <a href="https://tools.ietf.org/html/rfc7181" class="urlextern" title="https://tools.ietf.org/html/rfc7181" rel="ugc nofollow">https://tools.ietf.org/html/rfc7181</a> and several updates since published in 2014.</em>
</p>

<p>
Mesh networks self-arrange and auto-configure themselves on the basis of network topology changes.  For example, the properly configured OLSR mesh will automatically arrange itself in cases where one node fails, or when a new route emerges, or when a low traffic route becomes available or disappears.  The concept of a mesh network is not new; the Internet itself is a huge mesh network.  So what&#039;s new?  Well, mesh networks with wireless technology on OpenWrt simply rocks! ;)
</p>

<p>
OLSR is one of the routing protocols available to create a <a href="http://en.wikipedia.org/wiki/Mobile_ad-hoc_network" class="urlextern" title="http://en.wikipedia.org/wiki/Mobile_ad-hoc_network" rel="ugc nofollow">Mobile Adhoc Networks (MANET)</a>, or rather, in more general terms, a wireless mesh network.  <a href="http://www.olsr.org" class="urlextern" title="http://www.olsr.org" rel="ugc nofollow">The OLSR code developed by Andreas Tønnesen</a> is the best suited for our case as packages have been created for OpenWrt.
</p>

<p>
This wiki page contains information on how to create an OLSR mesh network by configuring OpenWrt and olsrd (the OLSR daemon process) yourself.  If your objective is to get an OLSR network quickly running, you may want to have a look at firmware that has been specifically created for this purpose.  An example of this sort of firmare is the <a href="http://firmware.freifunk.net" class="urlextern" title="http://firmware.freifunk.net" rel="ugc nofollow">Freifunk project</a>.  If you&#039;re determined to get OLSR running on OpenWrt without the assistance of pre-packaged firmare, keep reading!
</p>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign" colspan="3">  olsrd  0.6.1-3  </th>
	</tr>
	<tr class="row1">
		<th class="col0 leftalign"> Name                  </th><th class="col1 centeralign">  Size  </th><th class="col2 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row2">
		<td class="col0 leftalign"> olsrd                 </td><td class="col1 rightalign">  108257 </td><td class="col2 leftalign"> OLSR (Optimized Link State Routing) daemon  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> olsrd-mod-dyn-gw-plain  </td><td class="col1 rightalign">  2902 </td><td class="col2 leftalign"> Dynamic internet gateway plain plugin  </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> olsrd-mod-bmf         </td><td class="col1 rightalign">  12106 </td><td class="col2 leftalign"> Basic multicast forwarding plugin, dependece: <code>kmod-tun</code>  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> olsrd-mod-httpinfo    </td><td class="col1 rightalign">  23831 </td><td class="col2 leftalign"> Small informative web server plugin  </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> olsrd-mod-quagga      </td><td class="col1 rightalign">   5848 </td><td class="col2 leftalign"> Quagga plugin  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> olsrd-mod-dyn-gw      </td><td class="col1 rightalign">   4348 </td><td class="col2 leftalign"> Dynamic internet gateway plugin  </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> olsrd-mod-txtinfo     </td><td class="col1 rightalign">   6201 </td><td class="col2 leftalign"> Small informative web server plugin  </td>
	</tr>
	<tr class="row9">
		<td class="col0"> olsrd-mod-nameservice </td><td class="col1 rightalign">  11511 </td><td class="col2 leftalign"> Lightweight hostname resolver plugin  </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> olsrd-mod-dot-draw    </td><td class="col1 rightalign">  4233 </td><td class="col2 leftalign"> Dot topology information plugin  </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> olsrd-mod-mdns        </td><td class="col1 rightalign">  5648 </td><td class="col2 leftalign"> Multicast <abbr title="Domain Name System">DNS</abbr> plugin  </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> olsrd-mod-watchdog    </td><td class="col1 rightalign">  2316 </td><td class="col2 leftalign"> Watchdog plugin  </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> olsrd-mod-arprefresh  </td><td class="col1 rightalign">  2703 </td><td class="col2 leftalign"> Kernel ARP cache refresh plugin  </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> olsrd-mod-p2pd        </td><td class="col1 rightalign">  8066 </td><td class="col2 leftalign"> Peer to Peer Discovery plugin  </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> olsrd-mod-secure      </td><td class="col1 rightalign">  9710 </td><td class="col2 leftalign"> Message signing plugin to secure routing domain  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;1794-2868&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OLSR Mesh&quot;,&quot;hid&quot;:&quot;olsr_mesh&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-2870&quot;} -->
<h2 class="sectionedit7" id="the_network">The Network</h2>
<div class="level2">

<p>
There are an infinite number of ways that a mesh network can be configured; below is a simple example that allows routing over a set of subnets in the 10.0.0.0/255.0.0.0 range through the OLSR mesh.
</p>
<pre class="code">
      WAN                                                 WAN
       |                                                   |
OpenWrt + OLSR Node 1 ---- wireless link ---- OpenWrt + OLSR Node 2
       |                                                   |
      LAN                                                 LAN
       |                                                   |
  Workstation A                                      Workstation B
</pre>

<p>
Both nodes (in this case the <a href="/toh/linksys/wrt54g" class="wikilink1" title="toh:linksys:wrt54g" data-wiki-id="toh:linksys:wrt54g">WRT54GL</a> was used) need to have OLSR installed.  In general, OLSR will have to be installed on any node that participates in establishing routing between the OLSR-aware subnets that you configure.  OLSR needs to be configured to listen on all WIFI interfaces on these routers.  Running it on wired interfaces is usually not necessary, and according to some sources may interfere with other services on these interfaces such as <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
</p>

<p>
If the “wired” interfaces on your router are on a different subnet from the wireless interfaces you can configure OLSR to distribute <em>host and network association</em> (HNA) messages to other routers.  Depending on if if you are running <abbr title="Internet Protocol version 4">IPv4</abbr> or <abbr title="Internet Protocol version 6">IPv6</abbr> you will either have Hna4 or Hna6 directives in your <code>/?/olsrd.conf</code> configuration file.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:outdated&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:outdated">
<div class="level2">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_outdated wrap_center plugin_wrap" style="width: 70%;">
<p>
<strong>Outdated Information!</strong><br/>

This article contains information that is outdated or no longer valid. You can edit this page to update it. 
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:outdated&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;The Network&quot;,&quot;hid&quot;:&quot;the_network&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2871-4443&quot;} -->
<h2 class="sectionedit12" id="how_to">HOW TO</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> separate the wireless and lan interface in <code><a href="/docs/guide-user/base-system/basic-networking" class="wikilink1" title="docs:guide-user:base-system:basic-networking" data-wiki-id="docs:guide-user:base-system:basic-networking">/etc/config/network</a></code> again, by default they are bridged</div>
</li>
<li class="level1"><div class="li"> configure the WNICs to work in <em>adhoc</em>-mode. Your file <code><a href="/docs/guide-user/network/wifi/basic" class="wikilink1" title="docs:guide-user:network:wifi:basic" data-wiki-id="docs:guide-user:network:wifi:basic">/etc/config/wireless</a></code> might look as follows:<pre class="code">config wifi-device  wl0
        option type     broadcom
        option channel  11
        # disable radio to prevent an open ap after reflashing:
        option disabled 0

config wifi-iface
        option device   wl0
        # option network        lan
        option mode     adhoc
        option ssid     OLSR
        option hidden   0
        option encryption none</pre>
</div>
</li>
<li class="level1"><div class="li"> install olsrd<pre class="code">  opkg update
  opkg install olsrd</pre>
</div>
</li>
<li class="level1"><div class="li"> Edit the <code>/etc/olsrd.conf</code> and replace “Interface “XXX” with the wireless interface on your router. Example<pre class="code"># olsr.org OLSR daemon config file
# /etc/olsrd.conf
#
# Modified for sample OLSR network by Justin S. Leiteb
# http://justin.phq.org/ Fri Jun  8 10:34:27 EDT 2007
# Many comments and commented line from conf file distributed
# with olsrd omitted for brevity in wiki.

DebugLevel	0
IpVersion	4
ClearScreen     yes

# On the second OLSR node (olsrd.conf not supplied for this node, since only one line is different),
# which has a LAN interface on the 10.100.2.0/255.255.255.0 network, the Hna4 entry is:
# 10.100.2.0 255.255.255.0.  These Hna4 entries are what propagates information about how to route
# to these subnets through the mesh.
Hna4
{
	# My home LAN
	10.100.1.0  255.255.255.0
}

AllowNoInt	yes
UseHysteresis	yes

# Hysteresis parameters
HystScaling	0.50
HystThrHigh	0.80
HystThrLow	0.30


LinkQualityLevel	0
Pollrate	0.05
NicChgsPollInt  3.0

Interface &quot;wl0&quot;
{
    AutoDetectChanges            yes
}

# Run http server with mesh information.  Won&#039;t work unless you&#039;ve already installed
# the olsrd_httpinfo plugin through ipkg.
LoadPlugin &quot;olsrd_httpinfo.so.0.1&quot;
{
	PlParam		&quot;port&quot;	&quot;1979&quot;
	PlParam		&quot;Net&quot;	&quot;0.0.0.0 0.0.0.0&quot;
}</pre>
</div>
</li>
<li class="level1"><div class="li"> firewall, allow the router to forward packets between the interfaces, example:<pre class="code">#!/bin/sh

# Copyright (C) 2006 OpenWrt.org

iptables -F input_rule
iptables -F output_rule
iptables -F forwarding_rule
iptables -t nat -F prerouting_rule
iptables -t nat -F postrouting_rule

# The following chains are for traffic directed at the IP of the
# WAN interface

iptables -F input_wan
iptables -F forwarding_wan
iptables -t nat -F prerouting_wan

# Does anyone have a command to get the name of the WIFI interface on Kamikaze so
# that it doesn&#039;t have to be hard-coded here?  This is a bit sloppy it seems.
WIFI=wl0

iptables        -A input_wan      -p tcp --dport 22 -j ACCEPT

# Allow connections to olsr info port.
iptables        -A input_wan      -p tcp --dport 1979 -j ACCEPT

# OLSR needs port 698 to transmit state messages.
iptables -A input_rule -p udp --dport 698 -j ACCEPT


# Debugging... do we have WIFI, LAN and WAN appropriately defined?
# These values are passed to us from /etc/init.d/firewall, which
# calls this script.

# echo WIFI == $WIFI
# echo LAN == $LAN
# echo WAN == $WAN

iptables -A forwarding_rule -i $WAN -o $WIFI -j ACCEPT

iptables -A forwarding_rule -i $WIFI -o $WAN -j ACCEPT

# For forwarding LAN &amp; WIFI in nodes
iptables -A forwarding_rule -i $LAN -o $WIFI -j ACCEPT

# For WIFI clients to connect to nodes.
iptables -A forwarding_rule -i $WIFI -o $WIFI -j ACCEPT

# For connecting a wired lan client of node 1 to wired lan client of node 2
iptables -A forwarding_rule -i $LAN -o $LAN -j ACCEPT

# WIFI needs to go to LAN ports, too!
iptables -A forwarding_rule -i $WIFI -o $LAN -j ACCEPT</pre>
</div>
</li>
<li class="level1"><div class="li"> start olsrd<pre class="code">/etc/init.d/olsrd start
/etc/init.d/olsrd enable</pre>
</div>
</li>
</ol>

<p>
Reboot your router and test everything by pinging interfaces on the different devices.  Go and have a beverage of choice to celebrate!
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;HOW TO&quot;,&quot;hid&quot;:&quot;how_to&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:12,&quot;range&quot;:&quot;4444-8337&quot;} -->
<h2 class="sectionedit13" id="after_basic_configuration">After basic configuration</h2>
<div class="level2">

<p>
You may want to check out some of the plugins that are easy to configure and show you the basic status of your mesh.  On my network I run <code>olsrd-mod-httpinfo</code>, which provides a basic http server that shows you the status of the mesh.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;After basic configuration&quot;,&quot;hid&quot;:&quot;after_basic_configuration&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:13,&quot;range&quot;:&quot;8338-8612&quot;} -->
<h2 class="sectionedit14" id="references">References</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://www.olsr.org" class="urlextern" title="http://www.olsr.org" rel="ugc nofollow">Master&#039;s thesis of primary developer of olsrd</a> - should be read before attempting to install OLSR if you aren&#039;t clear on the fundamentals of how it works</div>
</li>
<li class="level1"><div class="li"> <a href="http://nbd.name/openwrt" class="urlextern" title="http://nbd.name/openwrt" rel="ugc nofollow">Manual for Kamikaze by one of the developers</a> - great reference on networking interface configuration and other parts of the OpenWrt system</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;References&quot;,&quot;hid&quot;:&quot;references&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:14,&quot;range&quot;:&quot;8613-&quot;} -->