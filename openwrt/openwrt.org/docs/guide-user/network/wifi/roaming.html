
<h1 class="sectionedit1" id="wifi_roaming">Wifi Roaming</h1>
<div class="level1">

<p>
It is common in larger installations (e.g. large domestic networks or commercial installations) for a WiFi network to be configured with multiple different access points all advertising the same SSID (wifi network name) with the same authentication method and credentials.
</p>

<p>
The intention is that a WiFi client will choose “the best” access point (or rather “BSSID”) to connect to.  If network conditions change, or a client is physically moved to a different location, then “the best” BSSID may change.
</p>

<p>
Even if there is a only a single access point present, then a client may prefer to disconnect from the access point on one radio frequency band and reconnect on another band (e.g. switch from using 5 <abbr title="Gigahertz">GHz</abbr> to 2.4 <abbr title="Gigahertz">GHz</abbr>).  i.e. A single physical access point might have two or three different BSSIDs, one on each frequency band which it supports, and “roaming” between then looks a lot like the transition which occurs between access points.
</p>

<p>
The WiFi standards refer to configuration where the same SSID is available from multiple access points as an Extended Service Set (ESS).
</p>

<p>
Over time, a number of optional features have been added to the WiFi standards to try to increase roaming performance within an ESS.  These include:
</p>
<ul>
<li class="level1"><div class="li"> <strong>802.11r</strong> (“Fast Transition”) reduces the time taken for a client to establish a secure connection when roaming to a different BSSID.</div>
</li>
<li class="level1"><div class="li"> <strong>802.11k</strong> (“Radio Resource Measurement”) allows a single BSSID provide wifi clients with a list of other BSSIDs and frequencies which are included in the ESS.  This reduces the time that each client needs to spend looking for an alternative “better” SSID because it no longer needs to scan all frequencies.</div>
</li>
<li class="level1"><div class="li"> <strong>802.11v</strong> (“Wireless Network Management”) this standard includes “Network assisted Roaming” whereby the BSSID can recommend alternative BSSIDs that the client could roam to.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Wifi Roaming&quot;,&quot;hid&quot;:&quot;wifi_roaming&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1891&quot;} -->
<h2 class="sectionedit2" id="r_fast_transition">802.11r Fast Transition</h2>
<div class="level2">

<p>
When joining (“associating with”) a wireless network with security enabled, a “4 way handshake” occurs between a wireless client and the BSS (usually a typical radio on an access point). In the case of “Enterprise” EAP / 802.1X type authentication (whereby each user has their own authentication credentials), this can be especially time consuming because the authentication step may involve a distant authentication server.
</p>

<p>
Without 802.11r, a roam (a transition to a different BSS) repeats the same authentication process.  During this time, network traffic is interrupted.  802.11r aims to speed up the roam with a shorter packet exchange (e.g. 4 packets total vs 8) during the transition to the new BSS (n.b. the new BSS could also be on the same physical access point if the client switches between the 2.4GHz and 5GHz radios).
</p>

<p>
802.11r is particularly beneficial when “Enterprise” EAP / 802.1X type authentication is used because an additional (potentially high latency) round-trip to the authentication server is not required.  See the linked WLPC presentation video in the “Additional Resources” section for some real world examples and timings.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;802.11r Fast Transition&quot;,&quot;hid&quot;:&quot;r_fast_transition&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1892-3082&quot;} -->
<h3 class="sectionedit3" id="configuring">Configuring</h3>
<div class="level3">

<p>
The full set of 802.11r related options which OpenWrt supports can be found <a href="/docs/guide-user/network/wifi/basic#fast_bss_transition_options_80211r" class="wikilink1" title="docs:guide-user:network:wifi:basic" data-wiki-id="docs:guide-user:network:wifi:basic">here in the documentation</a>.
</p>

<p>
To configure using the Luci web interface, go to <code>Network→Wireless</code>, and on each <code>SSID</code> click <code>Edit</code>, scroll-down to the <code>Interface Configuration</code> tabs, select <code><abbr title="Wireless Local Area Network">WLAN</abbr> Roaming</code>, check the <code>802.11r Fast Transition</code> box, and put in a 4-digit <code>Mobility Domain</code> that matches the same SSID on your other 802.11r-enabled routers/<abbr title="Access Point">AP</abbr>&#039;s.
</p>
<ul>
<li class="level1"><div class="li"> If you do not see the <code><abbr title="Wireless Local Area Network">WLAN</abbr> Roaming</code> tab, you need to update your OpenWrt or load a version of <code>wpad</code> that has the 802.11r features. All current versions of OpenWrt come with 802.11r support in the basic <code>wpad</code> drivers.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuring&quot;,&quot;hid&quot;:&quot;configuring&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;3083-3856&quot;} -->
<h3 class="sectionedit4" id="wifi_clients_with_no_or_limited_support_for_80211r">Wifi clients with no or limited support for 802.11r</h3>
<div class="level3">

<p>
Clients without 802.11r support should connect to networks with 802.11r enabled, however <strong>some buggy clients are known to refuse to associate</strong> with networks which have 802.11r enabled, or have other problematic behaviour.  A workaround for this is to create a separate “legacy” SSID which has 802.11r disabled, for those devices alone to connect to.  In some cases upgrading the client firmware, drivers, or <abbr title="Operating System">OS</abbr> may fix issues.
</p>
<ul>
<li class="level1"><div class="li"> MacOS on Intel CPUs do not support 802.11r.  Some older Intel Macs will refuse to connect to networks with 802.11r enabled. For minimum versions for iOS devices <a href="https://support.apple.com/en-gb/guide/deployment/dep98f116c0f/web" class="urlextern" title="https://support.apple.com/en-gb/guide/deployment/dep98f116c0f/web" rel="ugc nofollow">Apple includes a table on this page</a></div>
</li>
<li class="level1"><div class="li"> Windows 10 and Windows 11 (up to and including version 2024H2) only supports 802.11r on networks which use 802.1X authentication (i.e. <strong>801.11r with PSK is not supported</strong> - i.e. on networks with single a single passphrase as set by `option key` in OpenWrt Windows does not are not supported).</div>
</li>
<li class="level1"><div class="li"> Some Intel Windows wifi6 client cards with driver versions 23.60.* would fail to re-associate to OpenWrt 23.x access points when 802.11r with PSK was enabled.  Upgrading to Intel driver version 23.90.* fixed the problem.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Wifi clients with no or limited support for 802.11r&quot;,&quot;hid&quot;:&quot;wifi_clients_with_no_or_limited_support_for_80211r&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;3857-5145&quot;} -->
<h3 class="sectionedit5" id="verifying_client_80211r_support">Verifying client 802.11r support</h3>
<div class="level3">

<p>
To check if 802.11r is working properly, set log_level to 1 (cf. <a href="/docs/guide-user/network/wifi/basic#common_options1" class="wikilink1" title="docs:guide-user:network:wifi:basic" data-wiki-id="docs:guide-user:network:wifi:basic">Common Options</a>) and look for message “<em>FT authentication already completed - do not start 4-way handshake</em>” in your system log after roaming.
</p>

<p>
It&#039;s also possible to verify that clients are using 802.11r by inspecting the “Association Request” frames that they send.  Verify the “Auth Key Management type” includes “FT” (Fast Transition).
</p>

<p>
In the packet capture screenshot below, Wireshark is used with the filter <code>wlan.fc.type_subtype == 0</code>. The client can be seen to request the use of 802.11r - the “Auth Key Management type” is set to “FT using SAE” (i.e. 802.11r fast transition, with WPA3 SAE pre-shared key).
</p>

<p>
<a href="/_detail/media/802.11r_assoc_wireshark.png?id=docs%3Aguide-user%3Anetwork%3Awifi%3Aroaming" class="media" title="media:802.11r_assoc_wireshark.png"><img src="/_media/media/802.11r_assoc_wireshark.png?w=400&amp;tok=ebb43b" class="media" loading="lazy" alt="" width="400" /></a>
</p>

<p>
When 802.11r is in use, this can be found in each Association Request frame, under <code>IEEE 802.11 Wireless Management</code> → <code>Tagged parameters</code> → <code>RSN Information</code> → <code>Auth Key Management (AKM) List</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Verifying client 802.11r support&quot;,&quot;hid&quot;:&quot;verifying_client_80211r_support&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;5146-6181&quot;} -->
<h2 class="sectionedit6" id="k_and_80211v">802.11k and 802.11v</h2>
<div class="level2">

<p>
The “hostap” management software forms a key part of OpenWrt in that it manages advertising WiFi networks and authenticating WiFi clients.  hostapd includes support for 802.11k and 802.11v, but relies on external software to make roaming recommendations and provide it with lists of alternative BSSIDs etc. OpenWrt packages software which can perform these functions and are intended to manage both 802.11k and 802.11v.  Only one should be active at a time:
</p>
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/network/wifi/dawn" class="wikilink1" title="docs:guide-user:network:wifi:dawn" data-wiki-id="docs:guide-user:network:wifi:dawn">dawn</a></div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/network/wifi/usteer" class="wikilink1" title="docs:guide-user:network:wifi:usteer" data-wiki-id="docs:guide-user:network:wifi:usteer">usteer</a></div>
</li>
</ul>

<p>
Alternative packages which only implement 802.11k include:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/simonyiszk/openwrt-rrm-nr-distributor" class="urlextern" title="https://github.com/simonyiszk/openwrt-rrm-nr-distributor" rel="ugc nofollow">rmm-nr-distributor</a></div>
</li>
</ul>

<p>
Double check that your wpad supports 802.11k (wpad-basic-mbedtls does not, e.g., in  24.10)
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;802.11k and 802.11v&quot;,&quot;hid&quot;:&quot;k_and_80211v&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;6182-7000&quot;} -->
<h2 class="sectionedit7" id="additional_resources">Additional Resources</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://youtu.be/4Ua2lI6HBhE?&amp;t=24" class="urlextern" title="https://youtu.be/4Ua2lI6HBhE?&amp;t=24" rel="ugc nofollow">A talk given at Wireless Lan Professionals Conference 2019 entitled &quot;Effects of 802.11k/r/v&quot;</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://www.youtube.com/watch?v=kMgs2XFClaM" class="urlextern" title="https://www.youtube.com/watch?v=kMgs2XFClaM" rel="ugc nofollow">OneMarkFifty explaining how to set-up fast roaming OpenWrt Wi-Fi Access points</a> (Youtube)</div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/documentation-on-802-11r/176972" class="urlextern" title="https://forum.openwrt.org/t/documentation-on-802-11r/176972" rel="ugc nofollow">OpenWrt Forum: Documentation on 802.11r</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/802-11r-fast-transition-how-to-understand-that-ft-works/110920" class="urlextern" title="https://forum.openwrt.org/t/802-11r-fast-transition-how-to-understand-that-ft-works/110920" rel="ugc nofollow">OpenWrt Forum: 802.11r Fast Transition, another discussion</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Additional Resources&quot;,&quot;hid&quot;:&quot;additional_resources&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;7001-&quot;} -->