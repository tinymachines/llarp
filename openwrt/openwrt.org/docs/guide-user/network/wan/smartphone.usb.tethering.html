
<h1 class="sectionedit1" id="smartphone_usb_tethering">Smartphone USB tethering</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Smartphone USB tethering&quot;,&quot;hid&quot;:&quot;smartphone_usb_tethering&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-121&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">

<p>
USB tethering is used to connect your OpenWrt Router to the Internet by using the your smartphone.
It&#039;s more convenient and has better performance (lower latency) than turning your smartphone into an access point and using that.
It also is less of a CPU load on your phone, charges your phone, and allows you the flexibility of doing things with your OpenWrt router that you cannot do with your phone like connecting multiple devices with ease, both wireless and wired, to each other and to the internet.
In order to maximize performance, you should turn your tethered phone Wi-Fi and Bluetooth off.
</p>
<ul>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> USB tethering is known to be problematic on <a href="https://forum.openwrt.org/t/has-the-ios14-tethering-issue-been-resolved/74949" class="urlextern" title="https://forum.openwrt.org/t/has-the-ios14-tethering-issue-been-resolved/74949" rel="ugc nofollow">iOS 14 devices</a>.  works without patch on latest trunk 01/2022, 21.02.1 needs patch</div>
</li>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Connecting your whole network to the Internet using the Smartphone might consume your monthly traffic quota very fast.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/network/wan/smartphone.usb.reverse.tethering" class="wikilink1" title="docs:guide-user:network:wan:smartphone.usb.reverse.tethering" data-wiki-id="docs:guide-user:network:wan:smartphone.usb.reverse.tethering">USB reverse tethering</a> to share the internet from router to the smartphone over USB.</div>
</li>
</ul>

<p>
A new option has arrived with Android 11: &#039;<strong>Ethernet Tethering</strong>&#039;. The only devices that seem to consistently support it, across a wide variety of phones, are AXIS-Chipset based Ethernet-to-USB-C adapters. The upside to using an adapter instead of a direct USB tether that requires you first load additional USB support into the router, is simply uses an ethernet cable to connect to the <abbr title="Wide Area Network">WAN</abbr> port on your router. The downside is, if the phone ever restarts, if the adapter is ever unplugged from the phone, or the USB-C PD power feed to the adapter is interrupted, it is necessary to manually go to the phone, to Network, Hotspot &amp; Tethering, and re-enable Ethernet Tethering. There is no automated, programmatic method to re-enable it, yet. USB Tethering, however, can be set to automatically re-enable, e.g. after a power loss. Note: <em>Merely rebooting the router with Ethernet Tethering enabled, does not disable ethernet tethering. Tethering will automatically work when the router starts back up. But if the power to the phone/adapter is interrupted, it will turn off on the phone, and need to be manually re-enabled.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;122-2378&quot;} -->
<h2 class="sectionedit7" id="instructions">Instructions</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Instructions&quot;,&quot;hid&quot;:&quot;instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2379-2403&quot;} -->
<h3 class="sectionedit8" id="installation_of_usb_support_on_router">1. Installation of USB Support on Router</h3>
<div class="level3">

<p>
For the easiest installation, have a wired upstream internet connection to boot-strap this process.
</p>

<p>
You will need: the router, your tethering phone, necessary cables, a computer and an upstream Internet connection via Ethernet for initial setup.
Instead of a wired upstream connection,<a href="https://forum.openwrt.org/t/install-packages-while-offline/66148" class="urlextern" title="https://forum.openwrt.org/t/install-packages-while-offline/66148" rel="ugc nofollow">it is also possible to download necessary packages below, through your computer while tethered to your phone,</a> the same way you can get the OpenWrt distribution for your router. If you need to manually download the packages on another device for bootstrapping, see also <a href="/downloads#get_additional_software_packages" class="wikilink1" title="downloads" data-wiki-id="downloads">get_additional_software_packages</a>. The Kernel modules will be in the <abbr title="Uniform Resource Locator">URL</abbr> of form <code>downloads.openwrt.org/releases/[your release]/targets/[your target]/generic/packages/</code> and other packages (iOS stuff in this case) in <code>downloads.openwrt.org/releases/[release]/packages/[instruction set]/packages/</code>.
</p>

<p>
Other alternative ways to bootstrap, include using the phone&#039;s WiFi hotspot and a micro-router configured as a wireless-to-ethernet device, or an Ethernet-to-USB-C adapter [see above].
</p>

<p>
RNDIS is the most common protocol for Android-based devices for tethering via USB. The following commands will install <a href="/packages/pkgdata/kmod-usb-net-rndis" class="wikilink1" title="packages:pkgdata:kmod-usb-net-rndis" data-wiki-id="packages:pkgdata:kmod-usb-net-rndis">kmod-usb-net-rndis</a> kernel module and its dependencies on the router:
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> kmod-usb-net-rndis</pre>

<p>
See also <a href="/docs/guide-user/network/wan/wwan/ethernetoverusb_rndis" class="wikilink1" title="docs:guide-user:network:wan:wwan:ethernetoverusb_rndis" data-wiki-id="docs:guide-user:network:wan:wwan:ethernetoverusb_rndis">How To use LTE modem in RNDIS mode for WAN connection</a>
</p>

<p>
Android devices come with great diversity, therefore some require different <a href="https://en.wikipedia.org/wiki/Ethernet_over_USB" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Ethernet_over_USB">protocols</a>. For instance, newer devices may use NCM, others may require EEM or even need a subset implementation. 
</p>

<p>
<strong>NOTE:</strong> You may need to add a different protocol if you don&#039;t see that a new interface (usually - <code>usb0</code> or <code>ethX</code>) has been added on the router or the device keeps disconnecting:
</p>
<pre class="code">opkg install kmod-usb-net-cdc-ncm

# Huawei may need its own implementation!
opkg install kmod-usb-net-huawei-cdc-ncm

# More protocols:
kmod-usb-net-cdc-eem
kmod-usb-net-cdc-ether
kmod-usb-net-cdc-subset</pre>

<p>
Extra steps depending on <a href="/docs/guide-user/storage/usb-installing" class="wikilink1" title="docs:guide-user:storage:usb-installing" data-wiki-id="docs:guide-user:storage:usb-installing">USB type and drivers</a> for your router:
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> kmod-nls-base kmod-usb-core kmod-usb-net kmod-usb-net-cdc-ether kmod-usb2</pre>

<p>
Additional steps for iOS devices:
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> kmod-usb-net-ipheth usbmuxd libimobiledevice usbutils
&nbsp;
<span class="co0"># Call usbmuxd</span>
usbmuxd <span class="re5">-v</span>
&nbsp;
<span class="co0"># Add usbmuxd to autostart</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\$</span>i usbmuxd&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Installation of USB Support on Router&quot;,&quot;hid&quot;:&quot;installation_of_usb_support_on_router&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;2404-5077&quot;} -->
<h3 class="sectionedit9" id="smartphone_settings">2. Smartphone Settings</h3>
<div class="level3">

<p>
Connect the smartphone to the USB port of the router with the USB cable, and then enable <code>USB Tethering</code> from the Android settings.
Turn on the phone&#039;s <code>Developer Options</code> <em>[Find the <code>Build</code> information in the <code>About Phone</code> menu, and tap rapidly 7x]</em>.
There is a <code>Default USB Configuration, USB Tethering</code> option in Developer Options.
The phone will now immediately turn on USB Tethering mode when plugged into a configured router [or laptop], without further commands.
However, <strong>it is necessary to remove the screen lock on the phone.
A locked phone will not start automatically USB Tethering by itself.</strong> <em>E.G. When the router starts, or restarts after a scheduled reboot, if the phone is locked, it needs to be manually unlocked if a screen lock is activated.</em>
</p>

<p>
For iPhones, you may have to disable and re-enable the <em>Personal Hotspot/Allow Others to Join</em> setting on the iPhone to force the OpenWrt <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> client to get an <abbr title="Internet Protocol">IP</abbr> address from the eth1 iPhone interface.
Disabling and re-enabling the <em>Personal Hotspot/Allow Others to Join</em> setting on the iPhone is also required if you disconnect the iPhone from the OpenWrt USB port and re-connect it later, unless you cache Trust records (see watchdog section and/or LeJeko&#039;s Github repository in reference section).
</p>

<p>
iPhones starting from iOS 11 will terminate the USB data connections after one hour by default to improve security. This can easily be changed via:
</p>

<p>
<code>Settings &gt; Touch ID/Face ID &amp; Passcode &gt; USB Accessories &gt; ON</code> (<a href="https://www.macworld.com/article/233368/that-s-right-you-can-t-turn-off-personal-hotspot-in-ios-13-and-ipados-13.html" class="urlextern" title="https://www.macworld.com/article/233368/that-s-right-you-can-t-turn-off-personal-hotspot-in-ios-13-and-ipados-13.html" rel="ugc nofollow">macworld</a>)
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Smartphone Settings&quot;,&quot;hid&quot;:&quot;smartphone_settings&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:9,&quot;range&quot;:&quot;5078-6746&quot;} -->
<h3 class="sectionedit10" id="a_routerweb_interface">3.a Router: Web interface</h3>
<div class="level3">

<p>
Go back to the router and navigate to “Network” then “Interfaces”.
</p>

<p>
Here you can simply assign the existing <abbr title="Wide Area Network">WAN</abbr>&amp;WAN6 Interfaces to <code>usb0</code>, or create a whole new interfaces (e.g. &#039;TetheringWAN&#039;, &#039;TetheringWAN6&#039;) that use <code>usb0</code>, if you want both to be active, and be able to swap between the <abbr title="Wide Area Network">WAN</abbr> Ethernet port and USB tethering (such as in a dual-wan fail-over situation). To make the easiest changes: in the web interface, simply edit the existing default <abbr title="Wide Area Network">WAN</abbr> &amp; WAN6 interfaces, and change the physical device to <code>usb0</code>, then “Save &amp; Apply”.
</p>

<p>
TetheringWAN: To create a whole new USB interface, and leave <abbr title="Wide Area Network">WAN</abbr>&amp;WAN6 connected to the <abbr title="Wide Area Network">WAN</abbr> Ethernet port, make a new Interface called <strong>TetheringWAN</strong>, and bind to it the new <code>usb0</code> network device (restart if you do not see it yet. And, for some cases, the new interface may be called <code>eth1</code>: check what the log is showing in your case). Set the protocol to <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> client mode, and under the Firewall Settings tab, place it into the <abbr title="Wide Area Network">WAN</abbr> zone. Then you can also make a &#039;TetheringWAN6&#039;, and assign it to DHCPv6 Client. See below for more information on further configuring <abbr title="Internet Protocol version 6">IPv6</abbr> so your clients can use it.
</p>

<p>
Save changes.
</p>

<p>
See the following screenshots:<br/>

First page of the Create Interface wizard.<br/>

<a href="/_media/docs/guide-user/advanced/image_create_new_interface.png" class="media" title="docs:guide-user:advanced:image_create_new_interface.png"><img src="/_media/docs/guide-user/advanced/image_create_new_interface.png?w=800&amp;tok=1b4f10" class="media" loading="lazy" alt="" width="800" /></a><br/>

Firewall tab of the Create Interface Wizard.
Very important to set it as <abbr title="Wide Area Network">WAN</abbr>.<br/>

<a href="/_media/docs/guide-user/advanced/image_create_new_interface_set_firewall_region.png" class="media" title="docs:guide-user:advanced:image_create_new_interface_set_firewall_region.png"><img src="/_media/docs/guide-user/advanced/image_create_new_interface_set_firewall_region.png?w=800&amp;tok=7b9c37" class="media" loading="lazy" alt="" width="800" /></a><br/>

And the end result in the Interfaces page:<br/>

<a href="/_media/docs/guide-user/advanced/image_create_new_interface_end_result.png" class="media" title="docs:guide-user:advanced:image_create_new_interface_end_result.png"><img src="/_media/docs/guide-user/advanced/image_create_new_interface_end_result.png?w=800&amp;tok=b5a710" class="media" loading="lazy" alt="" width="800" /></a><br/>

</p>

</div>

<h4 id="wan_activity_light">WAN Activity light</h4>
<div class="level4">

<p>
When you create a second interface or simply switch the existing <abbr title="Wide Area Network">WAN</abbr> Interface to <code>usb0</code>, the <abbr title="Wide Area Network">WAN</abbr> activity light will go out. To reactivate it&#039;s function (blinking on activity), go to System, LED Configuration, Name - Wan, Edit, and change Device: <code>wan</code> to <code>usb0</code>. Save &amp; Save-&amp;-Apply.
</p>

<p>
After committing the changes, the <abbr title="Wide Area Network">WAN</abbr>&amp;WAN6 or new TetheringWAN/TetheringWAN6 should be active. Otherwise, restart them with the buttons you find in the <strong>Interface</strong> page of LuCI web interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3.a Router: Web interface&quot;,&quot;hid&quot;:&quot;a_routerweb_interface&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:10,&quot;range&quot;:&quot;6747-8928&quot;} -->
<h3 class="sectionedit11" id="b_routercommand_line_interface">3.b Router: Command Line Interface</h3>
<div class="level3">
<pre class="code bash"><span class="co0"># Enable tethering</span>
uci <span class="kw1">set</span> network.wan.ifname=<span class="st0">&quot;usb0&quot;</span>
uci <span class="kw1">set</span> network.wan6.ifname=<span class="st0">&quot;usb0&quot;</span>
uci commit network
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>network restart</pre>

<p>
For iPhones, replace the interface name <code>usb*</code> with <code>eth*</code>.
</p>

<p>
<strong>All your clients and router should have internet connectivity at this point.</strong>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3.b Router: Command Line Interface&quot;,&quot;hid&quot;:&quot;b_routercommand_line_interface&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:11,&quot;range&quot;:&quot;8929-9276&quot;} -->
<h2 class="sectionedit12" id="troubleshooting_optimizations">Troubleshooting &amp; Optimizations</h2>
<div class="level2">

<p>
If all went well, you should be able to see something like the following in the log
</p>
<ul>
<li class="level1"><div class="li"> click on <strong>Status</strong> and then on <strong>System Log</strong> to see this log from the LuCi web interface</div>
</li>
<li class="level1"><div class="li"> or use <code>dmesg</code> command on the <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">console over SSH</a></div>
</li>
</ul>
<pre class="code">[  176.449246] usb 1-1: new high-speed USB device number 3 using orion-ehci
[  176.654650] rndis_host 1-1:1.0 usb0: register &#039;rndis_host&#039; at usb-f1050000.ehci-1, RNDIS device, ee:da:c0:50:ff:44</pre>

<p>
Note the interface name (<code>usb0</code>) mentioned on the last line, this is the name to use during the setup process.
</p>

<p>
With iPhone attached and necessary driver loaded the log output will be different:
</p>
<pre class="code">[  276.139195] usb 4-1: new high-speed USB device number 2 using ehci-platform
[  276.344366] usb 4-1: New USB device found, idVendor=05ac, idProduct=12a8, bcdDevice=14.06
[  276.352586] usb 4-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[  276.359800] usb 4-1: Product: iPhone
[  276.363431] usb 4-1: Manufacturer: Apple Inc.
[  276.367818] usb 4-1: SerialNumber: XXXXXXXXXXXXXXXXXXXXXXXX
[  413.508513] ipheth 4-1:4.2: Apple iPhone USB Ethernet device attached</pre>

<p>
The interface device name will not appear in the logs unlike the previous example, until the interface is manually created in OpenWrt and underlying device is selected. In practice it will be the next available <code>ethX</code> like <code>eth1</code> in this example. The name can be discovered by running the following line of code on the console (replace <code>4-1:4.2</code> with numbers from your log):
</p>
<pre class="code">root@OpenWrt:~# for a in /sys/class/net/*; do readlink $a; done | grep  4-1:4.2 | xargs -r basename
eth1</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting &amp; Optimizations&quot;,&quot;hid&quot;:&quot;troubleshooting_optimizations&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:12,&quot;range&quot;:&quot;9277-11001&quot;} -->
<h3 class="sectionedit13" id="overcoming_bottlenecks">Overcoming bottlenecks</h3>
<div class="level3">

<p>
Openwrt 22.03 and newer (<a href="/docs/guide-user/firewall/firewall_configuration" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">using nftables/fw4, instead of older iptables/fw3</a>):
</p>

<p>
1.) Put this in /etc/config/firewall
</p>
<pre class="code bash">config include
    option path <span class="st_h">'/etc/firewall.user'</span>
    option fw4_compatible <span class="st_h">'1'</span></pre>

<p>
2.) Create the file &#039;/etc/firewall.user&#039;
</p>

<p>
3.) Put these lines in it:
</p>
<pre class="code bash">nft add rule inet fw4 mangle_forward oifname usb0 <span class="kw2">ip</span> ttl <span class="kw1">set</span> <span class="nu0">65</span>
nft add rule inet fw4 mangle_forward oifname usb0 ip6 hoplimit <span class="kw1">set</span> <span class="nu0">65</span>
<span class="co0">#for USB tethering, OR:</span>
nft add rule inet fw4 mangle_forward oifname wan <span class="kw2">ip</span> ttl <span class="kw1">set</span> <span class="nu0">65</span>
nft add rule inet fw4 mangle_forward oifname wan ip6 hoplimit <span class="kw1">set</span> <span class="nu0">65</span>
<span class="co0">#for regular WAN ethernet uplink</span></pre>

<p>
4.) Restart the firewall
</p>
<pre class="code bash"><span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>firewall restart</pre>

<p>
There is no way to do the above commands through the web interface Luci, <a href="/docs/guide-user/network/wan/yet_on_current_versions_of_openwrt" class="wikilink2" title="docs:guide-user:network:wan:yet_on_current_versions_of_openwrt" rel="nofollow" data-wiki-id="docs:guide-user:network:wan:yet_on_current_versions_of_openwrt">https://forum.openwrt.org/t/custom-rules-on-firewall-tab/120056</a>. These changes require <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">ssh or another CLI method</a>, and a text editor (e.g. <a href="/packages/pkgdata/nano" class="wikilink1" title="packages:pkgdata:nano" data-wiki-id="packages:pkgdata:nano">nano</a>). The Custom/User Firewall tab, is missing in current builds (23.x).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Overcoming bottlenecks&quot;,&quot;hid&quot;:&quot;overcoming_bottlenecks&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:13,&quot;range&quot;:&quot;11002-12189&quot;} -->
<h3 class="sectionedit14" id="connectivity_issues_related_to_cell_provider_networks">Connectivity Issues Related to Cell Provider Networks</h3>
<div class="level3">

<p>
You may notice the following: Android client devices to the router, will say there is &#039;no internet&#039;, but laptops may function fine. Intermittent connectivity issues to certain sites, but no problems connecting to others. Certain apps will behave poorly. Certain websites will take an otherwise unexplainably long time to load. There will be unaccounted-for hesitation on your connection, compared with no issues using them at the tethering phone directly. To further verify, before making these changes, test by opening a Wireguard connection directly from your device to your <abbr title="Virtual Private Network">VPN</abbr> host.
</p>

<p>
On some providers, it may be necessary to reduce the <abbr title="Maximum Transmission Unit">MTU</abbr> (e.g. Verizon):<br/>

Set <code>Network &gt; Interfaces &gt; Devices &gt; usb0 &gt; Configure</code> (or &#039;wan&#039; if you are using an ethernet-to-usb-c adapter) to an <abbr title="Maximum Transmission Unit">MTU</abbr> of 1400, and an <abbr title="Internet Protocol version 6">IPv6</abbr> <abbr title="Maximum Transmission Unit">MTU</abbr> of 1400.
</p>

<p>
Another fix is <code>Network &gt; Firewall &gt; General Settings</code>: On the &#039;<abbr title="Local Area Network">LAN</abbr> → <abbr title="Wide Area Network">WAN</abbr>&#039; rule, turn on <strong>Masquerading</strong> and <strong>MSS Clamping</strong>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Connectivity Issues Related to Cell Provider Networks&quot;,&quot;hid&quot;:&quot;connectivity_issues_related_to_cell_provider_networks&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:14,&quot;range&quot;:&quot;12190-13207&quot;} -->
<h3 class="sectionedit15" id="restart_tethering_on_connection_failure">Restart tethering on connection failure</h3>
<div class="level3">

<p>
If your tethering connection fails every so often, and:
</p>
<ul>
<li class="level1"><div class="li"> You see in your client devices that there is no internet connectivity, and</div>
</li>
<li class="level1"><div class="li"> Your phone is still showing a good 4G/tower connection, and tethering enabled, and</div>
</li>
<li class="level1"><div class="li"> Simply unplugging your tethering phone and plugging it back into the router fixes the problem</div>
</li>
</ul>

<p>
Then it might be fixed with the following solution:
</p>

<p>
1.) Install packages:
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> hub-ctrl</pre>

<p>
2.) Create the connectivity checking script:
</p>
<pre class="code bash"><span class="kw2">nano</span> <span class="sy0">/</span>root<span class="sy0">/</span>wan-watchdog.sh</pre>

<p>
3.) Copy and paste:
</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
&nbsp;
<span class="co0"># Fetch WAN gateway</span>
. <span class="sy0">/</span>lib<span class="sy0">/</span>functions<span class="sy0">/</span>network.sh
network_flush_cache
network_find_wan NET_IF
network_get_gateway NET_GW <span class="st0">&quot;<span class="es3">${NET_IF}</span>&quot;</span>
&nbsp;
<span class="co0"># Check WAN connectivity</span>
<span class="re2">TRIES</span>=<span class="st0">&quot;0&quot;</span>
<span class="kw1">while</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${TRIES}</span>&quot;</span> <span class="re5">-lt</span> <span class="nu0">5</span> <span class="br0">&#93;</span>
<span class="kw1">do</span>
    <span class="kw1">if</span> <span class="kw2">ping</span> <span class="re5">-c</span> <span class="nu0">1</span> <span class="re5">-w</span> <span class="nu0">3</span> <span class="st0">&quot;<span class="es3">${NET_GW}</span>&quot;</span> <span class="sy0">&amp;&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
    <span class="kw1">then</span> <span class="kw3">exit</span> <span class="nu0">0</span>
    <span class="kw1">else</span> <span class="kw3">let</span> TRIES++
    <span class="kw1">fi</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># Restart network</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>network stop
hub-ctrl <span class="re5">-h</span> <span class="nu0">0</span> <span class="re5">-P</span> <span class="nu0">1</span> <span class="re5">-p</span> <span class="nu0">0</span>
<span class="kw2">sleep</span> <span class="nu0">1</span>
hub-ctrl <span class="re5">-h</span> <span class="nu0">0</span> <span class="re5">-P</span> <span class="nu0">1</span> <span class="re5">-p</span> <span class="nu0">1</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>network start</pre>

<p>
4.) Run:
</p>
<pre class="code bash"><span class="kw2">chmod</span> +x <span class="sy0">/</span>root<span class="sy0">/</span>wan-watchdog.sh</pre>

<p>
5.) Set the script to run every minute as scheduled task:
Go to System→Scheduled Tasks, add:
</p>
<pre class="code bash"><span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">/</span>root<span class="sy0">/</span>wan-watchdog.sh</pre>

<p>
Every 1 minute, the script will be run, ping <abbr title="Wide Area Network">WAN</abbr> gateway, and if there are 5 consecutive failures, it will stop the network, power off the USB hub (which will terminate tethering on the phone), power it back on, then restart the network.
This solution is much faster than restarting the whole router.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Restart tethering on connection failure&quot;,&quot;hid&quot;:&quot;restart_tethering_on_connection_failure&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:15,&quot;range&quot;:&quot;13208-14783&quot;} -->
<h3 class="sectionedit16" id="iphone_automatic_watchdog">iPhone automatic watchdog</h3>
<div class="level3">

<p>
Once you set up iPhone tethering as per above, you&#039;ll may notice several issues:
</p>
<ul>
<li class="level1"><div class="li"> usbmuxd needs to be started manually after every reboot</div>
</li>
<li class="level1"><div class="li"> On iPhone, you need to set up trust again after every router reboot</div>
</li>
<li class="level1"><div class="li"> If your cellular signal is weak, tethering will disconnect every now and then and you&#039;ll need to unplug and reconnect USB cable</div>
</li>
</ul>

<p>
Save following script to some location that survives reboot, e.g. <code>/etc/lockdown</code>, and execute it after every reboot.
It should keep tethering up and running as long as iPhone is connected.
</p>
<pre class="code bash"><span class="co0"># Save watchdog script</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>lockdown
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>lockdown<span class="sy0">/</span>watchdog.sh
<span class="co0">#!/bin/sh</span>
<span class="co0"># A small script to make life with iPhone tethering less cumbersome on OpenWrt</span>
<span class="co0"># Petr Vyskocil, Apr 2020</span>
<span class="co0"># Public domain</span>
&nbsp;
<span class="co0"># After you successfully allow iPhone tethering, copy files with name like</span>
<span class="co0"># /var/lib/lockdown/12345678-9ABCDEF012345678.plist to /etc/lockdown/locks.</span>
<span class="co0"># That way, you won't have to set up trust again after router reboots.</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-e</span> <span class="sy0">/</span>etc<span class="sy0">/</span>lockdown<span class="sy0">/</span>locks <span class="br0">&#93;</span>
<span class="kw1">then</span>
    <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>lockdown
    <span class="kw2">cp</span> <span class="re5">-f</span> <span class="sy0">/</span>etc<span class="sy0">/</span>lockdown<span class="sy0">/</span>locks<span class="sy0">/*</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>lockdown<span class="sy0">/</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># lockdown records restored, now we can launch usbmuxd. Don't launch it sooner!</span>
usbmuxd
&nbsp;
<span class="co0"># We are up and running now. But unfortunately if your carrier signal is weak, iPhone will</span>
<span class="co0"># drop connection from time to time and you'd have to unplug and replug USB cable to start tethering</span>
<span class="co0"># again. Script below automates that activity.</span>
&nbsp;
<span class="co0"># First wait a bit - we just brought the interface up by usbmuxd</span>
<span class="kw2">sleep</span> <span class="nu0">20</span>
&nbsp;
<span class="co0"># If we see iPhone ethernet interface, try to ping iPhone router's address (172.20.10.1).</span>
<span class="co0"># When the ping is unsuccessful, rebind iPhone ethernet USB driver and wait for things to settle down</span>
<span class="kw1">while</span> :
<span class="kw1">do</span>
    <span class="kw1">for</span> i <span class="kw1">in</span> <span class="sy0">/</span>sys<span class="sy0">/</span>bus<span class="sy0">/</span>usb<span class="sy0">/</span>drivers<span class="sy0">/</span>ipheth<span class="sy0">/*</span>:<span class="sy0">*</span>
    <span class="kw1">do</span>
        <span class="kw3">test</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es3">${i}</span>&quot;</span> <span class="sy0">||</span> <span class="kw3">continue</span>
        <span class="kw2">ping</span> <span class="re5">-w</span> <span class="nu0">3</span> 172.20.10.1 <span class="sy0">&amp;&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${?}</span>&quot;</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            <span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${i##*/}</span>&quot;</span> <span class="sy0">&gt;</span> <span class="st0">&quot;<span class="es3">${i%/*}</span>&quot;</span><span class="sy0">/</span>unbind
            <span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${i##*/}</span>&quot;</span> <span class="sy0">&gt;</span> <span class="st0">&quot;<span class="es3">${i%/*}</span>&quot;</span><span class="sy0">/</span><span class="kw3">bind</span>
            <span class="kw2">sleep</span> <span class="nu0">20</span>
        <span class="kw1">fi</span>
    <span class="kw1">done</span>
    <span class="kw2">sleep</span> <span class="nu0">1</span>
<span class="kw1">done</span>
EOF
<span class="kw2">chmod</span> +x <span class="sy0">/</span>etc<span class="sy0">/</span>lockdown<span class="sy0">/</span>watchdog.sh
&nbsp;
<span class="co0"># Add watchdog script to autostart</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\$</span>i (/etc/lockdown/watchdog.sh) &amp;&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;iPhone automatic watchdog&quot;,&quot;hid&quot;:&quot;iphone_automatic_watchdog&quot;,&quot;codeblockOffset&quot;:16,&quot;secid&quot;:16,&quot;range&quot;:&quot;14784-16997&quot;} -->
<h3 class="sectionedit17" id="work_around_tethering-activation_issue_on_rooted_phones">Work around tethering-activation issue on rooted phones</h3>
<div class="level3">

<p>
If your Android phone does not seem to detect that there is something attached to the USB port and refuses to switch to USB tethering, you might want to install <strong>DriveDroid</strong> and try to enable various methods of using USB guest for its own functionality.
This does solve that issue on some phones. You will probably need <strong>root</strong> (administrator) access on your device though.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Work around tethering-activation issue on rooted phones&quot;,&quot;hid&quot;:&quot;work_around_tethering-activation_issue_on_rooted_phones&quot;,&quot;codeblockOffset&quot;:17,&quot;secid&quot;:17,&quot;range&quot;:&quot;16998-17441&quot;} -->
<h3 class="sectionedit18" id="cell_provider_assigns_ipv6">Cell provider assigns IPv6</h3>
<div class="level3">

<p>
Cell phone companies are transitioning to <abbr title="Internet Protocol version 6">IPv6</abbr>, and they might assign your SIM an <abbr title="Internet Protocol version 6">IPv6</abbr> subnet bigger than a /64, typically, a /56 or /48, but sometimes a /60. You may use an assignment larger than a /64 (/56 or /48) to provide native <abbr title="Internet Protocol version 6">IPv6</abbr> addresses and connectivity to your <abbr title="Local Area Network">LAN</abbr>, but even /64 will provide some connectivity. A quick way to test, is to look at the wan6/TetheringWAN6 interface, and see what kind of <abbr title="Internet Protocol version 6">IPv6</abbr> address was provided.
</p>

<p>
The following <abbr title="Internet Protocol version 6">IPv6</abbr> settings have consistently worked for cell providers Verizon &amp; TMOBILE:
Luci (Web):
Your <abbr title="Local Area Network">LAN</abbr> <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> settings [Go to: Network, Interfaces, <abbr title="Local Area Network">LAN</abbr>, Edit, <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> Server, <abbr title="Internet Protocol version 6">IPv6</abbr> Settings] for <abbr title="Internet Protocol version 6">IPv6</abbr> preferences should be set to &#039;Relay&#039; for <strong>RA-Service</strong>, <strong>DHCPv6-Service</strong> and <strong>NDP-Proxy</strong>. Your WAN6/TetheringWAN6 settings, are &#039;Designated Master&#039; (checked), and again &#039;Relay&#039; for all three aspects.
</p>

<p>
The equivalent CLI settings, editing /etc/config/dhcp:
</p>
<pre class="code bash">config dhcp <span class="st_h">'lan'</span>
        ...
	option dhcpv6 <span class="st_h">'relay'</span>
	option ra <span class="st_h">'relay'</span>
	option ndp <span class="st_h">'relay'</span>
	option ra_useleasetime <span class="st_h">'1'</span>
	option ra_dns <span class="st_h">'0'</span> <span class="co0"># You may need this to get DNS to work properly!</span>
config dhcp <span class="st_h">'wan6'</span>
        ...
	option master <span class="st_h">'1'</span>
	option ra <span class="st_h">'relay'</span>
	option dhcpv6 <span class="st_h">'relay'</span>
	option ndp <span class="st_h">'relay'</span>
	option ra_useleasetime <span class="st_h">'1'</span></pre>

<p>
It may help to explicitly set your <strong>Gateway Metric</strong> on <abbr title="Wide Area Network">WAN</abbr> (<abbr title="Internet Protocol version 4">IPv4</abbr>), to a different (lower) value than on WAN6 (<abbr title="Internet Protocol version 6">IPv6</abbr>) [Network, Interfaces, <abbr title="Wide Area Network">WAN</abbr>/WAN6/TetheringWAN/TetheringWAN6, Edit, Advanced Settings, Use Gateway Metric]. These are not set, by default, and setting them like this, can clear up some connectivity issues, where the internet connection &#039;dies&#039; after awhile on Android devices, and needs to be restarted (either by toggling the Wifi on the device, or Airplane Mode).
</p>

<p>
If your provider does not assign a subnet larger than a /64, you could use <a href="/docs/guide-user/network/ipv6/ipv6.nat6" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6.nat6" data-wiki-id="docs:guide-user:network:ipv6:ipv6.nat6"> NAT6 and IPv6 masquerading</a> to enable <abbr title="Internet Protocol version 6">IPv6</abbr> access for your <abbr title="Local Area Network">LAN</abbr> clients. One of the features of <abbr title="Internet Protocol version 6">IPv6</abbr> is enough address space to move away from <abbr title="Network Address Translation">NAT</abbr> and CGNAT. If you have an <abbr title="Internet Protocol version 6">IPv6</abbr> interface on *usb0* over the usual <abbr title="Internet Protocol version 4">IPv4</abbr> <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> client and thus have two <abbr title="Wide Area Network">WAN</abbr> interfaces over *usb0*, and the provider assigns e.g. a /56, the <abbr title="Internet Protocol version 4">IPv4</abbr> wan interface would be doing <abbr title="Network Address Translation">NAT</abbr> and tunneling your traffic, which is overhead native <abbr title="Internet Protocol version 6">IPv6</abbr> would avoid.<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Cell provider assigns IPv6&quot;,&quot;hid&quot;:&quot;cell_provider_assigns_ipv6&quot;,&quot;codeblockOffset&quot;:17,&quot;secid&quot;:18,&quot;range&quot;:&quot;17442-19762&quot;} -->
<h3 class="sectionedit19" id="dual-wan">Dual-WAN</h3>
<div class="level3">

<p>
Install the <a href="/docs/guide-user/network/wan/multiwan/mwan3" class="wikilink1" title="docs:guide-user:network:wan:multiwan:mwan3" data-wiki-id="docs:guide-user:network:wan:multiwan:mwan3"> mwan3</a> and <code>luci-app-mwan3</code> packages to manage traffic over both (or up to 250 <abbr title="Wide Area Network">WAN</abbr>) interfaces with kernel policy routing, this is especially useful if you&#039;re using your cell phone as a secondary <abbr title="Wide Area Network">WAN</abbr> interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dual-WAN&quot;,&quot;hid&quot;:&quot;dual-wan&quot;,&quot;codeblockOffset&quot;:18,&quot;secid&quot;:19,&quot;range&quot;:&quot;19763-20055&quot;} -->
<h3 class="sectionedit20" id="references">References</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Tethering instructions (abbreviated) used to correct this guide (2020/06/10): <a href="https://android.stackexchange.com/a/26650" class="urlextern" title="https://android.stackexchange.com/a/26650" rel="ugc nofollow">https://android.stackexchange.com/a/26650</a></div>
</li>
<li class="level1"><div class="li"> The original forum thread: <a href="https://forum.openwrt.org/viewtopic.php?pid=173399#p173399" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=173399#p173399" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?pid=173399#p173399</a></div>
</li>
<li class="level1"><div class="li"> The old wiki archived page <a href="https://oldwiki.archive.openwrt.org/doc/howto/usb.tethering" class="urlextern" title="https://oldwiki.archive.openwrt.org/doc/howto/usb.tethering" rel="ugc nofollow">https://oldwiki.archive.openwrt.org/doc/howto/usb.tethering</a></div>
</li>
<li class="level1"><div class="li"> A script that might enhance the experience (especially for iPhone users) <a href="https://github.com/LeJeko/OpenWRT-USB-Tethering" class="urlextern" title="https://github.com/LeJeko/OpenWRT-USB-Tethering" rel="ugc nofollow">https://github.com/LeJeko/OpenWRT-USB-Tethering</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;References&quot;,&quot;hid&quot;:&quot;references&quot;,&quot;codeblockOffset&quot;:18,&quot;secid&quot;:20,&quot;range&quot;:&quot;20056-20523&quot;} -->
<h3 class="sectionedit21" id="openwrt_build_issues">OpenWrt build issues</h3>
<div class="level3">

<p>
If you don&#039;t see something like the sample kernel log output in your device&#039;s log then your device might be lacking proper USB drivers (drivers to operate the USB controllers at all).
Check <a href="/docs/guide-user/storage/usb-installing" class="wikilink1" title="docs:guide-user:storage:usb-installing" data-wiki-id="docs:guide-user:storage:usb-installing">Installing USB drivers</a> and report the issue in a bug report or in the mailing list, as devices should have base USB drivers integrated and working already.
</p>

<p>
For other issues it might be worth it to check <a href="/docs/guide-user/network/wan/wwan/ethernetoverusb_rndis" class="wikilink1" title="docs:guide-user:network:wan:wwan:ethernetoverusb_rndis" data-wiki-id="docs:guide-user:network:wan:wwan:ethernetoverusb_rndis"> the article about using RNDIS dongles</a> as Android tethering is using the same protocol.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenWrt build issues&quot;,&quot;hid&quot;:&quot;openwrt_build_issues&quot;,&quot;codeblockOffset&quot;:18,&quot;secid&quot;:21,&quot;range&quot;:&quot;20524-&quot;} -->