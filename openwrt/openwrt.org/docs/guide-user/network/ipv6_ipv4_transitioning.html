
<h1 class="sectionedit1" id="ipv4ipv6_transition_technologies">IPv4/IPv6 transition technologies</h1>
<div class="level1">

<p>
See also:
<a href="/docs/guide-user/network/ipv6/nat64" class="wikilink1" title="docs:guide-user:network:ipv6:nat64" data-wiki-id="docs:guide-user:network:ipv6:nat64">NAT64 for IPv6-only networks</a>,
<a href="/docs/guide-user/network/ipv6/ipv6.nat6" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6.nat6" data-wiki-id="docs:guide-user:network:ipv6:ipv6.nat6">NAT66 and IPv6 masquerading</a>,
<a href="/docs/guide-user/firewall/fw3_configurations/fw3_nat#ipv6_nat" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:fw3_nat" data-wiki-id="docs:guide-user:firewall:fw3_configurations:fw3_nat">IPv6 NAT and NPT</a>
</p>

<p>
Transition technologies can be installed using the following packages:
</p>
<ul>
<li class="level1"><div class="li"> <abbr title="Internet Protocol version 6">IPv6</abbr>-in-<abbr title="Internet Protocol version 4">IPv4</abbr> tunnels: <a href="/packages/pkgdata/6rd" class="wikilink1" title="packages:pkgdata:6rd" data-wiki-id="packages:pkgdata:6rd">6rd</a>, <a href="/packages/pkgdata/6to4" class="wikilink1" title="packages:pkgdata:6to4" data-wiki-id="packages:pkgdata:6to4">6to4</a>, <a href="/packages/pkgdata/6in4" class="wikilink1" title="packages:pkgdata:6in4" data-wiki-id="packages:pkgdata:6in4">6in4</a>.</div>
</li>
<li class="level1"><div class="li"> <abbr title="Internet Protocol version 4">IPv4</abbr>-in-<abbr title="Internet Protocol version 6">IPv6</abbr> tunnels: <a href="/packages/pkgdata/ds-lite" class="wikilink1" title="packages:pkgdata:ds-lite" data-wiki-id="packages:pkgdata:ds-lite">ds-lite</a>.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv4\/IPv6 transition technologies&quot;,&quot;hid&quot;:&quot;ipv4ipv6_transition_technologies&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-516&quot;} -->
<h2 class="sectionedit2" id="in4_tunnelhenet_tunnel_broker">6in4 Tunnel / HE.net Tunnel Broker</h2>
<div class="level2">

<p>
See also:
<a href="/docs/guide-user/network/ipv6/ipv6tunnel-luci" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6tunnel-luci" data-wiki-id="docs:guide-user:network:ipv6:ipv6tunnel-luci">Setting up an IPv6 Tunnel with LuCI</a>,
<a href="/docs/guide-user/network/ipv6/ipv6_henet" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6_henet" data-wiki-id="docs:guide-user:network:ipv6:ipv6_henet">IPv6 with Hurricane Electric</a>
</p>

<p>
6in4 tunnels are usually provided by external tunnel providers like HE.net.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package <a href="/packages/pkgdata/6in4" class="wikilink1" title="packages:pkgdata:6in4" data-wiki-id="packages:pkgdata:6in4">6in4</a> must be installed to use this protocol.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> 6in4 requires you to have a public <abbr title="Internet Protocol version 4">IPv4</abbr> address, clients behind CGNAT are <a href="https://forums.he.net/index.php?topic=488.0" class="urlextern" title="https://forums.he.net/index.php?topic=488.0" rel="ugc nofollow">not supported</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;6in4 Tunnel \/ HE.net Tunnel Broker&quot;,&quot;hid&quot;:&quot;in4_tunnelhenet_tunnel_broker&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;517-1035&quot;} -->
<h3 class="sectionedit3" id="static_ipv6-in-ipv4_tunnel">Static IPv6-in-IPv4 Tunnel</h3>
<div class="level3">

<p>
The example below illustrates a static tunnel configuration for the Hurricane Electric (he.net) broker.
option <code>ipaddr</code> specifies the local <abbr title="Internet Protocol version 4">IPv4</abbr> address, <code>peeraddr</code> is the broker <abbr title="Internet Protocol version 4">IPv4</abbr> address and <code>ip6addr</code> the local <abbr title="Internet Protocol version 6">IPv6</abbr> address routed via the tunnel.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface <span class="st_h">'wan6'</span>
        option proto        <span class="st_h">'6in4'</span>
        option ipaddr       <span class="st_h">'178.24.115.19'</span>
        option peeraddr     <span class="st_h">'216.66.80.30'</span>
        option ip6addr      <span class="st_h">'2001:0DB8:1f0a:1359::2/64'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Static IPv6-in-IPv4 Tunnel&quot;,&quot;hid&quot;:&quot;static_ipv6-in-ipv4_tunnel&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1036-1576&quot;} -->
<h3 class="sectionedit4" id="dynamic_ipv6-in-ipv4_tunnel_henet_only">Dynamic IPv6-in-IPv4 Tunnel (HE.net only)</h3>
<div class="level3">

<p>
The example below illustrates a dynamic tunnel configuration for the Hurricane Electric (he.net) broker with enabled <abbr title="Internet Protocol">IP</abbr> update.
The local <abbr title="Internet Protocol version 4">IPv4</abbr> address is determined automatically.
The options <code>tunnelid</code>, <code>username</code> and <code>updatekey</code> are provided for <abbr title="Internet Protocol">IP</abbr> update.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface <span class="st_h">'wan6'</span>
        option proto     <span class="st_h">'6in4'</span>
        option mtu       <span class="st_h">'1424'</span>                      <span class="co0"># the IPv6 tunnel MTU (optional)</span>
        option peeraddr  <span class="st_h">'216.66.80.30'</span>              <span class="co0"># the IPv4 tunnel endpoint at the tunnel provider</span>
        option ip6addr   <span class="st_h">'2001:0db8:1f0a:1359::2/64'</span> <span class="co0"># the IPv6 tunnel address</span>
        option ip6prefix <span class="st_h">'2001:db8:1234::/48'</span>        <span class="co0"># Your routed prefix (required)</span>
        <span class="co0"># configuration options below are only valid for HE.net tunnels, ignore them for other tunnel providers.</span>
        option tunnelid  <span class="st_h">'12345'</span>                     <span class="co0"># HE.net tunnel id</span>
        option username  <span class="st_h">'username'</span>                  <span class="co0"># HE.net username used to login into tunnelbroker, not the User ID shown after login in.</span>
        option updatekey <span class="st_h">'updatekey'</span>                 <span class="co0"># HE.net updatekey instead of password, default for new tunnels</span></pre>

<p>
See below for advanced configuration options.
</p>

<p>
In a typical tunnel configuration (e.g. HE.net) you get two different ipv6 addresses/prefixes from the tunnel provider:
</p>
<ul>
<li class="level1"><div class="li"> <strong>ip6addr</strong>: The tunnel endpoint address is like &#039;2001:DB8:2222:EFGH::2/64&#039;. This ...::2 address is only used for the tunnel interface endpoint. It is not a routable address and it can&#039;t be used for anything else than connecting to the other end of the tunnel, typically ...::1 .</div>
</li>
<li class="level1"><div class="li"> <strong>ip6prefix</strong>: The tunnel provider gives you also a routable prefix, typically either /48 or /64, for example &#039;2001:DB8:1112::/48&#039; or &#039;2001:DB8:1234:ABCD::/64&#039;. Your <abbr title="Local Area Network">LAN</abbr> clients will get addresses from that prefix. Using a wider prefix helps delegate <abbr title="Internet Protocol version 6">IPv6</abbr> to several downstream networks.</div>
</li>
</ul>

</div>

<h4 id="firewall">Firewall</h4>
<div class="level4">

<p>
Some users may require to add extra firewall rules to allow 6in4 traffic to always reach their tunnel endpoint.
The package <a href="/packages/pkgdata/iptables-mod-ipopt" class="wikilink1" title="packages:pkgdata:iptables-mod-ipopt" data-wiki-id="packages:pkgdata:iptables-mod-ipopt">iptables-mod-ipopt</a> must be installed for length matching.
</p>
<pre class="code bash"><span class="co0"># /etc/config/firewall</span>
config rule
        option name      <span class="st_h">'Allow-protocol-41'</span>
        option src       <span class="st_h">'wan'</span>
        option proto     <span class="st_h">'41'</span>
        option target    <span class="st_h">'ACCEPT'</span>
&nbsp;
config rule
        option name      <span class="st_h">'Allow-protocol-59'</span>
        option src       <span class="st_h">'wan'</span>
        option proto     <span class="st_h">'59'</span>
        option target    <span class="st_h">'ACCEPT'</span>
        option extra     <span class="st_h">'-m length --length 40'</span></pre>

</div>

<h4 id="default_route">Default route</h4>
<div class="level4">

<p>
Provide default route to override <code>sourcefilter</code>.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config route6
        option interface <span class="st_h">'wan6'</span>
        option target    <span class="st_h">'::/0'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dynamic IPv6-in-IPv4 Tunnel (HE.net only)&quot;,&quot;hid&quot;:&quot;dynamic_ipv6-in-ipv4_tunnel_henet_only&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;1577-4349&quot;} -->
<h2 class="sectionedit5" id="protocol_6in4_ipv6-in-ipv4_tunnel">Protocol 6in4 (IPv6-in-IPv4 Tunnel)</h2>
<div class="level2">
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>ipaddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col2"> no </td><td class="col3"> Current <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col4"> Local <abbr title="Internet Protocol version 4">IPv4</abbr> endpoint address </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>peeraddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Remote <abbr title="Internet Protocol version 4">IPv4</abbr> endpoint address </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ip6addr</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> address (CIDR) </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Local <abbr title="Internet Protocol version 6">IPv6</abbr> address delegated to the tunnel endpoint </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>ip6prefix</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> prefix </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Routed <abbr title="Internet Protocol version 6">IPv6</abbr> prefix for downstream interfaces (Barrier Breaker and later only) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>tunlink</code> </td><td class="col1"> Logical Interface </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Tunnel base interface. Define which Interface, for example <abbr title="Wide Area Network">WAN</abbr>, should be used for outgoing <abbr title="Internet Protocol version 4">IPv4</abbr> traffic to the Remote <abbr title="Internet Protocol version 4">IPv4</abbr> Address </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>defaultroute</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Whether to create an <abbr title="Internet Protocol version 6">IPv6</abbr> default route over the tunnel </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>ttl</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>64</code> </td><td class="col4"> <abbr title="Time To Live">TTL</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>tos</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Type Of Service : either “inherit” (the outer header inherits the value of the inner header) or an hexadecimal value. Also known as DSCP. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>mtu</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>1280</code> </td><td class="col4"> <abbr title="Maximum Transmission Unit">MTU</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>tunnelid</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> HE.net global tunnel ID, used for endpoint update </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>username</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> HE.net username which you use to login into tunnelbroker, not the User ID shown after you have login in, plaintext, used for endpoint update </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>password</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> HE.net password, plaintext, obsolete, used for endpoint update </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>updatekey</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> HE.net updatekey, plaintext, overrides password since 2014-02, used for endpoint update </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>metric</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies the default route metric to use </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;4398-6088&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This protocol type does not need the <code>device</code> option set in the interface section.
The interface name is derived from the section name, e.g. <code>config interface sixbone</code> would result in an interface named <code>6in4-sixbone</code>.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Although <code>ip6prefix</code> isn&#039;t required, <code>sourcefilter</code> is enabled by default and prevents forwarding of packets unless <code>ip6prefix</code> is specified.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol 6in4 (IPv6-in-IPv4 Tunnel)&quot;,&quot;hid&quot;:&quot;protocol_6in4_ipv6-in-ipv4_tunnel&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:5,&quot;range&quot;:&quot;4350-6472&quot;} -->
<h2 class="sectionedit7" id="rd_tunnel_isp-provided_ipv6_transition">6rd Tunnel (ISP-Provided IPv6 Transition)</h2>
<div class="level2">

<p>
6rd is a tunnel mechanism based on 6to4.
Unlike other tunneling mechanisms, 6rd is usually provided by the <abbr title="Internet Service Provider">ISP</abbr> itself.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package <a href="/packages/pkgdata/6rd" class="wikilink1" title="packages:pkgdata:6rd" data-wiki-id="packages:pkgdata:6rd">6rd</a> must be installed to use this protocol.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The configuration of 6rd is usually auto-detected and manual configuration is not needed, simply installing the 6rd package (and rebooting) is usually enough.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> To automatically configure 6rd from dhcp you need to create an interface with <code>option auto 0</code> and put its name as the &#039;iface6rd&#039; parameter.
In addition you also need to add its name to a suitable firewall zone in <code>/etc/config/firewall</code>.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface <span class="st_h">'wan6'</span>
        option proto <span class="st_h">'6rd'</span>
        option peeraddr <span class="st_h">'77.174.0.2'</span>
        option ip6prefix <span class="st_h">'2001:838:ad00::'</span>
        option ip6prefixlen <span class="st_h">'40'</span>
        option ip4prefixlen <span class="st_h">'16'</span></pre>

<p>
To debug 6rd via <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>, enable <a href="/docs/guide-user/network/protocol.dhcp#dhcp_client_scripts" class="wikilink1" title="docs:guide-user:network:protocol.dhcp" data-wiki-id="docs:guide-user:network:protocol.dhcp">DHCP client logging</a>, reboot the router, and check the logs:
</p>
<pre class="code bash"><span class="co0"># logread -e ip6rd</span>
<span class="re2">ip6rd</span>=<span class="nu0">16</span> <span class="nu0">40</span> <span class="nu0">2001</span>:0838:ad00:0000:0000:0000:0000:0000 77.174.0.2</pre>

<p>
If this line isn&#039;t present, you need to obtain the correct values for peeraddr, ip6prefix, ip6prefixlen and ip4prefixlen from your <abbr title="Internet Service Provider">ISP</abbr>.
The above ip6rd or the obtained values can be used to hardcode the 6rd tunnel.
Remove or comment out the iface6rd line in the wan section.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If you choose a name for your tunnel-interface different from <code>wan6</code>, be sure to add that network to the <code>wan</code> firewall-zone.
</p>

<p>
Below configuration options are only needed for hardcoding the 6rd tunnel.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;6rd Tunnel (ISP-Provided IPv6 Transition)&quot;,&quot;hid&quot;:&quot;rd_tunnel_isp-provided_ipv6_transition&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:7,&quot;range&quot;:&quot;6473-8121&quot;} -->
<h2 class="sectionedit8" id="protocol_6rd">Protocol 6rd</h2>
<div class="level2">
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>peeraddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col2"> yes </td><td class="col3"> no </td><td class="col4"> 6rd - Gateway </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>ipaddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col2"> no </td><td class="col3"> Current <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col4"> Local <abbr title="Internet Protocol version 4">IPv4</abbr> endpoint address </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ip6prefix</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> prefix (without length) </td><td class="col2"> yes </td><td class="col3"> no </td><td class="col4"> 6rd-<abbr title="Internet Protocol version 6">IPv6</abbr> Prefix </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>ip6prefixlen</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> prefix length </td><td class="col2"> yes </td><td class="col3"> no </td><td class="col4"> 6rd-<abbr title="Internet Protocol version 6">IPv6</abbr> Prefix length </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>ip4prefixlen</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> prefix length </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> <abbr title="Internet Protocol version 4">IPv4</abbr> common prefix </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>defaultroute</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Whether to create an <abbr title="Internet Protocol version 6">IPv6</abbr> default route over the tunnel </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>ttl</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>64</code> </td><td class="col4"> <abbr title="Time To Live">TTL</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>tos</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Type Of Service: either “inherit” (the outer header inherits the value of the inner header) or an hexadecimal value </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>mtu</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>1280</code> </td><td class="col4"> <abbr title="Maximum Transmission Unit">MTU</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>iface6rd</code> </td><td class="col1"> logical interface </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Logical interface template for auto-configuration of 6rd </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>mtu6rd</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>system default</em> </td><td class="col4"> <abbr title="Maximum Transmission Unit">MTU</abbr> of the 6rd interface </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>zone6rd</code> </td><td class="col1"> firewall zone </td><td class="col2"> no </td><td class="col3"> <em>system default</em> </td><td class="col4"> Firewall zone to which the 6rd interface should be added </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;8147-9290&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This protocol type does not need the <code>device</code> option set in the interface section.
The interface name is derived from the section name, e.g. <code>config interface wan6</code> would result in an interface named <code>6rd-wan6</code>.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Some <abbr title="Internet Service Provider">ISP</abbr>&#039;s give you the number of bytes you should use from your <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol">IP</abbr> to calculate your <abbr title="Internet Protocol version 6">IPv6</abbr> address.
<code>ip4prefixlen</code> expects the <em>prefix</em> bytes of your <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol">IP</abbr> to calculate the <abbr title="Internet Protocol version 6">IPv6</abbr> address.
So if your <abbr title="Internet Service Provider">ISP</abbr> gives you 14 bytes to calculate, enter 18 (32 - 14).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol 6rd&quot;,&quot;hid&quot;:&quot;protocol_6rd&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:8,&quot;range&quot;:&quot;8122-9783&quot;} -->
<h2 class="sectionedit10" id="pe_l2tp_tunnel_isp-provided_ipv6_transition">6pe, L2TP Tunnel (ISP-provided IPv6 Transition)</h2>
<div class="level2">

<p>
This is another transitional mechanism for <abbr title="Internet Protocol version 6">IPv6</abbr> used by some ISPs, it relies on a L2TPv2 tunnel.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package <a href="/packages/pkgdata/xl2tpd" class="wikilink1" title="packages:pkgdata:xl2tpd" data-wiki-id="packages:pkgdata:xl2tpd">xl2tpd</a> must be installed to use this protocol.
It will handle the L2TP tunnel and PPP session.
</p>

<p>
The high-level description of the tunneling is the following:
</p>
<ol>
<li class="level1"><div class="li"> An L2TP tunnel is created, encapsulated in <abbr title="User Datagram Protocol">UDP</abbr> packets over <abbr title="Internet Protocol version 4">IPv4</abbr>.</div>
</li>
<li class="level1"><div class="li"> A PPP session is established inside the tunnel.</div>
</li>
<li class="level1"><div class="li"> IPv6CP (see <a href="http://tools.ietf.org/html/rfc5072" class="urlextern" title="http://tools.ietf.org/html/rfc5072" rel="ugc nofollow">RFC 5072</a>) is used to negotiate link-local <abbr title="Internet Protocol version 6">IPv6</abbr> addresses.</div>
</li>
<li class="level1"><div class="li"> An <abbr title="Internet Protocol version 6">IPv6</abbr> prefix is obtained thanks to DHCPv6.</div>
</li>
</ol>

<p>
This howto is derived from an experience with SFR, in France (FTTH residential access).
It might apply to other ISPs as well.
In the case of SFR, steps 1 and 2 require an authentication.
Fortunately, the L2TP password is hardcoded.
The PPP password is not, but it&#039;s sent as cleartext, so a simple sniffing is enough to recover it.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface 6pe
        option proto l2tpv2
        option server <span class="sy0">&lt;</span>LNS address<span class="sy0">&gt;</span>
        option username <span class="st_h">'&lt;PPP username&gt;'</span>
        option password <span class="st_h">'&lt;PPP password&gt;'</span>
        option keepalive <span class="st_h">'6'</span>
        option ipv6 <span class="st_h">'1'</span>
&nbsp;
config interface <span class="st_h">'wan6'</span>
        option device <span class="st_h">'@6pe'</span>
        option proto <span class="st_h">'dhcpv6'</span></pre>

<p>
If you need authentication at the L2TP level (before PPP):
</p>
<pre class="code bash"><span class="co0"># /etc/xl2tpd/xl2tp-secrets</span>
<span class="sy0">*</span> <span class="sy0">*</span> my_l2tp_password</pre>

<p>
At this point, running <code>service network reload</code> or simply running <code>ifup wan6</code> should give you a fully working <abbr title="Internet Protocol version 6">IPv6</abbr> setup.
To debug, look at the logs (<code>logread</code>) and the interfaces status (<code>ifstatus 6pe</code> and <code>ifstatus wan6</code>).
</p>

<p>
Advanced options for this protocol are below.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;6pe, L2TP Tunnel (ISP-provided IPv6 Transition)&quot;,&quot;hid&quot;:&quot;pe_l2tp_tunnel_isp-provided_ipv6_transition&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:10,&quot;range&quot;:&quot;9784-11513&quot;} -->
<h2 class="sectionedit11" id="protocol_l2tp_ppp_over_l2tp_tunnel">Protocol l2tp (PPP over L2TP Tunnel)</h2>
<div class="level2">

<p>
Most options are similar to protocol “ppp”.
</p>
<div class="table sectionedit12"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>server</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> L2TP server to connect to. Acceptable datatypes are hostname or <abbr title="Internet Protocol">IP</abbr> address, with optional port separated by colon <code>:</code>. Note that specifying port is only supported recently and should appear in DD release </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>username</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Username for PAP/CHAP authentication </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>password</code> </td><td class="col1"> string </td><td class="col2"> yes if <code>username</code> is provided </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Password for PAP/CHAP authentication </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>ipv6</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> Enable <abbr title="Internet Protocol version 6">IPv6</abbr> on the PPP link (IPv6CP) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>mtu</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> <code>pppd</code> default </td><td class="col4"> Maximum Transmit/Receive Unit, in bytes </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>keepalive</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Number of unanswered echo requests before considering the peer dead. The interval between echo requests is 5 seconds. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>checkup_interval</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Number of seconds to pass before checking if the interface is not up since the last setup attempt and retry the connection otherwise. Set it to a value sufficient for a successful L2TP connection for you. It&#039;s mainly for the case that netifd sent the connect request yet xl2tpd failed to complete it without the notice of netifd </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>pppd_options</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Additional options to pass to <code>pppd</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;11608-12890&quot;} -->
<p>
The name of the physical interface will be “l2tp-&lt;logical interface name&gt;”.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol l2tp (PPP over L2TP Tunnel)&quot;,&quot;hid&quot;:&quot;protocol_l2tp_ppp_over_l2tp_tunnel&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:11,&quot;range&quot;:&quot;11514-12968&quot;} -->
<h2 class="sectionedit13" id="to4_tunnel">6to4 Tunnel</h2>
<div class="level2">

<p>
6to4 is the simplest <abbr title="Internet Protocol version 6">IPv6</abbr> tunneling mechanism and relies on publicly available gateways.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package <a href="/packages/pkgdata/6to4" class="wikilink1" title="packages:pkgdata:6to4" data-wiki-id="packages:pkgdata:6to4">6to4</a> must be installed to use this protocol.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface <span class="st_h">'wan6'</span>
        option proto <span class="st_h">'6to4'</span>
&nbsp;
<span class="co0"># /etc/config/firewall</span>
config rule
        option target <span class="st_h">'ACCEPT'</span> 
        option name <span class="st_h">'6to4'</span> 
        option src <span class="st_h">'wan'</span> 
        option proto <span class="st_h">'41'</span></pre>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If you choose a name for your tunnel-interface different from <code>wan6</code>, be sure to add that network to the <code>wan</code> firewall-zone.
</p>

<p>
See below for advanced configuration options.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;6to4 Tunnel&quot;,&quot;hid&quot;:&quot;to4_tunnel&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:13,&quot;range&quot;:&quot;12969-13590&quot;} -->
<h2 class="sectionedit14" id="protocol_6to4_ipv6-in-ipv4_tunnel">Protocol 6to4 (IPv6-in-IPv4 Tunnel)</h2>
<div class="level2">
<div class="table sectionedit15"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>ipaddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col2"> no </td><td class="col3"> Current <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol version 4">IPv4</abbr> address </td><td class="col4"> Local <abbr title="Internet Protocol version 4">IPv4</abbr> endpoint address </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>defaultroute</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Whether to create an <abbr title="Internet Protocol version 6">IPv6</abbr> default route over the tunnel </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ttl</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>64</code> </td><td class="col4"> <abbr title="Time To Live">TTL</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>tos</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Type Of Service : either “inherit” (the outer header inherits the value of the inner header) or an hexadecimal value </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>mtu</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>1280</code> </td><td class="col4"> <abbr title="Maximum Transmission Unit">MTU</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>metric</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies the default route metric to use </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;13639-14269&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This protocol type does not need the <code>device</code> option set in the interface section.
The interface name is derived from the section name, e.g. <code>config interface wan6</code> would result in an interface named <code>6to4-wan6</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol 6to4 (IPv6-in-IPv4 Tunnel)&quot;,&quot;hid&quot;:&quot;protocol_6to4_ipv6-in-ipv4_tunnel&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:14,&quot;range&quot;:&quot;13591-14494&quot;} -->
<h2 class="sectionedit16" id="dual-stack_lite_tunnel_ds-lite_ipv4_in_ipv6">Dual-Stack Lite tunnel (ds-lite IPv4 in IPv6)</h2>
<div class="level2">

<p>
ds-lite is a transitioning-mechanism which is used by ISPs to support legacy <abbr title="Internet Protocol version 4">IPv4</abbr>-connectivity over a native <abbr title="Internet Protocol version 6">IPv6</abbr> connection.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package <a href="/packages/pkgdata/ds-lite" class="wikilink1" title="packages:pkgdata:ds-lite" data-wiki-id="packages:pkgdata:ds-lite">ds-lite</a> must be installed to use this protocol.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The configuration is usually auto-detected and manual configuration is not needed, simply installing the ds-lite package (and restarting the network interfaces like when changing the configuration) is usually enough.
</p>
<pre class="code bash"><span class="co0"># /etc/config/network</span>
config interface <span class="st_h">'wan6'</span>
        option device <span class="st_h">'eth1'</span>
        option proto <span class="st_h">'dhcpv6'</span>
&nbsp;
config interface <span class="st_h">'wan'</span>
        option proto <span class="st_h">'dslite'</span>
        option peeraddr <span class="st_h">'2001:db80::1'</span> <span class="co0"># Your ISP's DS-Lite AFTR</span></pre>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If you choose a name for your tunnel-interface different from <code>wan</code>, be sure to add that network to the <code>wan</code> firewall-zone.
</p>

<p>
See below for advanced configuration options.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dual-Stack Lite tunnel (ds-lite IPv4 in IPv6)&quot;,&quot;hid&quot;:&quot;dual-stack_lite_tunnel_ds-lite_ipv4_in_ipv6&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:16,&quot;range&quot;:&quot;14495-15413&quot;} -->
<h2 class="sectionedit17" id="protocol_dslite_dual-stack_lite">Protocol dslite (Dual-Stack Lite)</h2>
<div class="level2">
<div class="table sectionedit18"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>peeraddr</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> address </td><td class="col2"> yes </td><td class="col3"> no </td><td class="col4"> DS-Lite AFTR address </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>ip6addr</code> </td><td class="col1"> <abbr title="Internet Protocol version 6">IPv6</abbr> address </td><td class="col2"> no </td><td class="col3"> Current <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol version 6">IPv6</abbr> address </td><td class="col4"> Local <abbr title="Internet Protocol version 6">IPv6</abbr> endpoint address </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>tunlink</code> </td><td class="col1"> Logical Interface </td><td class="col2"> no </td><td class="col3"> Current <abbr title="Wide Area Network">WAN</abbr> interface </td><td class="col4"> Tunnel base interface </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>defaultroute</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Whether to create an <abbr title="Internet Protocol version 6">IPv6</abbr> default route over the tunnel </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>ttl</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>64</code> </td><td class="col4"> <abbr title="Time To Live">TTL</abbr> used for the tunnel interface </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>mtu</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>1280</code> </td><td class="col4"> <abbr title="Maximum Transmission Unit">MTU</abbr> used for the tunnel interface </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;15460-16006&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> ds-lite operation requires that <abbr title="Internet Protocol version 4">IPv4</abbr> <abbr title="Network Address Translation">NAT</abbr> is disabled.
You should adjust your settings in /etc/config/firewall accordingly.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This protocol type does not need the <code>device</code> option set in the interface section.
The interface name is derived from the section name, e.g. <code>config interface wan</code> would result in an interface named <code>dslite-wan</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol dslite (Dual-Stack Lite)&quot;,&quot;hid&quot;:&quot;protocol_dslite_dual-stack_lite&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:17,&quot;range&quot;:&quot;15414-&quot;} -->