
<h1 class="sectionedit1" id="routing_rules">Routing rules</h1>
<div class="level1">

<p>
Netifd supports <em><abbr title="Internet Protocol">IP</abbr> rule</em> declarations which are required to implement policy routing.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Routing rules&quot;,&quot;hid&quot;:&quot;routing_rules&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-118&quot;} -->
<h2 class="sectionedit2" id="ipv4_rules">IPv4 rules</h2>
<div class="level2">

<p>
<abbr title="Internet Protocol version 4">IPv4</abbr> rules can be defined by declaring one or more sections of type <code>rule</code>, e.g.:
</p>
<pre class="code bash">config rule
	option mark   <span class="st_h">'0xFF'</span>
        option <span class="kw1">in</span>     <span class="st_h">'lan'</span>
	option dest   <span class="st_h">'172.16.0.0/16'</span>
	option lookup <span class="st_h">'100'</span></pre>
<ul>
<li class="level1"><div class="li"> <code>mark</code>, here <code>0xFF</code>, is a <a href="http://www.tldp.org/HOWTO/Adv-Routing-HOWTO/lartc.netfilter.html" class="urlextern" title="http://www.tldp.org/HOWTO/Adv-Routing-HOWTO/lartc.netfilter.html" rel="ugc nofollow">fwmark</a> to be matched</div>
</li>
<li class="level1"><div class="li"> <code>in</code>, here <code>lan</code>, is the incoming <em>logical interface name</em></div>
</li>
<li class="level1"><div class="li"> <code>dest</code>, here <code>172.16.0.0/16</code>, is the destination subnet to match</div>
</li>
<li class="level1"><div class="li"> <code>lookup</code>, here <code>100</code>, is the routing table ID to use for the matched traffic</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv4 rules&quot;,&quot;hid&quot;:&quot;ipv4_rules&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;119-713&quot;} -->
<h2 class="sectionedit3" id="ipv6_rules">IPv6 rules</h2>
<div class="level2">

<p>
<abbr title="Internet Protocol version 6">IPv6</abbr> rules are denoted by sections of type <code>rule6</code>, e.g.:
</p>
<pre class="code bash">config rule6
        option <span class="kw1">in</span>     <span class="st_h">'vpn'</span>
	option dest   <span class="st_h">'fdca:1234::/64'</span>
	option action <span class="st_h">'prohibit'</span></pre>
<ul>
<li class="level1"><div class="li"> <code>vpn</code> is the incoming <em>logical interface name</em></div>
</li>
<li class="level1"><div class="li"> <code>fdca:1234::/64</code> is the destination subnet to match</div>
</li>
<li class="level1"><div class="li"> <code>prohibit</code> is a routing action to take</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv6 rules&quot;,&quot;hid&quot;:&quot;ipv6_rules&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;714-1076&quot;} -->
<h2 class="sectionedit4" id="options_for_ipv4_and_ipv6_rules">Options for IPv4 and IPv6 rules</h2>
<div class="level2">

<p>
Both <code>rule</code> and <code>rule6</code> sections share the same set of defined options.
</p>
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>in</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the incoming <em>logical interface name</em> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>out</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the outgoing <em>logical interface name</em> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>src</code> </td><td class="col1"> ip subnet </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the source subnet to match (CIDR notation) </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>dest</code> </td><td class="col1"> ip subnet </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the destination subnet to match (CIDR notation) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>tos</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the TOS value to match in <abbr title="Internet Protocol">IP</abbr> headers </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>mark</code> </td><td class="col1"> mark/mask </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the <em>fwmark</em> and optionally its mask to match, e.g. <code>0xFF</code> to match mark 255 or <code>0x0/0x1</code> to match any even mark value </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>uidrange</code> </td><td class="col1"> integer/integer range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies an individual UID or range of UIDs to match, e.g. <code>1000</code> to match corresponding UID or <code>1000-1005</code> to inclusively match all UIDs within the corresponding range </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>suppress_prefixlength</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Reject routing decisions that have a prefix length less than or equal to the specified value </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>ipproto</code> </td><td class="col1"> integer 0-255 </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> The <strong>ipproto</strong> element allows you to specify a protocol number in <abbr title="Internet Protocol">IP</abbr> rule configuration, enabling rules to target traffic based on the protocol. This aligns with the <a href="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml" class="urlextern" title="https://www.iana.org/assignments/protocol-numbers/protocol-numbers.xhtml" rel="ugc nofollow">IANA Protocol Numbers</a>. The <strong>ipproto</strong> value is an unsigned integer and must be in the range of <strong>0â€“255</strong>. </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>invert</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> If set to <code>1</code>, the meaning of the match options is inverted </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>priority</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>(incrementing)</em> </td><td class="col4"> Controls the order of the <abbr title="Internet Protocol">IP</abbr> rules, by default the priority is auto-assigned so that they are processed in the same order they&#039;re declared in the config file </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>lookup</code> </td><td class="col1"> routing table </td><td class="col2" rowspan="3"> at least one of </td><td class="col3" rowspan="3"> <em>(none)</em> </td><td class="col4"> The rule target is a table lookup, the ID can be either a numeric table index ranging from <code>0</code> to <code>65535</code> or a symbolic alias declared in <code>/etc/iproute2/rt_tables</code>. The special aliases <code>local</code> (<code>255</code>), <code>main</code> (<code>254</code>) and <code>default</code> (<code>253</code>) are recognized as well </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>goto</code> </td><td class="col1"> rule index </td><td class="col2"> The rule target is a jump to another rule specified by its <code>priority</code> value </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>action</code> </td><td class="col1"> string </td><td class="col2"> The rule target is one of the routing actions outlined in the table below </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>disabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies if the rule should be set or not. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;1198-3661&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Options for IPv4 and IPv6 rules&quot;,&quot;hid&quot;:&quot;options_for_ipv4_and_ipv6_rules&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;1077-3662&quot;} -->
<h2 class="sectionedit6" id="routing_actions">Routing actions</h2>
<div class="level2">
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Action           </th><th class="col1 leftalign"> Description                                                                                       </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> <code>unicast</code>      </td><td class="col1 leftalign"> Permit the traffic; the rule returns the route found in the routing table referenced by the rule  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>prohibit</code>     </td><td class="col1 leftalign"> When reaching the rule, respond with <em><abbr title="Internet Control Message Protocol">ICMP</abbr> prohibited</em> messages and abort route lookup          </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>unreachable</code>  </td><td class="col1 leftalign"> When reaching the rule, respond with <em><abbr title="Internet Control Message Protocol">ICMP</abbr> unreachable</em> messages and abort route lookup         </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>blackhole</code>    </td><td class="col1 leftalign"> When reaching the rule, drop packet and abort route lookup                                        </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>throw</code>        </td><td class="col1 leftalign"> Stop lookup in the current routing table even if a default route exists                           </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;3691-4416&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Routing actions&quot;,&quot;hid&quot;:&quot;routing_actions&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:6,&quot;range&quot;:&quot;3663-&quot;} -->