
<h1 class="sectionedit1" id="routing_exampleopenvpn">Routing example: OpenVPN</h1>
<div class="level1">

<p>
For creating a basic network configuration in OpenVPN like it shows in the picture.
</p>

<p>
<a href="/_detail/docs/guide-user/network/openvpn.jpeg?id=docs%3Aguide-user%3Anetwork%3Arouting%3Aexamples%3Arouting_in_openvpn" class="media" title="docs:guide-user:network:openvpn.jpeg"><img src="/_media/docs/guide-user/network/openvpn.jpeg?w=800&amp;tok=2265b0" class="media" loading="lazy" title="openvpn.jpeg" alt="openvpn.jpeg" width="800" /></a>
</p>

<p>
In this example, we will use 3 routers and 2 stations (computers).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Routing example: OpenVPN&quot;,&quot;hid&quot;:&quot;routing_exampleopenvpn&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-238&quot;} -->
<h2 class="sectionedit2" id="router_r1">Router R1</h2>
<div class="level2">
<pre class="code bash"><span class="co0"># /etc/config/network</span>
&nbsp;
config interface <span class="st_h">'lan'</span>
	option device <span class="st_h">'eth1'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'172.16.1.1'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
&nbsp;
config interface <span class="st_h">'wan'</span>
	option device <span class="st_h">'eth0'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'10.1.1.1'</span>
	option netmask <span class="st_h">'255.255.255.252'</span>
	option gateway <span class="st_h">'10.1.1.2'</span>
&nbsp;
<span class="co0"># /etc/config/openvpn</span>
&nbsp;
uci import openvpn <span class="sy0">&lt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
uci <span class="kw1">set</span> openvpn.myvpn=openvpn
uci <span class="kw1">set</span> openvpn.myvpn.enabled=<span class="nu0">1</span>
uci <span class="kw1">set</span> openvpn.myvpn.dev=tun
uci <span class="kw1">set</span> openvpn.myvpn.proto=udp
uci <span class="kw1">set</span> openvpn.myvpn.verb=<span class="nu0">3</span>
uci <span class="kw1">set</span> openvpn.myvpn.ca=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>ca.crt
uci <span class="kw1">set</span> openvpn.myvpn.cert=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>my-client.crt
uci <span class="kw1">set</span> openvpn.myvpn.key=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>my-client.key
uci <span class="kw1">set</span> openvpn.myvpn.client=<span class="nu0">1</span>
uci <span class="kw1">set</span> openvpn.myvpn.remote_cert_tls=server
uci <span class="kw1">set</span> openvpn.myvpn.remote=<span class="st0">&quot;SERVER_IP_ADDRESS 1194&quot;</span>
uci commit openvpn</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Router R1&quot;,&quot;hid&quot;:&quot;router_r1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;239-1097&quot;} -->
<h2 class="sectionedit3" id="router_r2">Router R2</h2>
<div class="level2">
<pre class="code bash"><span class="co0"># /etc/config/network</span>
&nbsp;
config interface <span class="st_h">'lan'</span>
	option device <span class="st_h">'eth0'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'172.16.2.1'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
&nbsp;
config interface <span class="st_h">'wan'</span>
	option device <span class="st_h">'eth1'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'10.2.2.1'</span>
	option netmask <span class="st_h">'255.255.255.252'</span>
	option gateway <span class="st_h">'10.2.2.2'</span>
&nbsp;
<span class="co0"># /etc/config/openvpn</span>
&nbsp;
uci import openvpn <span class="sy0">&lt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
uci <span class="kw1">set</span> openvpn.myvpn=openvpn
uci <span class="kw1">set</span> openvpn.myvpn.enabled=<span class="nu0">1</span>
uci <span class="kw1">set</span> openvpn.myvpn.verb=<span class="nu0">3</span>
uci <span class="kw1">set</span> openvpn.myvpn.port=<span class="nu0">1194</span>
uci <span class="kw1">set</span> openvpn.myvpn.proto=udp
uci <span class="kw1">set</span> openvpn.myvpn.dev=tun
uci <span class="kw1">set</span> openvpn.myvpn.server=<span class="st_h">'10.8.0.0 255.255.255.0'</span>
uci <span class="kw1">set</span> openvpn.myvpn.keepalive=<span class="st_h">'10 120'</span>
uci <span class="kw1">set</span> openvpn.myvpn.ca=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>ca.crt
uci <span class="kw1">set</span> openvpn.myvpn.cert=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>my-server.crt
uci <span class="kw1">set</span> openvpn.myvpn.key=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>my-server.key
uci <span class="kw1">set</span> openvpn.myvpn.dh=<span class="sy0">/</span>etc<span class="sy0">/</span>openvpn<span class="sy0">/</span>dh2048.pem
uci commit openvpn</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Router R2&quot;,&quot;hid&quot;:&quot;router_r2&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;1098-2002&quot;} -->
<h2 class="sectionedit4" id="router_wan">Router WAN</h2>
<div class="level2">
<pre class="code bash"><span class="co0"># /etc/config/network</span>
&nbsp;
config interface <span class="st_h">'lan1'</span>
	option device <span class="st_h">'eth0'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'10.1.1.2'</span>
	option netmask <span class="st_h">'255.255.255.252'</span>
&nbsp;
config interface <span class="st_h">'lan2'</span>
	option device <span class="st_h">'eth1'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'10.2.2.2'</span>
	option netmask <span class="st_h">'255.255.255.252'</span>
&nbsp;
config route <span class="st_h">'net1'</span>
	option interface <span class="st_h">'lan1'</span>
	option target <span class="st_h">'172.16.1.0'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
	option gateway <span class="st_h">'10.1.1.1'</span>
&nbsp;
config route <span class="st_h">'net2'</span>
	option interface <span class="st_h">'lan2'</span>
	option target <span class="st_h">'172.16.2.0'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
	option gateway <span class="st_h">'10.2.2.1'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Router WAN&quot;,&quot;hid&quot;:&quot;router_wan&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;2003-2594&quot;} -->
<h2 class="sectionedit5" id="client_pcs">Client PCs</h2>
<div class="level2">

<p>
For the PCs configuration, we just set up the <abbr title="Internet Protocol">IP</abbr> addresses in each station.
</p>
<pre class="code bash"><span class="co0"># PC1</span>
address 172.16.1.3<span class="sy0">/</span><span class="nu0">24</span>
gateway 172.16.1.1
&nbsp;
<span class="co0"># PC2 </span>
address 172.16.2.3<span class="sy0">/</span><span class="nu0">24</span>
gateway 172.16.2.1 </pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Client PCs&quot;,&quot;hid&quot;:&quot;client_pcs&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:5,&quot;range&quot;:&quot;2595-&quot;} -->