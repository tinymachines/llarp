
<h1 class="sectionedit1" id="integrating_an_openwrt_network_device_in_your_network">Integrating an OpenWrt network device in your network</h1>
<div class="level1">

<p>
If you want to have an OpenWrt-powered network infrastructure, there are good chances you will need to reconfigure (or replace) the device the <abbr title="Internet Service Provider">ISP</abbr> gave you to access Internet. In case you wonder what an <abbr title="Internet Service Provider">ISP</abbr> is, it&#039;s the company you pay for your Internet access.
</p>

<p>
The main reason is that daisy-chaining routers is not a good idea. Depending on the type of Internet access equipment you have or have been given by your <abbr title="Internet Service Provider">ISP</abbr>, you may encounter a situation known as double <abbr title="Network Address Translation">NAT</abbr>, which isn&#039;t good.<br/>

While double <abbr title="Network Address Translation">NAT</abbr> doesn&#039;t generally have any ill effects on run-of-the-mill network connectivity -- Web browsing, e-mail, <abbr title="Instant Messaging">IM</abbr>, and so forth -- it can be a major impediment when you need remote access to devices on your network, preventing you from connecting to your OpenWrt device&#039;s webinterface, ssh, <abbr title="Virtual Private Network">VPN</abbr>, ftp, http, Nextcloud, Seafile, and whatever else service you might want to install on your devices to be accessible from outside of your own local network.<br/>

Double <abbr title="Network Address Translation">NAT</abbr> also screws up communication between devices connected to the upstream device (the device provided by the <abbr title="Internet Service Provider">ISP</abbr>) and the downstream device (the OpenWrt router).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Integrating an OpenWrt network device in your network&quot;,&quot;hid&quot;:&quot;integrating_an_openwrt_network_device_in_your_network&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1197&quot;} -->
<h2 class="sectionedit2" id="what_is_nat">What is NAT</h2>
<div class="level2">

<p>
In a typical home network, you are allotted a single public <abbr title="Internet Protocol">IP</abbr> address by your <abbr title="Internet Service Provider">ISP</abbr>, and this address gets issued to your router when you plug it into the <abbr title="Internet Service Provider">ISP</abbr>-provided gateway device (e.g. a cable or DSL modem). The router&#039;s Wide Area Network (<abbr title="Wide Area Network">WAN</abbr>) port gets the public <abbr title="Internet Protocol">IP</abbr> address, and PCs and other devices that are connected to <abbr title="Local Area Network">LAN</abbr> ports (or via Wi-Fi) become part of a private network, usually in the 192.168.x.x address range. <abbr title="Network Address Translation">NAT</abbr> manages the connectivity between the public Internet and your private network, and either UPnP or manual port forwarding ensures that incoming connections from the Internet (i.e. remote access requests) find their way through <abbr title="Network Address Translation">NAT</abbr> to the appropriate private network PC or other device.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;What is NAT&quot;,&quot;hid&quot;:&quot;what_is_nat&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1198-1941&quot;} -->
<h2 class="sectionedit3" id="what_is_double_nat">What is Double NAT</h2>
<div class="level2">

<p>
When <abbr title="Network Address Translation">NAT</abbr> is being performed not just on your router but also on another device that&#039;s connected upstream (on its <abbr title="Wide Area Network">WAN</abbr> port/interface, usually), you&#039;ve got double <abbr title="Network Address Translation">NAT</abbr>. In this case, the public/private network boundary doesn&#039;t exist on your router -- it&#039;s on the other device, which means that both the <abbr title="Wide Area Network">WAN</abbr> and <abbr title="Local Area Network">LAN</abbr> sides of your router are private networks.<br/>

Any UPnP and/or port forwarding you enable on your OpenWrt router is pointless, because incoming remote access requests never make it that far -- they arrive at the public <abbr title="Internet Protocol">IP</abbr> address on the upstream device, where they&#039;re promptly discarded.
Double NATing will also have a performance impact on bandwidth and latency because more processing is required by the network device to relay traffic.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;What is Double NAT&quot;,&quot;hid&quot;:&quot;what_is_double_nat&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1942-2722&quot;} -->
<h2 class="sectionedit4" id="upstream_nat">Upstream NAT</h2>
<div class="level2">

<p>
If the double <abbr title="Network Address Translation">NAT</abbr> is happening in your own network, you can usually fix it or at least sidestep it. But many ISPs use <abbr title="Network Address Translation">NAT</abbr> within their network infrastructure so they don&#039;t waste public <abbr title="Internet Protocol">IP</abbr> addresses, in this case the only way to fix it is to call them and ask (and pay) for a public <abbr title="Internet Protocol">IP</abbr>. It&#039;s usually affordable.
</p>

<p>
To check for double <abbr title="Network Address Translation">NAT</abbr> on your upstream network, log into your <abbr title="Internet Service Provider">ISP</abbr> device and look up the <abbr title="Internet Protocol">IP</abbr> address of its <abbr title="Wide Area Network">WAN</abbr> port. If you see an address in the 10.x.x.x, 172.16.x.x or 192.168.x.x range (these are private <abbr title="Internet Protocol">IP</abbr> ranges according to <abbr title="Internet Protocol version 4">IPv4</abbr> standards) it means that the device your router&#039;s <abbr title="Wide Area Network">WAN</abbr> port connects to is doing <abbr title="Network Address Translation">NAT</abbr>, and hence, you&#039;re dealing with double <abbr title="Network Address Translation">NAT</abbr>.
</p>

<p>
Also, another way is to look at the <abbr title="Internet Protocol">IP</abbr> address of its <abbr title="Wide Area Network">WAN</abbr> port, and connect to a site that tells you your public <abbr title="Internet Protocol">IP</abbr> address like for example <a href="http://whatismyipaddress.com/" class="urlextern" title="http://whatismyipaddress.com/" rel="ugc nofollow">whatismyipaddress.com</a>, and if the two <abbr title="Internet Protocol">IP</abbr> addresses differ... yeah you guessed it, your <abbr title="Internet Service Provider">ISP</abbr> is using <abbr title="Network Address Translation">NAT</abbr>.
</p>

<p>
For Linux users, there are also CLI commands to run that can provide what is the <abbr title="Wide Area Network">WAN</abbr> <abbr title="Internet Protocol">IP</abbr> address of the router you can then compare to the <abbr title="Internet Protocol">IP</abbr> shown by the websites. <a href="https://www.cyberciti.biz/faq/how-to-find-my-public-ip-address-from-command-line-on-a-linux/" class="urlextern" title="https://www.cyberciti.biz/faq/how-to-find-my-public-ip-address-from-command-line-on-a-linux/" rel="ugc nofollow">From here</a>
</p>

<p>
<code>dig +short myip.opendns.com @resolver1.opendns.com</code>
</p>
<hr />

<p>
Based on <a href="http://www.practicallynetworked.com/networking/fixing_double_nat.htm" class="urlextern" title="http://www.practicallynetworked.com/networking/fixing_double_nat.htm" rel="ugc nofollow">this external Article</a> by Joe Moran
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Upstream NAT&quot;,&quot;hid&quot;:&quot;upstream_nat&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2723-&quot;} -->