
<h1 class="sectionedit1" id="ipv6_with_hurricane_electric">IPv6 with Hurricane Electric</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IPv6 with Hurricane Electric&quot;,&quot;hid&quot;:&quot;ipv6_with_hurricane_electric&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-125&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for setting up <a href="https://en.wikipedia.org/wiki/6in4" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/6in4">6in4</a> tunnel on OpenWrt.</div>
</li>
<li class="level1"><div class="li"> It relies on Hurricane Electric <abbr title="Internet Protocol version 6">IPv6</abbr> tunnel broker and supports static/dynamic setup.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/services/ddns/client" class="wikilink1" title="docs:guide-user:services:ddns:client" data-wiki-id="docs:guide-user:services:ddns:client">DDNS client</a> to use <abbr title="Internet Protocol version 6">IPv6</abbr> tunnel broker with dynamic address.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/network/ipv6/ipv6tunnel-luci" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6tunnel-luci" data-wiki-id="docs:guide-user:network:ipv6:ipv6tunnel-luci">IPv6 with Hurricane Electric using LuCI</a> for web interface instructions.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;126-573&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Provide <abbr title="Internet Protocol version 6">IPv6</abbr> connectivity for <abbr title="Local Area Network">LAN</abbr> clients.</div>
</li>
<li class="level1"><div class="li"> Access your <abbr title="Local Area Network">LAN</abbr> services remotely without port forwarding.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;574-702&quot;} -->
<h2 class="sectionedit8" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

<p>
Register a free account with <a href="https://tunnelbroker.net/" class="urlextern" title="https://tunnelbroker.net/" rel="ugc nofollow">Hurricane Electric IPv6 tunnel broker</a> and create a regular tunnel.
</p>

<p>
Install the required packages.
Specify configuration parameters for the tunnel.
Set up a static <abbr title="Internet Protocol version 6">IPv6</abbr> tunnel.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> 6in4
&nbsp;
<span class="co0"># Configuration parameters</span>
<span class="re2">HENET_PEER</span>=<span class="st0">&quot;203.0.113.45&quot;</span>
<span class="re2">HENET_IPV6</span>=<span class="st0">&quot;2001:db8:1f0a:1a2::2/64&quot;</span>
<span class="re2">HENET_PFX64</span>=<span class="st0">&quot;2001:db8:1f0a:2b3::/64&quot;</span>
<span class="re2">HENET_PFX48</span>=<span class="st0">&quot;2001:db8:1f0a::/48&quot;</span>
&nbsp;
<span class="co0"># Fetch WAN IP address</span>
. <span class="sy0">/</span>lib<span class="sy0">/</span>functions<span class="sy0">/</span>network.sh
network_flush_cache
network_find_wan NET_IF
network_get_ipaddr NET_ADDR <span class="st0">&quot;<span class="es3">${NET_IF}</span>&quot;</span>
&nbsp;
<span class="co0"># Configure tunnel</span>
uci <span class="re5">-q</span> delete network.wan6
uci <span class="kw1">set</span> network.wan6=<span class="st0">&quot;interface&quot;</span>
uci <span class="kw1">set</span> network.wan6.proto=<span class="st0">&quot;6in4&quot;</span>
uci <span class="kw1">set</span> network.wan6.ipaddr=<span class="st0">&quot;<span class="es3">${NET_ADDR}</span>&quot;</span>
uci <span class="kw1">set</span> network.wan6.peeraddr=<span class="st0">&quot;<span class="es3">${HENET_PEER}</span>&quot;</span>
uci <span class="kw1">set</span> network.wan6.ip6<span class="re2">addr</span>=<span class="st0">&quot;<span class="es3">${HENET_IPV6}</span>&quot;</span>
uci add_list network.wan6.ip6<span class="re2">prefix</span>=<span class="st0">&quot;<span class="es3">${HENET_PFX64}</span>&quot;</span>
uci add_list network.wan6.ip6<span class="re2">prefix</span>=<span class="st0">&quot;<span class="es3">${HENET_PFX48}</span>&quot;</span>
uci commit network
service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;703-1740&quot;} -->
<h2 class="sectionedit9" id="testing">Testing</h2>
<div class="level2">

<p>
Use <a href="http://man.cx/ping6%288%29" class="interwiki iw_man" title="http://man.cx/ping6%288%29">ping6</a> and <a href="http://man.cx/traceroute6%288%29" class="interwiki iw_man" title="http://man.cx/traceroute6%288%29">traceroute6</a> to verify you can reach <abbr title="Internet Protocol version 6">IPv6</abbr> services.
</p>
<pre class="code bash">ping6 openwrt.org
traceroute6 openwrt.org</pre>

<p>
Check your internet connectivity.
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://ipleak.net/" class="urlextern" title="https://ipleak.net/" rel="ugc nofollow">ipleak.net</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Testing&quot;,&quot;hid&quot;:&quot;testing&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:9,&quot;range&quot;:&quot;1741-2003&quot;} -->
<h2 class="sectionedit10" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Collect and analyze the following information.
</p>
<pre class="code bash"><span class="co0"># Restart services</span>
service log restart; <span class="kw2">ifup</span> wan6; <span class="kw2">sleep</span> <span class="nu0">10</span>
&nbsp;
<span class="co0"># Log and status</span>
logread; ifstatus wan6
&nbsp;
<span class="co0"># Runtime configuration</span>
<span class="kw2">ip</span> address show; <span class="kw2">ip route</span> show table all
<span class="kw2">ip rule</span> show; <span class="kw2">ip</span> <span class="re5">-6</span> rule show; nft list ruleset
&nbsp;
<span class="co0"># Persistent configuration</span>
uci show network; uci show dhcp; uci show firewall</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;2004-2394&quot;} -->
<h2 class="sectionedit11" id="extras">Extras</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:11,&quot;range&quot;:&quot;2395-2413&quot;} -->
<h3 class="sectionedit12" id="dynamic_address">Dynamic address</h3>
<div class="level3">

<p>
Reconfigure <abbr title="Internet Protocol version 6">IPv6</abbr> tunnel for dynamic <abbr title="Internet Protocol">IP</abbr> address.
</p>
<pre class="code bash"><span class="co0"># Configuration parameters</span>
<span class="re2">HENET_TUNID</span>=<span class="st0">&quot;123456&quot;</span>
<span class="re2">HENET_USER</span>=<span class="st0">&quot;USERNAME&quot;</span>
<span class="re2">HENET_UPKEY</span>=<span class="st0">&quot;UPDATEKEY&quot;</span>
&nbsp;
<span class="co0"># Configure tunnel</span>
uci <span class="re5">-q</span> delete network.wan6.ipaddr
uci <span class="kw1">set</span> network.wan6.tunnelid=<span class="st0">&quot;<span class="es3">${HENET_TUNID}</span>&quot;</span>
uci <span class="kw1">set</span> network.wan6.username=<span class="st0">&quot;<span class="es3">${HENET_USER}</span>&quot;</span>
uci <span class="kw1">set</span> network.wan6.updatekey=<span class="st0">&quot;<span class="es3">${HENET_UPKEY}</span>&quot;</span>
uci commit network
service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dynamic address&quot;,&quot;hid&quot;:&quot;dynamic_address&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:12,&quot;range&quot;:&quot;2414-2841&quot;} -->
<h3 class="sectionedit13" id="default_route">Default route</h3>
<div class="level3">

<p>
Provide <abbr title="Internet Protocol version 6">IPv6</abbr> default route with source filter disabled.
</p>
<pre class="code bash"><span class="co0"># Configure network</span>
uci <span class="re5">-q</span> delete network.wan6_rt
uci <span class="kw1">set</span> network.wan6<span class="re2">_rt</span>=<span class="st0">&quot;route6&quot;</span>
uci <span class="kw1">set</span> network.wan6_rt.interface=<span class="st0">&quot;wan6&quot;</span>
uci <span class="kw1">set</span> network.wan6_rt.target=<span class="st0">&quot;::/0&quot;</span>
uci commit network
service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Default route&quot;,&quot;hid&quot;:&quot;default_route&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:13,&quot;range&quot;:&quot;2842-3148&quot;} -->
<h3 class="sectionedit14" id="cake_sqm">Cake SQM</h3>
<div class="level3">

<p>
Process <abbr title="Internet Protocol version 6">IPv6</abbr> traffic as separate flows when using <a href="/docs/guide-user/network/traffic-shaping/sqm-details" class="wikilink1" title="docs:guide-user:network:traffic-shaping:sqm-details" data-wiki-id="docs:guide-user:network:traffic-shaping:sqm-details">cake SQM</a>.
</p>
<pre class="code bash"><span class="co0"># Configure network</span>
uci <span class="kw1">set</span> network.wan6.tos=<span class="st0">&quot;inherit&quot;</span>
uci commit network
service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Cake SQM&quot;,&quot;hid&quot;:&quot;cake_sqm&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:14,&quot;range&quot;:&quot;3149-&quot;} -->