
<h1 class="sectionedit1" id="how_to_use_openwrt_behind_a_freebox_crystal_with_ipv6_bridge">How to use OpenWrt behind a Freebox Crystal with IPv6 bridge</h1>
<div class="level1">

<p>
This HOWTO explains how to configure OpenWrt to work with a <a href="https://www.free.fr/freebox/freebox-crystal/" class="urlextern" title="https://www.free.fr/freebox/freebox-crystal/" rel="ugc nofollow">Freebox Crystal</a>.
</p>

<p>
If you have a newer model of Freebox please refer to <a href="/docs/guide-user/network/ipv6/freebox" class="wikilink1" title="docs:guide-user:network:ipv6:freebox" data-wiki-id="docs:guide-user:network:ipv6:freebox">How to use OpenWrt behind a Freebox with IPv6 delegation</a>. The method described on that page is more complex than the below and is stated not to work on a Freebox Crystal.
</p>

<p>
As described in the page linked above, the Freebox Crystal is limited in it&#039;s <abbr title="Internet Protocol version 6">IPv6</abbr> functionality. It is, however, able to function as a bridge for Router Advertisement, DHCPv6, etc. so the below explains how to configure OpenWrt to take advantage of that. Your local <abbr title="Internet Protocol version 6">IPv6</abbr> boxes will obtain full public <abbr title="Internet Protocol version 6">IPv6</abbr> addresses, but as they are behind the OpenWrt firewall can be protected if required (in fact, that is the case with default OpenWrt configuration at time of writing).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;How to use OpenWrt behind a Freebox Crystal with IPv6 bridge&quot;,&quot;hid&quot;:&quot;how_to_use_openwrt_behind_a_freebox_crystal_with_ipv6_bridge&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-944&quot;} -->
<h2 class="sectionedit2" id="on_your_freebox_subscriber_space">On your Freebox Subscriber Space</h2>
<div class="level2">

<p>
If you have not already disabled router mode on your Freebox <strong>the below will likely break your Internet connection</strong> so be sure to have everything in place and prepared before doing this:
</p>
<ol>
<li class="level1"><div class="li"> Login to your Freebox Subscriber space.</div>
</li>
<li class="level1"><div class="li"> Under &#039;Ma Freebox&#039;/&#039;Paramétrer mon routeur Freebox&#039; disable router &amp; <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> (&#039;Etat du routeur&#039; = &#039;non&#039; &amp; &#039;Etat du <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>&#039; = &#039;non&#039;). Note that this isn&#039;t strictly necessary but is considered good practice as turning off router functionality on the Freebox prevents double <abbr title="Network Address Translation">NAT</abbr> on <abbr title="Internet Protocol version 4">IPv4</abbr>.</div>
</li>
<li class="level1"><div class="li"> Under &#039;Ma Freebox&#039;/&#039;Passer au protocole <abbr title="Internet Protocol version 6">IPv6</abbr>&#039; enable <abbr title="Internet Protocol version 6">IPv6</abbr> (&#039;Support <abbr title="Internet Protocol version 6">IPv6</abbr>&#039; = &#039;oui&#039;).</div>
</li>
<li class="level1"><div class="li"> Reboot your Freebox.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;On your Freebox Subscriber Space&quot;,&quot;hid&quot;:&quot;on_your_freebox_subscriber_space&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;945-1623&quot;} -->
<h2 class="sectionedit3" id="physical_connections">Physical connections</h2>
<div class="level2">

<p>
As we have just disabled the router &amp; <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> functions of the Freebox disconnect all other devices aside from your OpenWrt box.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Physical connections&quot;,&quot;hid&quot;:&quot;physical_connections&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1624-1784&quot;} -->
<h2 class="sectionedit4" id="on_openwrt">On OpenWrt</h2>
<div class="level2">

<p>
Upon reboot of the Freebox your OpenWrt router should now get both <abbr title="Internet Protocol version 4">IPv4</abbr> and <abbr title="Internet Protocol version 6">IPv6</abbr> addresses from the Freebox. Note that as the Freebox Router function is disabled the OpenWrt router should obtain a public <abbr title="Internet Protocol version 4">IPv4</abbr> address rather than a 192.168.x.x range. It should also obtain an <abbr title="Internet Protocol version 6">IPv6</abbr> address on this interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;On OpenWrt&quot;,&quot;hid&quot;:&quot;on_openwrt&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1785-2116&quot;} -->
<h3 class="sectionedit5" id="lan_dhcp">LAN DHCP</h3>
<div class="level3">

<p>
Visit your <abbr title="Local Area Network">LAN</abbr> interface settings in LUCI and set the following <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> <abbr title="Internet Protocol version 6">IPv6</abbr> settings to &#039;relay mode&#039;:
</p>
<ul>
<li class="level1"><div class="li"> Router Advertisement-Service</div>
</li>
<li class="level1"><div class="li"> DHCPv6-Service</div>
</li>
<li class="level1"><div class="li"> NDP-Proxy</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LAN DHCP&quot;,&quot;hid&quot;:&quot;lan_dhcp&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;2117-2304&quot;} -->
<h3 class="sectionedit6" id="wan_dhcp">WAN DHCP</h3>
<div class="level3">

<p>
We now simply have to associate the above <abbr title="Local Area Network">LAN</abbr> relay with the <abbr title="Wide Area Network">WAN</abbr> port. This is done by editing <code>/etc/config/dhcp</code> on your OpenWrt router and adding the following options:
</p>
<pre class="code">config dhcp &#039;wan&#039;                  
        ...
        option dhcpv6 &#039;relay&#039;
        option ra &#039;relay&#039;                  
        option ndp &#039;relay&#039;                       
        option master &#039;1&#039;</pre>

<p>
Edited: prefer to set <abbr title="Internet Protocol">IP</abbr> in fixed way, so you do not lost the dhcpv6 parameters and can set them in the luci interface...
Also was the only method that make all “it works” for me !
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;WAN DHCP&quot;,&quot;hid&quot;:&quot;wan_dhcp&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2305-2894&quot;} -->
<h2 class="sectionedit7" id="verify_ipv6_functionality">Verify IPv6 Functionality</h2>
<div class="level2">

<p>
That&#039;s it. Devices on the <abbr title="Local Area Network">LAN</abbr> should now obtain full public <abbr title="Internet Protocol version 6">IPv6</abbr> addresses from your <abbr title="Internet Service Provider">ISP</abbr>. They will not be reachable from outside world though, as OpenWrt blocks incoming <abbr title="Internet Protocol version 6">IPv6</abbr> packets by default.
</p>

<p>
Visit <a href="https://ipv6-test.com/" class="urlextern" title="https://ipv6-test.com/" rel="ugc nofollow">https://ipv6-test.com/</a> to confirm this functionality.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Verify IPv6 Functionality&quot;,&quot;hid&quot;:&quot;verify_ipv6_functionality&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:7,&quot;range&quot;:&quot;2895-3195&quot;} -->
<h2 class="sectionedit8" id="lan_dns">LAN DNS</h2>
<div class="level2">

<p>
As discussed this solution is using the Freebox as a relay for various <abbr title="Internet Protocol version 6">IPv6</abbr> functionality. In this state, hosts on the <abbr title="Local Area Network">LAN</abbr> will obtain <abbr title="Internet Protocol version 6">IPv6</abbr> <abbr title="Domain Name System">DNS</abbr> servers via that relay and use them for <abbr title="Domain Name System">DNS</abbr> resolution. Ie. the <abbr title="Internet Service Provider">ISP</abbr>&#039;s <abbr title="Internet Protocol version 6">IPv6</abbr> <abbr title="Domain Name System">DNS</abbr> servers will be used directly by <abbr title="Local Area Network">LAN</abbr> hosts. This might not be desirable if you want to resolve a local domain, include some other <abbr title="Domain Name System">DNS</abbr> based features (such as <a href="/docs/guide-user/services/ad-blocking" class="wikilink1" title="docs:guide-user:services:ad-blocking" data-wiki-id="docs:guide-user:services:ad-blocking">Adblock</a>) or simply have a <abbr title="Local Area Network">LAN</abbr> based <abbr title="Domain Name System">DNS</abbr> for efficiency.
</p>

<p>
In order to have the OpenWrt router service <abbr title="Domain Name System">DNS</abbr> requests from the <abbr title="Local Area Network">LAN</abbr> the following two changes are necessary:
</p>
<ol>
<li class="level1"><div class="li"> Edit the <abbr title="Local Area Network">LAN</abbr> network interface and assign an <abbr title="Internet Protocol version 6">IPv6</abbr> address. The Free <abbr title="Internet Service Provider">ISP</abbr> allocates a /64 block to each customer so copy that subnet and add <code>::1:fe</code> to the end to get something like <code>2a01:e35:xxxx:xxxx::1:fe</code> (as suggested in <a href="/docs/guide-user/network/ipv6/freebox" class="wikilink1" title="docs:guide-user:network:ipv6:freebox" data-wiki-id="docs:guide-user:network:ipv6:freebox">How to use OpenWrt behind a Freebox with IPv6 delegation</a>). Just add this address - there is no need to enter <abbr title="Internet Protocol version 6">IPv6</abbr> gateway, routed prefix, etc.</div>
</li>
<li class="level1"><div class="li"> In the &#039;<abbr title="Internet Protocol version 6">IPv6</abbr> Settings&#039; tab of &#039;<abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> Server&#039; below add this <abbr title="Internet Protocol version 6">IPv6</abbr> address set on the <abbr title="Local Area Network">LAN</abbr> interface to &#039;Announced <abbr title="Domain Name System">DNS</abbr> servers&#039; setting.</div>
</li>
</ol>

<p>
Now <abbr title="Local Area Network">LAN</abbr> clients should be provided with the <abbr title="Local Area Network">LAN</abbr> <abbr title="Internet Protocol version 6">IPv6</abbr> address of OpenWrt router and it should service requests normally. You are free to set local <abbr title="Local Area Network">LAN</abbr> domain names, use Adblock, etc.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LAN DNS&quot;,&quot;hid&quot;:&quot;lan_dns&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:8,&quot;range&quot;:&quot;3196-&quot;} -->