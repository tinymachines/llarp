
<h1 class="sectionedit1" id="nat66_and_ipv6_masquerading">NAT66 and IPv6 masquerading</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;NAT66 and IPv6 masquerading&quot;,&quot;hid&quot;:&quot;nat66_and_ipv6_masquerading&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-124&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for setting up NAT66 aka NAT6 with <abbr title="Internet Protocol version 6">IPv6</abbr> masquerading on your OpenWrt router.</div>
</li>
<li class="level1"><div class="li"> Assuming a <a href="/docs/guide-user/network/ipv6/configuration#ula_prefix" class="wikilink1" title="docs:guide-user:network:ipv6:configuration" data-wiki-id="docs:guide-user:network:ipv6:configuration">ULA prefix</a>, <a href="/docs/guide-user/network/ipv6/configuration#slaac_and_dhcpv6" class="wikilink1" title="docs:guide-user:network:ipv6:configuration" data-wiki-id="docs:guide-user:network:ipv6:configuration">SLAAC and DHCPv6</a> and a working <abbr title="Internet Protocol version 6">IPv6</abbr> connection on the router.</div>
</li>
<li class="level1"><div class="li"> Avoid using NAT66 and better <a href="/docs/guide-user/network/ipv6/configuration#ipv6_relay" class="wikilink1" title="docs:guide-user:network:ipv6:configuration" data-wiki-id="docs:guide-user:network:ipv6:configuration">use relay mode</a> if you are provided with a /64 prefix.</div>
</li>
<li class="level1 node"><div class="li"> It is also best to avoid using NAT66 unless you are facing the following problems:</div>
<ul>
<li class="level2"><div class="li"> <abbr title="Internet Protocol version 6">IPv6</abbr> multihoming without BGP.</div>
</li>
<li class="level2"><div class="li"> Performing stateless 1:1 <abbr title="Network Address Translation">NAT</abbr> for migration purposes.</div>
</li>
<li class="level2"><div class="li"> Your <abbr title="Internet Service Provider">ISP</abbr> uses a dynamic prefix and you need stable addressing.</div>
</li>
<li class="level2"><div class="li"> Creating a subnet for when the network doesn&#039;t support subnetting.</div>
</li>
<li class="level2"><div class="li"> Being provided a smaller prefix than a /64 or worse, none at all or a ULA address.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> See also: <a href="/docs/guide-user/network/ipv6/nat64" class="wikilink1" title="docs:guide-user:network:ipv6:nat64" data-wiki-id="docs:guide-user:network:ipv6:nat64">NAT64 for a IPv6-only networks</a>, <a href="/docs/guide-user/firewall/fw3_configurations/fw3_nat#ipv6_nat" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:fw3_nat" data-wiki-id="docs:guide-user:firewall:fw3_configurations:fw3_nat">IPv6 NAT and NPT</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;125-1200&quot;} -->
<h2 class="sectionedit7" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;1201-1238&quot;} -->
<h3 class="sectionedit8" id="firewall">1. Firewall</h3>
<div class="level3">

<p>
Enable <abbr title="Internet Protocol version 6">IPv6</abbr> masquerading on the upstream zone.
</p>
<pre class="code bash"><span class="co0"># Configure firewall</span>
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>zone<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>.masq6=<span class="st0">&quot;1&quot;</span>
uci commit firewall
service firewall restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Firewall&quot;,&quot;hid&quot;:&quot;firewall&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;1239-1431&quot;} -->
<h3 class="sectionedit9" id="network">2. Network</h3>
<div class="level3">

<p>
Disable <abbr title="Internet Protocol version 6">IPv6</abbr> source filter on the upstream interface.
</p>
<pre class="code bash"><span class="co0"># Configure network</span>
uci <span class="kw1">set</span> network.wan6.sourcefilter=<span class="st0">&quot;0&quot;</span>
uci commit network
service network restart</pre>

<p>
Prefer <a href="/docs/guide-user/network/ipv6/ipv6_extras#using_ipv6_by_default" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6_extras" data-wiki-id="docs:guide-user:network:ipv6:ipv6_extras">IPv6 by default</a> or announce <a href="/docs/guide-user/network/ipv6/ipv6_extras#announcing_ipv6_default_route" class="wikilink1" title="docs:guide-user:network:ipv6:ipv6_extras" data-wiki-id="docs:guide-user:network:ipv6:ipv6_extras">IPv6 default route</a> if necessary.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Network&quot;,&quot;hid&quot;:&quot;network&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:9,&quot;range&quot;:&quot;1432-1840&quot;} -->
<h2 class="sectionedit10" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Collect and analyze the following information.
</p>
<pre class="code bash"><span class="co0"># Log and status</span>
service firewall restart
&nbsp;
<span class="co0"># Runtime configuration</span>
<span class="kw2">ip</span> <span class="re5">-6</span> address show; <span class="kw2">ip</span> <span class="re5">-6</span> route show table all
<span class="kw2">ip</span> <span class="re5">-6</span> rule show; nft list ruleset
&nbsp;
<span class="co0"># Persistent configuration</span>
uci show network; uci show firewall</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;1841-&quot;} -->