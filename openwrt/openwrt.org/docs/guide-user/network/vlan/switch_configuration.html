<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:1,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level0">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_important plugin_wrap">
<p>
This article may contain network configuration that depends on migration to DSA in OpenWrt 21.02
</p>
<ul>
<li class="level1"><div class="li"> Check if your device uses DSA or swconfig as not all devices have been migrated</div>
</li>
<li class="level1"><div class="li"> ifname@interface has been moved to device sections</div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/network/dsa/start" class="wikilink1" title="docs:guide-user:network:dsa:start" data-wiki-id="docs:guide-user:network:dsa:start">DSA Networking</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/mini-tutorial-for-dsa-network-config/96998" class="urlextern" title="https://forum.openwrt.org/t/mini-tutorial-for-dsa-network-config/96998" rel="ugc nofollow">Mini tutorial for DSA network config</a> on the forum</div>
</li>
<li class="level1"><div class="li"> <a href="https://openwrt.org/releases/21.02/notes-21.02.0#new_network_configuration_syntax_and_boardjson_change" class="urlextern" title="https://openwrt.org/releases/21.02/notes-21.02.0#new_network_configuration_syntax_and_boardjson_change" rel="ugc nofollow">DSA in the 21.02 release notes</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --></div>

<h1 class="sectionedit5" id="vlan">VLAN</h1>
<div class="level1">

<p>
<abbr title="Virtual Local Area Network">VLAN</abbr> is the acronym for <strong>V</strong>irtual <strong>L</strong>ocal <strong>A</strong>rea <strong>N</strong>etwork, it is a virtual partitioning of physical network switches on OSI layer 2.
</p>

<p>
It is a way to keep network clients separated from each other even if they use the same shared physical network, without setting up a whole subnet and a router.
It works by adding a label (<abbr title="Virtual Local Area Network">VLAN</abbr> ID) on networking traffic, and using this label to route the traffic to keep isolated clients in different VLANs. To use a <abbr title="Virtual Local Area Network">VLAN</abbr> you need at least 2 devices supporting <abbr title="Virtual Local Area Network">VLAN</abbr> features (as any route requires at least 2 points), which is usually advanced routers, any OpenWrt device, and any self-respecting PC or single-board computer (Windows, MacOS, Linux and BSDs support VLANs).
</p>

<p>
OpenWrt supports <a href="https://en.wikipedia.org/wiki/IEEE_802.1Q" class="urlextern" title="https://en.wikipedia.org/wiki/IEEE_802.1Q" rel="ugc nofollow">IEEE 802.1Q</a> and <a href="https://en.wikipedia.org/wiki/IEEE_802.1ad" class="urlextern" title="https://en.wikipedia.org/wiki/IEEE_802.1ad" rel="ugc nofollow">IEEE 802.1ad</a> <abbr title="Virtual Local Area Network">VLAN</abbr> standards.
</p>

<p>
Many embedded devices with more than 1 port contain a <abbr title="Virtual Local Area Network">VLAN</abbr>-capable switch (all routers with a <abbr title="Wide Area Network">WAN</abbr> port have a <abbr title="Virtual Local Area Network">VLAN</abbr>-capable switch for example). Single-port devices and devices where there is an ethernet controller for each port (like for example PCEngines boards or most PC hardware in general) will have <abbr title="Virtual Local Area Network">VLAN</abbr> managed by <abbr title="Operating System">OS</abbr> drivers.
</p>

<p>
A <abbr title="Virtual Local Area Network">VLAN</abbr>-capable switch is an integrated version of an independent device called “managed switch”. It is connected to an internal “ethernet” interface of your device, and it is more or less independent from the main CPU.
It can place ports under the same <abbr title="Virtual Local Area Network">VLAN</abbr> (and they will communicate with each other) by just setting the right <abbr title="Virtual Local Area Network">VLAN</abbr> ID(s) on the ports (with the right configuration, below), and this will work irrespective of the fact that the network communication reaches or not the router CPU itself (do note that to configure the router itself you still need at least one <abbr title="Virtual Local Area Network">VLAN</abbr> to reach the CPU).
</p>

<p>
A device where there is software <abbr title="Virtual Local Area Network">VLAN</abbr> support is just a device with many different ethernet controllers, so if you want to place 2 interfaces in the same <abbr title="Virtual Local Area Network">VLAN</abbr>, AND you want these two interfaces to also route traffic to-from each other (to act as if they were a <abbr title="Virtual Local Area Network">VLAN</abbr>-capable switch as the one I talked about above), you need to bridge them too (i.e. both must be in the same Interface, be it <strong>lan</strong>, <strong>wan</strong> or whatever).
</p>

<p>
If you have any question, feel free to discuss this guide on the OpenWrt forum:
<a href="https://forum.openwrt.org/t/vlan-assigning" class="urlextern" title="https://forum.openwrt.org/t/vlan-assigning" rel="ugc nofollow">https://forum.openwrt.org/t/vlan-assigning</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;VLAN&quot;,&quot;hid&quot;:&quot;vlan&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;92-2467&quot;} -->
<h2 class="sectionedit6" id="vlan_explained_with_default_scenario_of_most_openwrt_routers">VLAN explained with default scenario of most OpenWrt routers</h2>
<div class="level2">

<p>
A very common default <abbr title="Virtual Local Area Network">VLAN</abbr> configuration on many off-the-shelf routers is the <abbr title="Local Area Network">LAN</abbr>↔<abbr title="Wide Area Network">WAN</abbr> separation.
OpenWrt default configuration on such devices does usually mirror the stock configuration.
Most of such routers only contain a single network interface (eth0), leading to a 5-port <abbr title="Virtual Local Area Network">VLAN</abbr>-enabled switch that is virtually partitioned into a <abbr title="Local Area Network">LAN</abbr> and <abbr title="Wide Area Network">WAN</abbr> network by using VLANs:
</p>
<div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0 centeralign">  <abbr title="Virtual Local Area Network">VLAN</abbr> ID  </td><td class="col1 centeralign">  <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Upstream:<br/>
HW switch<br/>
↑↓<br/>
eth0 driver
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} --></td><td class="col2 centeralign" colspan="5">  <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Downstream:<br/>
HW switch<br/>
↑↓<br/>
physical ports
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row1">
		<td class="col0"> </td><td class="col1 centeralign">  CPU (eth0)  </td><td class="col2 centeralign">  <abbr title="Local Area Network">LAN</abbr> 1  </td><td class="col3 centeralign">  <abbr title="Local Area Network">LAN</abbr> 2  </td><td class="col4 centeralign">  <abbr title="Local Area Network">LAN</abbr> 3  </td><td class="col5 centeralign">  <abbr title="Local Area Network">LAN</abbr> 4  </td><td class="col6 centeralign">  <abbr title="Wide Area Network">WAN</abbr>  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 1 </td><td class="col1 centeralign">  tagged  </td><td class="col2 centeralign">  untagged  </td><td class="col3 centeralign">  untagged  </td><td class="col4 centeralign">  untagged  </td><td class="col5 centeralign">  untagged  </td><td class="col6 centeralign">  off  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 2 </td><td class="col1 centeralign">  tagged  </td><td class="col2 centeralign">  off  </td><td class="col3 centeralign">  off  </td><td class="col4 centeralign">  off  </td><td class="col5 centeralign">  off  </td><td class="col6 centeralign">  untagged  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;2914-3266&quot;} -->
<p>
In this example, <abbr title="Virtual Local Area Network">VLAN</abbr> ID of the <abbr title="Local Area Network">LAN</abbr> ports is 1 while the <abbr title="Virtual Local Area Network">VLAN</abbr> ID of the <abbr title="Wide Area Network">WAN</abbr> port is 2.
</p>

<p>
Note that the terms “incoming” and “outgoing” and similar refer to network traffic reaching the switch physical ports (or internal CPU port), NOT to traffic that has already entered in the switch.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Tagged</strong> on “CPU (eth0)” means that the two <abbr title="Virtual Local Area Network">VLAN</abbr> ID tags used in this example (1, 2) are sent to the router CPU “as tagged data”. Remember: you can only send Tagged data to <abbr title="Virtual Local Area Network">VLAN</abbr>-aware devices configured to deal with it properly.</div>
</li>
<li class="level1"><div class="li"> <strong>Untagged</strong> means that on these ports the switch will accept only the incoming traffic without any <abbr title="Virtual Local Area Network">VLAN</abbr> IDs (i.e. normal ethernet traffic). The switch will remove <abbr title="Virtual Local Area Network">VLAN</abbr> IDs on outgoing data in such ports. Each port can only be assigned as “untagged” to exactly one <abbr title="Virtual Local Area Network">VLAN</abbr> ID. </div>
</li>
<li class="level1"><div class="li"> <strong>Off</strong> no traffic to or from the tagged ports of this <abbr title="Virtual Local Area Network">VLAN</abbr> ID will reach these ports.</div>
</li>
</ul>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_help plugin_wrap" style="width: 60%;">
<p>
The purpose of a tagged port is to pass traffic for multiple VLANs, whereas an untagged port accepts traffic for only a single <abbr title="Virtual Local Area Network">VLAN</abbr>. Generally speaking, tagged ports will link switches, and untagged ports will link to end devices.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;0-&quot;} -->
<p>
The router CPU then uses the tag information configured above to know if the data came from <abbr title="Virtual Local Area Network">VLAN</abbr> 1 (<abbr title="Local Area Network">LAN</abbr>) or <abbr title="Virtual Local Area Network">VLAN</abbr> 2 (<abbr title="Wide Area Network">WAN</abbr>) and will then act accordingly. In the default configuration, the CPU will only receive and generate “Tagged” data (as there is no other way for it to tell what is what). The CPU uses driver level <abbr title="Virtual Local Area Network">VLAN</abbr>-management for this, as it acts as a single-port device.
</p>

<p>
Note how the <abbr title="Wide Area Network">WAN</abbr> and <abbr title="Local Area Network">LAN</abbr> <abbr title="Virtual Local Area Network">VLAN</abbr> IDs in this example do not share any external ports. For any data to cross the <abbr title="Wide Area Network">WAN</abbr> and <abbr title="Local Area Network">LAN</abbr> border, it has to pass the CPU on eth0 (where the router and firewall will be filtering the data). As said above, nothing prevents to make VLANs that bypass the CPU entirely.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;VLAN explained with default scenario of most OpenWrt routers&quot;,&quot;hid&quot;:&quot;vlan_explained_with_default_scenario_of_most_openwrt_routers&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2468-5105&quot;} -->
<h2 class="sectionedit14" id="is_there_a_vlan-capable_hardware_switch_integrated_in_your_device">Is there a VLAN-capable hardware switch integrated in your device?</h2>
<div class="level2">

<p>
To find out if the ports of an OpenWrt device consist of several distinct network interfaces, or if it is a single network interface leading to a switch
</p>
<ul>
<li class="level1"><div class="li"> You can check the OpenWrt tech page for your router.</div>
</li>
<li class="level1"><div class="li"> You can run the following <abbr title="Secure Shell">SSH</abbr> command on your device to find out <code>ls -l /sys/class/net</code>.</div>
</li>
</ul>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
Newer devices with embedded switches (like Netgear R7800) use the DSA switch driver, that creates a distinct network interface for each switch port as if they didn&#039;t have a switch at all.
</p>

<p>
Most OpenWrt-supported devices can use the DSA driver, but they aren&#039;t ported over yet because the switch configuration would change significantly and likely break any custom setup in devices in the field.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:16,&quot;range&quot;:&quot;0-&quot;} -->
<p>
Example: The following ALIX.2D13 has 3 <strong>real</strong> network interfaces: eth0, eth1 and eth2. Each leads to a single non-switched physical network jack. If needed, you have to use <abbr title="Operating System">OS</abbr>-software based <abbr title="Virtual Local Area Network">VLAN</abbr> configuration:
</p>
<pre class="code"># ls -l /sys/class/net
...
lrwxrwxrwx    1 root     root             0 Jul 25 14:10 eth0 -&gt; ../../devices/pci0000:00/0000:00:09.0/net/eth0
lrwxrwxrwx    1 root     root             0 Jul 25 14:10 eth1 -&gt; ../../devices/pci0000:00/0000:00:0a.0/net/eth1
lrwxrwxrwx    1 root     root             0 Jul 25 14:10 eth2 -&gt; ../../devices/pci0000:00/0000:00:0b.0/net/eth2</pre>

<p>
Example: The following TP-Link TL-WDR3600 has only 1 real network interface: eth0. Its 5 physical network jacks belong to a single <abbr title="Virtual Local Area Network">VLAN</abbr>-capable switch, that in this example is segmented into 2 VLANs, managed by the switch-hardware : eth0.1 and eth0.2:
</p>
<pre class="code"># ls -l /sys/class/net
...
lrwxrwxrwx    1 root     root             0 Jan  1  1970 eth0 -&gt; ../../devices/platform/ag71xx.0/net/eth0
lrwxrwxrwx    1 root     root             0 Jul 21 22:13 eth0.1 -&gt; ../../devices/virtual/net/eth0.1
lrwxrwxrwx    1 root     root             0 Jul 21 22:13 eth0.2 -&gt; ../../devices/virtual/net/eth0.2</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Is there a VLAN-capable hardware switch integrated in your device?&quot;,&quot;hid&quot;:&quot;is_there_a_vlan-capable_hardware_switch_integrated_in_your_device&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:14,&quot;range&quot;:&quot;5106-7099&quot;} -->
<h2 class="sectionedit17" id="assigning_vlan_ids_on_vlan-enabled_switch_hardware">Assigning VLAN IDs on VLAN-enabled switch hardware</h2>
<div class="level2">

<p>
The <code>switch</code> section of <code>/etc/config/network</code> is responsible for partitioning the embedded switch into several <em>VLANs</em> which appear as independent interfaces in the system although they share the same hardware.
</p>

<p>
This section might not be present on some platforms (depends on specific hardware support). Also, some switches only support 4-bit VLANs.
</p>

<p>
<strong>The example below shows a typical configuration for systems not using</strong> <a href="/docs/guide-user/network/dsa/converting-to-dsa" class="wikilink1" title="docs:guide-user:network:dsa:converting-to-dsa" data-wiki-id="docs:guide-user:network:dsa:converting-to-dsa">DSA</a>:
</p>
<pre class="code bash">config <span class="st_h">'switch'</span> <span class="st_h">'eth0'</span>
        option <span class="st_h">'reset'</span> <span class="st_h">'1'</span>
        option <span class="st_h">'enable_vlan'</span> <span class="st_h">'1'</span>
&nbsp;
config <span class="st_h">'switch_vlan'</span> <span class="st_h">'eth0_1'</span>
        option <span class="st_h">'device'</span> <span class="st_h">'eth0'</span>
        option <span class="st_h">'vlan'</span> <span class="st_h">'1'</span>
        option <span class="st_h">'ports'</span> <span class="st_h">'0 1 3t 5t'</span>
&nbsp;
config <span class="st_h">'switch_vlan'</span> <span class="st_h">'eth0_2'</span>
        option <span class="st_h">'device'</span> <span class="st_h">'eth0'</span>
        option <span class="st_h">'vlan'</span> <span class="st_h">'2'</span>
        option <span class="st_h">'ports'</span> <span class="st_h">'2 4t 5t'</span>
&nbsp;
config <span class="st_h">'switch_vlan'</span> <span class="st_h">'eth0_3'</span>
        option <span class="st_h">'device'</span> <span class="st_h">'eth0'</span>
        option <span class="st_h">'vlan'</span> <span class="st_h">'3'</span>
        option <span class="st_h">'ports'</span> <span class="st_h">'3t 4t'</span>
&nbsp;
config <span class="st_h">'switch_port'</span>
        option <span class="st_h">'device'</span> <span class="st_h">'eth0'</span>
        option <span class="st_h">'port'</span> <span class="st_h">'3'</span>
        option <span class="st_h">'pvid'</span> <span class="st_h">'3'</span></pre>

<p>
Common properties are defined within the <code>switch</code> section; vlan specific properties are located in additional <code>switch_vlan</code> sections linked to the <code>switch</code> section through the <code>device</code> option; pvid specific properties are found in <code>switch_port</code> sections linked to the <code>switch</code> section through the <code>device</code> option.
</p>

<p>
Ports can be <em>tagged</em> or <em>untagged</em>:
</p>
<ul>
<li class="level1"><div class="li"> The <em>tagged</em> port (<code>t</code> is appended to the port number) is the one that forces usage of <abbr title="Virtual Local Area Network">VLAN</abbr> tags, i.e. when the packet is outgoing, the <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag with <code>vlan</code> value is added to the packet, and when the packet is incoming, the <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag has to be present and match the configured <code>vlan</code> value(s).</div>
</li>
<li class="level1"><div class="li"> The <em>untagged</em> port is removing the <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag when leaving the port -- this is used for communication with ordinary devices that does not have any clue about VLANs. When the untagged packet arrives to the port, the default port <abbr title="Virtual Local Area Network">VLAN</abbr> ID (called <code>pvid</code>) is assigned to the packet automatically. The <code>pvid</code> value can be selected by the <code>switch_port</code> section.</div>
</li>
</ul>

<p>
The CPU port (number <code>5</code> in our example) may be configured as tagged or untagged, it may even be omitted in the port configuration. The CPU port works like any other ordinary port and can be configured to be tagged or untagged -- when the switch routes packet to the CPU port, it appears on the corresponding switch interface (with <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag number appended to the interface name in case of a tagged port) as incoming packet to allow software routing (to WiFi for example).
</p>

<p>
In our example, untagged packet coming to port 0 would be marked as <abbr title="Virtual Local Area Network">VLAN</abbr> ID 1 first, then sent to port 1 (untagged, <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag removed), port 3 (tagged) and the CPU port (tagged), so the packet appears on <code>eth0.1</code> interface. Another packet arriving to port 2 tagged with <abbr title="Virtual Local Area Network">VLAN</abbr> ID 2 would be sent to port 4 (tagged) and the CPU port (tagged), the packet appears on <code>eth0.2</code> interface. Each tagged switch CPU port has a corresponding interface, in our example you see <code>eth0.1</code> and <code>eth0.2</code> in the system (as well as <code>eth0</code>). When the packet is sent by the software to the tagged CPU port, it has the corresponding <abbr title="Virtual Local Area Network">VLAN</abbr> ID assigned automatically. So when the software sends packet to <code>eth0.2</code>, is is marked with <abbr title="Virtual Local Area Network">VLAN</abbr> ID 2 tag automatically first, and then sent to port 2 (untagged, <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag removed) and port 4 (tagged).
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> An untagged port can have only 1 <abbr title="Virtual Local Area Network">VLAN</abbr> ID <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" />
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Assigning VLAN IDs on VLAN-enabled switch hardware&quot;,&quot;hid&quot;:&quot;assigning_vlan_ids_on_vlan-enabled_switch_hardware&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:17,&quot;range&quot;:&quot;7100-10635&quot;} -->
<h2 class="sectionedit18" id="creating_driver-level_vlans">Creating driver-level VLANs</h2>
<div class="level2">

<p>
A driver-level <abbr title="Virtual Local Area Network">VLAN</abbr> could be created in the <code>interface</code> section by adding a dot (<code>.</code>) and the respective <abbr title="Virtual Local Area Network">VLAN</abbr> ID after the interface name (in the <code>ifname</code> option), like <code>eth1.2</code> for <abbr title="Virtual Local Area Network">VLAN</abbr> ID 2 on <code>eth1</code>.
When any internal software routing decision sends the packet to the software <abbr title="Virtual Local Area Network">VLAN</abbr>, it leaves the respective interface (<code>eth1</code> in our example) with the <abbr title="Virtual Local Area Network">VLAN</abbr> tag present and <abbr title="Virtual Local Area Network">VLAN</abbr> ID set to the number corresponding to the interface name (<code>2</code> in our example on <code>eth1.2</code>).
</p>

<p>
If the incoming packet arrives to the interface with software VLANs (incoming packet to <code>eth1</code>) and has a <abbr title="Virtual Local Area Network">VLAN</abbr> ID tag set, it appears on the respective software-<abbr title="Virtual Local Area Network">VLAN</abbr>-interface instead (<abbr title="Virtual Local Area Network">VLAN</abbr> ID 2 tag arrives on <code>eth1.2</code>) -- if it exists in the configuration! Otherwise the packet is dropped. Non-tagged packets are delivered to non-<abbr title="Virtual Local Area Network">VLAN</abbr> interface (<code>eth1</code>) as usual.
</p>

<p>
When you bridge non-<abbr title="Virtual Local Area Network">VLAN</abbr> and <abbr title="Virtual Local Area Network">VLAN</abbr> interfaces together, the system takes care about adding <abbr title="Virtual Local Area Network">VLAN</abbr> ID when sending packet from non-<abbr title="Virtual Local Area Network">VLAN</abbr> to <abbr title="Virtual Local Area Network">VLAN</abbr> interface, and it automatically removes the <abbr title="Virtual Local Area Network">VLAN</abbr> ID when sending packet from <abbr title="Virtual Local Area Network">VLAN</abbr> interface to non-<abbr title="Virtual Local Area Network">VLAN</abbr> one.
</p>

<p>
Driver-level <abbr title="Virtual Local Area Network">VLAN</abbr> Interfaces may be configured manually. If not, they are created on the fly by netifd. Defining VLANs manually gives more options.
The following options are supported:
</p>
<div class="table sectionedit19"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>type</code> </td><td class="col1"> <abbr title="Virtual Local Area Network">VLAN</abbr> Type </td><td class="col2"> no </td><td class="col3"> 802.1q </td><td class="col4"> <abbr title="Virtual Local Area Network">VLAN</abbr> type, possible values: 8021q or 8021ad </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>name</code> </td><td class="col1"> Name </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Name of device, i.e. eth0.5 or vlan5 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ifname</code> </td><td class="col1"> Parent interface </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Name of parent/base interface, i.e. eth0 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>vid</code> </td><td class="col1"> <abbr title="Virtual Local Area Network">VLAN</abbr> Id </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> <abbr title="Virtual Local Area Network">VLAN</abbr> Id </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>macaddr</code> </td><td class="col1"> MAC </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> MAC of new interface </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;11972-12395&quot;} -->
<p>
Let&#039;s take the example of TP-Link outdoor CPE210 wireless adapter. It has only one NIC, like most outdoor devices, but it can be extended to support several virtual NICs very easily.
</p>

<p>
In the following example, eth0 is segmented into 2 <abbr title="Virtual Local Area Network">VLAN</abbr>-interfaces, with <abbr title="Virtual Local Area Network">VLAN</abbr> ID 106 and 204 using explicit manual configuration:
</p>
<pre class="code bash">config device
	option <span class="kw3">type</span> <span class="st_h">'8021q'</span>
	option ifname <span class="st_h">'eth0'</span>
	option vid <span class="st_h">'106'</span>
	option name <span class="st_h">'vlan1'</span>
&nbsp;
config device
	option <span class="kw3">type</span> <span class="st_h">'8021q'</span>
	option ifname <span class="st_h">'eth0'</span>
	option vid <span class="st_h">'204'</span>
	option name <span class="st_h">'vlan2'</span>
&nbsp;
config interface <span class="st_h">'lan'</span>
	option <span class="kw3">type</span> <span class="st_h">'bridge'</span>
	option ifname <span class="st_h">'vlan1'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'192.168.1.1'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
&nbsp;
config interface <span class="st_h">'wan'</span>
	option ifname <span class="st_h">'vlan2'</span>
	option proto <span class="st_h">'dhcp'</span></pre>

<p>
An equivalent configuration in implicit notation is shown below.
Note that the <code>device</code> sections are missing and the <abbr title="Virtual Local Area Network">VLAN</abbr> ID and parent interface is derived from the <code>ifname</code> option value in dot-notation.
</p>
<pre class="code bash">config interface <span class="st_h">'lan'</span>
	option <span class="kw3">type</span> <span class="st_h">'bridge'</span>
	option ifname <span class="st_h">'eth0.106'</span>
	option proto <span class="st_h">'static'</span>
	option ipaddr <span class="st_h">'192.168.1.1'</span>
	option netmask <span class="st_h">'255.255.255.0'</span>
&nbsp;
config interface <span class="st_h">'wan'</span>
	option ifname <span class="st_h">'eth0.204'</span>
	option proto <span class="st_h">'dhcp'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Creating driver-level VLANs&quot;,&quot;hid&quot;:&quot;creating_driver-level_vlans&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:18,&quot;range&quot;:&quot;10636-13603&quot;} -->
<h2 class="sectionedit20" id="assigning_vlan_ids_using_dsa_on_devices_with_one_physical_port">Assigning VLAN IDs using DSA on devices with one physical port</h2>
<div class="level2">

<p>
An equivalent <abbr title="Virtual Local Area Network">VLAN</abbr> configuration using <strong>Distributed Switch Architecture</strong> (DSA) on a simple device with one physical port (not a switch).
</p>

<p>
To get WLANs to work, bridge the wireless networks to the interfaces (e.g. &#039;iot&#039; network on <abbr title="Virtual Local Area Network">VLAN</abbr> 2 and wlan0-1, &#039;guest&#039; network on <abbr title="Virtual Local Area Network">VLAN</abbr> and wlan1-1).
</p>

<p>
Full known working /etc/config/network
</p>
<pre class="code bash">config interface <span class="st_h">'loopback'</span>
        option ifname <span class="st_h">'lo'</span>
        option proto <span class="st_h">'static'</span>
        option ipaddr <span class="st_h">'127.0.0.1'</span>
        option netmask <span class="st_h">'255.0.0.0'</span>
&nbsp;
config globals <span class="st_h">'globals'</span>
        option packet_steering <span class="st_h">'1'</span>
        option ula_prefix <span class="st_h">'fdfe:bdca:64ed::/48'</span>
&nbsp;
config device
        option name <span class="st_h">'br-lan'</span>
        option <span class="kw3">type</span> <span class="st_h">'bridge'</span>
        list ports <span class="st_h">'lan'</span>
&nbsp;
config bridge-vlan <span class="st_h">'lan_vlan'</span>
	option device <span class="st_h">'br-lan'</span>
	option vlan <span class="st_h">'1'</span>
	list ports <span class="st_h">'lan:u*'</span>
&nbsp;
&nbsp;
config interface <span class="st_h">'lan'</span>
	option device <span class="st_h">'br-lan.1'</span>
	option proto <span class="st_h">'dhcp'</span>
&nbsp;
&nbsp;
config bridge-vlan
        option device <span class="st_h">'br-lan'</span>
        option vlan <span class="st_h">'2'</span>
        list ports <span class="st_h">'lan:t'</span>
&nbsp;
&nbsp;
config interface <span class="st_h">'iot'</span>
        option device <span class="st_h">'br-lan.2'</span>
        option proto <span class="st_h">'none'</span>
&nbsp;
&nbsp;
config bridge-vlan
        option device <span class="st_h">'br-lan'</span>
        option vlan <span class="st_h">'3'</span>
        list ports <span class="st_h">'lan:t'</span>
&nbsp;
&nbsp;
config interface <span class="st_h">'guest'</span>
        option device <span class="st_h">'br-lan.3'</span>
        option proto <span class="st_h">'none'</span></pre>

<p>
brctl show
</p>
<pre class="code">bridge name     bridge id               STP enabled     interfaces
br-lan          7fff.74acb915ff33       no              lan
                                                        wlan0
                                                        wlan1
                                                        lan.3
                                                        wlan0-1
                                                        lan.2
                                                        wlan1-1
                                                       
                                                        </pre>

<p>
With the ip-bridge package installed you can run 
</p>
<pre class="code">bridge v
port              vlan-id  
lan               1 PVID Egress Untagged
                  2
                  3
br-lan            1
                  2
                  3
wlan0             1 PVID Egress Untagged
wlan1             1 PVID Egress Untagged
wlan0-1           2 PVID Egress Untagged
wlan1-1           3 PVID Egress Untagged</pre>

<p>
If the above does not work you may need to install the <strong>ip-full</strong> package.
</p>

<p>
PS/2 This configuration assumes another device is providing <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> servers per network segment (on the untagged <abbr title="Local Area Network">LAN</abbr>, and on the tagged <abbr title="Virtual Local Area Network">VLAN</abbr> 2 &amp; 3 on the same link).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Assigning VLAN IDs using DSA on devices with one physical port&quot;,&quot;hid&quot;:&quot;assigning_vlan_ids_using_dsa_on_devices_with_one_physical_port&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:20,&quot;range&quot;:&quot;13604-&quot;} -->