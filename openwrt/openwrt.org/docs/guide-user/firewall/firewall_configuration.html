
<h1 class="sectionedit1" id="firewall_configurationetcconfigfirewall">Firewall configuration /etc/config/firewall</h1>
<div class="level1">

<p>
OpenWrt&#039;s firewall management application <a href="/docs/guide-user/firewall/overview" class="wikilink1" title="docs:guide-user:firewall:overview" data-wiki-id="docs:guide-user:firewall:overview">firewall</a> is mainly configured through <code>/etc/config/firewall</code>.
</p>

<p>
Most of the information in this wiki will focus on the configuration files and content.
The LuCI and UCI interfaces are user abstractions, ultimately modifying the configuration files.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Firewall configuration \/etc\/config\/firewall&quot;,&quot;hid&quot;:&quot;firewall_configurationetcconfigfirewall&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-389&quot;} -->
<h2 class="sectionedit2" id="management">Management</h2>
<div class="level2">
<ul>
<li class="level1 node"><div class="li"> <strong>The main firewall config file is <code>/etc/config/firewall</code>, and this is edited to modify the firewall settings</strong></div>
<ul>
<li class="level2 node"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> <em>Create a backup of the firewall config <em class="u">prior</em> to making changes</em></div>
<ul>
<li class="level3"><div class="li"> Should changes cause a loss-of-connectivity to the router, you will need to access it in <a href="/docs/guide-user/troubleshooting/failsafe_and_factory_reset#failsafe_mode" class="wikilink1" title="docs:guide-user:troubleshooting:failsafe_and_factory_reset" data-wiki-id="docs:guide-user:troubleshooting:failsafe_and_factory_reset">failsafe mode</a> to restore the backup</div>
</li>
</ul>
</li>
<li class="level2 node"><div class="li"> Once the settings are changed, <em>and <em class="u">after</em> double checking changes</em>, reload the firewall via <code>/etc/init.d/firewall reload</code></div>
<ul>
<li class="level3"><div class="li"> This is a simple shell script calling <code>fw4 reload</code>, and will print diagnostics to the console as it parses the new firewall configuration. <em>Check for errors!</em></div>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> <strong>Any line using <code>#</code> in the first character is not parsed</strong></div>
<ul>
<li class="level2"><div class="li"> Comments are utilized to describe, explain, or quickly comment out, a section</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>OpenWrt 22.03 and later</strong> ships with <strong>firewall4</strong> by default, which uses nftables as a backend. It accepts the same UCI configuration syntax as fw3.</div>
</li>
<li class="level1 node"><div class="li"> <strong>The UCI firewall configuration in <code>/etc/config/firewall</code> covers a reasonable subset of <a href="/docs/guide-user/firewall/netfilter_iptables/netfilter_openwrt" class="wikilink1" title="docs:guide-user:firewall:netfilter_iptables:netfilter_openwrt" data-wiki-id="docs:guide-user:firewall:netfilter_iptables:netfilter_openwrt">NetFilter</a> rules, but not all of them</strong></div>
<ul>
<li class="level2 node"><div class="li"> To provide more functionality, <code><a href="/docs/guide-user/firewall/firewall_configuration#includes_2203_and_later_with_fw4" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">include</a></code> mechanisms are available.</div>
<ul>
<li class="level3 node"><div class="li"> <em>You can either include a shell script with nftables commands, or include nftables snippets at different locations.</em></div>
<ul>
<li class="level4"><div class="li"> See <a href="/docs/guide-user/firewall/fw3_configurations/fw3_config_examples" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:fw3_config_examples" data-wiki-id="docs:guide-user:firewall:fw3_configurations:fw3_config_examples">Firewall examples</a> for usage (might be outdated!)</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> <strong>Whenever possible, use the firewall UCI config <code>/etc/config/firewall</code></strong></div>
<ul>
<li class="level2 node"><div class="li"> There are some scenarios where custom <code><a href="http://www.netfilter.org" class="urlextern" title="http://www.netfilter.org" rel="ugc nofollow">nftables</a></code> rules are required</div>
<ul>
<li class="level3"><div class="li"> See <a href="/docs/guide-user/firewall/netfilter_iptables/netfilter_openwrt" class="wikilink1" title="docs:guide-user:firewall:netfilter_iptables:netfilter_openwrt" data-wiki-id="docs:guide-user:firewall:netfilter_iptables:netfilter_openwrt">Netfilter in OpenWrt</a> for more information</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Management&quot;,&quot;hid&quot;:&quot;management&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;390-2333&quot;} -->
<h3 class="sectionedit3" id="web_interface_instructions">Web interface instructions</h3>
<div class="level3">

<p>
<a href="/docs/guide-user/luci/start" class="wikilink1" title="docs:guide-user:luci:start" data-wiki-id="docs:guide-user:luci:start">LuCI</a> is a good mechanism to view and modify the firewall configuration.
</p>
<ul>
<li class="level1"><div class="li"> It is located under <strong>Network → Firewall</strong> and maps closely to the configuration file sections.</div>
</li>
<li class="level1"><div class="li"> It takes a little longer to modify the firewall configuration, but has a higher level of organization than the config files.</div>
</li>
</ul>

<p>
Make changes and reload using the <code>Save &amp; Apply</code> button.
</p>
<ul>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> LuCI will remove all comment [<code>#</code>] lines from <code>/etc/config/firewall</code>!</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web interface instructions&quot;,&quot;hid&quot;:&quot;web_interface_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;2334-2846&quot;} -->
<h3 class="sectionedit4" id="command-line_instructions">Command-line instructions</h3>
<div class="level3">

<p>
<a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">UCI</a> is a low-level abstraction to the configuration files and can be accessed remotely through <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">SSH</a>.
</p>
<pre class="code bash">uci add firewall rule
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span>-<span class="nu0">1</span><span class="br0">&#93;</span>.name=<span class="st_h">'Reject VPN to LAN traffic'</span>
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span>-<span class="nu0">1</span><span class="br0">&#93;</span>.src=<span class="st_h">'vpn'</span>
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span>-<span class="nu0">1</span><span class="br0">&#93;</span>.dest=<span class="st_h">'lan'</span>
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span>-<span class="nu0">1</span><span class="br0">&#93;</span>.proto=<span class="st_h">'all'</span>
uci <span class="kw1">set</span> firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span>-<span class="nu0">1</span><span class="br0">&#93;</span>.target=<span class="st_h">'REJECT'</span>
uci commit firewall
service firewall restart</pre>

<p>
These would be presumed to be the final rules <em>(each <code>proto</code> creates a rule)</em> in the <em><abbr title="Virtual Private Network">VPN</abbr></em> → <em><abbr title="Local Area Network">LAN</abbr></em> forward chain, as all packets from <abbr title="Virtual Private Network">VPN</abbr> will be rejected.
</p>

<p>
Show firewall configuration:
</p>
<pre class="code bash"><span class="co0"># uci show firewall</span>
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>=rule
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>.name=<span class="st_h">'Reject VPN to LAN traffic'</span>
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>.src=<span class="st_h">'vpn'</span>
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>.dest=<span class="st_h">'lan'</span>
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>.proto=<span class="st_h">'all'</span>
firewall.<span class="sy0">@</span>rule<span class="br0">&#91;</span><span class="nu0">20</span><span class="br0">&#93;</span>.target=<span class="st_h">'REJECT'</span>
...</pre>

<p>
<a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">UCI</a> is useful to view the firewall configuration, but not to do any meaningful modifications for the following reasons:
</p>
<ul>
<li class="level1"><div class="li"> Essential prior knowledge of where a firewall rule needs to go into the rule array in order to make it work.</div>
</li>
<li class="level1"><div class="li"> <code>uci</code> does not recognize content within the <code>/etc/firewall.user</code> script.</div>
</li>
<li class="level1"><div class="li"> <code>uci commit</code> is necessary to save the changes, but still needs <code>/etc/init.d/firewall reload</code> to reload new tables.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2847-4285&quot;} -->
<h2 class="sectionedit5" id="config_sections">Config sections</h2>
<div class="level2">

<p>
Below is an overview of the section types that may be defined in the firewall configuration.
</p>
<ul>
<li class="level1"><div class="li"> A minimal firewall configuration for a router usually consists of one <em>defaults</em> section, at least two <em>zones</em> (<code>lan</code> and <code>wan</code>), and one <em>forwarding</em> to allow traffic from <code>lan</code> to <code>wan</code>.</div>
</li>
<li class="level1"><div class="li"> <em>The forwarding section is not strictly required when there are no more than two zones, as the rule can then be set as the &#039;global default&#039; for that zone.</em></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Config sections&quot;,&quot;hid&quot;:&quot;config_sections&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;4286-4776&quot;} -->
<h3 class="sectionedit6" id="defaults">Defaults</h3>
<div class="level3">

<p>
The <code>defaults</code> section declares global firewall settings which do not belong to specific zones: 
</p>
<pre class="code bash">config defaults
	option	input			<span class="st_h">'ACCEPT'</span>
	option	output			<span class="st_h">'ACCEPT'</span>
	option	forward			<span class="st_h">'REJECT'</span>
	option	custom_chains		<span class="st_h">'1'</span>
	option	drop_invalid		<span class="st_h">'1'</span>
	option	synflood_protect	<span class="st_h">'1'</span>
	option	synflood_rate		<span class="st_h">'25/s'</span>
	option	synflood_burst		<span class="st_h">'50'</span>
	option	tcp_ecn			<span class="st_h">'1'</span>
	option	tcp_syncookies		<span class="st_h">'1'</span>
	option	tcp_window_scaling	<span class="st_h">'1'</span></pre>

</div>

<h4 id="options">Options</h4>
<div class="level4">
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>input</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>ACCEPT</code> </td><td class="col4"> Set policy for the <code>INPUT</code> chain of the <code>filter</code> table. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>output</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>ACCEPT</code> </td><td class="col4"> Set policy for the <code>OUTPUT</code> chain of the <code>filter</code> table. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>forward</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>REJECT</code> </td><td class="col4"> Set policy for the <code>FORWARD</code> chain of the <code>filter</code> table. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>drop_invalid</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Drop invalid packets (e.g. not matching any active connection). </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>syn_flood</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Enable <a href="https://en.wikipedia.org/wiki/SYN flood" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/SYN flood">SYN flood</a> protection (obsoleted by <code>synflood_protect</code> setting). </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>synflood_protect</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Enable <a href="https://en.wikipedia.org/wiki/SYN flood" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/SYN flood">SYN flood</a> protection. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>synflood_rate</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>25/s</code> </td><td class="col4"> Set rate limit (packets/second) for SYN packets above which the traffic is considered a flood. </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>synflood_burst</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>50</code> </td><td class="col4"> Set burst limit for SYN packets above which the traffic is considered a flood if it exceeds the allowed rate. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>tcp_syncookies</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Enable the use of <a href="https://en.wikipedia.org/wiki/SYN cookies" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/SYN cookies">SYN cookies</a>. </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>tcp_ecn</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> <code>0</code> Disable, <code>1</code> Enable, <code>2</code> Enable when requested for ingress (but disable for egress) <a href="https://en.wikipedia.org/wiki/Explicit_Congestion_Notification" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Explicit_Congestion_Notification">Explicit Congestion Notification</a>. Affects only traffic originating from the router itself. Implemented upstream in Linux Kernel. See <a href="https://docs.kernel.org/networking/ip-sysctl.html" class="urlextern" title="https://docs.kernel.org/networking/ip-sysctl.html" rel="ugc nofollow">kernel docs</a>. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>tcp_window_scaling</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Enable <a href="https://en.wikipedia.org/wiki/TCP_window_scale_option" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/TCP_window_scale_option">TCP window scaling</a>. </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>accept_redirects</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Accepts redirects. Implemented upstream in Linux Kernel. See <a href="https://docs.kernel.org/networking/ip-sysctl.html" class="urlextern" title="https://docs.kernel.org/networking/ip-sysctl.html" rel="ugc nofollow">kernel docs</a>. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>accept_source_route</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Implemented upstream in Linux Kernel. See <a href="https://docs.kernel.org/networking/ip-sysctl.html" class="urlextern" title="https://docs.kernel.org/networking/ip-sysctl.html" rel="ugc nofollow">kernel docs</a>. </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>custom_chains</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Enable generation of custom rule chain hooks for user generated rules. User rules would be typically stored in firewall.user but some packages e.g. BCP38 also make use of these hooks. </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>disable_ipv6</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Disable <abbr title="Internet Protocol version 6">IPv6</abbr> firewall rules. (not supported by fw4) </td>
	</tr>
	<tr class="row16">
		<td class="col0"> <code>flow_offloading</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Enable software flow offloading for connections. (decrease cpu load / increase routing throughput) </td>
	</tr>
	<tr class="row17">
		<td class="col0"> <code>flow_offloading_hw</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Enable hardware flow offloading for connections. (depends on flow_offloading and hw capability) </td>
	</tr>
	<tr class="row18">
		<td class="col0"> <code>tcp_reject_code</code> </td><td class="col1"> reject_code </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Defined in <a href="https://lxr.openwrt.org/source/firewall3/options.h#L92" class="urlextern" title="https://lxr.openwrt.org/source/firewall3/options.h#L92" rel="ugc nofollow">firewall3/options.h</a>. Seems to determine method of packet rejection; (<a href="https://en.wikipedia.org/wiki/TCP_reset_attack" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/TCP_reset_attack">tcp reset, or drop</a>, vs <a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Destination_unreachable" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Destination_unreachable">ICMP Destination Unreachable, or closed</a>) </td>
	</tr>
	<tr class="row19">
		<td class="col0"> <code>any_reject_code</code> </td><td class="col1"> reject_code </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Defined in <a href="https://lxr.openwrt.org/source/firewall3/options.h#L92" class="urlextern" title="https://lxr.openwrt.org/source/firewall3/options.h#L92" rel="ugc nofollow">firewall3/options.h</a>. Seems to determine method of packet rejection; (<a href="https://en.wikipedia.org/wiki/TCP_reset_attack" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/TCP_reset_attack">tcp reset, or drop</a>, vs <a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Destination_unreachable" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol#Destination_unreachable">ICMP Destination Unreachable, or closed</a>)</td>
	</tr>
	<tr class="row20">
		<td class="col0"> <code>auto_helper</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Enable Conntrack helpers </td>
	</tr>
	<tr class="row21">
		<td class="col0"> <code>auto_includes</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> (fw4 only, 22.03 and later) Enable automatic nftables includes under <code>/usr/share/nftables.d/</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;5247-8665&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Defaults&quot;,&quot;hid&quot;:&quot;defaults&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:6,&quot;range&quot;:&quot;4777-8666&quot;} -->
<h3 class="sectionedit8" id="zones">Zones</h3>
<div class="level3">

<p>
A <code>zone</code> section groups one or more <em>interfaces</em> and serves as a <em>source</em> or <em>destination</em> for <em>forwardings</em>, <em>rules</em> and <em>redirects</em>.
</p>
<pre class="code bash">config zone
	option	name		<span class="st_h">'wan'</span>
	option	network		<span class="st_h">'wan wan6'</span>
	option	input		<span class="st_h">'REJECT'</span>
	option	output		<span class="st_h">'ACCEPT'</span>
	option	forward		<span class="st_h">'REJECT'</span>
	option	masq		<span class="st_h">'1'</span>
	option	mtu_fix		<span class="st_h">'1'</span></pre>
<ul>
<li class="level1"><div class="li"> <strong>MASQUERADE</strong> (<abbr title="Network Address Translation">NAT</abbr>) of outgoing traffic (<abbr title="Wide Area Network">WAN</abbr>) is controlled on a per-zone basis on the <em>outgoing</em> interface.</div>
</li>
<li class="level1"><div class="li"> <strong>INPUT</strong> rules for a zone describe what happens to traffic trying to reach the router itself through an interface in that zone.</div>
</li>
<li class="level1"><div class="li"> <strong>OUTPUT</strong> rules for a zone describe what happens to traffic originating from the router itself going through an interface in that zone.</div>
</li>
<li class="level1"><div class="li"> <strong>FORWARD</strong> rules for a zone describe what happens to traffic passing between different interfaces belonging in the same zone.</div>
</li>
</ul>

</div>

<h4 id="options1">Options</h4>
<div class="level4">
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>name</code> </td><td class="col1"> zone name </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Unique zone name. 11 characters is the maximum working firewall zone name length. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>network</code> </td><td class="col1"> list </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> List of <em><a href="/docs/guide-user/network/network_configuration#section_interface" class="wikilink1" title="docs:guide-user:network:network_configuration" data-wiki-id="docs:guide-user:network:network_configuration">interfaces</a></em> attached to this zone. If omitted and neither extra* options, subnets nor devices are given, the value of <code>name</code> is used by default. Alias interfaces defined in the network config cannot be used as valid &#039;standalone&#039; networks. Use <a href="/docs/guide-user/base-system/basic#appending_or_deleting_values_on_a_list_option" class="wikilink1" title="docs:guide-user:base-system:basic" data-wiki-id="docs:guide-user:base-system:basic"> list syntax</a>. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>masq</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies whether <em>outgoing</em> zone <abbr title="Internet Protocol version 4">IPv4</abbr> traffic should be masqueraded. This is typically enabled on the <em>wan</em> zone. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>masq6</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies whether <em>outgoing</em> zone <abbr title="Internet Protocol version 6">IPv6</abbr> traffic should be masqueraded. This is typically enabled on the <em>wan</em> zone. Available with fw4. Requires <code><a href="/docs/guide-user/network/ipv6/configuration?s=sourcefilter#protocol_dhcpv6" class="wikilink1" title="docs:guide-user:network:ipv6:configuration" data-wiki-id="docs:guide-user:network:ipv6:configuration">sourcefilter=0</a></code> for DHCPv6 interfaces with missing GUA prefix. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>masq_src</code> </td><td class="col1"> list of subnets </td><td class="col2"> no </td><td class="col3"> <code>0.0.0.0/0</code> </td><td class="col4"> Limit masquerading to the given source subnets. Negation is possible by prefixing the subnet with <code>!</code>; multiple subnets are allowed. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>masq_dest</code> </td><td class="col1"> list of subnets </td><td class="col2"> no </td><td class="col3"> <code>0.0.0.0/0</code> </td><td class="col4"> Limit masquerading to the given destination subnets. Negation is possible by prefixing the subnet with <code>!</code>; multiple subnets are allowed. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>masq_allow_invalid</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Do not add <code>DROP INVALID</code> rules, if masquerading is used. The <code>DROP</code> rules are supposed to prevent <abbr title="Network Address Translation">NAT</abbr> leakage (see <a href="https://git.lede-project.org/?p=project/firewall3.git;a=commit;h=e751cde8954a09ea32f67a8bf7974b4dc1395f2e" class="urlextern" title="https://git.lede-project.org/?p=project/firewall3.git;a=commit;h=e751cde8954a09ea32f67a8bf7974b4dc1395f2e" rel="ugc nofollow">commit in firewall3</a>). </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>mtu_fix</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Enable MSS clamping for <em>outgoing</em> zone traffic. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>input</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> From <code>defaults</code> section </td><td class="col4"> Policy (<code>ACCEPT</code>, <code>REJECT</code>, <code>DROP</code>) for <em>incoming</em> zone traffic. </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>output</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> From <code>defaults</code> section </td><td class="col4"> Policy (<code>ACCEPT</code>, <code>REJECT</code>, <code>DROP</code>) for <em>outgoing</em> zone traffic. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>forward</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> From <code>defaults</code> section </td><td class="col4"> Policy (<code>ACCEPT</code>, <code>REJECT</code>, <code>DROP</code>) for <em>forwarded</em> zone traffic. </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(auto)</em> </td><td class="col4"> Specifies the address family (<code>ipv4</code>, <code>ipv6</code> or <code>any</code>) for which the rules are generated. If unspecified, matches the address family of other options in this section and defaults to <code>any</code>. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>log</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Bit field to enable logging in the filter and/or mangle tables, bit 0 = filter, bit 1 = mangle. </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>log_limit</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>10/minute</code> </td><td class="col4"> Limits the amount of log messages per interval. </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>device</code> </td><td class="col1"> list </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> List of L3 network interface names attached to this zone, e.g. <code>tun+</code> or <code>ppp+</code> to match any TUN or PPP interface. This is specifically suitable for undeclared interfaces which lack built-in netifd support such as OpenVPN. Otherwise <code>network</code> is preferable and <code>device</code> should be avoided. </td>
	</tr>
	<tr class="row16">
		<td class="col0"> <code>subnet</code> </td><td class="col1"> list </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> List of <abbr title="Internet Protocol">IP</abbr> subnets attached to this zone. </td>
	</tr>
	<tr class="row17">
		<td class="col0"> <del><code>extra</code></del> </td><td class="col1"> <del>string</del> </td><td class="col2"> <del>no</del> </td><td class="col3"> <del><em>(none)</em></del> </td><td class="col4"> <del>Extra arguments passed directly to iptables. Note that these options are passed to both source and destination classification rules, therefor direction-specific options like <code>--dport</code> should not be used here - in this case the <code>extra_src</code> and <code>extra_dest</code> options should be used instead.</del> </td>
	</tr>
	<tr class="row18">
		<td class="col0"> <del><code>extra_src</code></del> </td><td class="col1"> <del>string</del> </td><td class="col2"> <del>no</del> </td><td class="col3"> <del><em>Value of <code>extra</code></em></del> </td><td class="col4"> <del>Extra arguments passed directly to iptables for source classification rules.</del> </td>
	</tr>
	<tr class="row19">
		<td class="col0"> <del><code>extra_dest</code></del> </td><td class="col1"> <del>string</del> </td><td class="col2"> <del>no</del> </td><td class="col3"> <del><em>Value of <code>extra</code></em></del> </td><td class="col4"> <del>Extra arguments passed directly to iptables for destination classification rules.</del> </td>
	</tr>
	<tr class="row20">
		<td class="col0"> <code>custom_chains</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Enable generation of custom rule chain hooks for user generated rules. Has no effect if disabled (0) in the <code>defaults</code> section (see above). </td>
	</tr>
	<tr class="row21">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> yes </td><td class="col4"> if set to <code>0</code>, zone is disabled </td>
	</tr>
	<tr class="row22">
		<td class="col0"> <code>auto_helper</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> <code>1</code> for non-masq zone </td><td class="col4"> Add CT helpers for zone </td>
	</tr>
	<tr class="row23">
		<td class="col0"> <code>helper</code> </td><td class="col1"> cthelper </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> List of helpers to add to zone </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;9566-13974&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Zones&quot;,&quot;hid&quot;:&quot;zones&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:8,&quot;range&quot;:&quot;8667-13975&quot;} -->
<h3 class="sectionedit10" id="forwardings">Forwardings</h3>
<div class="level3">

<p>
The <code>forwarding</code> sections control the traffic flow between <em>zones</em>.
</p>
<pre class="code bash">config forwarding
	option	src		<span class="st_h">'lan'</span>
	option	dest		<span class="st_h">'wan'</span></pre>
<ul>
<li class="level1"><div class="li"> Only one direction is covered by a <code>forwarding</code> rule. To allow bidirectional traffic flows between two <em>zones</em>, two <em>forwardings</em> are required, with <code>src</code> and <code>dest</code> reversed in each.</div>
</li>
</ul>

</div>

<h4 id="options2">Options</h4>
<div class="level4">
<div class="table sectionedit11"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>name</code> </td><td class="col1"> forward name </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Unique forwarding name. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>src</code> </td><td class="col1"> zone name </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>source zone</em>. Refers to one of the defined <em>zone names</em>. For typical port forwards this usually is &#039;wan&#039;. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>dest</code> </td><td class="col1"> zone name </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>destination zone</em>. Refers to one of the defined <em>zone names</em>. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>any</code> </td><td class="col4"> Specifies the address family (<code>ipv4</code>, <code>ipv6</code> or <code>any</code>) for which the rules are generated. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> bool </td><td class="col2"> no </td><td class="col3"> yes </td><td class="col4"> If set to <code>0</code>, forward is disabled. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>ipset</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If specified, match traffic against the given <em><a href="/docs/guide-user/firewall/firewall_configuration#ip_sets" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">ipset</a></em>. The match can be inverted by prefixing the value with an exclamation mark. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;14364-15245&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The rules generated for this section rely on the <em>state match</em> which needs connection tracking to work.
</p>
<ul>
<li class="level1"><div class="li"> At least one of the <code>src</code> or <code>dest</code> zones needs to have <em>connection tracking</em> enabled through the <code>masq</code> option.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Forwardings&quot;,&quot;hid&quot;:&quot;forwardings&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:10,&quot;range&quot;:&quot;13976-15482&quot;} -->
<h3 class="sectionedit12" id="rules">Rules</h3>
<div class="level3">

<p>
The <code>rule</code> section is used to define basic accept, drop, or reject rules to allow or restrict access to specific ports or hosts.
</p>
<pre class="code bash">config rule
	option	name		<span class="st_h">'Reject LAN to WAN for custom IP'</span>
	option	src		<span class="st_h">'lan'</span>
	option	src_ip		<span class="st_h">'192.168.1.2'</span>
	option	src_mac		<span class="st_h">'00:11:22:33:44:55'</span>
	option	src_port	<span class="st_h">'80'</span>
	option	dest		<span class="st_h">'wan'</span>
	option	dest_ip		<span class="st_h">'194.25.2.129'</span>
	option	dest_port	<span class="st_h">'120'</span>
	option	proto		<span class="st_h">'tcp'</span>
	option	target		<span class="st_h">'REJECT'</span></pre>

<p>
Below example is based on a <strong>inter zone forward case</strong> (where zone forward is set to reject) where you have one firewall zone called <code>lan</code> with two interfaces. In one interface you have a server with <abbr title="Internet Protocol">IP</abbr> address <code>172.30.100.1</code> and the other interface is the default lan interface with <code>192.168.1.0/24</code> <abbr title="Internet Protocol">IP</abbr> range. This configuration case will allow <abbr title="Internet Protocol version 4">IPv4</abbr> <code>tcp</code> traffic from all <abbr title="Internet Protocol">IP</abbr> addresses in the default lan interface to specifically connect only to the server <abbr title="Internet Protocol">IP</abbr> address and to the server port <code>22</code>.
</p>
<pre class="code bash">config rule
	option name             <span class="st_h">'forward ssh to server'</span>
	option family           <span class="st_h">'ipv4'</span>
	option src              <span class="st_h">'lan'</span>
	option src_ip           <span class="st_h">'192.168.1.0/24'</span>
	option dest             <span class="st_h">'lan'</span>
	option dest_ip          <span class="st_h">'172.30.100.1'</span>
	option proto            <span class="st_h">'tcp'</span>
	option dest_port        <span class="st_h">'22'</span>
	option target           <span class="st_h">'ACCEPT'</span></pre>
<ul>
<li class="level1"><div class="li"> In OpenWrt firewall, the <code>src</code> and <code>dest</code> are tied to the target:</div>
</li>
<li class="level1"><div class="li"> If <code>src</code> and <code>dest</code> are given, the rule matches <em>forwarded</em> traffic</div>
</li>
<li class="level1"><div class="li"> If only <code>src</code> is given, the rule matches <em>incoming</em> traffic</div>
</li>
<li class="level1"><div class="li"> If only <code>dest</code> is given, the rule matches <em>outgoing</em> traffic</div>
</li>
<li class="level1"><div class="li"> If neither <code>src</code> nor <code>dest</code> are given, the rule defaults to an <em>outgoing</em> traffic rule</div>
</li>
<li class="level1"><div class="li"> <abbr title="Internet Protocol">IP</abbr> address for <code>src_ip</code> and <code>dest_ip</code> can be a specific <abbr title="Internet Protocol">IP</abbr> address or use CIDR notations to define a complete interface group of <abbr title="Internet Protocol">IP</abbr> addresses as a source or destination, for instance <code>192.168.1.0/24</code>.</div>
</li>
<li class="level1"><div class="li"> Port ranges are specified as <code>start-stop</code>, for instance <code>6666-6670</code>.</div>
</li>
</ul>

</div>

<h4 id="options3">Options</h4>
<div class="level4">
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>name</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Name of rule </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>src</code> </td><td class="col1"> zone name </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>source zone</em>. Refers to one of the defined <em>zone names</em>, or <code>*</code> for any zone. If omitted, the rule applies to <em>output</em> traffic. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>src_ip</code> </td><td class="col1"> ip address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic from the specified <em>source <abbr title="Internet Protocol">IP</abbr> address</em>, CIDR notations can be used, see note above. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>src_mac</code> </td><td class="col1"> mac address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic from the specified <em>MAC address</em> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>src_port</code> </td><td class="col1"> port or range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic from the specified <em>source port</em> or <em>port range</em>, if relevant <code>proto</code> is specified. Multiple ports can be specified like &#039;80 443 465&#039; <a href="https://forum.openwrt.org/viewtopic.php?pid=287271" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=287271" rel="ugc nofollow">1</a>. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>proto</code> </td><td class="col1"> protocol name or number </td><td class="col2"> no </td><td class="col3"> <code>tcp udp</code> </td><td class="col4"> Match incoming traffic using the given <em>protocol</em>. Can be one (or several when using list syntax) of <code>tcp</code>, <code>udp</code>, <code>udplite</code>, <code>icmp</code>, <code>esp</code>, <code>ah</code>, <code>sctp</code>, or <code>all</code> or it can be a numeric value, representing one of these protocols or a different one. A protocol name from <code>/etc/protocols</code> is also allowed. The number <code>0</code> is equivalent to <code>all</code>. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>icmp_type</code> </td><td class="col1"> list of type names or numbers </td><td class="col2"> no </td><td class="col3"> any </td><td class="col4"> For <em>protocol</em> <code>icmp</code> select specific <abbr title="Internet Control Message Protocol">ICMP</abbr> types to match. Values can be either exact <abbr title="Internet Control Message Protocol">ICMP</abbr> type numbers or type names (see below). </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>dest</code> </td><td class="col1"> zone name </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>destination zone</em>. Refers to one of the defined <em>zone names</em>, or <code>*</code> for any zone. If specified, the rule applies to <em>forwarded</em> traffic; otherwise, it is treated as <em>input</em> rule. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>dest_ip</code> </td><td class="col1"> ip address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic directed to the specified <em>destination <abbr title="Internet Protocol">IP</abbr> address</em>, CIDR notations can be used, see note above. With no dest zone, this is treated as an input rule! </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>dest_port</code> </td><td class="col1"> port or range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic directed at the given <em>destination port or port range</em>, if relevant <code>proto</code> is specified. Multiple ports can be specified like &#039;80 443 465&#039; <a href="https://forum.openwrt.org/viewtopic.php?pid=287271" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=287271" rel="ugc nofollow">1</a>. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>ipset</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If specified, match traffic against the given <em><a href="/docs/guide-user/firewall/firewall_configuration#ip_sets" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">ipset</a></em>. The match can be inverted by prefixing the value with an exclamation mark. You can specify the direction as &#039;setname src&#039; or &#039;setname dest&#039;. The default if neither src nor dest are added is to assume src </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>mark</code> </td><td class="col1"> mark/mask </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If specified, match traffic against the given firewall mark, e.g. <code>0xFF</code> to match mark 255 or <code>0x0/0x1</code> to match any even mark value. The match can be inverted by prefixing the value with an exclamation mark, e.g. <code>!0x10</code> to match all but mark #16. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>start_date</code> </td><td class="col1"> date (<code>yyyy-mm-dd</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specifed, only match traffic after the given date (inclusive). </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>stop_date</code> </td><td class="col1"> date (<code>yyyy-mm-dd</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic before the given date (inclusive). </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>start_time</code> </td><td class="col1"> time (<code>hh:mm:ss</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic after the given time of day (inclusive). </td>
	</tr>
	<tr class="row16">
		<td class="col0"> <code>stop_time</code> </td><td class="col1"> time (<code>hh:mm:ss</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic before the given time of day (inclusive). </td>
	</tr>
	<tr class="row17">
		<td class="col0"> <code>weekdays</code> </td><td class="col1"> list of weekdays </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic during the given week days, e.g. <code>sun mon thu fri</code> to only match on sundays, mondays, thursdays and Fridays. The list can be inverted by prefixing it with an exclamation mark, e.g. <code>! sat sun</code> to always match but on Saturdays and sundays. </td>
	</tr>
	<tr class="row18">
		<td class="col0"> <code>monthdays</code> </td><td class="col1"> list of dates </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic during the given days of the month, e.g. <code>2 5 30</code> to only match on every 2nd, 5th and 30rd day of the month. The list can be inverted by prefixing it with an exclamation mark, e.g. <code>! 31</code> to always match but on the 31st of the month. </td>
	</tr>
	<tr class="row19">
		<td class="col0"> <code>utc_time</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Treat all given time values as UTC time instead of local time. </td>
	</tr>
	<tr class="row20">
		<td class="col0"> <code>target</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <code>DROP</code> </td><td class="col4"> Firewall action (<code>ACCEPT</code>, <code>REJECT</code>, <code>DROP</code>, <code>MARK</code>, <code>NOTRACK</code>) for matched traffic. </td>
	</tr>
	<tr class="row21">
		<td class="col0"> <code>set_mark</code> </td><td class="col1" rowspan="2"> mark/mask </td><td class="col2" rowspan="2"> yes for target <code>MARK</code> </td><td class="col3" rowspan="2"> <em>(none)</em> </td><td class="col4"> Zeroes out the bits given by mask and ORs value into the packet mark. If mask is omitted, <code>0xFFFFFFFF</code> is assumed. </td>
	</tr>
	<tr class="row22">
		<td class="col0"> <code>set_xmark</code> </td><td class="col1"> Zeroes out the bits given by mask and XORs value into the packet mark. If mask is omitted, <code>0xFFFFFFFF</code> is assumed. </td>
	</tr>
	<tr class="row23">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(auto)</em> </td><td class="col4"> Specifies the address family (<code>ipv4</code>, <code>ipv6</code> or <code>any</code>) for which the rules are generated. If unspecified, matches the address family of other options in this section and defaults to <code>any</code>. </td>
	</tr>
	<tr class="row24">
		<td class="col0"> <code>limit</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Maximum average matching rate; specified as a number, with an optional <code>/second</code>, <code>/minute</code>, <code>/hour</code> or <code>/day</code> suffix. Examples: <code>3/minute</code>, <code>3/min</code> or <code>3/m</code>. </td>
	</tr>
	<tr class="row25">
		<td class="col0"> <code>limit_burst</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>5</code> </td><td class="col4"> Maximum initial number of packets to match, allowing a short-term average above <code>limit</code>. </td>
	</tr>
	<tr class="row26">
		<td class="col0"> <del><code>extra</code></del> </td><td class="col1"> <del>string</del> </td><td class="col2"> <del>no</del> </td><td class="col3"> <del><em>(none)</em></del> </td><td class="col4"> <del>Extra arguments to pass to iptables. Useful mainly to specify additional match options, such as <code>-m policy --dir in</code> for IPsec.</del> </td>
	</tr>
	<tr class="row27">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> yes </td><td class="col4"> Enable or disable rule. </td>
	</tr>
	<tr class="row28">
		<td class="col0"> <code>device</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td><td class="col4"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td>
	</tr>
	<tr class="row29">
		<td class="col0"> <code>direction</code> </td><td class="col1"> direction </td><td class="col2"> no </td><td class="col3"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td><td class="col4"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> <em>direction_out</em> </td>
	</tr>
	<tr class="row30">
		<td class="col0"> <code>set_helper</code> </td><td class="col1"> cthelper </td><td class="col2"> no </td><td class="col3"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td><td class="col4"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td>
	</tr>
	<tr class="row31">
		<td class="col0"> <code>helper</code> </td><td class="col1"> cthelper </td><td class="col2"> no </td><td class="col3"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td><td class="col4"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;17498-23280&quot;} -->
</div>

<h4 id="icmp_name_types">ICMP name types</h4>
<div class="level4">
<div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>address-mask-reply</code> </td><td class="col1"> <code>host-redirect</code> </td><td class="col2"> <code>pong</code> </td><td class="col3"> <code>time-exceeded</code> </td>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>address-mask-request</code> </td><td class="col1"> <code>host-unknown</code> </td><td class="col2"> <code>port-unreachable</code> </td><td class="col3"> <code>timestamp-reply</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>any</code> </td><td class="col1"> <code>host-unreachable</code> </td><td class="col2"> <code>precedence-cutoff</code> </td><td class="col3"> <code>timestamp-request</code> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>communication-prohibited</code> </td><td class="col1"> <code>ip-header-bad</code> </td><td class="col2"> <code>protocol-unreachable</code> </td><td class="col3"> <code>TOS-host-redirect</code> </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>destination-unreachable</code> </td><td class="col1"> <code>network-prohibited</code> </td><td class="col2"> <code>redirect</code> </td><td class="col3"> <code>TOS-host-unreachable</code> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>echo-reply</code> </td><td class="col1"> <code>network-redirect</code> </td><td class="col2"> <code>required-option-missing</code> </td><td class="col3"> <code>TOS-network-redirect</code> </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>echo-request</code> </td><td class="col1"> <code>network-unknown</code> </td><td class="col2"> <code>router-advertisement</code> </td><td class="col3"> <code>TOS-network-unreachable</code> </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>fragmentation-needed</code> </td><td class="col1"> <code>network-unreachable</code> </td><td class="col2"> <code>router-solicitation</code> </td><td class="col3"> <code>ttl-exceeded</code> </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>host-precedence-violation</code> </td><td class="col1"> <code>parameter-problem</code> </td><td class="col2"> <code>source-quench</code> </td><td class="col3"> <code>ttl-zero-during-reassembly</code> </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>host-prohibited</code> </td><td class="col1"> <code>ping</code> </td><td class="col2"> <code>source-route-failed</code> </td><td class="col3"> <code>ttl-zero-during-transit</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;23306-24263&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Rules&quot;,&quot;hid&quot;:&quot;rules&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:12,&quot;range&quot;:&quot;15483-24264&quot;} -->
<h3 class="sectionedit15" id="redirects">Redirects</h3>
<div class="level3">

<p>
Port forwardings (DNAT) are defined by <code>redirect</code> sections.
<em>Port Redirects are also commonly known as “port forwarding” or “virtual servers”.</em>
</p>
<ul>
<li class="level1"><div class="li"> All <em>incoming</em> traffic on the specified <em>source zone</em> which matches the given rules will be directed to the specified internal host.</div>
</li>
<li class="level1"><div class="li"> Port ranges are specified as <code>start-stop</code>, for instance <code>6666-6670</code>.</div>
</li>
</ul>

</div>

<h4 id="destination_nat">Destination NAT</h4>
<div class="level4">

<p>
See also: <a href="/docs/guide-user/firewall/fw3_configurations/fw3_ipv6_examples#ipv6_port_forwarding" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:fw3_ipv6_examples" data-wiki-id="docs:guide-user:firewall:fw3_configurations:fw3_ipv6_examples">IPv6 port forwarding</a>
</p>
<pre class="code bash">config redirect
	option	name		<span class="st_h">'DNAT WAN to LAN for SSH'</span>
	option	src		<span class="st_h">'wan'</span>
	option	src_dport	<span class="st_h">'19900'</span>
	option	dest		<span class="st_h">'lan'</span>
	option	dest_ip		<span class="st_h">'192.168.1.1'</span>
	option	dest_port	<span class="st_h">'22'</span>
	option	proto		<span class="st_h">'tcp'</span>
	option	target		<span class="st_h">'DNAT'</span></pre>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If a <code>src_dport</code> is not included in the config section, packets matching the other config options, <em>on any port</em>, will be forwarded to the destination port specified in that config section.
This could pose a security risk to the application running on the destination port the config section opens.
One way to test for this issue, is to use <em> <a href="https://www.grc.com/default.htm" class="urlextern" title="https://www.grc.com/default.htm" rel="ugc nofollow">Gibson Research Corporation&#039;s</a> </em> ShieldsUP! service, and probe the desired ports on your router.
The response could be <em>open</em>, <em>closed</em>, or <em>stealth</em> (drop).
In cases of open or closed ports, packets are reaching a destination host, and are sending ack/reply packets back.
Whereas stealthed ports drop packets; from the perspective of the probing system (Gibson Research), that system cannot definitively know if those packets may, or may not be reaching the destination host.
</p>

</div>

<h4 id="source_nat">Source NAT</h4>
<div class="level4">

<p>
Masquerade is the most common form of SNAT, changing the source of traffic to <abbr title="Wide Area Network">WAN</abbr> to the router&#039;s public <abbr title="Internet Protocol">IP</abbr>.
SNAT can also be done manually:
</p>
<pre class="code bash">config redirect
	option	name		<span class="st_h">'SNAT DMZ 192.168.1.250 to WAN 1.2.3.4 for ICMP'</span>
	option	src		<span class="st_h">'dmz'</span>
	option	src_ip		<span class="st_h">'192.168.1.250'</span>
	option	src_dip		<span class="st_h">'1.2.3.4'</span>
	option	dest		<span class="st_h">'wan'</span>
	option	proto		<span class="st_h">'icmp'</span>
	option	target		<span class="st_h">'SNAT'</span></pre>

</div>

<h4 id="options4">Options</h4>
<div class="level4">

<p>
See also: <a href="https://git.openwrt.org/?p=project/firewall3.git;a=blob;f=snats.c;hb=HEAD#l22" class="urlextern" title="https://git.openwrt.org/?p=project/firewall3.git;a=blob;f=snats.c;hb=HEAD#l22" rel="ugc nofollow">List of SNAT options @ OpenWrt SNAPSHOT</a>
</p>
<div class="table sectionedit16"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>name</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>string</em> </td><td class="col4"> Name of redirect </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>src</code> </td><td class="col1"> zone name </td><td class="col2"> yes for <code>DNAT</code> target </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>source zone</em>. Refers to one of the defined <em>zone names</em>. For typical port forwards this usually is <code>wan</code>. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>src_ip</code> </td><td class="col1"> ip address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic from the specified <em>source <abbr title="Internet Protocol">IP</abbr> address</em>. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>src_dip</code> </td><td class="col1"> ip address </td><td class="col2"> yes for <code>SNAT</code> target </td><td class="col3"> <em>(none)</em> </td><td class="col4"> For <em>DNAT</em>, match incoming traffic directed at the given <em>destination <abbr title="Internet Protocol">IP</abbr> address</em>. For <em>SNAT</em> rewrite the <em>source address</em> to the given address. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>src_mac</code> </td><td class="col1"> mac address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic from the specified <em>MAC address</em>. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>src_port</code> </td><td class="col1"> port or range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Match incoming traffic originating from the given <em>source port or port range</em> on the client host. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>src_dport</code> </td><td class="col1"> port or range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> For <em>DNAT</em>, match incoming traffic directed at the given <em>destination port or port range</em> on this host. For <em>SNAT</em> rewrite the <em>source ports</em> to the given value. </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>proto</code> </td><td class="col1"> protocol name or number </td><td class="col2"> no </td><td class="col3"> <em>tcp udp</em> </td><td class="col4"> Match incoming traffic using the given <em>protocol</em>. Can be one (or several when using list syntax) of <code>tcp</code>, <code>udp</code>, <code>udplite</code>, <code>icmp</code>, <code>esp</code>, <code>ah</code>, <code>sctp</code>, or <code>all</code> or it can be a numeric value, representing one of these protocols or a different one. A protocol name from <code>/etc/protocols</code> is also allowed. The number <code>0</code> is equivalent to <code>all</code>. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>dest</code> </td><td class="col1"> zone name </td><td class="col2"> yes for <code>SNAT</code> target </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the traffic <em>destination zone</em>. Refers to one of the defined <em>zone names</em>. Irrelevant for <em>DNAT</em> target. </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>dest_ip</code> </td><td class="col1"> ip address </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> For <em>DNAT</em>, redirect matches incoming traffic to the specified internal host. For <em>SNAT</em>, it matches traffic directed at the given address. For <em>DNAT</em>, if the <code>dest_ip</code> is not specified, the rule is translated in a redirect rule, otherwise it is a <em>DNAT</em> rule. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>dest_port</code> </td><td class="col1"> port or range </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> For <em>DNAT</em>, redirect matched incoming traffic to the given port on the internal host. For <em>SNAT</em>, match traffic directed at the given ports. Only a single port or range can be specified, not disparate ports as with Rules (below). </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>ipset</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If specified, match traffic against the given <em><a href="/docs/guide-user/firewall/firewall_configuration#ip_sets" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">ipset</a></em>. The match can be inverted by prefixing the value with an exclamation mark. Unsupported in firewall4. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>mark</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If specified, match traffic against the given firewall mark, e.g. <code>0xFF</code> to match mark 255 or <code>0x0/0x1</code> to match any even mark value. The match can be inverted by prefixing the value with an exclamation mark, e.g. <code>!0x10</code> to match all but mark #16. </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>start_date</code> </td><td class="col1"> date (<code>yyyy-mm-dd</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specifed, only match traffic after the given date (inclusive). </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>stop_date</code> </td><td class="col1"> date (<code>yyyy-mm-dd</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic before the given date (inclusive). </td>
	</tr>
	<tr class="row16">
		<td class="col0"> <code>start_time</code> </td><td class="col1"> time (<code>hh:mm:ss</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic after the given time of day (inclusive). </td>
	</tr>
	<tr class="row17">
		<td class="col0"> <code>stop_time</code> </td><td class="col1"> time (<code>hh:mm:ss</code>) </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic before the given time of day (inclusive). </td>
	</tr>
	<tr class="row18">
		<td class="col0"> <code>weekdays</code> </td><td class="col1"> list of weekdays </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic during the given week days, e.g. <code>sun mon thu fri</code> to only match on Sundays, Mondays, Thursdays and Fridays. The list can be inverted by prefixing it with an exclamation mark, e.g. <code>! sat sun</code> to always match but on Saturdays and sundays. </td>
	</tr>
	<tr class="row19">
		<td class="col0"> <code>monthdays</code> </td><td class="col1"> list of dates </td><td class="col2"> no </td><td class="col3"> <em>(always)</em> </td><td class="col4"> If specified, only match traffic during the given days of the month, e.g. <code>2 5 30</code> to only match on every 2nd, 5th and 30rd day of the month. The list can be inverted by prefixing it with an exclamation mark, e.g. <code>! 31</code> to always match but on the 31st of the month. </td>
	</tr>
	<tr class="row20">
		<td class="col0"> <code>utc_time</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Treat all given time values as UTC time instead of local time. </td>
	</tr>
	<tr class="row21">
		<td class="col0"> <code>target</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>DNAT</code> </td><td class="col4"> <abbr title="Network Address Translation">NAT</abbr> target (<code>DNAT</code> or <code>SNAT</code>) to use when generating the rule. </td>
	</tr>
	<tr class="row22">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(auto)</em> </td><td class="col4"> Specifies the address family (<code>ipv4</code>, <code>ipv6</code> or <code>any</code>) for which the rules are generated. If unspecified, matches the address family of other options in this section and defaults to <code>ipv4</code>. </td>
	</tr>
	<tr class="row23">
		<td class="col0"> <code>reflection</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Activate <abbr title="Network Address Translation">NAT</abbr> reflection for this redirect - applicable to <code>DNAT</code> targets. </td>
	</tr>
	<tr class="row24">
		<td class="col0"> <code>reflection_src</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>internal</code> </td><td class="col4"> The source address to use for <abbr title="Network Address Translation">NAT</abbr>-reflected packets if <code>reflection</code> is <code>1</code>. This can be <code>internal</code> or <code>external</code>, specifying which interface’s address to use. Applicable to <code>DNAT</code> targets. </td>
	</tr>
	<tr class="row25">
		<td class="col0"> <code>reflection_zone</code> </td><td class="col1"> list of zone names </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> List of zones for which reflection should be enabled. Applicable to <code>DNAT</code> targets. </td>
	</tr>
	<tr class="row26">
		<td class="col0"> <code>limit</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Maximum average matching rate; specified as a number, with an optional <code>/second</code>, <code>/minute</code>, <code>/hour</code> or <code>/day</code> suffix. Examples: <code>3/second</code>, <code>3/sec</code> or <code>3/s</code>. </td>
	</tr>
	<tr class="row27">
		<td class="col0"> <code>limit_burst</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>5</code> </td><td class="col4"> Maximum initial number of packets to match, allowing a short-term average above <code>limit</code>. </td>
	</tr>
	<tr class="row28">
		<td class="col0"> <del><code>extra</code></del> </td><td class="col1"> <del>string</del> </td><td class="col2"> <del>no</del> </td><td class="col3"> <del><em>(none)</em></del> </td><td class="col4"> <del>Extra arguments to pass to iptables. Useful mainly to specify additional match options, such as <code>-m policy --dir in</code> for IPsec.</del> </td>
	</tr>
	<tr class="row29">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>1</code> or <code>yes</code> </td><td class="col4"> Enable the redirect rule or not. </td>
	</tr>
	<tr class="row30">
		<td class="col0"> <code>helper</code> </td><td class="col1"> cthelper </td><td class="col2"> no </td><td class="col3"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td><td class="col4"> <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:16,&quot;range&quot;:&quot;26460-32268&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Redirects&quot;,&quot;hid&quot;:&quot;redirects&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:15,&quot;range&quot;:&quot;24265-32269&quot;} -->
<h3 class="sectionedit17" id="ip_sets">IP sets</h3>
<div class="level3">

<p>
See also: <a href="/docs/guide-user/firewall/fw3_configurations/fw3_config_ipset" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:fw3_config_ipset" data-wiki-id="docs:guide-user:firewall:fw3_configurations:fw3_config_ipset">IP set examples</a>
</p>

<p>
fw4 supports referencing or creating <a href="https://wiki.nftables.org/wiki-nftables/index.php/Sets" class="urlextern" title="https://wiki.nftables.org/wiki-nftables/index.php/Sets" rel="ugc nofollow">IP sets</a> to simplify matching of large address or port lists without the need for creating one rule per item to match. fw4 <a href="https://git.openwrt.org/?p=project/firewall4.git;a=blob;f=root/usr/share/ucode/fw4.uc;h=47e86cd7dd2a0f87caeccde51710330199905fd3;hb=47e86cd7dd2a0f87caeccde51710330199905fd3#l3189" class="interwiki iw_commit" title="https://git.openwrt.org/?p=project/firewall4.git;a=blob;f=root/usr/share/ucode/fw4.uc;h=47e86cd7dd2a0f87caeccde51710330199905fd3;hb=47e86cd7dd2a0f87caeccde51710330199905fd3#l3189">supports fewer options</a> (see <a href="/docs/guide-user/firewall/firewall_configuration#options_fw4" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">below</a>).
</p>

</div>

<h4 id="options_fw3">Options (fw3)</h4>
<div class="level4">
<div class="table sectionedit18"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Allows to disable the declaration of the ipset without the need to delete the section. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>external</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> If the <code>external</code> option is set to a name, the firewall will simply reference an already existing ipset pointed to by the name. If the <code>external</code> option is unset, the firewall will create the ipset on start and destroy it on stop. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>name</code> </td><td class="col1"> string </td><td class="col2"> yes if <code>external</code> is unset <br/>
no if <code>external</code> is set </td><td class="col3"> <em>(none)</em> if <code>external</code> is unset <br/>
value of <code>external</code> if <code>external</code> is set </td><td class="col4"> Specifies the firewall internal name of the ipset which is used to reference the set in rules or redirects. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>ipv4</code> </td><td class="col4"> Specifies the address family (<code>ipv4</code> or <code>ipv6</code>) for which the <abbr title="Internet Protocol">IP</abbr> set is created. Only applicable to storage types <code>hash</code> and <code>list</code>, the <code>bitmap</code> type implies <code>ipv4</code>. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>storage</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>varies</em> </td><td class="col4"> Specifies the storage method (<code>bitmap</code>, <code>hash</code> or <code>list</code>) used by the ipset, the default varies depending on the used datatypes (see <code>match</code> option below). In most cases the storage method can be automatically inferred from the datatype combination but in some cases multiple choices are possible (e.g. <code>bitmap:ip</code> vs. <code>hash:ip</code>). <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> This is only required by fw3 and must be removed from the fw4 configuration. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>match</code> </td><td class="col1"> list of direction/type tuples </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the matched data types (<code>ip</code>, <code>port</code>, <code>mac</code>, <code>net</code> or <code>set</code>) and their direction (<code>src</code> or <code>dest</code>). The direction is joined with the datatype by an underscore to form a tuple, e.g. <code>src_port</code> to match source ports or <code>dest_net</code> to match destination CIDR ranges. When using ipsets matching on multiple elements, e.g. <code>hash:ip,port</code>, specify the packet fields to match on in quotes or comma-separated (i.e. “match dest_ip dest_port”). </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>iprange</code> </td><td class="col1"> <abbr title="Internet Protocol">IP</abbr> range </td><td class="col2"> yes for storage type <code>bitmap</code> with datatype <code>ip</code> </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the <abbr title="Internet Protocol">IP</abbr> range to cover, see <a href="http://ipset.netfilter.org/ipset.man.html" class="urlextern" title="http://ipset.netfilter.org/ipset.man.html" rel="ugc nofollow">ipset(8)</a>. Only applicable to the <code>hash</code> storage type. </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>portrange</code> </td><td class="col1"> Port range </td><td class="col2"> yes for storage type <code>bitmap</code> with datatype <code>port</code> </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the port range to cover, see <a href="http://ipset.netfilter.org/ipset.man.html" class="urlextern" title="http://ipset.netfilter.org/ipset.man.html" rel="ugc nofollow">ipset(8)</a>. Only applicable to the <code>hash</code> storage type. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>netmask</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>32</code> </td><td class="col4"> If specified, network addresses will be stored in the set instead of <abbr title="Internet Protocol">IP</abbr> host addresses. Value must be between <code>1</code> and <code>32</code>, see <a href="http://ipset.netfilter.org/ipset.man.html" class="urlextern" title="http://ipset.netfilter.org/ipset.man.html" rel="ugc nofollow">ipset(8)</a>. Only applicable to the <code>bitmap</code> storage type with match <code>ip</code> or the <code>hash</code> storage type with match <code>ip</code>. </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>maxelem</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>65536</code> </td><td class="col4"> Limits the number of items that can be added to the set, only applicable to the <code>hash</code> and <code>list</code> storage types. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>hashsize</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>1024</code> </td><td class="col4"> Specifies the initial hash size of the set, only applicable to the <code>hash</code> storage type. </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>timeout</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies the default timeout for entries added to the set. A value of <code>0</code> means enabling the timeout capability flag on a set, but do not put the timeout to entries. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>entry</code> </td><td class="col1"> setentry </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> The <abbr title="Internet Protocol">IP</abbr> address, CIDR, or MAC. Each list entry is a single CIDR, or <abbr title="Internet Protocol">IP</abbr> etc when not using ranges or masks etc above. </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>loadfile</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> A path <abbr title="Uniform Resource Locator">URL</abbr> on the openwrt filesystem to a file containing a list of CIDRs. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;32888-36468&quot;} -->
</div>

<h4 id="options_fw4">Options (fw4)</h4>
<div class="level4">
<div class="table sectionedit19"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Allows to disable the declaration of the ipset without the need to delete the section. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>comment</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Seems like a bug: should be a string for user defined comment. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>name</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the firewall internal name of the ipset which is used to reference the set in rules or redirects. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>ipv4</code> </td><td class="col4"> Specifies the address family (<code>ipv4</code> or <code>ipv6</code>) for which the <abbr title="Internet Protocol">IP</abbr> set is created. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>match</code> </td><td class="col1"> list of ipsettypes </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Specifies the matched data types (<code>ip</code>, <code>port</code>, <code>mac</code>, <code>net</code> or <code>set</code>) and their direction (<code>src</code> or <code>dest</code>). The direction is joined with the datatype by an underscore to form a tuple, e.g. <code>src_port</code> to match source ports or <code>dest_net</code> to match destination CIDR ranges. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>maxelem</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>65536</code> </td><td class="col4"> Limits the number of items that can be added to the set. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>timeout</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies the default timeout for entries added to the set. A value of <code>0</code> means enabling the timeout capability flag on a set, but do not put the timeout to entries. </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>entry</code> </td><td class="col1"> List of <code>entry</code> </td><td class="col2"> no </td><td class="col3"> </td><td class="col4"> The <abbr title="Internet Protocol">IP</abbr> address, CIDR, or MAC. Each list entry is a single CIDR, or <abbr title="Internet Protocol">IP</abbr> etc. </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>loadfile</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> A path <abbr title="Uniform Resource Locator">URL</abbr> on the openwrt filesystem to a file containing a list of CIDRs. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table7&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;36492-37965&quot;} -->
</div>

<h4 id="ip_set_types">IP set types</h4>
<div class="level4">

<p>
<code>prefix_suffix</code>
</p>
<div class="table sectionedit20"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Prefix, aka direction </th><th class="col1"> Suffix aka datatype </th><th class="col2"> Notes </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> src_* </td><td class="col1"> </td><td class="col2"> Source matching of <code>suffix</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> dest_* </td><td class="col1"> </td><td class="col2"> Destination matching of <code>suffix</code> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> </td><td class="col1"> _ip </td><td class="col2"> <abbr title="Internet Protocol">IP</abbr> addresses </td>
	</tr>
	<tr class="row4">
		<td class="col0"> </td><td class="col1"> _port </td><td class="col2"> <abbr title="Transmission Control Protocol">TCP</abbr>/<abbr title="User Datagram Protocol">UDP</abbr> ports </td>
	</tr>
	<tr class="row5">
		<td class="col0"> </td><td class="col1"> _mac </td><td class="col2"> MAC addresses </td>
	</tr>
	<tr class="row6">
		<td class="col0"> </td><td class="col1"> _net </td><td class="col2"> Subnets </td>
	</tr>
	<tr class="row7">
		<td class="col0"> </td><td class="col1"> _set </td><td class="col2"> Unsupported in firewall4 </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table8&quot;,&quot;secid&quot;:20,&quot;range&quot;:&quot;38007-38295&quot;} -->
</div>

<h4 id="storagematch_options">Storage / Match options</h4>
<div class="level4">

<p>
The order of datatype matches is significant
</p>
<div class="table sectionedit21"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Family </th><th class="col1"> Storage </th><th class="col2"> Match </th><th class="col3"> Notes </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>ipv4</code> </td><td class="col1"> <code>bitmap</code> </td><td class="col2"> <code>ip</code> </td><td class="col3"> Requires <code>iprange</code> option </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>ipv4</code> </td><td class="col1"> <code>bitmap</code> </td><td class="col2"> <code>ip mac</code> </td><td class="col3"> Requires <code>iprange</code> option </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ipv4</code> </td><td class="col1"> <code>bitmap</code> </td><td class="col2"> <code>port</code> </td><td class="col3"> Requires <code>portrange</code> option </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>ip</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>net</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>ip port</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>net port</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>ip port ip</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <em>any</em> </td><td class="col1"> <code>hash</code> </td><td class="col2"> <code>ip port net</code> </td><td class="col3"> - </td>
	</tr>
	<tr class="row10">
		<td class="col0"> - </td><td class="col1"> <code>list</code> </td><td class="col2"> <code>set</code> </td><td class="col3"> Meta type to create a set-of-sets </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table9&quot;,&quot;secid&quot;:21,&quot;range&quot;:&quot;38374-38921&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;IP sets&quot;,&quot;hid&quot;:&quot;ip_sets&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:17,&quot;range&quot;:&quot;32270-38922&quot;} -->
<h3 class="sectionedit22" id="includes_2203_and_later_with_fw4">Includes (22.03 and later with fw4)</h3>
<div class="level3">

<p>
<code>fw4</code> has several ways to include custom firewall rules.
In all cases, the custom rules need to be written in nftables-style.
</p>

</div>

<h4 id="config_include_section_with_nftables_snippets">Config include section with nftables snippets</h4>
<div class="level4">

<p>
One way is to include <code>nftables</code> snippets.
There are several possible positions in the nftables structure.
</p>

<p>
For example, to add custom logging to the <code>input_wan</code> chain:
</p>
<pre class="code bash"><span class="co0"># /etc/config/firewall</span>
config include
	option	<span class="kw3">type</span>		<span class="st_h">'nftables'</span>
	option	path		<span class="st_h">'/etc/my_custom_firewall_rule.nft'</span>
	option	position	<span class="st_h">'chain-pre'</span>
	option	chain		<span class="st_h">'input_wan'</span>
&nbsp;
<span class="co0"># /etc/my_custom_firewall_rule.nft</span>
tcp dport <span class="nu0">0</span>-<span class="nu0">1023</span> log prefix <span class="st0">&quot;Inbound WAN connection attempt to low TCP port: &quot;</span></pre>

<p>
To add one or more custom chains:
</p>
<pre class="code bash">config include
	option	<span class="kw3">type</span>		<span class="st_h">'nftables'</span>
	option	path		<span class="st_h">'/etc/my_custom_firewall_chain.nft'</span>
	option	position	<span class="st_h">'table-post'</span></pre>

<p>
Supported options:
</p>
<div class="table sectionedit23"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Allows to disable the corresponding include without having to delete the section </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>type</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>script</code> </td><td class="col4"> Specifies the type of the include, either <code>script</code> for compatibility with fw3 (shell script, see below) or <code>nftables</code> for nftables snippets </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>path</code> </td><td class="col1"> file name </td><td class="col2"> yes </td><td class="col3"> - </td><td class="col4"> Specifies the filename to include </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>position</code> </td><td class="col1"> string </td><td class="col2"> yes (if type is nftables) </td><td class="col3"> <code>table-post</code> </td><td class="col4"> Specifies the position at which the rules will be inserted (see below for allowed values) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>chain</code> </td><td class="col1"> string </td><td class="col2"> yes (if position matches <code>chain-*</code>) </td><td class="col3"> - </td><td class="col4"> Specifies the chain in which the rules will be inserted </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table10&quot;,&quot;secid&quot;:23,&quot;range&quot;:&quot;39826-40543&quot;} -->
<p>
The possible positions for nftables snippets are:
</p>
<div class="table sectionedit24"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Position </th><th class="col1"> Meaning </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>ruleset-pre</code> </td><td class="col1"> At the very beginning, before the fw4 table definition </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>ruleset-post</code> </td><td class="col1"> At the very end, after the fw4 table definition </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>table-pre</code> </td><td class="col1"> At the beginning of the fw4 table, before any chain definition </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>table-post</code> </td><td class="col1"> At the end of the fw4 table, after all chains definition </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>chain-pre</code> </td><td class="col1"> At the beginning of $chain (defined in <code>option chain</code>), before rules in this chain </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>chain-post</code> </td><td class="col1"> At the end of $chain (defined in <code>option chain</code>), after rules in this chain </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table11&quot;,&quot;secid&quot;:24,&quot;range&quot;:&quot;40596-41131&quot;} -->
<p>
Run <code>fw4 print</code> to understand the table / chain / rules structure.
</p>

<p>
Note that <code>-pre</code> can also be written as <code>-prepend</code>, and <code>-post</code> can also be written as <code>-postpend</code> or <code>-append</code>.
</p>

</div>

<h4 id="config_include_section_with_shell_script">Config include section with shell script</h4>
<div class="level4">

<p>
Custom rule inclusion through a shell script works similarly as fw3, but the script should use nftables.
Option <code>fw4_compatible</code> is required when the path is <code>/etc/firewall.user</code> to indicate to fw4 that the script is compatible with nftables.
</p>
<pre class="code bash">config include
	option	enabled		<span class="nu0">1</span>
	option	<span class="kw3">type</span>		<span class="st_h">'script'</span>
	option	path		<span class="st_h">'/etc/firewall.user'</span>
	option	fw4_compatible	<span class="nu0">1</span></pre>

<p>
Options <code>family</code> and <code>reload</code> from fw3 are no longer supported with fw4.
</p>

</div>

<h4 id="default_drop-in_includes">Default drop-in includes</h4>
<div class="level4">

<p>
fw4 includes <code>/etc/nftables.d/*.nft</code> by default, at the beginning of the fw4 table (equivalent to the <code>table-pre</code> position)
</p>

<p>
It means that custom chains can be created by adding a file ending in <code>.nft</code> in the <code>/etc/nftables.d/</code> directory.
</p>

</div>

<h4 id="drop-in_includes_for_package_authors">Drop-in includes for package authors</h4>
<div class="level4">

<p>
For package authors that need custom firewall rules, it is possible to add nftables snippets in the following directories, depending on the desired position:
</p>
<div class="table sectionedit25"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Position </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>/usr/share/nftables.d/ruleset-pre/*.nft</code> </td><td class="col1"> Included at the very beginning, before the fw4 table definition </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>/usr/share/nftables.d/ruleset-post/*.nft</code> </td><td class="col1"> Included at the very end, after the fw4 table definition </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>/usr/share/nftables.d/table-pre/*.nft</code> </td><td class="col1"> Included at the beginning of the fw4 table, before any chain definition </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>/usr/share/nftables.d/table-post/*.nft</code> </td><td class="col1"> Included at the end of the fw4 table, after all chains definition </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>/usr/share/nftables.d/chain-pre/${chain}/*.nft</code> </td><td class="col1"> Included at the beginning of <code>${chain}</code> (a valid fw4 chain name), before rules in this chain </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>/usr/share/nftables.d/chain-post/${chain}/*.nft</code> </td><td class="col1"> Included at the end of <code>${chain}</code> (a valid fw4 chain name), after rules in this chain </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table12&quot;,&quot;secid&quot;:25,&quot;range&quot;:&quot;42325-43099&quot;} -->
<p>
Snippets need to be readable files and their name must end with <code>.nft</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Includes (22.03 and later with fw4)&quot;,&quot;hid&quot;:&quot;includes_2203_and_later_with_fw4&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:22,&quot;range&quot;:&quot;38923-43175&quot;} -->
<h3 class="sectionedit26" id="includes_2102_and_earlier_with_fw3">Includes (21.02 and earlier with fw3)</h3>
<div class="level3">

<p>
It is possible to include custom firewall scripts by specifying one or more <code>include</code> sections in the firewall configuration:
</p>
<pre class="code bash">config include
	option	path		<span class="st_h">'/etc/firewall.user'</span></pre>

<p>
The <code>/etc/firewall.user</code> script is empty by default.
</p>

</div>

<h4 id="options5">Options</h4>
<div class="level4">
<div class="table sectionedit27"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>enabled</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>1</code> </td><td class="col4"> Allows to disable the corresponding include without having to delete the section. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>type</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>script</code> </td><td class="col4"> Specifies the type of the include, can be <code>script</code> for traditional shell script includes or <code>restore</code> for plain files in <em>iptables-restore</em> format. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>path</code> </td><td class="col1"> file name </td><td class="col2"> yes </td><td class="col3"> <code>/etc/firewall.user</code> </td><td class="col4"> Specifies a shell script to execute on boot or firewall restarts. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>family</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <code>any</code> </td><td class="col4"> Specifies the address family (<code>ipv4</code>, <code>ipv6</code> or <code>any</code>) for which the include is called. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>reload</code> </td><td class="col1"> boolean </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Specifies whether the include should be called on reload. This is only needed if the include injects rules into internal chains. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table13&quot;,&quot;secid&quot;:27,&quot;range&quot;:&quot;43496-44293&quot;} -->
<p>
Includes of type <code>script</code> may contain arbitrary commands, for example advanced nftables rules or tc commands required for traffic shaping.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Includes (21.02 and earlier with fw3)&quot;,&quot;hid&quot;:&quot;includes_2102_and_earlier_with_fw3&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:26,&quot;range&quot;:&quot;43176-&quot;} -->