
<h1 class="sectionedit1" id="logging_rejected_packets">Logging rejected packets</h1>
<div class="level1">

<p>
In the standard <a href="/docs/guide-user/firewall/firewall_configuration" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">firewall configuration</a> only REJECTED packets can be logged.
</p>

<p>
The rules documented here can also be added to fw4 using the <a href="/docs/guide-user/firewall/firewall_configuration#includes_for_2203_and_later_with_fw4" class="wikilink1" title="docs:guide-user:firewall:firewall_configuration" data-wiki-id="docs:guide-user:firewall:firewall_configuration">includes</a>.
</p>

<p>
Before choosing to enable logging of REJECTED packets, please consider pros and cons:
</p>
<ul>
<li class="level1"><div class="li"> DROPPED packets are discarded, i.e. “trashed” without further notice. DROPPING packets does not require too much computing power, nor network bandwidth. This is also more resistent to <abbr title="Denial of Service">DoS</abbr> attacks, as no answer is sent.</div>
</li>
<li class="level1"><div class="li"> In comparison, REJECTED packets require more computing power, as an answer is sent to client. Logging REJECTED packets also consume computing power. Logging may also display continuous messages on the serial port if you connect via serial console (not via <abbr title="Secure Shell">SSH</abbr>). You also need another device to log packets, <strong>as logging packets on the same device is not recommended</strong>.</div>
</li>
</ul>

<p>
Here is an example of the <abbr title="Wide Area Network">WAN</abbr> zone:
</p>
<pre class="code bash">config zone
    option name <span class="st_h">'wan'</span>
    ...
    option log <span class="st_h">'1'</span>
    option log_limit <span class="st_h">'10/second'</span></pre>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_info wrap_round plugin_wrap" style="width: 60%;">
<p>
Logging REJECTED packets on the <abbr title="Wide Area Network">WAN</abbr> zone or a zone that is applied to one or more external facing interface may cause an increase in latency due to it requiring additional system resources on your router. i.e. processing power.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} -->
<p>
In these settings, INPUT and FORWARDED packets are logged when REJECTED and
written to system log with a limit of 5 messages per second. The <code>log_limit</code>
maps directly to the netfilter <code>limit</code> match extension which states:
</p>

<p>
<em>This module matches at a limited rate using a token bucket filter. A rule using this extension will match until this limit is reached.  It can be used in combination with the LOG target to give limited  logging.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Logging rejected packets&quot;,&quot;hid&quot;:&quot;logging_rejected_packets&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1874&quot;} -->
<h2 class="sectionedit4" id="logging_configuration_in_luci">Logging configuration in LuCI</h2>
<div class="level2">

<p>
In <em>Firewall → General settings</em>:
</p>
<ul>
<li class="level1"><div class="li"> Make sure that packets are not dropped, only rejected.</div>
</li>
<li class="level1"><div class="li"> Case by case, select “reject” and not “drop”</div>
</li>
</ul>

<p>
In <em>Firewall Zones</em>:
</p>
<ul>
<li class="level1"><div class="li"> <em>→ Advanced settings</em></div>
</li>
<li class="level1"><div class="li"> Check [x] <em>Enable logging on this zone</em></div>
</li>
<li class="level1"><div class="li"> Fill in the <em>Limit log messages</em> value.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Logging configuration in LuCI&quot;,&quot;hid&quot;:&quot;logging_configuration_in_luci&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;1875-2210&quot;} -->
<h2 class="sectionedit5" id="generated_rules">Generated rules</h2>
<div class="level2">

<p>
Use the nftables dump to understand the rules generated by the above firewall configuration.
</p>
<pre class="code bash">fw4 print</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Generated rules&quot;,&quot;hid&quot;:&quot;generated_rules&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;2211-&quot;} -->