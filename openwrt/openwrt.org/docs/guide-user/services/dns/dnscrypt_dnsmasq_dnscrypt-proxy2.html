
<h1 class="sectionedit1" id="dnscrypt_with_dnsmasq_and_dnscrypt-proxy2">DNSCrypt with Dnsmasq and dnscrypt-proxy2</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;DNSCrypt with Dnsmasq and dnscrypt-proxy2&quot;,&quot;hid&quot;:&quot;dnscrypt_with_dnsmasq_and_dnscrypt-proxy2&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-138&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for setting up <a href="https://en.wikipedia.org/wiki/DNSCrypt" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/DNSCrypt">DNSCrypt</a> on OpenWrt.</div>
</li>
<li class="level1"><div class="li"> It relies on <a href="/docs/guide-user/base-system/dhcp.dnsmasq" class="wikilink1" title="docs:guide-user:base-system:dhcp.dnsmasq" data-wiki-id="docs:guide-user:base-system:dhcp.dnsmasq">Dnsmasq</a> and <a href="/packages/pkgdata/dnscrypt-proxy2" class="wikilink1" title="packages:pkgdata:dnscrypt-proxy2" data-wiki-id="packages:pkgdata:dnscrypt-proxy2">dnscrypt-proxy2</a> that supports DNSCrypt v2, <abbr title="Domain Name System">DNS</abbr> over <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr> and Anonymized DNSCrypt.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/firewall/fw3_configurations/intercept_dns" class="wikilink1" title="docs:guide-user:firewall:fw3_configurations:intercept_dns" data-wiki-id="docs:guide-user:firewall:fw3_configurations:intercept_dns">DNS hijacking</a> to intercept <abbr title="Domain Name System">DNS</abbr> traffic or use <a href="/docs/guide-user/services/vpn/start" class="wikilink1" title="docs:guide-user:services:vpn:start" data-wiki-id="docs:guide-user:services:vpn:start">VPN</a> to protect all traffic.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;139-624&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-user:services:dns:dnscrypt_dnsmasq_dnscrypt-proxy&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-user:services:dns:dnscrypt_dnsmasq_dnscrypt-proxy">
<div class="level2">
<ul>
<li class="level1 node"><div class="li"> Encrypt your <abbr title="Domain Name System">DNS</abbr> traffic improving security and privacy.</div>
<ul>
<li class="level2"><div class="li"> Prevent <abbr title="Domain Name System">DNS</abbr> leaks and <abbr title="Domain Name System">DNS</abbr> hijacking.</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Bypass regional restrictions using public <abbr title="Domain Name System">DNS</abbr> providers.</div>
<ul>
<li class="level2"><div class="li"> Escape <abbr title="Domain Name System">DNS</abbr>-based content filters and internet censorship.</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-user:services:dns:dnscrypt_dnsmasq_dnscrypt-proxy&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;625-753&quot;} -->
<h2 class="sectionedit10" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

<p>
Install the required packages.
Enable <abbr title="Domain Name System">DNS</abbr> encryption.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> dnscrypt-proxy2
&nbsp;
<span class="co0"># Enable DNS encryption</span>
service dnsmasq stop
uci <span class="kw1">set</span> dhcp.<span class="sy0">@</span>dnsmasq<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.noresolv=<span class="st0">&quot;1&quot;</span>
uci <span class="kw1">set</span> dhcp.<span class="sy0">@</span>dnsmasq<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.cachesize=<span class="st_h">'0'</span>
uci <span class="re5">-q</span> delete dhcp.<span class="sy0">@</span>dnsmasq<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.server
uci add_list dhcp.<span class="sy0">@</span>dnsmasq<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.server=<span class="st0">&quot;127.0.0.53&quot;</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;32 s/.*/server_names = ['google', 'cloudflare']/&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/*</span>.toml
uci commit dhcp
service dnsmasq start
service dnscrypt-proxy restart
&nbsp;
<span class="co0"># Ensure, that the NTP server can work without DNS</span>
uci del system.ntp.server
uci add_list system.ntp.server=<span class="st_h">'194.177.4.1'</span>    <span class="co0"># 0.openwrt.pool.ntp.org</span>
uci add_list system.ntp.server=<span class="st_h">'213.222.217.11'</span> <span class="co0"># 1.openwrt.pool.ntp.org</span>
uci add_list system.ntp.server=<span class="st_h">'80.50.102.114'</span>  <span class="co0"># 2.openwrt.pool.ntp.org</span>
uci add_list system.ntp.server=<span class="st_h">'193.219.28.60'</span>  <span class="co0"># 3.openwrt.pool.ntp.org</span>
uci commit system</pre>

<p>
<abbr title="Local Area Network">LAN</abbr> clients should use Dnsmasq as a primary resolver.
Dnsmasq forwards <abbr title="Domain Name System">DNS</abbr> queries to dnscrypt-proxy2 which encrypts <abbr title="Domain Name System">DNS</abbr> traffic.
</p>

<p>
Note: These are the recommended options from the <a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation-on-OpenWrt#recommended-tweaks" class="urlextern" title="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation-on-OpenWrt#recommended-tweaks" rel="ugc nofollow">official DNSCrypt guide for OpenWrt on GitHub</a>.
</p>

<p>
Note: Beware that the distributed configuration includes an activated <code>block-names.txt</code>. If you experience problems with some names, match them against this file first.
</p>

<p>
Optional steps suggested by the <a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation-on-OpenWrt#recommended-tweaks" class="urlextern" title="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation-on-OpenWrt#recommended-tweaks" rel="ugc nofollow">official DNSCrypt guide for OpenWrt on GitHub</a>:
</p>
<pre class="code"># Optional: Enable printing logs in syslog
sed -i &quot;183 s/.*/use_syslog = true/&quot; /etc/dnscrypt-proxy2/*.toml
service dnscrypt-proxy restart

# Optional: Disable ISP&#039;s DNS server
uci set network.wan.peerdns=&#039;0&#039;
uci set network.wan6.peerdns=&#039;0&#039;
uci commit network

# Optional: Force LAN clients to send DNS queries to dnscrypt-proxy:
## 1. Divert-DNS, port 53
uci add firewall redirect
uci set firewall.@redirect[-1].dest=&#039;lan&#039;
uci set firewall.@redirect[-1].target=&#039;DNAT&#039;
uci set firewall.@redirect[-1].name=&#039;Divert-DNS, port 53&#039;
uci set firewall.@redirect[-1].src=&#039;wan&#039;
uci set firewall.@redirect[-1].src_dport=&#039;53&#039;
uci set firewall.@redirect[-1].dest_port=&#039;53&#039;
uci commit firewall

## 2. Block DNS-over-TLS over port 853
uci add firewall rule
uci set firewall.@rule[-1].name=&#039;Reject-DoT,port 853&#039;
uci add_list firewall.@rule[-1].proto=&#039;tcp&#039;
uci set firewall.@rule[-1].src=&#039;lan&#039;
uci set firewall.@rule[-1].dest=&#039;wan&#039;
uci set firewall.@rule[-1].dest_port=&#039;853&#039;
uci set firewall.@rule[-1].target=&#039;REJECT&#039;
uci commit firewall

## 3. Optional: Redirect queries for DNS servers running on non-standard ports. For example: 5353
## Warning: don&#039;t use this one if you run an mDNS server
uci add firewall redirect
uci set firewall.@redirect[-1].dest=&#039;lan&#039;
uci set firewall.@redirect[-1].target=&#039;DNAT&#039;
uci set firewall.@redirect[-1].name=&#039;Divert-DNS, port 5353&#039;
uci set firewall.@redirect[-1].src=&#039;lan&#039;
uci set firewall.@redirect[-1].src_dport=&#039;5353&#039;
uci set firewall.@redirect[-1].dest_port=&#039;53&#039;
uci commit firewall

# Remember to reload firewall
/etc/init.d/firewall reload</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;754-3931&quot;} -->
<h2 class="sectionedit11" id="testing">Testing</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-user:services:dns:dot_dnsmasq_dnsproxy&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-user:services:dns:dot_dnsmasq_dnsproxy">
<div class="level2">

<p>
Verify domain name resolution with <a href="http://man.cx/nslookup%281%29" class="interwiki iw_man" title="http://man.cx/nslookup%281%29">nslookup</a>:
</p>
<pre class="code bash">nslookup openwrt.org localhost</pre>

<p>
To check your <abbr title="Domain Name System">DNS</abbr> provider, you can use:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://one.one.one.one/help/" class="urlextern" title="https://one.one.one.one/help/" rel="ugc nofollow">Cloudflare Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://adguard.com/en/test.html" class="urlextern" title="https://adguard.com/en/test.html" rel="ugc nofollow">AdGuard Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://test.nextdns.io/" class="urlextern" title="https://test.nextdns.io/" rel="ugc nofollow"> NextDNS Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://mullvad.net/en/check" class="urlextern" title="https://mullvad.net/en/check" rel="ugc nofollow">Mullvad Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://on.quad9.net/" class="urlextern" title="https://on.quad9.net/" rel="ugc nofollow">Quad9 Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://welcome.opendns.com/" class="urlextern" title="https://welcome.opendns.com/" rel="ugc nofollow">OpenDNS Test</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://www.cloudflare.com/ssl/encrypted-sni/" class="urlextern" title="https://www.cloudflare.com/ssl/encrypted-sni/" rel="ugc nofollow">Cloudflare Browser Check</a></div>
</li>
</ul>

<p>
<abbr title="Domain Name System">DNS</abbr> Leak Test and DNSSEC Test:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://dnsleaktest.com/" class="urlextern" title="https://dnsleaktest.com/" rel="ugc nofollow">DNS Leak Test #1</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://dnscheck.tools/" class="urlextern" title="https://dnscheck.tools/" rel="ugc nofollow">DNS Leak Test #2</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://dnssec-or-not.com/" class="urlextern" title="http://dnssec-or-not.com/" rel="ugc nofollow">DNSSEC Test #1</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://wander.science/projects/dns/dnssec-resolver-test/" class="urlextern" title="https://wander.science/projects/dns/dnssec-resolver-test/" rel="ugc nofollow">DNSSEC Test #2</a></div>
</li>
</ul>

<p>
Alternative test via CLI:
* check connection to Quad9 <abbr title="Domain Name System">DNS</abbr> (it require to use Quad9 <abbr title="Domain Name System">DNS</abbr> servers):
</p>
<pre class="code">dig +short txt proto.on.quad9.net.
# should print: doh. or dot.</pre>

<p>
* check connection to NextDNS (it require to use NextDNS <abbr title="Domain Name System">DNS</abbr> servers):
</p>
<pre class="code">curl -SL https://test.nextdns.io/
{
        &quot;status&quot;: &quot;ok&quot;,
        &quot;protocol&quot;: &quot;DOT&quot;,
        &quot;profile&quot;: &quot;SOMEPROFILE&quot;,
        &quot;client&quot;: &quot;80.XXX.XXX.XXX&quot;,
        &quot;srcIP&quot;: &quot;80.XXX.XXX.XXX&quot;,
        &quot;destIP&quot;: &quot;XX.XX.28.0&quot;,
        &quot;anycast&quot;: true,
        &quot;server&quot;: &quot;zepto-ber-1&quot;,
        &quot;clientName&quot;: &quot;unknown-dot&quot;
}</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-user:services:dns:dot_dnsmasq_dnsproxy&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Testing&quot;,&quot;hid&quot;:&quot;testing&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:11,&quot;range&quot;:&quot;3932-4052&quot;} -->
<h2 class="sectionedit14" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Collect and analyze the following information.
</p>
<pre class="code bash"><span class="co0"># Restart services</span>
service log restart; service dnsmasq restart; service dnscrypt-proxy restart
&nbsp;
<span class="co0"># Log and status</span>
logread <span class="re5">-e</span> dnsmasq; <span class="kw2">netstat</span> <span class="re5">-l</span> <span class="re5">-n</span> <span class="re5">-p</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-e</span> dnsmasq
logread <span class="re5">-e</span> dnscrypt-proxy; <span class="kw2">netstat</span> <span class="re5">-l</span> <span class="re5">-n</span> <span class="re5">-p</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-e</span> dnscrypt-proxy
&nbsp;
<span class="co0"># Runtime configuration</span>
pgrep <span class="re5">-f</span> <span class="re5">-a</span> dnsmasq; pgrep <span class="re5">-f</span> <span class="re5">-a</span> dnscrypt-proxy
<span class="kw2">head</span> <span class="re5">-v</span> <span class="re5">-n</span> <span class="re5">-0</span> <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.<span class="sy0">*</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>resolv.<span class="sy0">*</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>resolv.<span class="sy0">*/*</span>
&nbsp;
<span class="co0"># Persistent configuration</span>
uci show dhcp; <span class="kw2">grep</span> <span class="re5">-v</span> <span class="re5">-e</span> <span class="st0">&quot;^\s*#&quot;</span> <span class="re5">-e</span> <span class="st0">&quot;^\s*$&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/</span>dnscrypt-proxy.toml</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:14,&quot;range&quot;:&quot;4053-4632&quot;} -->
<h2 class="sectionedit15" id="extras">Extras</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:15,&quot;range&quot;:&quot;4633-4651&quot;} -->
<h3 class="sectionedit16" id="doh_and_dnscrypt_provider">DoH and DNSCrypt provider</h3>
<div class="level3">

<p>
<strong>dnscrypt-proxy2</strong> is configured with Google <abbr title="Domain Name System">DNS</abbr> and Cloudflare <abbr title="Domain Name System">DNS</abbr> by default.
You can change it to Google <abbr title="Domain Name System">DNS</abbr> or any other <a href="https://dnscrypt.info/public-servers" class="urlextern" title="https://dnscrypt.info/public-servers" rel="ugc nofollow">DoH or DNSCrypt provider</a>.
Use resolvers supporting DNSSEC validation if necessary.
Specify several resolvers to improve fault tolerance.
</p>
<pre class="code bash"><span class="co0"># Configure DoH or DNSCrypt provider</span>
<span class="co0"># First, we need to set up a list of servers to use, example: (you have to change &quot;exampledns&quot; for the name of the DNS provider)</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;32 s/.*/server_names = ['exampledns', 'exampledns2']/&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/*</span>.toml
service dnscrypt-proxy restart
&nbsp;
<span class="co0"># Or you can also use only one server, example:</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;32 s/.*/server_names = ['cloudflare']/&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/*</span>.toml
service dnscrypt-proxy restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;DoH and DNSCrypt provider&quot;,&quot;hid&quot;:&quot;doh_and_dnscrypt_provider&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:16,&quot;range&quot;:&quot;4652-5457&quot;} -->
<h3 class="sectionedit17" id="odoh_protocol">ODoH protocol</h3>
<div class="level3">

<p>
<strong><a href="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Oblivious-DoH" class="urlextern" title="https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Oblivious-DoH" rel="ugc nofollow">ODoH (Oblivious DNS-over-HTTPS)</a></strong> prevents servers from learning anything about client <abbr title="Internet Protocol">IP</abbr> addresses, by using intermediate <strong>relays</strong> dedicated to forwarding encrypted <abbr title="Domain Name System">DNS</abbr> data.
Instead of directly sending a query to a target <abbr title="DNS over HTTPS">DoH</abbr> server, the client encrypts it for that server, but sends it to a <strong>relay</strong>.
An <strong>ODoH relay</strong> can only communicate with an <strong>ODoH server</strong> and an <strong>ODoH client</strong>. <strong>Relays</strong> can&#039;t get responses from a<strong> generic <abbr title="DNS over HTTPS">DoH</abbr> server</strong> that doesn&#039;t support <strong>ODoH</strong>.
You can change the <a href="https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-servers.md" class="urlextern" title="https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-servers.md" rel="ugc nofollow">ODoH servers</a> and <a href="https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-relays.md" class="urlextern" title="https://github.com/DNSCrypt/dnscrypt-resolvers/blob/master/v3/odoh-relays.md" rel="ugc nofollow">ODoH relays</a> to any other.
</p>
<pre class="code bash"><span class="co0"># Enable ODoH on dnscrypt-proxy2</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;s/.*odoh_servers.*/odoh_servers = true/; 689,700 s/#//&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/*</span>.toml
&nbsp;
<span class="co0"># Configure &quot;ODoH servers&quot; and &quot;ODoH relays&quot;</span>
<span class="re2">odoh_servers</span>=<span class="st0">&quot;['odoh-cloudflare', 'odoh-crypto-sx']&quot;</span>
<span class="re2">odoh_relays</span>=<span class="st0">&quot;['odohrelay-crypto-sx', 'odohrelay-koki-bcn']&quot;</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;32 s/.*/server_names = <span class="es2">$odoh_servers</span>/; 795 s/.*/routes = [/; 797 s/.*/    { server_name='*', via=<span class="es2">$odoh_relays</span> }/; 798 s/.*/]/&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>dnscrypt-proxy2<span class="sy0">/*</span>.toml
service dnscrypt-proxy restart</pre>

<p>
More information about <strong>ODoH protocol</strong>: <a href="https://blog.cloudflare.com/oblivious-dns/" class="urlextern" title="https://blog.cloudflare.com/oblivious-dns/" rel="ugc nofollow">Improving DNS Privacy with Oblivious DoH in 1.1.1.1</a>
</p>

<p>
Caveats: The <strong>Oblivious <abbr title="Domain Name System">DNS</abbr>-over-<abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr></strong> protocol is still a work in progress. Servers and relays may not be very stable.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ODoH protocol&quot;,&quot;hid&quot;:&quot;odoh_protocol&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:17,&quot;range&quot;:&quot;5458-&quot;} -->