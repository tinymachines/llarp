
<h1 class="sectionedit1" id="random_generator">Random generator</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Random generator&quot;,&quot;hid&quot;:&quot;random_generator&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-113&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for optimizing <a href="https://en.wikipedia.org/wiki/Random_number_generation" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Random_number_generation">RNG</a> on OpenWrt.</div>
</li>
<li class="level1"><div class="li"> It may help to minimize system startup time on low performance devices.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;114-315&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">
<ul>
<li class="level1 node"><div class="li"> Minimize startup time for cryptography-dependent services.</div>
<ul>
<li class="level2"><div class="li"> Avoid potential deadlock states and race conditions.</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;316-456&quot;} -->
<h2 class="sectionedit8" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

<p>
Provide fast RNG with rng-tools.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> rng-tools
&nbsp;
<span class="co0"># Configure RNG</span>
uci <span class="kw1">set</span> system.<span class="sy0">@</span>rngd<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.enabled=<span class="st0">&quot;1&quot;</span>
uci commit system
service rngd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;457-695&quot;} -->
<h2 class="sectionedit9" id="testing">Testing</h2>
<div class="level2">

<p>
Test the <a href="https://en.wikipedia.org/wiki/Entropy_(computing)#Practical_implications" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Entropy_(computing)#Practical_implications">entropy</a> pool size.
</p>
<pre class="code bash">sysctl kernel.random.entropy_avail</pre>

<p>
Use <a href="http://man.cx/rngtest%281%29" class="interwiki iw_man" title="http://man.cx/rngtest%281%29">rngtest</a> to check the randomness of data.
</p>
<pre class="code bash"><span class="re2">RNG_DEV</span>=<span class="st0">&quot;<span class="es4">$(uci get system.@rngd[0].device)</span>&quot;</span>
rngtest <span class="re5">-c</span> <span class="nu0">1000</span> <span class="sy0">&lt;</span> <span class="co1">${RNG_DEV}</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Testing&quot;,&quot;hid&quot;:&quot;testing&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:9,&quot;range&quot;:&quot;696-1009&quot;} -->
<h2 class="sectionedit10" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Collect and analyze the following information.
</p>
<pre class="code bash"><span class="co0"># Restart services</span>
service log restart; service rngd restart
&nbsp;
<span class="co0"># Log and status</span>
logread <span class="re5">-e</span> rngd; pgrep <span class="re5">-f</span> <span class="re5">-a</span> rngd
&nbsp;
<span class="co0"># Persistent configuration</span>
uci show system</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:10,&quot;range&quot;:&quot;1010-1263&quot;} -->
<h2 class="sectionedit11" id="extras">Extras</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:11,&quot;range&quot;:&quot;1264-1282&quot;} -->
<h3 class="sectionedit12" id="software_rng">Software RNG</h3>
<div class="level3">

<p>
Use software RNG by default.
</p>
<pre class="code bash"><span class="co0"># Use software RNG</span>
uci <span class="kw1">set</span> system.<span class="sy0">@</span>rngd<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.device=<span class="st0">&quot;/dev/urandom&quot;</span>
uci commit system
service rngd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Software RNG&quot;,&quot;hid&quot;:&quot;software_rng&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:12,&quot;range&quot;:&quot;1283-1460&quot;} -->
<h3 class="sectionedit13" id="hardware_rng">Hardware RNG</h3>
<div class="level3">

<p>
Use hardware RNG if available.
</p>
<pre class="code bash"><span class="co0"># Use hardware RNG</span>
uci <span class="kw1">set</span> system.<span class="sy0">@</span>rngd<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>.device=<span class="st0">&quot;/dev/hwrng&quot;</span>
uci commit system
service urngd disable <span class="sy0">&amp;&amp;</span> service urngd stop
service rngd restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hardware RNG&quot;,&quot;hid&quot;:&quot;hardware_rng&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:13,&quot;range&quot;:&quot;1461-&quot;} -->