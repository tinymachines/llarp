
<h1 class="sectionedit1" id="cifs_client">CIFS Client</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CIFS Client&quot;,&quot;hid&quot;:&quot;cifs_client&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-26&quot;} -->
<h2 class="sectionedit2" id="description">Description</h2>
<div class="level2">

<p>
<a href="https://en.wikipedia.org/wiki/Server Message Block" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Server Message Block">Common Internet File System (CIFS)</a> allows you to mount networked drives. You&#039;ll need a Internet connection for downloading the packages and a computer with CIFS/SAMBA server with some shares.
</p>
<div class="table sectionedit3"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="/_media/meta/icons/tango/dialog-information.png" class="media" loading="lazy" alt="" /> </td><td class="col1"> <strong><em><code>Note1</code>:</em></strong> cifs mount is not compatible with luci (see <a href="https://dev.openwrt.org/ticket/10366" class="urlextern" title="https://dev.openwrt.org/ticket/10366" rel="ugc nofollow">#10366</a>)<br/>
<strong><em><code>Note2</code>:</em></strong> In <a href="https://dev.openwrt.org/changeset/31584" class="urlextern" title="https://dev.openwrt.org/changeset/31584" rel="ugc nofollow">r31584</a> the package <code>cifsmount</code>  was replaced with <code>cifs-utils</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;272-576&quot;} -->
</div>

<h4 id="packages">Packages</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <strong>kmod-fs-cifs</strong> Package is required for the actual mounting of cifs drives.</div>
</li>
<li class="level1"><div class="li"> <strong>cifsmount</strong>  contains a helper program <strong>mount.cifs</strong> which can be used instead of <strong>mount -t cifs</strong> command. Personal note: On Backfire 10.03.1-rc6, I observed that cifsmount is necessary (in addition to kmod-fs-cifs). “mount -t cifs” fails without cifsmount.</div>
</li>
<li class="level1"><div class="li"> <strong>kmod-nls-utf8</strong> <a href="https://en.wikipedia.org/wiki/Native language support" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Native language support">Native language support</a>-Package is required for anonymous/guest access to cifs mounts.  Otherwise, “mount error 83 = Can not access a needed shared library” results.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Description&quot;,&quot;hid&quot;:&quot;description&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;27-1137&quot;} -->
<h2 class="sectionedit4" id="install">Install</h2>
<div class="level2">

</div>

<h5 id="required">Required</h5>
<div class="level5">
<pre class="code bash">opkg <span class="kw2">install</span> kmod-fs-cifs kmod-nls-base</pre>

</div>

<h5 id="optional">Optional</h5>
<div class="level5">
<pre class="code bash">opkg <span class="kw2">install</span> kmod-nls-utf8 kmod-crypto-hmac kmod-crypto-md5 kmod-crypto-misc cifsmount</pre>

<p>
Note: kmod-crypto-misc for md4-hash algorithm --- <em>ivang 2011/11/06 22:12</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Install&quot;,&quot;hid&quot;:&quot;install&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1138-1433&quot;} -->
<h2 class="sectionedit5" id="examples">Examples</h2>
<div class="level2">

<p>
Options required for a successful mount vary by kernel version. Newer kernels require more options for a successful mount.
</p>

<p>
Example of authenticated share with options, kernel 3.14+ 
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> cifs <span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>mnt <span class="re5">-o</span> <span class="re2">username</span>=admin,<span class="re2">password</span>=pwpwpw,<span class="re2">sec</span>=ntlm,<span class="re2">file_mode</span>=0644,<span class="re2">unc</span>=\\\\cifs-server\\share</pre>

<p>
Basic example of authenticated share (no options, may work with old kernels)
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> cifs <span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>localfolder <span class="re5">-o</span> <span class="re2">user</span>=username,<span class="re2">password</span>=password</pre>

<p>
Same as above, but specifies more options
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> cifs <span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>localfolder <span class="re5">-o</span> <span class="re2">unc</span>=\\\\cifs-server\\share,<span class="re2">ip</span>=IP-Address,<span class="re2">user</span>=john,<span class="re2">pass</span>=doe,<span class="re2">dom</span>=workgroup</pre>

<p>
Anonymous or guest share mounting, current 3.14+ kernels:
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> cifs <span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>mnt<span class="sy0">/</span>share <span class="re5">-o</span> <span class="re2">user</span>=,<span class="re2">file_mode</span>=0777,<span class="re2">dir_mode</span>=0777,<span class="re2">unc</span>=\\\\cifs-server\\share</pre>

<p>
Anonymous or guest share mounting, old version.
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> cifs <span class="st_h">'\\cifs-server\share'</span> <span class="sy0">/</span>localfolder <span class="re5">-o</span> guest,<span class="re2">iocharset</span>=utf8,<span class="re2">file_mode</span>=0777,<span class="re2">dir_mode</span>=0777,nounix,noserverino</pre>

<p>
Anonymous or guest share mounting. If you have a problems with mounting CIFS with Anonymous or guest share try this.
Its known bug/issue on kernel 3.8.x. 
</p>
<pre class="code bash">mount.cifs <span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>localfolder <span class="re5">-o</span> guest,<span class="re2">sec</span>=ntlm</pre>

<p>
And for fstab.
</p>
<pre class="code bash"><span class="sy0">//</span>wndr4300<span class="sy0">/</span>extroot <span class="sy0">/</span>mnt cifs <span class="re2">username</span>=root,<span class="re2">password</span>=<span class="nu0">72587258</span>,<span class="re2">sec</span>=ntlm,<span class="re2">file_mode</span>=0777	 <span class="nu0">0</span>	 <span class="nu0">0</span></pre>

<p>
Another example for fstab
</p>
<pre class="code bash"><span class="sy0">//</span>cifs-server<span class="sy0">/</span>share <span class="sy0">/</span>localfolder cifs <span class="re2">credentials</span>=<span class="sy0">/</span>etc<span class="sy0">/</span>samba_pswds_my_share,_netdev,<span class="re2">uid</span>=user,<span class="re2">gid</span>=group <span class="nu0">0</span> <span class="nu0">0</span></pre>

<p>
where credentials file (chmod 0700) is formatted as
</p>
<pre class="code">username=shareuser
password=sharepassword</pre>

<p>
If the <strong>cifsmount</strong> package is installed the <strong>mount.cifs</strong> can be used be instead of <strong>mount -t cifs</strong>.
</p>

<p>
Check <a href="http://linux.die.net/man/8/mount.cifs" class="urlextern" title="http://linux.die.net/man/8/mount.cifs" rel="ugc nofollow">manpage of mount.cifs</a>
</p>

<p>
Note: if you face the error “Value too large for defined data type”, use the option “nounix,noserverino” as per Samba <abbr title="Frequently Asked Questions">FAQ</abbr>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;1434-3452&quot;} -->
<h3 class="sectionedit6" id="throughput_issues">Throughput Issues</h3>
<div class="level3">

<p>
Since <a href="/docs/guide-user/firewall/netfilter-iptables/netfilter" class="wikilink2" title="docs:guide-user:firewall:netfilter-iptables:netfilter" rel="nofollow" data-wiki-id="docs:guide-user:firewall:netfilter-iptables:netfilter">netfilter</a> will track every connection, if you use MASQUERADING for example, you could disable conntrack&#039;ing for data connection:
</p>
<pre class="code">$IPT -t raw -A OUTPUT -o $IF_LAN -s $IP_LAN -p tcp --dport 139 -j CT --notrack #------------------ don&#039;t track SMB
$IPT -t raw -A OUTPUT -o $IF_LAN -s $IP_LAN -p tcp --dport 445 -j CT --notrack #------------------ don&#039;t track SMB
$IPT -t raw -A PREROUTING -o $IF_LAN -s $IP_LAN -p tcp --sport 139 -j CT --notrack #------------------ don&#039;t track SMB
$IPT -t raw -A PREROUTING -o $IF_LAN -s $IP_LAN -p tcp --sport 445 -j CT --notrack #------------------ don&#039;t track SMB</pre>

<p>
Note this is not the same as for the server, the source and destination ports differ. The INPUT is for when you read from the remote filesystem and the OUTPUT for when you write to it.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Throughput Issues&quot;,&quot;hid&quot;:&quot;throughput_issues&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:6,&quot;range&quot;:&quot;3453-&quot;} -->