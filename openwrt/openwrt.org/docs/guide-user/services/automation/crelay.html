
<h1 class="sectionedit1" id="crelay">Crelay</h1>
<div class="level1">

<p>
This software is intended to run on Linux systems to control USB relay cards from different manufacturers in a unified way. It provides several interfaces for controlling the relays locally or remotely via the network. The relays can be controlled by a human being via a device like smartphone or web browser, or directly by an intelligent device as used in the Internet of Things.
</p>

<p>
New relay cards support can be added by providing the cards driver code for detecting the card, reading and setting the relays. Currently the following relay cards are supported:
</p>
<ul>
<li class="level1"><div class="li">     Conrad USB 4-channel relay card, see Note 1 below</div>
</li>
<li class="level1"><div class="li">     Sainsmart USB 4/8-channel relay card, see Note 2 below</div>
</li>
<li class="level1"><div class="li">     HID <abbr title="Application Programming Interface">API</abbr> compatible relay cards (1/2/4/8 channel), Chinese USB relay cards, see below for some images of them.</div>
</li>
<li class="level1"><div class="li">     Sainsmart USB 16-channel relay control module</div>
</li>
<li class="level1"><div class="li">     Generic GPIO controlled relays, see Note 3 below</div>
</li>
</ul>

<p>
The used relay card is automatically detected. No complicated port or communication parameter settings required. Just plug in your card and play.
</p>

<p>
The following picture shows a high level view on the modular software architecture.
</p>

<p>
<a href="/_detail/docs/guide-user/services/automation/sw-architecture.png?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:sw-architecture.png"><img src="/_media/docs/guide-user/services/automation/sw-architecture.png" class="media" loading="lazy" alt="" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Crelay&quot;,&quot;hid&quot;:&quot;crelay&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1232&quot;} -->
<h2 class="sectionedit2" id="features">Features</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li">     Command line mode and daemon mode with Web <abbr title="Graphical User Interface">GUI</abbr></div>
</li>
<li class="level1"><div class="li">     Automatic detection of relay card</div>
</li>
<li class="level1"><div class="li">     Reading of current relay states</div>
</li>
<li class="level1"><div class="li">     Setting of new relay states</div>
</li>
<li class="level1"><div class="li">     Single pulse generation on relay contact</div>
</li>
<li class="level1"><div class="li">     <abbr title="Hypertext Transfer Protocol">HTTP</abbr> <abbr title="Application Programming Interface">API</abbr> for external clients (e.g. Smartphone/tablet apps)</div>
</li>
<li class="level1"><div class="li">     Multiple relay card type support</div>
</li>
<li class="level1"><div class="li">     Support for configuration file with custom parameters</div>
</li>
<li class="level1"><div class="li">     Multiple cards support (command line interface only)</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Features&quot;,&quot;hid&quot;:&quot;features&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1233-1710&quot;} -->
<h2 class="sectionedit3" id="web_gui">Web GUI</h2>
<div class="level2">

<p>
The web <abbr title="Graphical User Interface">GUI</abbr> is accessible at port <strong>8000</strong> (by default), so if your device has <abbr title="Internet Protocol">IP</abbr> <strong>192.168.1.1</strong>, you can access it by writing <strong>192.168.1.1:8000</strong> in your browser address bar.
</p>

<p>
<a href="/_detail/docs/guide-user/services/automation/crelay-screenshot1.png?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:crelay-screenshot1.png"><img src="/_media/docs/guide-user/services/automation/crelay-screenshot1.png" class="media" loading="lazy" alt="" /></a>
<a href="/_detail/docs/guide-user/services/automation/crelay-screenshot2.png?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:crelay-screenshot2.png"><img src="/_media/docs/guide-user/services/automation/crelay-screenshot2.png" class="media" loading="lazy" alt="" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web GUI&quot;,&quot;hid&quot;:&quot;web_gui&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1711-2041&quot;} -->
<h2 class="sectionedit4" id="command_line_interface">Command line interface</h2>
<div class="level2">
<pre class="code">$ crelay 
crelay, version 0.11

This utility provides a unified way of controlling different types of relay cards.
Currently supported relay cards:
  - Conrad USB 4-channel relay card
  - Sainsmart USB 4/8-channel relay card
  - HID API compatible relay card
  - Sainsmart USB-HID 16-channel relay card
  - Generic GPIO relays
The card which is detected first will be used, unless -s switch and a serial number is passed.

The program can be run in interactive (command line) mode or in daemon mode with
built-in web server.

Interactive mode:
    crelay [-s &lt;serial number&gt;] -i | [&lt;relay number&gt;] [ON|OFF]

       The state of any relay can be read or it can be changed to a new state.
       If only the relay number is provided then the current state is returned,
       otherwise the relays state is set to the new value provided as second parameter.
       The USB communication port is auto detected. The first compatible device
       found will be used, unless -s switch and a serial number is passed.

Daemon mode:
    crelay -d [&lt;relay1_label&gt; [&lt;relay2_label&gt; [&lt;relay3_label&gt; [&lt;relay4_label&gt;]]]] 

       In daemon mode the built-in web server will be started and the relays
       can be completely controlled via a Web browser GUI or HTTP API.
       Optionally a personal label for each relay can be supplied which will
       be displayed next to the relay name on the web page.

       To access the web interface point your Web browser to the following address:
       http://&lt;my-ip-address&gt;:8000

       To use the HTTP API send a POST or GET request from the client to this URL:
       http://&lt;my-ip-address&gt;:8000/gpio</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command line interface&quot;,&quot;hid&quot;:&quot;command_line_interface&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2042-3730&quot;} -->
<h2 class="sectionedit5" id="configuration_file_default">Configuration file (default)</h2>
<div class="level2">

<p>
Crelay isn&#039;t integrated in UCI, its configuration file can be found in <strong>/etc/crelay.conf</strong>
</p>
<pre class="code">################################################
#
# crelay config file
#
# This file is read by crelay in daemon mode
# from /etc/crelay.conf
#
################################################

# HTTP server parameters
################################################
[HTTP server]
server_iface = 0.0.0.0    # listen interface IP address
#server_iface = 127.0.0.1 # to listen on localhost only
server_port  = 8000       # listen port
relay1_label = Device 1   # label for relay 1
relay2_label = Device 2   # label for relay 2
relay3_label = Device 3   # label for relay 3
relay4_label = Device 4   # label for relay 4
relay5_label = Device 5   # label for relay 5
relay6_label = Device 6   # label for relay 6
relay7_label = Device 7   # label for relay 7
relay8_label = Device 8   # label for relay 8

# GPIO driver parameters
################################################
[GPIO drv]
#num_relays = 8    # Number of GPIOs connected to relays (1 to 8)
#relay1_gpio_pin = 17   # GPIO pin for relay 1 (17 for RPi GPIO0)
#relay2_gpio_pin = 18   # GPIO pin for relay 2 (18 for RPi GPIO1)
#relay3_gpio_pin = 27   # GPIO pin for relay 3 (27 for RPi GPIO2)
#relay4_gpio_pin = 22   # GPIO pin for relay 4 (22 for RPi GPIO3)
#relay5_gpio_pin = 23   # GPIO pin for relay 5 (23 for RPi GPIO4)
#relay6_gpio_pin = 24   # GPIO pin for relay 6 (24 for RPi GPIO5)
#relay7_gpio_pin = 25   # GPIO pin for relay 7 (25 for RPi GPIO6)
#relay8_gpio_pin = 4    # GPIO pin for relay 8 ( 4 for RPi GPIO7)

# Sainsmart driver parameters
################################################
[Sainsmart drv]
num_relays = 4   # Number of relays on the Sainsmart card (4 or 8)</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration file (default)&quot;,&quot;hid&quot;:&quot;configuration_file_default&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;3731-5527&quot;} -->
<h2 class="sectionedit6" id="http_api">HTTP API</h2>
<div class="level2">

<p>
An <abbr title="Hypertext Transfer Protocol">HTTP</abbr> <abbr title="Application Programming Interface">API</abbr> is provided to access the server from external clients. This <abbr title="Application Programming Interface">API</abbr> is compatible with the PiRelay Android app. Therefore the app can be used on your Android phone to control crelay remotely.
</p>

<p>
Note: the author of this app seems to have removed the free version of the app from the Google Play Store (leaving only the PRO version). For this reason and the fact that PiRelay is not open source I am considering to develop a dedicated crelay Android app. This will use a more universal Json format based <abbr title="Application Programming Interface">API</abbr>. Any volunteers who want to contribute to this app are very welcome.
</p>

<p>
<abbr title="Application Programming Interface">API</abbr> url:
</p>
<pre class="code">    ip_address[:port]/gpio</pre>

<p>
Method:
</p>
<pre class="code">    POST or GET</pre>
<ul>
<li class="level1"><div class="li"> Reading relay states<br/>
   Required Parameter: none</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> Setting relay state<br/>
    Required Parameter: <pre class="code">pin=[1|2|3|4], status=[0|1|2] where 0=off 1=on 2=pulse</pre>
</div>
</li>
</ul>

<p>
Response from server:
</p>
<pre class="code">    Relay 1:[0|1]
    Relay 2:[0|1]
    Relay 3:[0|1]
    Relay 4:[0|1]</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;HTTP API&quot;,&quot;hid&quot;:&quot;http_api&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:6,&quot;range&quot;:&quot;5528-6507&quot;} -->
<h2 class="sectionedit7" id="source_repository">Source repository</h2>
<div class="level2">

<p>
<a href="https://github.com/ondrej1024/crelay" class="urlextern" title="https://github.com/ondrej1024/crelay" rel="ugc nofollow">In this github repo</a> you find the source and the bugtracker for crelay.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Source repository&quot;,&quot;hid&quot;:&quot;source_repository&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:7,&quot;range&quot;:&quot;6508-6650&quot;} -->
<h2 class="sectionedit8" id="images_of_chinese_usb_relays">Images of chinese USB relays</h2>
<div class="level2">

<p>
These usb relays are pretty cheap and can be found on ebay. They all have an Atmel microcontroller onboard (Attiny or Atmega depending on number of relays), which does USB 1.1 emulation on 2 pins to receive commands and uses its other pins to control the relays.<br/>

They are available in many sizes, from 1 to 8 relays.
On smaller 1 and 2 channel boards there are 2 holes where you can solder wires or connectors for an auxiliary 5V power source, in case your device can&#039;t provide enough power to operate all relays through the USB port.<br/>

The 4 and 8 relay boards have a normal barrel power socket and a contact block with screws for bare wires, as you can&#039;t operate all relays at the same time with only a USB 2.0 500mA power supply.
</p>

<p>
As all things chinese, they can have minor board differences (colors and layout) but most use the same firmware for the microcontroller, so they are plug-and-play.
</p>

<p>
Some sellers also list the protocol/commands or provide libraries/source to connect a software to their product, so if they are not supported out of the box by crelay, they can be added easily to it.
</p>

<p>
These devices were tested personally, and work out of the box:<br/>

<a href="/_detail/docs/guide-user/services/automation/usb_relay.jpg?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:usb_relay.jpg"><img src="/_media/docs/guide-user/services/automation/usb_relay.jpg?w=400&amp;tok=0de63d" class="media" loading="lazy" alt="" width="400" /></a>
<a href="/_detail/docs/guide-user/services/automation/usb_relay-side.jpg?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:usb_relay-side.jpg"><img src="/_media/docs/guide-user/services/automation/usb_relay-side.jpg?w=400&amp;tok=5aa365" class="media" loading="lazy" alt="" width="400" /></a>
<a href="/_detail/docs/guide-user/services/automation/usb_relay_group.jpg?id=docs%3Aguide-user%3Aservices%3Aautomation%3Acrelay" class="media" title="docs:guide-user:services:automation:usb_relay_group.jpg"><img src="/_media/docs/guide-user/services/automation/usb_relay_group.jpg?w=400&amp;tok=cf63ef" class="media" loading="lazy" alt="" width="400" /></a>
</p>

<p>
They can be found on ebay by searching for “<strong>usb relay 5V</strong>”, and usually come from chinese sellers.<br/>

The “usb delay relays” boards were not tested so I don&#039;t know if they work without adjustments.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Images of chinese USB relays&quot;,&quot;hid&quot;:&quot;images_of_chinese_usb_relays&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:8,&quot;range&quot;:&quot;6651-&quot;} -->