
<h1 class="sectionedit1" id="python">Python</h1>
<div class="level1">

<p>
Python is a widely used general-purpose, high-level programming language. Its design philosophy emphasizes code readability, and its syntax allows programmers to express concepts in fewer lines of code than would be possible in languages such as C++ or Java. 
</p>

<p>
There are three main Python packages for OpenWrt; <em>python</em>, <em>python3</em> and  <em>micropython</em>.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_alert plugin_wrap" style="width: 60%;">
<p>
Main <em>python</em> package is much larger than <em>python-mini</em> and <em>python-light</em> packages so we suggest that you don&#039;t even try to install full version unless you have at least 50MB of free space on your flash storage.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_info plugin_wrap" style="width: 60%;">
<p>
If you are using Chaos Calmer then <em>python-mini</em> package is replaced by <em>python-light</em> package. Currently <em>python</em> package adds a lot of dependencies so we suggest that you don&#039;t even try to install full version, unless you have at least 50MB of free space on your flash storage.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Python&quot;,&quot;hid&quot;:&quot;python&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-963&quot;} -->
<h2 class="sectionedit6" id="changes_in_naming_since_chaos_calmer">Changes in naming since Chaos Calmer</h2>
<div class="level2">

<p>
After Barrier Breaker <em>python</em> package became:
</p>
<ul>
<li class="level1"><div class="li"> <strong>python-base</strong> - just the minimal to have a python interpreter running</div>
</li>
<li class="level1"><div class="li"> <strong>python-light</strong> - is a “dynamic” package; it&#039;s python (full) minus all other python-codecs, python-compiler, etc</div>
</li>
<li class="level1"><div class="li"> <strong>python</strong> - full python install, minus a few stuff that could be stripped [to reduce size], like tests [per module],  some python-tk/tcl [<abbr title="Graphical User Interface">GUI</abbr>] libs</div>
</li>
</ul>

<p>
The idea of <strong>python-light</strong> is that, whenever you move a Python built-in module from python-light into a separate package (like python-codecs), python-light gets lighter.
The mechanism is fairly dynamic; you just need to add a new &#039;python-package-xxxxxxx.mk&#039; file with some basic Makefile rules, and that&#039;s it.
</p>

<p>
People can choose to install <strong>python-base</strong> if they need like really-really-really-really basic python (a = b + c and maybe some other syntax).
Then they can choose to install other optional packages.
</p>

<p>
All other packages depend on <strong>python-light</strong>, because that one has some common libs.
</p>

<p>
The above is also true for python3.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Changes in naming since Chaos Calmer&quot;,&quot;hid&quot;:&quot;changes_in_naming_since_chaos_calmer&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;964-2050&quot;} -->
<h2 class="sectionedit7" id="make_python_code_run_much_faster_by_pre-compiling_python_py_modules_into_pyc">Make Python code run much faster by pre-compiling python py modules into pyc</h2>
<div class="level2">

<p>
To compile all python modules into pyc issue this command:
</p>
<pre class="code">python -m compileall</pre>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_important plugin_wrap" style="width: 60%;">
<p>
Make sure you have at least 7MB of free space on your internal storage!
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} -->
<p>
Now my python scripts start under 1.5 seconds and previously it would take them 6-8 seconds!
</p>

<p>
If you have additional python modules installed you need to compile them also, so for me I needed to additionally run these commands:
</p>
<pre class="code">python -m compileall /usr/lib/python2.7/site-packages/serial/*.py
python -m compileall /usr/lib/python2.7/site-packages/serial/tools/*.py
python -m compileall /usr/lib/python2.7/site-packages/serial/urlhandler/*.py</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Make Python code run much faster by pre-compiling python py modules into pyc&quot;,&quot;hid&quot;:&quot;make_python_code_run_much_faster_by_pre-compiling_python_py_modules_into_pyc&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2051-2808&quot;} -->
<h2 class="sectionedit10" id="installing_python">Installing Python</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installing Python&quot;,&quot;hid&quot;:&quot;installing_python&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;2809-2839&quot;} -->
<h3 class="sectionedit11" id="storage_use">Storage use</h3>
<div class="level3">

</div>

<h4 id="barrier_breaker_and_earlier">Barrier Breaker and earlier</h4>
<div class="level4">

<p>
<em>python-mini</em> uses around 1.5 <abbr title="Megabyte">MB</abbr> of compressed space on squashfs /overlay partition or 4.5 <abbr title="Megabyte">MB</abbr> uncompressed in /tmp (tmpfs ram) partition.
</p>

<p>
To install python mini just use:
</p>
<pre class="code">opkg update
opkg install python-mini</pre>

</div>

<h4 id="chaos_calmer_and_later">Chaos Calmer and later</h4>
<div class="level4">

<p>
<em>python-light</em> uses around 7.2 <abbr title="Megabyte">MB</abbr> of space.
</p>

<p>
To install <em>python-light</em> just use:
</p>
<pre class="code">opkg update
opkg install python-light</pre>

<p>
<strong>Note:</strong> all these sizes are arbitrary and have been obtained from building an <strong>ar71xx</strong> image.
</p>

<p>
At the time of writing this doc (3rd of July), the <strong>python</strong> package is comprised of
</p>
<ul>
<li class="level1"><div class="li"> <strong>python-base</strong> - takes up around 2.2 <abbr title="Megabyte">MB</abbr> - you really cannot go any lower than this with Python to run</div>
</li>
<li class="level2"><div class="li"> <strong>python-light</strong> - (adds 5.0 <abbr title="Megabyte">MB</abbr>) is <strong>python-base</strong> + a few python libs that have not been stripped out Python&#039;s default lib dir (like the ones below) ; all of the libs presented below take up a few hundred (or more) KB, which add up (especially when counting up dependencies) and are not used by everyone ; takes around 4 <abbr title="Megabyte">MB</abbr> which is a lot of your flash size is 4-8-16-32 <abbr title="Megabyte">MB</abbr>, but at least </div>
</li>
</ul>

<p>
All packages below, depend on <strong>python-light</strong>, so if you decide to install any of them, you&#039;ll get <strong>python-light</strong> too.
</p>
<ul>
<li class="level1"><div class="li"> <strong>python-codecs</strong> - (3 <abbr title="Megabyte">MB</abbr>) the <em>import codecs</em> lib</div>
</li>
<li class="level2"><div class="li"> <strong>python-compiler</strong> - (240k) compiler lib support, for working with compiler paths/env vars</div>
</li>
<li class="level2"><div class="li"> <strong>python-ctypes</strong> - (580k + 44k libffi) ctypes lib/support ; this is also install the <strong>libffi</strong> lib</div>
</li>
<li class="level2"><div class="li"> <strong>python-db</strong> - (584k + 992k libdb-47) Berkley DB support; this also installs the <strong>libdb-47</strong> package</div>
</li>
<li class="level2"><div class="li"> <strong>python-decimal</strong> - (248k) - decimal support lib/logic ; it&#039;s pretty useful for abstracting numeric logic (floats and stuff) away from machine-dependant floats ; it is fairly big though just for decimals</div>
</li>
<li class="level2"><div class="li"> <strong>python-distutils</strong> - (1.7 <abbr title="Megabyte">MB</abbr>) support for packaging for various distributions, and various distro-type support</div>
</li>
<li class="level2"><div class="li"> <strong>python-email</strong> - (768K) email libs/logic</div>
</li>
<li class="level2"><div class="li"> <strong>python-logging</strong> - (180k) <em>import logging</em></div>
</li>
<li class="level2"><div class="li"> <strong>python-multiprocessing</strong> - (264k)</div>
</li>
<li class="level2"><div class="li"> <strong>python-ncurses</strong> - (169k + 304k libncurses) support for <strong>libncurses</strong> ( not <strong>libncursesw</strong> ) ; also install <strong>libncuses</strong></div>
</li>
<li class="level2"><div class="li"> <strong>python-openssl</strong> - (140k + 1.9M libopenssl) Python can be compiled with <abbr title="Secure Socket Layer">SSL</abbr> support, but not have this lib around; this lib is also used for MD5 and some SHA hash stuff; it also installs <strong>libopenssl</strong>, but on a devices where you need this, you&#039;d typically already have it installed</div>
</li>
<li class="level2"><div class="li"> <strong>python-pydoc</strong> - (640k) generation of doc pages from Python comments</div>
</li>
<li class="level2"><div class="li"> <strong>python-sqlite3</strong> - (240k + 616k) also installs <strong>libsqlite3</strong></div>
</li>
<li class="level2"><div class="li"> <strong>python-unittest</strong> - (400k) unit-test support</div>
</li>
<li class="level2"><div class="li"> <strong>python-xml</strong> - (692k + 984k libxml2) basic XML support ; Python&#039;s XML support is not that great anyway; this installs <strong>libxml2</strong> too</div>
</li>
</ul>

<p>
There is no general recipe that works for everyone and keeps Python small, so anyone wanting Python on a device will have to install it step-by-step depending on the features you&#039;d want.
</p>

<p>
We hope <strong>python-light</strong> will accommodate most needs. This package will become lighter if it makes sense to split some other lib out of it.
</p>

</div>

<h4 id="installing_python_into_tmpfs_ram_drive">Installing Python into tmpfs RAM drive</h4>
<div class="level4">

<p>
If you don&#039;t have at least 7.5 <abbr title="Megabyte">MB</abbr> of free space on your / partition (check with “df -h”) then install <em>python-mini</em> or <em>python-light</em> to your /tmp ram drive with:
</p>

<p>
Barrier Breaker:
</p>
<pre class="code">opkg update
opkg install python-mini -d ram
export PATH=$PATH:/tmp/usr/bin/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/tmp/usr/lib/</pre>

<p>
Chaos Calmer and later:
</p>
<pre class="code">opkg update
opkg install python-light -d ram
export PATH=$PATH:/tmp/usr/bin/
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/tmp/usr/lib/</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Storage use&quot;,&quot;hid&quot;:&quot;storage_use&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:11,&quot;range&quot;:&quot;2840-6595&quot;} -->
<h2 class="sectionedit12" id="installing_python3">Installing Python3</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installing Python3&quot;,&quot;hid&quot;:&quot;installing_python3&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:12,&quot;range&quot;:&quot;6596-6628&quot;} -->
<h2 class="sectionedit13" id="building_pythonpython3">Building Python/Python3</h2>
<div class="level2">

<p>
Python is part of the package feeds, so you need to make sure you have the Packages feed configured in feeds.conf or feeds.conf.default.
</p>
<pre class="code">src-git packages https://github.com/openwrt/packages.git</pre>

<p>
And then:
</p>
<pre class="code">cd &lt;your-openwrt-folder&gt;
./scripts/feeds update packages 
./scripts/feeds install python &lt;or python3 if you want that too&gt;</pre>

<p>
Then you should have Python (and/or Python3) in your <strong>make menuconfig</strong> under <strong>Languages =⇒ Python</strong>
</p>

<p>
Note that you&#039;ll get a lot of Python/Python3 packages, as the ones detailed above, as they&#039;ve been split to reduce size.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Building Python\/Python3&quot;,&quot;hid&quot;:&quot;building_pythonpython3&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:13,&quot;range&quot;:&quot;6629-&quot;} -->