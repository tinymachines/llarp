
<h1 class="sectionedit1" id="single_packet_authorization_with_fwknop">Single Packet Authorization with Fwknop</h1>
<div class="level1">

<p>
Fwknop (FireWall KNock OPerator) provides support for Single Packet Authorization (SPA).<br/>

Fwknop is a modern and more secure replacement for <a href="/docs/guide-user/services/remote_control/portknock.server" class="wikilink1" title="docs:guide-user:services:remote_control:portknock.server" data-wiki-id="docs:guide-user:services:remote_control:portknock.server">port knocking</a>.<br/>

More information can be found at <a href="https://www.cipherdyne.org/fwknop/" class="urlextern" title="https://www.cipherdyne.org/fwknop/" rel="ugc nofollow">https://www.cipherdyne.org/fwknop/</a> <br/>

Detailed tutorial at <a href="https://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html" class="urlextern" title="https://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html" rel="ugc nofollow">https://www.cipherdyne.org/fwknop/docs/fwknop-tutorial.html</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Single Packet Authorization with Fwknop&quot;,&quot;hid&quot;:&quot;single_packet_authorization_with_fwknop&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-435&quot;} -->
<h2 class="sectionedit2" id="clients">Clients</h2>
<div class="level2">

<p>
A client is required to open ports on the router configured with Fwknopd (Fwknop server).
</p>
<ul>
<li class="level1"><div class="li"> <strong>CLI (Command Line Interface)</strong> client is known as fwknop or fwknop-client which is available in most Linux distribution <a href="https://en.wikipedia.org/wiki/package manager" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/package manager">package manager</a>s, including OpenWrt. It can also be used on MacOS natively and on Windows using <a href="https://en.wikipedia.org/wiki/Cygwin" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Cygwin">Cygwin</a>.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Smart Phone</strong> client is called fwknop2, which is available on the <a href="https://play.google.com/store/apps/details?id=org.cipherdyne.fwknop2" class="urlextern" title="https://play.google.com/store/apps/details?id=org.cipherdyne.fwknop2" rel="ugc nofollow">Google Play Store</a>. There does not appear to be an iPhone client currently available.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Desktop/Server</strong> client is known as <a href="https://incomsystems.biz/fwknop-gui/" class="urlextern" title="https://incomsystems.biz/fwknop-gui/" rel="ugc nofollow">fwknop-gui</a>, which is cross-platform. It is available at <a href="https://incomsystems.biz/fwknop-gui/" class="urlextern" title="https://incomsystems.biz/fwknop-gui/" rel="ugc nofollow">https://incomsystems.biz/fwknop-gui/</a> for Linux, MacOS, and Windows for manual installation or on most Linux distributions it is available in the package manager.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Clients&quot;,&quot;hid&quot;:&quot;clients&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;436-1323&quot;} -->
<h2 class="sectionedit3" id="configuration">Configuration</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1324-1349&quot;} -->
<h3 class="sectionedit4" id="installation">Installation</h3>
<div class="level3">

<p>
The easiest way to get the Fwknop server running is to install luci-app-fwknopd
</p>

<p>
<a href="/_detail/media/doc/howtos/fwknop-install-luci-app.png?id=docs%3Aguide-user%3Aservices%3Afwknop" class="media" title="media:doc:howtos:fwknop-install-luci-app.png"><img src="/_media/media/doc/howtos/fwknop-install-luci-app.png?w=600&amp;tok=1a3d05" class="mediacenter" loading="lazy" title="


" alt="


" width="600" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1350-1514&quot;} -->
<h3 class="sectionedit5" id="configuration1">Configuration</h3>
<div class="level3">

<p>
The Luci app installation will automatically generate a set of keys. The qr code, at the top of the settings page, contains the two keys and can be used to import keys into the fwknop Android app. Once you have configured the settings as required, you will need to tick the <strong>Enable config overwrite</strong> checkbox at the top.
</p>

<p>
<a href="/_detail/media/doc/howtos/fwknop-enable-settings.png?id=docs%3Aguide-user%3Aservices%3Afwknop" class="media" title="media:doc:howtos:fwknop-enable-settings.png"><img src="/_media/media/doc/howtos/fwknop-enable-settings.png?w=400&amp;tok=5a8b0b" class="mediacenter" loading="lazy" alt="" width="400" /></a>
</p>

<p>
The following settings can be configured from the Luci app, with a few that are configured by default. The only setting you should modify is OPEN_PORTS to restrict the required ports. Usually you would only allow <abbr title="Secure Shell">SSH</abbr> or <abbr title="Hypertext Transfer Protocol Secure">HTTPS</abbr> access to the router.
</p>

<p>
<a href="/_detail/media/doc/howtos/fwknop-settings.png?id=docs%3Aguide-user%3Aservices%3Afwknop" class="media" title="media:doc:howtos:fwknop-settings.png"><img src="/_media/media/doc/howtos/fwknop-settings.png?w=600&amp;tok=706b16" class="mediacenter" loading="lazy" alt="" width="600" /></a>
</p>

<p>
<strong>SOURCE</strong> defines the <abbr title="Internet Protocol">IP</abbr> or IPs that are allowed to send valid SPA packets.  If an otherwise valid packet arrives from an <abbr title="Internet Protocol">IP</abbr> not listed, it will be ignored. The default value is ANY, which indicates that any source <abbr title="Internet Protocol">IP</abbr> can be valid.
</p>

<p>
<strong>KEY_BASE64</strong> or <strong>KEY</strong> defines the primary key used to generate and validate the SPA packet. This will be automatically generated by default.
</p>

<p>
<strong>Key type</strong> indicates whether the HMAC key is plaintext or Base64 encoded.  A Base64 key is translated to Binary, which allows for a larger keyspace than a plain text key.
</p>

<p>
<strong>HMAC_KEY_BASE64</strong> or <strong>HMAC_KEY</strong> defines the HMAC message verification key.  This field is optional and can be left blank to indicate no HMAC verification. Recommended to leave the default setting.
</p>

<p>
<strong>HMAC Key type</strong> indicates whether the HMAC key is plaintext or Base64 encoded.
</p>

<p>
<strong>OPEN_PORTS</strong> defines the protocol and port to open when a valid SPA packet is received.  If left blank, this information will be derived from the SPA packet.  If populated, this must be in the format of protocol/portnumber e.g. <em><strong>tcp/22</strong></em> or <em><strong>udp/22</strong></em>.
</p>

<p>
<strong>FW_ACCESS_TIMEOUT</strong> defines in seconds the length of time that a port will remain open by default.  Note that even after the port closes, the established connection will persist until terminated.
</p>

<p>
<strong>REQUIRE_SOURCE_ADDRESS</strong> causes the server to require the source <abbr title="Internet Protocol">IP</abbr> to be included in the SPA packet.
</p>

<p>
<strong>MAX_SPA_PACKET_AGE</strong> defines the maximum age in seconds that the server will accept requests. If left blank, it will default to 120 seconds.
</p>

<p>
<strong>PCAP_INTF</strong> dictates which interface Fwknop will listen on. The Luci app will try to select the correct interface on installation, based on which is the <abbr title="Wide Area Network">WAN</abbr> port.
</p>

<p>
<strong>ENABLE_IPT_FORWARDING</strong> defines whether an SPA packet can trigger port forwarding through to an internal host.  Defaults to “y”.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;1515-4069&quot;} -->
<h2 class="sectionedit6" id="debug">Debug</h2>
<div class="level2">

<p>
The best way to debug what is happening with fwknopd is to run it as follows:
</p>
<pre class="code">fwknopd -f -v -i eth0</pre>

<p>
This will not start the fwknopd daemon, but start the app against eth0 so you can see debugging output on the console.
You might need to change that interface depending on your setup.
Now, with fwknopd running, go ahead and run the fwknop client. You will see verbose information about:
- SPA packet specifics.
- If it successfully authenticates/decrypts: corresponding iptables commands that fwknopd executes (to grant access to whatever service you are requesting with the client)
You can stop debugging by pressing Ctrl+C
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Debug&quot;,&quot;hid&quot;:&quot;debug&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;4070-&quot;} -->