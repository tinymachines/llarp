
<h1 class="sectionedit1" id="freeswitch_on_openwrt_intro">FreeSWITCH on OpenWrt intro</h1>
<div class="level1">

<p>
This page is meant to provide some basic information about FreeSWITCH on OpenWrt. Visit the official <a href="https://freeswitch.org/confluence/display/FREESWITCH/FreeSWITCH+Explained" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/FreeSWITCH+Explained" rel="ugc nofollow">FreeSWITCH wiki</a> to find out more about FreeSWITCH in particular.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_round wrap_important plugin_wrap">
<p>
<strong>Telephony systems like FreeSWITCH are targeted by criminals to commit toll fraud. If you fall victim to toll fraud this can cost you a lot of money. You are responsible for the security of your sytem. Make sure all security measures are in place before bringing FreeSWITCH online.</strong>
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;FreeSWITCH on OpenWrt intro&quot;,&quot;hid&quot;:&quot;freeswitch_on_openwrt_intro&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-605&quot;} -->
<h2 class="sectionedit4" id="freeswitch_init_configuration">freeswitch init configuration</h2>
<div class="level2">

<p>
The file <code>/etc/config/freeswitch</code> contains the general on/off switch - FreeSWITCH is disabled by default. Here you can also change the command line switches that are used when starting FreeSWITCH. E.g. you can set the directories for recordings and logs etc.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_round wrap_important plugin_wrap">
<p>
<strong>WARNING: FreeSWITCH writes to its databases constantly. Constant writes will quickly kill your device&#039;s integrated flash memory.</strong><br/>

</p>

<p>
It&#039;s recommended to keep the databases on external storage (see <a href="/docs/guide-user/storage/usb-drives" class="wikilink1" title="docs:guide-user:storage:usb-drives" data-wiki-id="docs:guide-user:storage:usb-drives">Using storage devices</a>).<br/>

</p>

<p>
If that is not possible they can also be kept in the device&#039;s RAM (working memory), on a <em>tmpfs</em> filesystem (<code>/tmp</code> is mounted as a <em>tmpfs</em> file system on OpenWrt devices). RAM memory is not subject to constant writing wear like flash memory.<br/>

The downside of the <em>tmpfs</em> approach is that the databases will be lost when the device loses power or is restarted, also the RAM used by these databases will decrease the amount of available RAM of the system by a few <abbr title="Megabyte">MB</abbr>. Please consider your options and requirements.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;0-&quot;} -->
<p>
Last but not least, you can select whether the output streams (<em>STDOUT</em> and <em>STDERR</em>) that are sent to the init process (<code>procd</code>), shall be forwarded to the system logger. Defaults to yes for both.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;freeswitch init configuration&quot;,&quot;hid&quot;:&quot;freeswitch_init_configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;606-1937&quot;} -->
<h2 class="sectionedit7" id="freeswitch_packages">freeswitch packages</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;freeswitch packages&quot;,&quot;hid&quot;:&quot;freeswitch_packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;1938-1970&quot;} -->
<h3 class="sectionedit8" id="modules">Modules</h3>
<div class="level3">

<p>
FreeSWITCH has a multitude of modules. OpenWrt typically runs on hardware that is somewhat restricted, i.e. memory, storage and processing power are limited. Luckily only a few packages are needed for basic functionality (depending on what you want it to do). Here is a list of modules you might be interested in:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_commands" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_commands" rel="ugc nofollow">freeswitch-mod-commands</a>: various <abbr title="Application Programming Interface">API</abbr> commands, for instance <code>fsctl</code></div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/XML+Dialplan" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/XML+Dialplan" rel="ugc nofollow">freeswitch-mod-dialplan-xml</a>: adds support for dialplans written in XML</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_dptools" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_dptools" rel="ugc nofollow">freeswitch-mod-dptools</a>: dialplan tools (<code>answer</code>, <code>blind_transfer</code> etc.)</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_event_socket" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_event_socket" rel="ugc nofollow">freeswitch-mod-event-socket</a>: provides a socket interface to FreeSWITCH which is used, for example, by <code>fs_cli</code></div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_hash" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_hash" rel="ugc nofollow">freeswitch-mod-hash</a>: can be used to limit the amount of calls and other things</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_logfile" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_logfile" rel="ugc nofollow">freeswitch-mod-logfile</a>: allows saving logs of the running application</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_sofia" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_sofia" rel="ugc nofollow">freeswitch-mod-sofia</a>: the SIP stack used by FreeSWITCH</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_spandsp" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_spandsp" rel="ugc nofollow">freeswitch-mod-spandsp</a>: adds fax capabilities, also includes additional audio codecs, e.g. G722 (“HD Voice”)</div>
</li>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/mod_xml_cdr" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/mod_xml_cdr" rel="ugc nofollow">freeswitch-mod-xml-cdr</a>: can save call data records, also useful for troubleshooting</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Modules&quot;,&quot;hid&quot;:&quot;modules&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;1971-3693&quot;} -->
<h3 class="sectionedit9" id="freetdm_modules">FreeTDM modules</h3>
<div class="level3">

<p>
FreeSWITCH supports select TDM hardware. At the heart of this sits <a href="https://freeswitch.org/confluence/display/FREESWITCH/FreeTDM" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/FreeTDM" rel="ugc nofollow">libfreetdm</a>. It will be pulled in automatically when you install the endpoint driver <em>freeswitch-mod-freetdm</em>, which is used by FreeSWITCH to
interconnect with all protocols supported by FreeTDM.
</p>

<p>
FreeTDM itself is modular as well. OpenWrt packages the following FreeTDM modules:
</p>
<ul>
<li class="level1"><div class="li"> libfreetdm-ftmod-analog: signaling module; provides support for FXS/FXO</div>
</li>
<li class="level1"><div class="li"> libfreetdm-ftmod-analog-em: signaling module; not solely for analog, supports E1/T1 analog and digital cards using CASE&amp;M signaling</div>
</li>
<li class="level1"><div class="li"> libfreetdm-ftmod-libpri: signaling module; provides support for ISDN over PRI/BRI</div>
</li>
<li class="level1"><div class="li"> libfreetdm-ftmod-pritap: PRI tapping</div>
</li>
<li class="level1"><div class="li"> libfreetdm-ftmod-skel: example module</div>
</li>
<li class="level1"><div class="li"> libfreetdm-ftmod-zt: I/O module; takes care of reading and writing raw data bytes and executing low level control commands on the telephony hardware</div>
</li>
</ul>

<p>
Don&#039;t forget to install <em>kmod-dahdi</em>. It provides the kernel driver for the TDM hardware.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;FreeTDM modules&quot;,&quot;hid&quot;:&quot;freetdm_modules&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;3694-4761&quot;} -->
<h3 class="sectionedit10" id="utilities">Utilities</h3>
<div class="level3">

<p>
There are also a number of utilities available. Let&#039;s just mention the one that is probably the most important:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://freeswitch.org/confluence/display/FREESWITCH/Command-Line+Interface+fs_cli" class="urlextern" title="https://freeswitch.org/confluence/display/FREESWITCH/Command-Line+Interface+fs_cli" rel="ugc nofollow">freeswitch-util-fs-cli</a>: allows CLI access to a FreeSWITCH server, either local or remote (uses the event socket interface mentioned above)</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Utilities&quot;,&quot;hid&quot;:&quot;utilities&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;4762-5126&quot;} -->
<h3 class="sectionedit11" id="examples">Examples</h3>
<div class="level3">

<p>
The FreeSWITCH source contains a number of folders with configuration examples. These are packaged as well:
</p>
<ul>
<li class="level1"><div class="li"> freeswitch-example-curl</div>
</li>
<li class="level1"><div class="li"> freeswitch-example-insideout</div>
</li>
<li class="level1"><div class="li"> ...</div>
</li>
</ul>

<p>
Any of these will install the corresponding sample configuration to <code>/usr/share/freeswitch/examples</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;5127-5430&quot;} -->
<h2 class="sectionedit12" id="hotplug">Hotplug</h2>
<div class="level2">

<p>
The <em>freeswitch</em> package includes a hotplug script. You can set a hotplug interface in <code>/etc/config/freeswitch</code> to enable it.
</p>

<p>
Note: It may be advisable to disable the init autostart, to avoid FreeSWITCH beeing started twice when booting:
</p>
<pre class="code">/etc/init.d/freeswitch disable</pre>

<p>
The hotplug script can check the following extra conditions:
</p>
<ul>
<li class="level1"><div class="li"> a device (perhaps a USB stick) is connected at a given mount point (for instance <code>/mnt/usb</code>)</div>
</li>
<li class="level1"><div class="li"> the system clock is accurate (needs <code>ntpd</code> to be installed)</div>
</li>
</ul>

<p>
If you add any of these conditions the hotplug script will only start FreeSWITCH if the condition is met. You can also specify the timeout after which it considers a condition failed (defaults to 60 seconds).
</p>

<p>
Below a log excerpt from the hotplug script in action:
</p>
<pre class="code">Sat Nov 17 11:24:43 2018 user.notice freeswitch-hotplug: /mnt/usb mounted
Sat Nov 17 11:24:43 2018 user.notice freeswitch-hotplug: ntpd stratum 16
Sat Nov 17 11:24:43 2018 user.notice freeswitch-hotplug: system time not in sync yet, timeout in 60 s
Sat Nov 17 11:24:48 2018 user.notice freeswitch-hotplug: ntpd stratum 16
Sat Nov 17 11:24:48 2018 user.notice freeswitch-hotplug: system time not in sync yet, timeout in 55 s
Sat Nov 17 11:24:53 2018 user.notice freeswitch-hotplug: ntpd stratum 3
Sat Nov 17 11:24:53 2018 user.notice freeswitch-hotplug: ntpd to system time offset +/- 4 ms
Sat Nov 17 11:24:53 2018 user.notice freeswitch-hotplug: system time in sync
Sat Nov 17 11:24:54 2018 user.notice freeswitch-hotplug: started freeswitch due to &quot;ifup wan&quot; event</pre>

<p>
Both extra conditions were configured. A device was already mounted at <code>/mnt/usb</code>. The system time was initially not accurate, so the hotplug script waited a bit before starting FreeSWITCH.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hotplug&quot;,&quot;hid&quot;:&quot;hotplug&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;5431-&quot;} -->