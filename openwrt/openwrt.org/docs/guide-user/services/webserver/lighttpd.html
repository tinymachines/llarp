
<h1 class="sectionedit1" id="lighttpd_webserver">Lighttpd webserver</h1>
<div class="level1">

<p>
LuCI is the main web administration utility for OpenWrt. <strong>By default LuCI uses <a href="/docs/guide-user/services/webserver/http.uhttpd" class="wikilink1" title="docs:guide-user:services:webserver:http.uhttpd" data-wiki-id="docs:guide-user:services:webserver:http.uhttpd">uHTTPd</a></strong>.
</p>

<p>
Lighttpd is a highly-configurable, lightweight web server.
See <a href="https://en.wikipedia.org/wiki/lighttpd" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/lighttpd">lighttpd</a> and <a href="https://www.lighttpd.net/" class="urlextern" title="https://www.lighttpd.net/" rel="ugc nofollow">https://www.lighttpd.net/</a>.
There are many modules available for lighttpd that can be installed and configured.
For more information on the modules see <a href="https://redmine.lighttpd.net/projects/lighttpd/wiki/docs" class="urlextern" title="https://redmine.lighttpd.net/projects/lighttpd/wiki/docs" rel="ugc nofollow">https://redmine.lighttpd.net/projects/lighttpd/wiki/docs</a>.
This article explains how to get lighttpd working on OpenWrt.
</p>

<p>
Consult <a href="/docs/guide-user/luci/luci.on.lighttpd" class="wikilink1" title="docs:guide-user:luci:luci.on.lighttpd" data-wiki-id="docs:guide-user:luci:luci.on.lighttpd">luci.on.lighttpd</a> to make lighttpd serve the LuCI web interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Lighttpd webserver&quot;,&quot;hid&quot;:&quot;lighttpd_webserver&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-636&quot;} -->
<h2 class="sectionedit2" id="requirements">Requirements</h2>
<div class="level2">

<p>
Execute
</p>
<pre class="code">opkg list lighttpd*</pre>

<p>
to see what packages are available.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Requirements&quot;,&quot;hid&quot;:&quot;requirements&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;637-741&quot;} -->
<h2 class="sectionedit3" id="installation">Installation</h2>
<div class="level2">

<p>
Use <a href="/docs/guide-user/additional-software/opkg" class="wikilink1" title="docs:guide-user:additional-software:opkg" data-wiki-id="docs:guide-user:additional-software:opkg">opkg</a>
</p>
<pre class="code">opkg update
opkg install lighttpd</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;742-866&quot;} -->
<h2 class="sectionedit4" id="configuration">Configuration</h2>
<div class="level2">

<p>
Edit <code>/etc/lighttpd/lighttpd.conf</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;867-931&quot;} -->
<h3 class="sectionedit5" id="basic_configuration">Basic Configuration</h3>
<div class="level3">

<p>
To get a basic server running make the following changes to <code>/etc/lighttpd/lighttpd.conf</code>:
</p>

<p>
<em class="u">Server Root Directory</em>
</p>
<pre class="code">server.document-root = &quot;/www/&quot;</pre>

<p>
where the <code>www</code> is the root directory of the web server.
</p>

<p>
<em class="u">Enable Logging</em>
</p>

<p>
Uncomment (remove #) the following line so errors are written to the log:
</p>
<pre class="code">server.errorlog = &quot;/var/log/lighttpd/error.log&quot;</pre>

<p>
<em class="u">Set Server Port</em>
</p>

<p>
Uncomment the following line:
</p>
<pre class="code">server.port = 8000</pre>

<p>
where 8000 is the port you want your webserver on.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Basic Configuration&quot;,&quot;hid&quot;:&quot;basic_configuration&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;932-1488&quot;} -->
<h3 class="sectionedit6" id="advanced_configuration">Advanced Configuration</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/services/webserver/lamp" class="wikilink1" title="docs:guide-user:services:webserver:lamp" data-wiki-id="docs:guide-user:services:webserver:lamp">Set up a LAMP stack on OpenWrt</a></div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/services/nas/webdav" class="wikilink1" title="docs:guide-user:services:nas:webdav" data-wiki-id="docs:guide-user:services:nas:webdav">WebDAV with Lighttpd on OpenWRT</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Advanced Configuration&quot;,&quot;hid&quot;:&quot;advanced_configuration&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:6,&quot;range&quot;:&quot;1489-1680&quot;} -->
<h2 class="sectionedit7" id="configuring_lighttpd_and_php">Configuring Lighttpd and PHP</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> First, follow <a href="/docs/guide-user/services/webserver/php" class="wikilink1" title="docs:guide-user:services:webserver:php" data-wiki-id="docs:guide-user:services:webserver:php">php</a> to install a version of PHP</div>
</li>
<li class="level1"><div class="li"> Second, follow <a href="/docs/guide-user/services/webserver/lamp#lighttpd1" class="wikilink1" title="docs:guide-user:services:webserver:lamp" data-wiki-id="docs:guide-user:services:webserver:lamp">lighttpd1</a> to configure lighttpd</div>
</li>
<li class="level1"><div class="li"> Third, to get PHP running with Lighttpd you need to install the package <code>lighttpd-mod-cgi</code></div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuring Lighttpd and PHP&quot;,&quot;hid&quot;:&quot;configuring_lighttpd_and_php&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:7,&quot;range&quot;:&quot;1681-2003&quot;} -->
<h2 class="sectionedit8" id="start_on_boot">Start on boot</h2>
<div class="level2">

<p>
To enable/disable start on boot:<br/>

<code>/etc/init.d/lighttpd enable</code>  this simply creates a symlink: <code>/etc/rc.d/S80lighttpd → /etc/init.d/lighttpd</code><br/>

<code>/etc/init.d/lighttpd disable</code> this removes the symlink again<br/>

</p>

<p>
To start the server:
</p>
<pre class="code">/etc/init.d/lighttpd start</pre>

<p>
To stop the server:
</p>
<pre class="code">/etc/init.d/lighttpd stop</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Start on boot&quot;,&quot;hid&quot;:&quot;start_on_boot&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:8,&quot;range&quot;:&quot;2004-2374&quot;} -->
<h2 class="sectionedit9" id="firewall">Firewall</h2>
<div class="level2">

<p>
To allow users on the <abbr title="Wide Area Network">WAN</abbr> to access the server, make sure to configure the firewall in <code><a href="/docs/guide-user/firewall/start" class="wikilink1" title="docs:guide-user:firewall:start" data-wiki-id="docs:guide-user:firewall:start">/etc/config/firewall</a></code> and port forwarding settings.
</p>
<pre class="code">config redirect
        option src              wan
        option src_dport        80
        option dest             lan
        option dest_ip          192.168.1.1
        option dest_port        8000
        option proto            tcp

config rule
        option src              wan
        option dest_port        8000
        option target           ACCEPT
        option proto            tcp</pre>

<p>
Restart the firewall with the following command: <code>/etc/init.d/firewall restart</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Firewall&quot;,&quot;hid&quot;:&quot;firewall&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:9,&quot;range&quot;:&quot;2375-3073&quot;} -->
<h2 class="sectionedit10" id="administration">Administration</h2>
<div class="level2">

<p>
<strong>Add virtual hosts via mod_simple_vhost</strong>
</p>

<p>
The goal is to run only one server on port 80. At the same time, this server should distinguish between different websites or directories.
First, the Lighttpd server is configured as described.
It must be ensured that the server works on port 80 (or any other port).
In my example, the local domain suffix was specified with “h” (see dnsmasq configuration).
</p>

<p>
Now add the following entries to your file:  <code>/etc/config/dhcp</code>
</p>
<pre class="code">config domain
      option name &#039;luci&#039;
      option ip &#039;192.168.1.1&#039;

config domain
      option name &#039;home&#039;
      option ip &#039;192.168.1.1&#039;</pre>

<p>
Add Module <code>mod_simple_vhost</code> to your: <code>/etc/lighttpd/lighttpd.conf</code>
<code>server.modules = ( “mod_simple_vhost”, )</code>
</p>

<p>
Create virtual host Configuration: <code>/etc/lighttpd/conf.d/IntraNet.conf</code>
</p>
<pre class="code">$HTTP[&quot;host&quot;] =~ &quot;^luci.h(\:[0-9]*)?$&quot; {
    dir-listing.activate = &quot;disable&quot;
    server.document-root = &quot;/www/&quot;
    $HTTP[&quot;url&quot;] =~ &quot;^/cgi-bin&quot; {
        cgi.assign += ( &quot;&quot; =&gt; &quot;&quot; )
    }
}

$HTTP[&quot;host&quot;] =~ &quot;^home.h(\:[0-9]*)?$&quot; {
    dir-listing.activate = &quot;enable&quot;
    server.document-root = &quot;/www/Home/&quot;
    url.redirect = ( &quot;^/config/&quot; =&gt; &quot;/www/status-403.html&quot;,
                    &quot;^/data/&quot; =&gt; &quot;/www/status-403.html&quot;,
                  )
}</pre>

<p>
Restarted dnsmasq and lighttpd: <code>/etc/init.d/dnsmasq restart; /etc/init.d/lighttpd restart;</code>
</p>

<p>
Via the address  luci.h  the configuration can now be called, and another website via  home.h
The IntraNet.conf can be extended with more virtual host names.
Within virtual host you can configure host specific configurations.
</p>

<p>
You can also configure Internet Websites with this, like example.org or second.example.org
</p>

<p>
<em>Make sure that the browser cache is deleted, often a new presence did not work because there is still some old information in the cache.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Administration&quot;,&quot;hid&quot;:&quot;administration&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:10,&quot;range&quot;:&quot;3074-4939&quot;} -->
<h2 class="sectionedit11" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
<em class="u">Incorrect Event Handler</em>
</p>

<p>
If you get the following error:
</p>
<pre class="code">(server.c.1105) fdevent_init failed</pre>

<p>
you might need to set the event handler explicitly for your system. Add the following line to the configuration file:
</p>
<pre class="code">server.event-handler = &quot;poll&quot;</pre>

<p>
See <a href="https://redmine.lighttpd.net/projects/lighttpd/wiki/Server.event-handlerDetails" class="urlextern" title="https://redmine.lighttpd.net/projects/lighttpd/wiki/Server.event-handlerDetails" rel="ugc nofollow">https://redmine.lighttpd.net/projects/lighttpd/wiki/Server.event-handlerDetails</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:11,&quot;range&quot;:&quot;4940-5335&quot;} -->
<h2 class="sectionedit12" id="notes">Notes</h2>
<div class="level2">

<p>
Note that lighttpd does not support <code>.htaccess</code> files as some web servers do to configure directory specific server settings.
Instead, it uses a centrally configured system using <code>lighttpd.conf</code> to define all settings, using powerful matching functions.
This still means that you have to manually set up directory settings.
Especially for (opkg) packages that supply <code>.htaccess</code> files to define required settings.
Allowing directory listings is one example that should be disabled or enabled as per the required security level.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Notes&quot;,&quot;hid&quot;:&quot;notes&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:12,&quot;range&quot;:&quot;5336-&quot;} -->