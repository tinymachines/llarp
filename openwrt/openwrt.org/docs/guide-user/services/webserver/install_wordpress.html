
<h1 class="sectionedit1" id="using_openwrt_to_build_a_lampwordpress_server">Using OpenWrt to build a LAMP/WordPress server</h1>
<div class="level1">

<p>
<strong>NOTE</strong> The article is outdated, see the <a href="/docs/guide-user/services/webserver/lamp" class="wikilink1" title="docs:guide-user:services:webserver:lamp" data-wiki-id="docs:guide-user:services:webserver:lamp">Set up a LAMP webserver stack</a> instead.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using OpenWrt to build a LAMP\/WordPress server&quot;,&quot;hid&quot;:&quot;using_openwrt_to_build_a_lampwordpress_server&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-188&quot;} -->
<h2 class="sectionedit2" id="preamblescope">Preamble/Scope</h2>
<div class="level2">

<p>
Pro web developers tend to rely on development servers, because no-one likes to expose a half-built site on the Internet. But if you work from home and build a site, say, every couple of months, it&#039;s hard to justify a dedicated server. Even a cheap old PC still takes up a lot of space. Much better to have a little box that you can stash in a drawer when it&#039;s not in use, right?
</p>

<p>
Well, getting a tiny devserver to behave like a commercial host is time consuming and can be expensive. Around 2010 I bought a SheevaPlug and committed several weeks of headscratching to the installation of a LAMP stack and WordPress, only to have the machine burn out within a week of commission. 
</p>

<p>
Things have got better in the last decade and with OpenWrt and a so-called &#039;travel router&#039; you can have a full-featured devserver with an outlay of less than $50 and a day or so of work. This how-to documents how I got WordPress running on a GL.inet MT300A I bought for Â£27 on Amazon. Much of my account references sources on this wiki and elsewhere. I will indicate the problems I encountered and how others might improve on my methods. I might have misremembered a few details and I&#039;m afraid I don&#039;t know the Windows or Mac equivalents to the Linux commands given here. Sorry!
</p>

<p>
NOTE: My objective was to build a small, cheap router that I could plug into my home network as needed. I do NOT recommend following this route if you&#039;re hosting content to any third party. It goes without saying that you won&#039;t be putting sensitive information on the devserver and that you won&#039;t be running it outside a firewall.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Preamble\/Scope&quot;,&quot;hid&quot;:&quot;preamblescope&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;189-1811&quot;} -->
<h2 class="sectionedit3" id="hardware">Hardware</h2>
<div class="level2">

<p>
I chose the MT300A in a blind purchase because of its low cost, small footprint and OpenWrt friendliness. Conclusion: it kinda works, with some bodging. I definitely wouldn&#039;t recommend trying to make the instructions below work with any of its predecessors, and other, better hardware may be available by the time you read this. 
</p>

<p>
Power up the router as per manufacturer&#039;s instructions. I&#039;d suggest connecting its <abbr title="Local Area Network">LAN</abbr> port to one of the spare ports on your broadband router, but of course that assumes that you&#039;ve got a typical home/small office setup with a broadband router plugged straight into your phone line. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hardware&quot;,&quot;hid&quot;:&quot;hardware&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1812-2451&quot;} -->
<h2 class="sectionedit4" id="firmware">Firmware</h2>
<div class="level2">

<p>
Launch a browser and type the <abbr title="Internet Protocol">IP</abbr> address of your device (192.168.8.1 for an out-of-the-box MT300A). You can access it using the factory default password. 
</p>

<p>
GL.inet recommend setting a new root password as soon as you connect. You&#039;re welcome to do so, but since you&#039;ll need to replace the firmware on the router there&#039;s little point. I used lede-17.01.4-ramips-mt7620-gl-mt300a-squashfs-sysupgrade.bin from this site and followed these instructions: <a href="/docs/guide-quick-start/factory_installation" class="wikilink1" title="docs:guide-quick-start:factory_installation" data-wiki-id="docs:guide-quick-start:factory_installation">factory_installation</a>
</p>

<p>
The new firmware changes the default <abbr title="Internet Protocol">IP</abbr> address from <code>192.168.8.1</code> to <code>192.168.1.1</code>. For access via OpenWrt&#039;s LuCI <abbr title="Graphical User Interface">GUI</abbr>, point your browser at the new address. Now&#039;s the time to set that new password!
</p>

<p>
NOTE: GL.inet state that you can use the reset button to return the device to factory defaults in the event of a meltdown, but that isn&#039;t strictly accurate. The reset button simply returns the installed firmware to its default state. Thus, once you&#039;ve uploaded OpenWrt firmware, resetting the device will take you back to a clean OpenWrt install rather than factory settings. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Firmware&quot;,&quot;hid&quot;:&quot;firmware&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2452-3576&quot;} -->
<h2 class="sectionedit5" id="software_prerequisites">Software prerequisites?</h2>
<div class="level2">

<p>
There are loads of packages to install, so I&#039;m not listing prerequisites. However, I will state at the outset that, since you&#039;ll need to use CLI/terminal programs, you might want to get up to speed on PuTTY and scp (secure copy). It&#039;s no fun wrestling with unfamiliar software on your own computer while trying to wrangle a remote machine.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Software prerequisites?&quot;,&quot;hid&quot;:&quot;software_prerequisites&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;3577-3955&quot;} -->
<h2 class="sectionedit6" id="lan">LAN</h2>
<div class="level2">

<p>
<abbr title="Transmission Control Protocol">TCP</abbr>/<abbr title="Internet Protocol">IP</abbr> is widely documented but still causes confusion. A brutally quick account: your broadband router has a fixed <abbr title="Internet Protocol">IP</abbr> address on the local network (<abbr title="Local Area Network">LAN</abbr>). It dynamically assigns <abbr title="Internet Protocol">IP</abbr> addresses to the devices which connect to it. Your new router will need a fixed <abbr title="Internet Protocol">IP</abbr> address so that you will be able to find it easily on the <abbr title="Local Area Network">LAN</abbr>, but that address has to align with the stuff the broadband router is doing.
</p>

<p>
To find exactly what the broadband router is up to, launch a terminal on your own computer and do: 
</p>

<p>
<code>route -n</code>
</p>

<p>
The response will look like this:
</p>
<pre class="code">Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.254   0.0.0.0         UG    1024   0        0 wlan0
169.244.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 wlan0
192.158.1.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0</pre>

<p>
Special bonus for UK readers: BT broadband routers mostly use the <abbr title="Internet Protocol">IP</abbr> address 192.168.1.254. Either way, make a note of that gateway <abbr title="Internet Protocol">IP</abbr> address.
</p>

<p>
Launch PuTTY from the terminal and start a new session with the ip address of the new router. Log in as &#039;root&#039; using whatever password you set via LuCI. If the login is successful, you&#039;ll see an OpenWrt logo in text and a command prompt. Update the gateway address by typing a uci command:
</p>
<pre class="code">uci set network.lan.gateway 192.168.1.254</pre>

<p>
Depending on setup you may also need to type:
</p>
<pre class="code">uci set network.lan.dns 192.168.1.254</pre>

<p>
...then:
</p>
<pre class="code">uci commit network
reboot</pre>

<p>
The new router *should* now be set up for your existing <abbr title="Local Area Network">LAN</abbr>. Check by using OpenWrt&#039;s package manager to install nano, thus: 
</p>
<pre class="code">opkg update
opkg install nano</pre>

<p>
If you get errors, there is a network configuration problem. Google is your friend! 
</p>

<p>
However, assuming you&#039;ve got nano running, you&#039;ll be able to review all your network config options at one pass by doing:
</p>

<p>
<code>nano /etc/config/network</code>
</p>

<p>
<abbr title="By the way">BTW</abbr>, when you&#039;ve finished with nano, it will be faster to reload the network than to reboot the router:
</p>

<p>
<code>/etc/init.d/network reload</code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LAN&quot;,&quot;hid&quot;:&quot;lan&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;3956-6076&quot;} -->
<h2 class="sectionedit7" id="extending_the_rom">Extending the ROM</h2>
<div class="level2">

<p>
OpenWrt is tiny, and so are its numerous packages. This enables the system to operate from the meagre storage provided by the average router. The MT300A offers only 16Mb, but that&#039;s enough for a LAMP stack. 
</p>

<p>
Unfortunately, it isn&#039;t enough for WordPress, which presently runs to about 20Mb. 
</p>

<p>
A full solution to this problem is to dedicate an external USB stick to the router using a technique called overlaying, documented here: <a href="/docs/guide-user/additional-software/extroot_configuration" class="wikilink1" title="docs:guide-user:additional-software:extroot_configuration" data-wiki-id="docs:guide-user:additional-software:extroot_configuration">extroot</a>
</p>

<p>
NOTES: 
* I found that, after following these instructions, I still needed to access the LuCI <abbr title="Graphical User Interface">GUI</abbr> tool, select &#039;System/Mount Points&#039;, check the &#039;Enabled&#039; option and reboot the new router to gain access to the extended storage.
* I used extroot/overlay because I didn&#039;t want to wrangle multiple storage devices on the router. However, the technique has a downside: the USB stick can&#039;t easily be moved between devices, so you can&#039;t, for instance, re-plug it into your own machine to copy files. You might prefer to mount the USB stick on the router and access it as /dev/sda1 or whatever without bothering to overlay it. Useful pointers here: <a href="https://snippets.khromov.se/installing-wordpress-on-a-tiny-wireless-router/" class="urlextern" title="https://snippets.khromov.se/installing-wordpress-on-a-tiny-wireless-router/" rel="ugc nofollow">https://snippets.khromov.se/installing-wordpress-on-a-tiny-wireless-router/</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extending the ROM&quot;,&quot;hid&quot;:&quot;extending_the_rom&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:7,&quot;range&quot;:&quot;6077-7407&quot;} -->
<h2 class="sectionedit8" id="configuring_the_web_server">Configuring the web server</h2>
<div class="level2">

<p>
You already have a working web server -- OpenWrt ships with uhttpd preinstalled. Result! The drawback is that uhttpd is tied up in providing the LuCI <abbr title="Graphical User Interface">GUI</abbr>. 
</p>

<p>
The simplest way around this is to activate another instance of uhttpd on port 81 pointing to a distinct directory (where your dev website will live). This will slightly complicate the business of accessing your development site, but that&#039;s better than messing up LuCI. Instructions here: <a href="/docs/guide-user/services/webserver/lamp" class="wikilink1" title="docs:guide-user:services:webserver:lamp" data-wiki-id="docs:guide-user:services:webserver:lamp">lamp</a> [scroll down to &#039;Installing and configuring a web server/uHTTPd&#039;]
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuring the web server&quot;,&quot;hid&quot;:&quot;configuring_the_web_server&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:8,&quot;range&quot;:&quot;7408-8005&quot;} -->
<h2 class="sectionedit9" id="installing_mysql">Installing MySQL</h2>
<div class="level2">

<p>
I chose MySQL over SQLite. I imagine you&#039;d get faster performance with the SQLite.
</p>

<p>
The MySQL install itself is pretty easy: 
</p>
<pre class="code">opkg update
opkg install mysql-server</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installing MySQL&quot;,&quot;hid&quot;:&quot;installing_mysql&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:9,&quot;range&quot;:&quot;8006-8216&quot;} -->
<h2 class="sectionedit10" id="installing_php">Installing PHP</h2>
<div class="level2">

<p>
PHP is available via opkg so you might think this would be easy. But you have to choose PHP5 or PHP7, and then you&#039;ll find that this is one of those times when OpenWrt&#039;s parsimonious approach to memory usage complicates matters -- the package is split across multiple components. 
</p>

<p>
The following worked for me:
</p>
<pre class="code">opkg update
opkg install php7 php7-cgi php7-cli php7-mod-gd php7-mod-hash php7-mod-json php7-mod-mbstring php7-modmysqli  php7-mod-opcache php7-mod-pdo php7-mod-pdo-mysql php7-mod-session</pre>

<p>
Use the configuration instructions here: <a href="/docs/guide-user/services/webserver/uhttpd" class="wikilink1" title="docs:guide-user:services:webserver:uhttpd" data-wiki-id="docs:guide-user:services:webserver:uhttpd">uhttpd</a> [scroll down to &#039;Using PHP5&#039; section, still seems to apply.]
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installing PHP&quot;,&quot;hid&quot;:&quot;installing_php&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:10,&quot;range&quot;:&quot;8217-8910&quot;} -->
<h2 class="sectionedit11" id="installing_wordpress">Installing WordPress</h2>
<div class="level2">

<p>
You&#039;ll need to install WordPress the hard way. 
</p>

<p>
Go to wordpress.org and download a copy of the latest version to your own machine. Unzip it and, while you&#039;re at it, rename &#039;wp-config-sample.php&#039; to &#039;wp-config.php&#039;.
</p>

<p>
Using Putty, make a new <code>wordpress</code> directory in <code>/srv/www</code> on the router: 
</p>
<pre class="code">cd /srv/www
mkdir wordpress</pre>

<p>
Now launch a terminal (not a PuTTY session!) and use scp to copy the unzipped archive to the new directory:
</p>
<pre class="code">scp -r /home/[yermamaspc]/Downloads/wordpress/ root@192.168.1.1:/srv/www/wordpress/</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installing WordPress&quot;,&quot;hid&quot;:&quot;installing_wordpress&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:11,&quot;range&quot;:&quot;8911-9496&quot;} -->
<h2 class="sectionedit12" id="tying_it_all_together_but_don_t_install_phpmyadmin">Tying it all together (but don&#039;t install PHPMyAdmin)</h2>
<div class="level2">

<p>
If you&#039;ve run WordPress in a commercial environment, you&#039;ve almost certainly used PHPMyAdmin to set up your MySQL databases. On OpenWrt, that&#039;s a bad move, since the available MySQL daemon isn&#039;t fully compatible with the latest PHP. Fortunately, manually configuring a suitable MySQL database is a piece of cake. Good instructions here: <a href="https://websiteforstudents.com/creating-new-mysql-user-database-wordpress/" class="urlextern" title="https://websiteforstudents.com/creating-new-mysql-user-database-wordpress/" rel="ugc nofollow">websiteforstudents.com/creating-new-mysql-user-database-wordpress/</a>
</p>

<p>
For our purposes I recommend standardizing thus: wordpress_db / wordpress_user / wordpress_pw. Of course that&#039;s at your own risk. (You&#039;re not going to put your credit card details or Google password on there, are you?)
</p>

<p>
Once you&#039;ve set up the MySQL database, you can run the WordPress installer script from:
</p>

<p>
<code>192.168.1.1:81/wordpress/</code>
</p>

<p>
From now on, you&#039;re on your own...
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Tying it all together (but don&#039;t install PHPMyAdmin)&quot;,&quot;hid&quot;:&quot;tying_it_all_together_but_don_t_install_phpmyadmin&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:12,&quot;range&quot;:&quot;9497-&quot;} -->