
<h1 class="sectionedit1" id="apache_http_server">Apache HTTP Server</h1>
<div class="level1">

<p>
Apache is one of the most popular web servers in the <abbr title="Free &amp; Open-Source Software">FOSS</abbr> world. First, I strongly recommend that you install the apache server on an external drive width swapfile, especially if you need to use mysql. If you do not have the external drive and the swapfile installed, please look first below. You can copy text, and width right mouse click copy the contents to your PuTTY terminal.<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Apache HTTP Server&quot;,&quot;hid&quot;:&quot;apache_http_server&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-418&quot;} -->
<h2 class="sectionedit2" id="installation">Installation</h2>
<div class="level2">

<p>
Installing apache with <code><a href="/docs/guide-user/additional-software/opkg" class="wikilink1" title="docs:guide-user:additional-software:opkg" data-wiki-id="docs:guide-user:additional-software:opkg">opkg</a></code> is very simple:
</p>
<pre class="code">opkg update
opkg install apache</pre>

<p>
or alternatively install it to the external drive: (see below)
</p>
<pre class="code">opkg -dest usb install apache</pre>

<p>
In case you manually mounted the hard drive, restart the drive, to make necessary links:
</p>
<pre class="code">/etc/init.d/hdd stop
/etc/init.d/hdd start</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;419-835&quot;} -->
<h2 class="sectionedit3" id="configuration">Configuration</h2>
<div class="level2">

<p>
Edit <code>/etc/apache/httpd.conf</code> to change the configuration according to your needs.
</p>

<p>
Sometimes you need to uncomment a line (=remove the <code>#</code> character at the beginning of the line) to activate the respective config option.
</p>

<p>
Search for “Listen 12.34.56.78:80” and replace with your router&#039;s <abbr title="Internet Protocol">IP</abbr> address and a port different then 80, because 80 is most likely already used by the OpenWrt <abbr title="Graphical User Interface">GUI</abbr> (LuCI).
</p>
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>Listen 192.168.1.1:81</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;1263-1290&quot;} -->
<p>
Search for “ServerName” and do the same:
</p>
<div class="table sectionedit5"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>ServerName YourServer:81</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;1334-1364&quot;} -->
<p>
where YourServer is <a href="https://en.wikipedia.org/wiki/FQDN" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/FQDN">FQDN</a> of your server name like <a href="http://www.something99.com" class="urlextern" title="http://www.something99.com" rel="ugc nofollow">www.something99.com</a>
</p>

<p>
Connect to <a href="http://192.168.1.1:81" class="urlextern" title="http://192.168.1.1:81" rel="ugc nofollow">http://192.168.1.1:81</a> in your browser to see if your configuration works.
Place your web server shared documents under <code>/usr/share/htdocs</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:3,&quot;range&quot;:&quot;836-1597&quot;} -->
<h2 class="sectionedit6" id="external_drive_and_the_swapfile_install">External drive and the swapfile install</h2>
<div class="level2">

<p>
Since the <em>Apache <abbr title="Hypertext Transfer Protocol">HTTP</abbr> Server</em> is quite a big memory hog, we recommend to use it only in conjunction with additional storage. Please follow these guides to get that started:
</p>
<ul>
<li class="level1 node"><div class="li"> <a href="/docs/guide-user/hardware/usb.overview" class="wikilink1" title="docs:guide-user:hardware:usb.overview" data-wiki-id="docs:guide-user:hardware:usb.overview">usb.overview</a></div>
<ul>
<li class="level2"><div class="li"> <a href="/docs/guide-user/storage/usb-installing" class="wikilink1" title="docs:guide-user:storage:usb-installing" data-wiki-id="docs:guide-user:storage:usb-installing">usb-installing</a></div>
</li>
<li class="level2"><div class="li"> <a href="/docs/guide-user/storage/usb-drives" class="wikilink1" title="docs:guide-user:storage:usb-drives" data-wiki-id="docs:guide-user:storage:usb-drives">usb-drives</a></div>
</li>
<li class="level2"><div class="li"> <code><a href="/docs/guide-user/storage/fstab" class="wikilink1" title="docs:guide-user:storage:fstab" data-wiki-id="docs:guide-user:storage:fstab">/etc/config/fstab</a></code></div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;External drive and the swapfile install&quot;,&quot;hid&quot;:&quot;external_drive_and_the_swapfile_install&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:6,&quot;range&quot;:&quot;1598-2029&quot;} -->
<h2 class="sectionedit7" id="configuring_apache_and_php5">Configuring Apache and PHP5</h2>
<div class="level2">

<p>
To install PHP see →<a href="/docs/guide-user/services/webserver/php" class="wikilink1" title="docs:guide-user:services:webserver:php" data-wiki-id="docs:guide-user:services:webserver:php">php</a>
</p>

<p>
Edit
</p>
<pre class="code">vi /etc/php.ini</pre>

<p>
Search for “doc_root” and “extension=gd.so”. Do not specify the doc_root, and uncomment the extension=gd.so.<br/>

</p>
<div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  doc_root =
  extension=gd.so
</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;2285-2322&quot;} -->
<p>
Configure Apache again:
</p>
<pre class="code">vi /etc/apache/httpd.conf</pre>

<p>
NOTE: This is a rather unsafe configuration. If you use this, you are putting yourself at risk. (<a href="http://insecurety.net/?p=912" class="urlextern" title="http://insecurety.net/?p=912" rel="ugc nofollow">http://insecurety.net/?p=912</a>)
</p>

<p>
Search for the portion of Your Apache configuration file which has the ScriptAlias section. Add the line from below immediately after the ScriptAlias line for “cgi-bin”. Make sure that the line goes before the closing &lt;/IfModule&gt; for that &lt;IfModule alias_module&gt; section.<br/>

</p>
<div class="table sectionedit9"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  ScriptAlias /php/ “/usr/bin/”</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;2794-2831&quot;} -->
<p>
Search for the “AddType” comment block, and add the AddType line below. You can find the AddType lines in the &lt;IfModule mime_module&gt; section. Add the following line just before the closing &lt;/IfModule&gt; for that section.<br/>

</p>
<div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  AddType application/x-httpd-php .php</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;3055-3099&quot;} -->
<p>
Add this line to the end of that file:
</p>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  Action application/x-httpd-php “/php/php-cgi”</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;3141-3194&quot;} -->
<p>
Search for this section:
</p>
<div class="table sectionedit12"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  &lt;Directory “/usr/share/cgi-bin”&gt;
    AllowOverride None
    Options None
    Order allow,deny
    Allow from all
  &lt;/Directory&gt;</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;3222-3357&quot;} -->
<p>
Add the following lines immediately after the section you just found.
</p>
<div class="table sectionedit13"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  &lt;Directory “/usr/bin”&gt;
    AllowOverride None
    Options none
    Order allow,deny
    Allow from all
  &lt;/Directory&gt;</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table7&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;3430-3555&quot;} -->
<p>
<strong><code>NOTE:</code></strong> The <code>/usr/bin</code> directory contains far more than just <code>php-cgi</code>. On a public server it could be wise to move <code>php-cgi</code> to its own directory and then configure Apache to use that separate directory instead!
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuring Apache and PHP5&quot;,&quot;hid&quot;:&quot;configuring_apache_and_php5&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:7,&quot;range&quot;:&quot;2030-3783&quot;} -->
<h3 class="sectionedit14" id="configuring_the_default_index_page">Configuring the default Index Page</h3>
<div class="level3">

<p>
Search for “DirectoryIndex index.html” and change to:
</p>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  DirectoryIndex index.php index.html</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table8&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;3884-3927&quot;} -->
<p>
Restart the Apache Web Server<br/>

</p>
<pre class="code">apachectl restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuring the default Index Page&quot;,&quot;hid&quot;:&quot;configuring_the_default_index_page&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:14,&quot;range&quot;:&quot;3784-3995&quot;} -->
<h2 class="sectionedit16" id="test_php">Test PHP</h2>
<div class="level2">

<p>
Create <code>/usr/share/htdocs/index.php</code> with the following content:
</p>
<div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>  &lt;?php phpinfo(); ?&gt;</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table9&quot;,&quot;secid&quot;:17,&quot;range&quot;:&quot;4085-4112&quot;} -->
<p>
Open your browser and access the file <a href="http://192.168.1.1:81/index.php" class="urlextern" title="http://192.168.1.1:81/index.php" rel="ugc nofollow">http://192.168.1.1:81/index.php</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Test PHP&quot;,&quot;hid&quot;:&quot;test_php&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:16,&quot;range&quot;:&quot;3996-4184&quot;} -->
<h1 class="sectionedit18" id="troubleshooting">Troubleshooting</h1>
<div class="level1">

<p>
When apache accept <abbr title="Transmission Control Protocol">TCP</abbr> connection, but not send respon. In log is:
[notice] child pid 19745 exit signal Segmentation fault (11)
</p>

<p>
It&#039;s necessary to set lower debug level: LogLevel error
</p>

<p>
<a href="https://dev.openwrt.org/ticket/10273" class="urlextern" title="https://dev.openwrt.org/ticket/10273" rel="ugc nofollow">Original solution</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:18,&quot;range&quot;:&quot;4185-4460&quot;} -->
<h1 class="sectionedit19" id="start_on_boot">Start on boot</h1>
<div class="level1">

<p>
Normally apache will not start on boot, I believe its deliberate so that it wont conflict with the default (uHTTPd) web-server, <em class="u">you will need to add a file to &#039;/etc/init.d/&#039;, probably naming it apache and setting it for execution (chmod +x),</em> the file itself is rather simple :
</p>
<div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<td class="col0"><code>#!/bin/sh /etc/rc.common
# Example script
# Copyright (C) 2007 OpenWrt.org

START=60
STOP=15

start() {
        echo launch apache
        # commands to launch application
        apachectl start
}

restart() {
        echo re-start apache
        # commands to launch application
        apachectl restart
}

stop() {
        echo stop apache
        # commands to kill application
        apachectl stop
}</code></td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table10&quot;,&quot;secid&quot;:20,&quot;range&quot;:&quot;4770-5183&quot;} -->
<p>
once in place, you can issue the command <strong>&#039;/etc/init.d/apache enable&#039;</strong> to spawn the server @ boot
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Start on boot&quot;,&quot;hid&quot;:&quot;start_on_boot&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:19,&quot;range&quot;:&quot;4461-&quot;} -->