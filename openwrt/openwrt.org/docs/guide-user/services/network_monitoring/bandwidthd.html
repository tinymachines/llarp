
<h1 class="sectionedit1" id="bandwidthd">Bandwidthd</h1>
<div class="level1">

<p>
<a href="http://bandwidthd.sourceforge.net/" class="urlextern" title="http://bandwidthd.sourceforge.net/" rel="ugc nofollow">http://bandwidthd.sourceforge.net/</a> (openWRT older than 17)
</p>

<p>
<a href="https://github.com/NethServer/bandwidthd" class="urlextern" title="https://github.com/NethServer/bandwidthd" rel="ugc nofollow">https://github.com/NethServer/bandwidthd</a> (openWRT 17 or higher)
</p>

<p>
<strong>Note: bandwidthd in LEDE/OpenWRT 17.01 or higher tracks the <abbr title="Simple Mail Transfer Protocol">SMTP</abbr> data (ports 25, 465 and 587) while the version in the previous version of OpenWrt (Chaos Calmer and older) tracks the <abbr title="Peer-To-Peer">P2P</abbr> data (Gnutella, eDonkey, etc.).  All of the other data (<abbr title="File Transfer Protocol">FTP</abbr>, <abbr title="User Datagram Protocol">UDP</abbr>, <abbr title="Transmission Control Protocol">TCP</abbr>, etc.) is tracked the same way in all versions.</strong>
</p>

<p>
<strong>Bandwidthd is composed of 4 packages:
</strong>
</p>
<ol>
<li class="level1"><div class="li">  <strong>bandwidthd</strong>: this package cannot save in a postgresql or sqlite database. This allows the router to generate bandwidth data that is accessible with a browser at <a href="http://192.168.1.1/bandwidthd" class="urlextern" title="http://192.168.1.1/bandwidthd" rel="ugc nofollow">http://192.168.1.1/bandwidthd</a>.  <strong><em class="u"><em>Use this package if you have no intention of storing the data on a postgresql or sqlite database.</em></em></strong></div>
</li>
<li class="level1"><div class="li">   <strong>bandwidthd-pgsql</strong>: this package can do everything the bandwidthd package can do, but in addition it can save the data to a postgresql database that can reside on the router or on another server.  This data can be analyzed by a series of PHP scripts and visualized with a browser.  Note that the router, the posgresql database and the graphing of the data by PHP can be on three different systems, one for each task (i.e.: <em class="u">collecting the data</em>, <em class="u">storing the postgresql data</em> and <em class="u">generating the graphs with PHP</em>).  Note that postgresql does not have to be installed on the router if the postgresql data is not stored on the router. <strong>NOTE: install only one of the package: bandwidthd, bandwidthd-pgsql or bandwidthd-sqlite.</strong></div>
</li>
<li class="level1"><div class="li">   <strong>bandwidthd-php</strong>: This package contains the PHP files that are installed in /www/phphtdocs on the router.  It is only required if the OpenWrt router serves as the web server to generate the graphs from the data on the postgresql database by pointing the browser to <a href="http://192.168.1.1/phphtdocs" class="urlextern" title="http://192.168.1.1/phphtdocs" rel="ugc nofollow">http://192.168.1.1/phphtdocs</a>.  <strong>NOTE: if you installed bandwidthd-sqlite, do not install bandwidthd-php as bandwidthd-sqlite contains the required PHP files to graph the data.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>bandwidthd-sqlite</strong>.  This package, in addition to do what the plain bandwidthd package can do, stores the data in a sqlite database on the router and graph the data using PHP.  In a way, it is a combination of bandwidthd-pgsql and bandwidthd-php together, but using sqlite instead of postgresql.  <strong>NOTE: install only one of the package: bandwidthd, bandwidthd-pgsql or bandwidthd-sqlite.</strong></div>
</li>
</ol>

<p>
The availability of each package varies according to which version of OpenWrt/LEDE you have:
</p>

<p>
<strong>bandwidthd</strong>
</p>
<ul>
<li class="level1"><div class="li"> In Backfire (10.03 or 10.03.1) as a package.</div>
</li>
<li class="level1"><div class="li"> In Attitude Adjustment (12.09) as a package.</div>
</li>
<li class="level1"><div class="li"> In Barrier Breaker (14.07) in “oldpackages” as a package.</div>
</li>
<li class="level1"><div class="li"> In original Chaos Calmer (15.05) <em class="u">it is not available as a precompiled package</em>: you have to compile it yourself and install it.  See <a href="https://wiki.openwrt.org/doc/howto/build" class="urlextern" title="https://wiki.openwrt.org/doc/howto/build" rel="ugc nofollow">https://wiki.openwrt.org/doc/howto/build</a> to have details on how to compile a package.</div>
</li>
<li class="level1"><div class="li"> As a package in 15.05.1 or higher.</div>
</li>
</ul>

<p>
<strong>bandwidthd-pgsql</strong>
</p>
<ul>
<li class="level1"><div class="li"> In the original Chaos Calmer (15.05) <em class="u">it is not available as a precompiled package</em>: you have to compile it yourself and install it.  See <a href="https://wiki.openwrt.org/doc/howto/build" class="urlextern" title="https://wiki.openwrt.org/doc/howto/build" rel="ugc nofollow">https://wiki.openwrt.org/doc/howto/build</a> to have details on how to compile a package.</div>
</li>
<li class="level1"><div class="li"> In the minor fix release of Chaos Calmer (15.05.1) it is available as a package.</div>
</li>
<li class="level1"><div class="li"> As a package in 15.05.1 or higher.</div>
</li>
<li class="level1"><div class="li"> </div>
</li>
</ul>

<p>
<strong>bandwidthd-php</strong>
</p>
<ul>
<li class="level1"><div class="li"> Available in LEDE/OpenWRT 17.01 or higher as a package and uses php7 or php8.  The PHP files found in these versions work fine with Chaos Calmer 15.05 or 15.05.1 with php5 (tested).</div>
</li>
</ul>

<p>
<strong>bandwidthd-sqlite</strong>
</p>
<ul>
<li class="level1"><div class="li"> Available in LEDE/OpenWRT 17.01 or higher.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Bandwidthd&quot;,&quot;hid&quot;:&quot;bandwidthd&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-3606&quot;} -->
<h2 class="sectionedit2" id="installation">Installation</h2>
<div class="level2">

<p>
For the bandwidthd package:
</p>
<pre class="code bash">opkg <span class="kw2">install</span> bandwidthd uhttpd
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd <span class="kw3">enable</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd start
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>bandwidthd <span class="kw3">enable</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>bandwidthd start</pre>

<p>
For the bandwidthd-pgsql package (note: do not install uhttpd if you do not plan for the router to perform the graphs):
</p>
<pre class="code bash">opkg <span class="kw2">install</span> bandwidthd-pgsql uhttpd
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd <span class="kw3">enable</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>uhttpd start
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>bandwidthd <span class="kw3">enable</span>
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>bandwidthd start</pre>

<p>
With all dependencies it uses around 500 kB of storage space.  If you have not changes the <abbr title="Internet Protocol">IP</abbr> address of your router (192.168.1.1), then the web page with the bandwidthd data will be available at <a href="http://192.168.1.1/bandwidthd" class="urlextern" title="http://192.168.1.1/bandwidthd" rel="ugc nofollow">http://192.168.1.1/bandwidthd</a>.  If you have changed the <abbr title="Internet Protocol">IP</abbr> address of your router, then edit the /etc/config/bandwidthd file to correct the address.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;3607-4456&quot;} -->
<h2 class="sectionedit3" id="configuration">Configuration</h2>
<div class="level2">

<p>
Packages <strong>bandwidth</strong>, <strong>bandwidthd-pgsql</strong> and <strong>bandwidthd-sqlite</strong> use basically the same configuration file: <em>/etc/config/bandwidthd
</em>
</p>

<p>
Each package installs the proper configuration file, and usually requires very little modifications, if any.
</p>

<p>
The options are the same for the 3 packages, with two additional for <strong>bandwidthd-pgsql</strong> and two others for <strong>bandwidthd-sqlite</strong>.
</p>

<p>
Here are the various options:
</p>

<p>
<em class="u">option dev</em>: Device to listen on.  The default is <em class="u">br-lan</em>.
</p>

<p>
<em class="u">option subnets</em>: Subnets to collect statistics on.  Traffic that matches none of these subnets will be ignored. Syntax is either <abbr title="Internet Protocol">IP</abbr> Subnet Mask or CIDR.  Ex: <em class="u">“10.0.0.0 255.0.0.0”</em>, <em class="u">“192.168.0.0/16”</em> or <em class="u">“172.16.0.0/12”</em>. The defaults is <em class="u">“192.168.1.0/24”</em>.
</p>

<p>
<em class="u">option skip_intervals</em>: An interval is 2.5 minutes, this is how many intervals to skip before doing a graphing run.  The default is <em class="u">0</em>.
</p>

<p>
<em class="u">option graph_cutoff</em>: Graph cutoff is how many k must be transferred by an ip before we bother to graph it.  The default is <em class="u">1024</em>.
</p>

<p>
<em class="u">option promiscuous</em>: Put interface in promiscuous mode to score to traffic that may not be routing through the host machine.  The default is <em class="u">true</em>.
</p>

<p>
<em class="u">option output_cdf</em>: Log data to cdf file <em class="u">log.cdf</em>.  All packages can log to cdf files.  These are only useful if you are using the <strong>bandwidthd</strong> package as the other packages (<strong>bandwidthd-pgsql</strong> and <strong>bandwidthd-sqlite</strong>) can store the data in a database.  These files are located on the root of the router (/).  The cdf files can be read when bandwidthd is started (see the option recover_cdf), which is useful if you reboot the router to recover the bandwidth data.  The default is <em class="u">false</em>.
</p>

<p>
<em class="u">option recover_cdf</em>: Read back the cdf file on startup.  See the comments for <em class="u">output_cdf</em> above.  The default is <em class="u">false</em>.
</p>

<p>
<em class="u">option filter</em>: Libpcap format filter string used to control what bandwidthd see&#039;s.  Please always include “ip” in the string to avoid strange problems.  The default is <em class="u">ip</em>.
</p>

<p>
<em class="u">option graph</em>: Draw Graphs - This default to true to graph the traffic bandwidthd is recording.  Usually set this to false if you only want cdf output or you are using the database output option (<strong>bandwidthd-pgsql</strong> or <strong>bandwidthd-sqlite</strong>).  Bandwidthd will use very little ram and cpu if this is set to false.  The defaults is <em class="u">true</em>.
</p>

<p>
<em class="u">option meta_refresh</em>: Set META REFRESH seconds (default 150, use 0 to disable).  Default is <em class="u">150</em>.
</p>

<p>
<em class="u">option pgsql_connect_string</em>: Only used for <strong>bandwidthd-pgsql</strong>.  Standard postgres connect string.  The default is <em class="u">“user = postgres dbname = bandwidthd host = 192.168.1.1”</em>.
</p>

<p>
<em class="u">option sensor_id</em>:  Used for <strong>bandwidthd-pgsql</strong> and <strong>bandwidthd-sqlite</strong>.  Arbitrary sensor name.  It can be anything you want for <strong>bandwidthd-pgsql</strong> but it has to be <em class="u">“default”</em> for <strong>bandwidthd-sqlite</strong>.  Default is <em class="u">“openwrt”</em> for <strong>bandwidthd-pgsql</strong>.
</p>

<p>
<em class="u">option sqlite_filename</em>: Only used for <strong>bandwidthd-sqlite</strong>.  This is the sqlite database file.  Default is <em class="u">“/www/bandwidthd/stats.db”</em>.
</p>

<p>
The package <strong>bandwidthd-php</strong> uses another configuration file: <em>/etc/config/bandwidthd-php</em>.  Package <strong>bandwidthd-sqlite</strong> can also use the <em>bandwidthd-php</em> configuration file (<strong>bandwidthd-sqlite</strong> uses two configuration files: <em>/etc/config/bandwidthd</em> and <em>/etc/config/bandwith-php</em>).
</p>

<p>
<strong>NOTE:</strong> the <strong>bandwidthd-sqlite</strong> package does not provide the <em>/etc/config/bandwidthd-php</em> file: it is not needed as the init file (<em>/etc/init.d/bandwidthd</em>) will provide the bandwidthd application the default graph sizes (900 and 256) and interval (INT_DAILY) and the default sqlite database: <em>/www/bandwidthd/stats.db</em>.  Create a /etc/config/bandwidthd-php file for bandwidthd-sqlite if you need to change the default.
</p>

<p>
Here are the options of the <em>/etc/config/bandwidthd-php</em> configuration file:
</p>

<p>
<em class="u">option dflt_width</em>:  Widthd of the graphs generated.  Default is <em class="u">&#039;900&#039;</em>.
</p>

<p>
<em class="u">option dflt_height</em>: height of the graphs generated.  Default is <em class="u">&#039;256&#039;</em>.
</p>

<p>
<em class="u">option dflt_interval</em>: Defaultinterval for the graphs.  The default is <em class="u">&#039;INT_DAILY&#039;</em>.  Options are: <em class="u">INT_DAILY</em>,  <em class="u">INT_WEEKLY</em>, <em class="u">INT_MONTHLY</em> and <em class="u">INT_YEARLY</em>.
</p>

<p>
<em class="u">option host</em>: This is for the host that has the postgresql database.  The default is <em class="u">&#039;127.0.0.1&#039;</em> which is the router.
</p>

<p>
<em class="u">option user</em>: This is the user owning the postgresql database.  Default is <em class="u">&#039;postgres&#039;</em>.
</p>

<p>
<em class="u">option dbname</em>: This is the name of the postgresql database.  Default is <em class="u">&#039;bandwidthd&#039;</em>.
</p>

<p>
A <em>/etc/config/bandwidthd-php</em> for <strong>bandwidthd-sqlite</strong> will have the same structure, but the options <em class="u">host</em>, <em class="u">user</em> and <em class="u">dbname</em> are not needed and are replaced by the following:
</p>

<p>
<em class="u">option sqlite_dbname “/www/bandwidthd/stats.db”</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:3,&quot;range&quot;:&quot;4457-9240&quot;} -->
<h2 class="sectionedit4" id="usage">Usage</h2>
<div class="level2">

<p>
By default, bandwidthd hosts its statistics at /bandwidthd. All packages (<strong>bandwidthd</strong>, <strong>bandwidthd-pgsql</strong> and <strong>bandwidthd-sqlite</strong>) are set by default to graph and if this is not the behaviour that you want, then change the <em class="u">option graph</em> to <em class="u">false</em> in the configuration file (<em>/etc/config/bandwidthd</em>)  For example, if the OpenWRT router&#039;s <abbr title="Internet Protocol">IP</abbr> address is 192.168.1.1, bandwidthd&#039;s stats would be available at <a href="http://192.168.1.1/bandwidthd" class="urlextern" title="http://192.168.1.1/bandwidthd" rel="ugc nofollow">http://192.168.1.1/bandwidthd</a>
</p>

<p>
<strong>bandwidthd-pgsql</strong> can store in a postgresql database and PHP has to be used to generate the graphs that are available at <a href="http://192.168.1.1/phphtdocs/index.php" class="urlextern" title="http://192.168.1.1/phphtdocs/index.php" rel="ugc nofollow">http://192.168.1.1/phphtdocs/index.php</a> (see below) (of course, change the <abbr title="Internet Protocol">IP</abbr> address to the one of the web server hosting the PHP files (your router or whatever web server you are using to graph the data)).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Usage&quot;,&quot;hid&quot;:&quot;usage&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;9241-10043&quot;} -->
<h2 class="sectionedit5" id="storing_bandwidthd_stats_in_external_permanent_storage">Storing bandwidthd stats in external permanent storage</h2>
<div class="level2">

<p>
The default bandwidthd installation loses your previous statistics on each reboot and you need more space to save those. To keep statistics it is needed to modify “/etc/config/bandwidthd”.
</p>

<p>
You need to change “option output_cdf	true” and “option recover_cdf	true” and “option sqlite_filename    &#039;file.db&#039; ”
</p>
<pre class="file">config bandwidthd
	option dev		br-lan
	option subnets		&quot;192.168.1.0/24&quot;
	option skip_intervals	0
	option graph_cutoff	1024
	option promiscuous	true
	option output_cdf	true
	option recover_cdf	true
	option filter		ip
	option graph		true
	option meta_refresh	150
        option SQLite_filename  &quot;/path/to/file.db&quot; # file gets created automatically and default path works pretty well</pre>

<p>
After modifying both of the files, restart the service. Afterwards, you will get a file and directory structure on your external mount like this:
</p>
<pre class="file">root@openwrt:~# ls -la /mnt/usb/bandwidthd/
drwxr-xr-x    3 root     root         1024 Aug 25 12:21 .
drwxr-xr-x    6 root     root         1024 Aug 25 00:39 ..
-rw-r--r--    1 root     root          158 Aug 25 00:40 bandwidthd.conf
drwxr-xr-x    2 root     root         2048 Aug 25 00:40 htdocs
-rw-r--r--    1 root     root        50034 Aug 25 12:21 log.1.0.cdf
-rw-r--r--    1 root     root        22204 Aug 25 12:21 log.2.0.cdf
-rw-r--r--    1 root     root         6698 Aug 25 12:10 log.3.0.cdf
-rw-r--r--    1 root     root          529 Aug 25 00:39 log.4.0.cdf</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Storing bandwidthd stats in external permanent storage&quot;,&quot;hid&quot;:&quot;storing_bandwidthd_stats_in_external_permanent_storage&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;10044-11548&quot;} -->
<h2 class="sectionedit6" id="storing_bandwidthd_stats_in_a_postgresql_database">Storing bandwidthd stats in a postgresql database</h2>
<div class="level2">

<p>
Bandwidthd now has support for external databases: it is provided by the <strong>bandwidthd-pgsql</strong> package: <em class="u">the <strong>bandwidthd</strong> package does not support this</em>.  This system consists of 3 major parts, and each part can be on a different server:
</p>
<ol>
<li class="level1"><div class="li"> <strong>The bandwidthd binary</strong> which acts as a sensor, recording traffic information and storing it in a database across the network or on the OpenWrt router.  In this mode Bandwidthd uses very little ram and CPU. In addition, multiple sensors can record to the same database.</div>
</li>
<li class="level1"><div class="li"> <strong>The database system.</strong>  Currently Bandwidthd only supports Postgresql.  Please note that the postgres-server package on OpenWrt is pretty big (the server and a blank database takes more than 15 <abbr title="Megabyte">MB</abbr>) and unless you have at lot of memory in your router, you will not be able to install it!</div>
</li>
<li class="level1"><div class="li"> <strong>The webserver and php application.</strong>  The package <strong>bandwidthd-php</strong> provides the required file if these have to run on the OpenWrt router.  In the “/www/phphtdocs” directory is a php application that reports on and graphs the contents of the database.  This has been designed to be easy to customize.  Everything is passed around on the urls, just tinker with it a little and you&#039;ll see how to generate custom graphs pretty easy.</div>
</li>
</ol>

<p>
Using Bandwidthd with a database has many advantages, such as much lower overhead, because graphs are only graphed on demand.  And much more flexibility, SQL makes building new reports easy, and php+sql greatly improves the interactivity of the reports.
</p>

<p>
<strong>It is strongly recommended to use the router only to collect the data and store it to another server running postgres.</strong>  That same server can also be running the web server and use PHP to generate the graphs, but generating the graphs can take a lot of CPU time for a router and the various packages (postgresql, php) uses a lot of memory space that most router do not have.
</p>

<p>
<strong>INSTRUCTIONS</strong>
</p>

<p>
As a prerequisite for these instructions, you must have Postgresql server installed and working for the database, as well as a web server that supports php for the web server that will generate the graphs.  Consult <a href="https://forum.openwrt.org/viewtopic.php?id=11812" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=11812" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?id=11812</a> to have more information on installing postgresql on OpenWrt.  For other OSes (Linux, NetBSD, Unix, etc.) consult the help on the respective <abbr title="Operating System">OS</abbr>.
</p>

<p>
<strong><em class="u">Database Setup:</em></strong>  Note that the database can reside on a remote computer and does not have to be on the OpenWrt router.  If not using the router for the database, the required files for the setup can be found at <a href="http://bandwidthd.sourceforge.net/" class="urlextern" title="http://bandwidthd.sourceforge.net/" rel="ugc nofollow">http://bandwidthd.sourceforge.net/</a>.
</p>
<ol>
<li class="level1"><div class="li"> Create a database for bandwidthd.  You will need to create a user that can access the database remotely if you want remote sensors. In OpenWrt, log as the user postgres (su - postgres) and issue the command “createdb bandwidthd”, then go back to be the root user with “exit”.</div>
</li>
<li class="level1"><div class="li"> Bandwidthd&#039;s schema is in “schema.postgresql” that can be found in /usr/share/postgresql (provided by the bandwidthd-pgsql package).  “psql mydb username &lt; schema.postgresql” should load it and create the 2 tables and 4 indexes.</div>
</li>
</ol>

<p>
In addition, you should schedule bd_pgsql_purge.sh to run every so often.  I recommend 
running it weekly.  This script outputs sql statements that aggregate the older 
data points in your database in order to reduce the amount of data that needs to
be slogged through in order to generate yearly, monthly, and weekly graphs.
</p>

<p>
Example to be run as the postgres user:
</p>

<p>
bd_pgsql_purge.sh | psql bandwidthd postgres
</p>

<p>
Will connect to the bandwidthd database on local host as the user postgres and summarize 
the data.
</p>

<p>
<strong><em class="u">Bandwidthd Setup:</em></strong>
Here is the /etc/config/bandwidthd file in the <strong>bandwidthd-pgsql</strong> package:
</p>
<pre class="code">config bandwidthd
        option dev      br-lan
        option subnets          &quot;192.168.1.0/24&quot;
        option skip_intervals   0
        option graph_cutoff     1024
        option promiscuous      true
        option output_cdf       false
        option recover_cdf      false
        option filter           ip
        option graph            true
        option meta_refresh     150
        option pgsql_connect_string    &quot;user = postgres dbname = bandwidthd host = 192.168.1.1&quot;
        option sensor_id       &quot;openwrt&quot;</pre>

<p>
The default configuration file may work, but chances are that you will have to modify it.  Modify the following lines:
</p>
<pre class="code">option graph false
   By default this is true so you can at least get some graph at http://192.168.1.1/bandwidthd even if the pgsql settings
   are not adequate.  If you plan to only use PHP to obtain your graphs, then set it at false.
option pgsql_connect_string    &quot;user = postgres dbname = bandwidthd host = 192.168.1.1&quot;
   Change the user variable to the proper username
   Change the dbname variable to the database name (by default it is bandwidthd)
   Change the host variable to the IP address (or the domain name) of the postghresql server
 option sensor_id &quot;openwrt&quot;
   Change the name to the name that you want for your sensor: the name you give is not really critical.</pre>

<p>
Simply start bandwidthd (/etc/init.d/bandwidthd start), and after a few minutes data should start appearing in 
your database.  If not, check syslog (logread) for error messages. (see <a href="https://wiki.openwrt.org/doc/howto/log.essentials" class="urlextern" title="https://wiki.openwrt.org/doc/howto/log.essentials" rel="ugc nofollow">https://wiki.openwrt.org/doc/howto/log.essentials</a> if you want more information on syslog in OpenWRT)
</p>

<p>
<strong><em class="u">Web Server Setup:</em></strong>  Note that the web server can be on a remote web server and does not have to reside on the OpenWrt router.  Consult <a href="http://wiki.openwrt.org/doc/howto/php" class="urlextern" title="http://wiki.openwrt.org/doc/howto/php" rel="ugc nofollow">http://wiki.openwrt.org/doc/howto/php</a> for installation of PHP on OpenWrt.  For other OSes (Linux, NetBSD, Unix, etc.) consult the help on the respective <abbr title="Operating System">OS</abbr>.  You will also have to configure the web server to work with PHP.  Running this on OpenWrt takes about 2 <abbr title="Megabyte">MB</abbr> of storage space for the various packages.
</p>
<ol>
<li class="level1"><div class="li"> Copy the contents of phphtdocs into your web tree somewhere: these files are available at <a href="http://bandwidthd.sourceforge.net/" class="urlextern" title="http://bandwidthd.sourceforge.net/" rel="ugc nofollow">http://bandwidthd.sourceforge.net/</a>, <a href="https://github.com/NethServer/bandwidthd" class="urlextern" title="https://github.com/NethServer/bandwidthd" rel="ugc nofollow">https://github.com/NethServer/bandwidthd</a> or   in the <strong>bandwidthd-php</strong> package: the package will install them automatically and puts then in /www/phphtdocs.</div>
</li>
<li class="level1"><div class="li"> Edit the file bandwidthd-php in /etc/config to set your db connect string (<em class="u">$db_connect_string = “host=192.168.1.1 user=postgres dbname=bandwidthd”</em>).  The variables <em class="u">host</em>, <em class="u">user</em> and <em class="u">dbname</em> have to be edited in order to connect to the database.</div>
</li>
<li class="level1"><div class="li"> On OpenWrt, the following packages will be installed automatically: <strong>libpcre</strong>; <strong>libxml2</strong>; <strong>php7</strong>; <strong>php7-cgi</strong>; <strong>php7-mod-pgsql</strong> and <strong>php7-mod-gd</strong>. On another system, the corresponding packages should be installed.  Note that it also works with php5 which to be used on Chaos Calmer as php7 is not available.</div>
</li>
<li class="level1"><div class="li"> Starting at the end of 2021, <strong>php8</strong> maybe installed instead of <strong>php7</strong>.</div>
</li>
<li class="level1"><div class="li"> With php5, a zoneinfo package should be installed (ex: <strong>zoneinfo-northamerica</strong> or <strong>zoneinfo-europe</strong>).  This is required to set the date.timezone value in php.ini.</div>
</li>
<li class="level1"><div class="li"> If you are not using the <strong>bandwidthd-php</strong> package from OpenWrt (i.e. you got the php files on the web at one of the links above), the file /etc/php.ini should be edited to have the following: <strong>short_open_tag = On</strong>: the reason is that the php files taken from <a href="http://bandwidthd.sourceforge.net/" class="urlextern" title="http://bandwidthd.sourceforge.net/" rel="ugc nofollow">http://bandwidthd.sourceforge.net/</a> or <a href="https://github.com/NethServer/bandwidthd" class="urlextern" title="https://github.com/NethServer/bandwidthd" rel="ugc nofollow">https://github.com/NethServer/bandwidthd</a> have the php short tag (&lt;? ?&gt;) instead of the normal tag (&lt;?php ?&gt;).  If you do not do it, then you will get a bunch of garbage on the screen.  If you installed the <strong>bandwidthd-php</strong> package on your router, then this is not necessary to set the <strong>short_open_tag =</strong> at <strong>On</strong> as the tags in the php files have been corrected to have &lt;?php ?&gt;.</div>
</li>
<li class="level1"><div class="li"> In the /etc/php.ini file a <strong>date.timezone =</strong> whould be present (ex:<strong>date.timezone = “America/Montreal”</strong>).  <em class="u">Without the <strong>date.timezone</strong> set to something valid, the graphs will not be drawn</em>.</div>
</li>
<li class="level1"><div class="li"> In the /etc/php.ini file the <strong>display_errors</strong> should be set to off as many variables are not defined.  If you have <strong>display_errors = On</strong> the web page will most probably not work.</div>
</li>
<li class="level1"><div class="li"> If you are using uhttpd, the following two lines should be added to /etc/config/uhttpd: <strong>list interpreter &#039;.php=/usr/bin/php-cgi&#039;</strong> and <strong>option index_page &#039;index.php&#039;</strong>.</div>
</li>
</ol>

<p>
You should now be able to access the web application and see you graphs.  All graphing is done by graph.php,  all parameters are passed to it in it&#039;s url.  You can create custom urls to pull custom graphs from your own index pages, or use the canned reporting system.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Storing bandwidthd stats in a postgresql database&quot;,&quot;hid&quot;:&quot;storing_bandwidthd_stats_in_a_postgresql_database&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:6,&quot;range&quot;:&quot;11549-&quot;} -->