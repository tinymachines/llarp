
<h1 class="sectionedit1" id="openconnect_client">OpenConnect client</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenConnect client&quot;,&quot;hid&quot;:&quot;openconnect_client&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-115&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> This how-to describes the method for setting up <a href="/packages/pkgdata/openconnect" class="wikilink1" title="packages:pkgdata:openconnect" data-wiki-id="packages:pkgdata:openconnect">openconnect</a> client on OpenWrt.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/services/vpn/openconnect/server" class="wikilink1" title="docs:guide-user:services:vpn:openconnect:server" data-wiki-id="docs:guide-user:services:vpn:openconnect:server">OpenConnect server</a> for server setup and <a href="/docs/guide-user/services/vpn/openconnect/extras" class="wikilink1" title="docs:guide-user:services:vpn:openconnect:extras" data-wiki-id="docs:guide-user:services:vpn:openconnect:extras">OpenConnect extras</a> for additional tuning.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;116-443&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-user:services:vpn:wireguard:server&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-user:services:vpn:wireguard:server">
<div class="level2">
<ul>
<li class="level1 node"><div class="li"> Encrypt your internet connection to enforce security and privacy.</div>
<ul>
<li class="level2"><div class="li"> Prevent traffic leaks and spoofing on the client side.</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Bypass regional restrictions using commercial providers.</div>
<ul>
<li class="level2"><div class="li"> Escape client side content filters and internet censorship.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Access your <abbr title="Local Area Network">LAN</abbr> services remotely without port forwarding.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-user:services:vpn:wireguard:server&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;444-557&quot;} -->
<h2 class="sectionedit10" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;558-595&quot;} -->
<h3 class="sectionedit11" id="preparation">1. Preparation</h3>
<div class="level3">

<p>
Install the required packages.
Specify configuration parameters for <abbr title="Virtual Private Network">VPN</abbr> client.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> openconnect openssl-util
&nbsp;
<span class="co0"># Configuration parameters</span>
<span class="re2">VPN_IF</span>=<span class="st0">&quot;vpn&quot;</span>
<span class="re2">VPN_SERV</span>=<span class="st0">&quot;SERVER_ADDRESS&quot;</span>
<span class="re2">VPN_PORT</span>=<span class="st0">&quot;4443&quot;</span>
<span class="re2">VPN_USER</span>=<span class="st0">&quot;USERNAME&quot;</span>
<span class="re2">VPN_PASS</span>=<span class="st0">&quot;PASSWORD&quot;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Preparation&quot;,&quot;hid&quot;:&quot;preparation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;596-914&quot;} -->
<h3 class="sectionedit12" id="key_management">2. Key management</h3>
<div class="level3">

<p>
Run the code below directly on the <abbr title="Virtual Private Network">VPN</abbr> server if you can or <a href="/docs/guide-user/services/vpn/openconnect/extras#server_certificate" class="wikilink1" title="docs:guide-user:services:vpn:openconnect:extras" data-wiki-id="docs:guide-user:services:vpn:openconnect:extras">fetch certificate</a> from the server and generate the hash locally:
</p>
<pre class="code bash"><span class="co0"># Generate certificate hash</span>
<span class="re2">VPN_CERT</span>=<span class="st0">&quot;server-cert.pem&quot;</span>
<span class="re2">VPN_HASH</span>=<span class="st0">&quot;pin-sha256:$(openssl x509 -in <span class="es3">${VPN_CERT}</span> -pubkey -noout <span class="es1">\
</span>| openssl pkey -pubin -outform der <span class="es1">\
</span>| openssl dgst -sha256 -binary <span class="es1">\
</span>| openssl enc -base64)&quot;</span></pre>

<p>
Variable <code>$<abbr title="Virtual Private Network">VPN</abbr>_HASH</code> will be used in the example below. Alternatively print its value with <code>echo $<abbr title="Virtual Private Network">VPN</abbr>_HASH</code> and use it with <code>serverhash</code> in the configuration file or in “<abbr title="Virtual Private Network">VPN</abbr> Server&#039;s certificate SHA1 hash” in Luci.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Key management&quot;,&quot;hid&quot;:&quot;key_management&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:12,&quot;range&quot;:&quot;915-1599&quot;} -->
<h3 class="sectionedit13" id="firewall">3. Firewall</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-user:services:vpn:wireguard:client&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-user:services:vpn:wireguard:client">
<div class="level3">

<p>
Consider <abbr title="Virtual Private Network">VPN</abbr> network as public.
Assign <abbr title="Virtual Private Network">VPN</abbr> interface to <abbr title="Wide Area Network">WAN</abbr> zone to minimize firewall setup.
</p>
<pre class="code bash"><span class="co0"># Configure firewall</span>
uci rename firewall.<span class="sy0">@</span>zone<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span>=<span class="st0">&quot;lan&quot;</span>
uci rename firewall.<span class="sy0">@</span>zone<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>=<span class="st0">&quot;wan&quot;</span>
uci del_list firewall.wan.network=<span class="st0">&quot;<span class="es3">${VPN_IF}</span>&quot;</span>
uci add_list firewall.wan.network=<span class="st0">&quot;<span class="es3">${VPN_IF}</span>&quot;</span>
uci commit firewall
service firewall restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-user:services:vpn:wireguard:client&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3. Firewall&quot;,&quot;hid&quot;:&quot;firewall&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:13,&quot;range&quot;:&quot;1600-1720&quot;} -->
<h3 class="sectionedit16" id="network">4. Network</h3>
<div class="level3">

<p>
Set up <abbr title="Virtual Private Network">VPN</abbr> interface.
</p>
<pre class="code bash"><span class="co0"># Configure network</span>
uci <span class="re5">-q</span> delete network.<span class="co1">${VPN_IF}</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>=<span class="st0">&quot;interface&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.proto=<span class="st0">&quot;openconnect&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.server=<span class="st0">&quot;<span class="es3">${VPN_SERV}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.port=<span class="st0">&quot;<span class="es3">${VPN_PORT}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.username=<span class="st0">&quot;<span class="es3">${VPN_USER}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.password=<span class="st0">&quot;<span class="es3">${VPN_PASS}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${VPN_IF}</span>.serverhash=<span class="st0">&quot;<span class="es3">${VPN_HASH}</span>&quot;</span>
uci commit network
service network restart</pre>

<p>
See all available OpenConnect protocol options <a href="/docs/guide-user/network/tunneling_interface_protocols#protocol_openconnect_openconnect_vpn" class="wikilink1" title="docs:guide-user:network:tunneling_interface_protocols" data-wiki-id="docs:guide-user:network:tunneling_interface_protocols">here</a> and a sample configuration <a href="https://github.com/openwrt/packages/blob/master/net/openconnect/README" class="urlextern" title="https://github.com/openwrt/packages/blob/master/net/openconnect/README" rel="ugc nofollow">here</a>.
</p>

<p>
Disable <a href="/docs/guide-user/services/vpn/openconnect/extras#gateway_redirection" class="wikilink1" title="docs:guide-user:services:vpn:openconnect:extras" data-wiki-id="docs:guide-user:services:vpn:openconnect:extras">gateway redirection</a> and/or <a href="/docs/guide-user/services/vpn/openconnect/extras#keep_existing_gateway" class="wikilink1" title="docs:guide-user:services:vpn:openconnect:extras" data-wiki-id="docs:guide-user:services:vpn:openconnect:extras">keep the existing gateway</a> if necessary.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;4. Network&quot;,&quot;hid&quot;:&quot;network&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;1721-2683&quot;} -->
<h2 class="sectionedit17" id="web-based_configuration">Web-based configuration</h2>
<div class="level2">

<p>
Web-based configuration is available through <a href="/packages/pkgdata/luci-proto-openconnect" class="wikilink1" title="packages:pkgdata:luci-proto-openconnect" data-wiki-id="packages:pkgdata:luci-proto-openconnect">luci-proto-openconnect</a> package.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> luci-proto-openconnect
service rpcd restart</pre>

<p>
Open Luci web interface and navigate to Network → Interfaces, then Add new interface… → Protocol: OpenConnect
</p>

<p>
Currently not all the <a href="/docs/guide-user/network/tunneling_interface_protocols#protocol_openconnect_openconnect_vpn" class="wikilink1" title="docs:guide-user:network:tunneling_interface_protocols" data-wiki-id="docs:guide-user:network:tunneling_interface_protocols">options</a> can be set through Luci, so manual changes in <code>/etc/config/network</code> might be needed.
</p>

<p>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web-based configuration&quot;,&quot;hid&quot;:&quot;web-based_configuration&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:17,&quot;range&quot;:&quot;2684-3263&quot;} -->
<h2 class="sectionedit18" id="testing">Testing</h2>
<div class="level2">

<p>
Establish the <abbr title="Virtual Private Network">VPN</abbr> connection.
Verify your routing with <a href="http://man.cx/traceroute%288%29" class="interwiki iw_man" title="http://man.cx/traceroute%288%29">traceroute</a> and <a href="http://man.cx/traceroute6%288%29" class="interwiki iw_man" title="http://man.cx/traceroute6%288%29">traceroute6</a>.
</p>
<pre class="code bash">traceroute openwrt.org
traceroute6 openwrt.org</pre>

<p>
Check your external <abbr title="Internet Protocol">IP</abbr> address and <abbr title="Domain Name System">DNS</abbr> provider in use
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://whatsmyip.com/" class="urlextern" title="https://whatsmyip.com/" rel="ugc nofollow"> WhatIsMyIP</a> should show a public <abbr title="Internet Protocol">IP</abbr> address of <abbr title="Virtual Private Network">VPN</abbr> server if all the traffic is routed through the <abbr title="Virtual Private Network">VPN</abbr> connection</div>
</li>
<li class="level1"><div class="li"> <a href="https://ipleak.net/" class="urlextern" title="https://ipleak.net/" rel="ugc nofollow">ipleak.net</a>, <a href="https://www.dnsleaktest.com/" class="urlextern" title="https://www.dnsleaktest.com/" rel="ugc nofollow">dnsleaktest.com</a> results depend on whether <abbr title="Domain Name System">DNS</abbr> traffic is routed through the <abbr title="Virtual Private Network">VPN</abbr> connection</div>
</li>
</ul>

<p>
On router:
</p>
<ul>
<li class="level1"><div class="li"> Go to <strong>LuCI &gt; Network &gt; Interfaces</strong> and look for <abbr title="Virtual Private Network">VPN</abbr> interface state, its <abbr title="Internet Protocol">IP</abbr> address and Tx/Rx counters</div>
</li>
<li class="level1"><div class="li"> Go to <strong>LuCI &gt; Network &gt; Diagnostics</strong> and <strong>ipv4 ping</strong> any address that should be accessible through the <abbr title="Virtual Private Network">VPN</abbr> connection</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Testing&quot;,&quot;hid&quot;:&quot;testing&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:18,&quot;range&quot;:&quot;3264-4094&quot;} -->
<h2 class="sectionedit19" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Collect and analyze the following information.
</p>
<pre class="code bash"><span class="co0"># Restart services</span>
service log restart; service network restart; <span class="kw2">sleep</span> <span class="nu0">10</span>
&nbsp;
<span class="co0"># Log and status</span>
logread <span class="re5">-e</span> openconnect
&nbsp;
<span class="co0"># Runtime configuration</span>
pgrep <span class="re5">-f</span> <span class="re5">-a</span> openconnect
<span class="kw2">ip</span> address show; <span class="kw2">ip route</span> show table all
<span class="kw2">ip rule</span> show; <span class="kw2">ip</span> <span class="re5">-6</span> rule show; nft list ruleset
&nbsp;
<span class="co0"># Persistent configuration</span>
uci show network; uci show firewall</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:19,&quot;range&quot;:&quot;4095-&quot;} -->