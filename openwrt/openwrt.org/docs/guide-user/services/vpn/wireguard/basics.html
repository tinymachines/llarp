
<h1 class="sectionedit1" id="wireguard_basics">WireGuard basics</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;WireGuard basics&quot;,&quot;hid&quot;:&quot;wireguard_basics&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-113&quot;} -->
<h2 class="sectionedit6" id="protocol">Protocol</h2>
<div class="level2">

<p>
WireGuard is an <a href="https://en.wikipedia.org/wiki/Open-source_software" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Open-source_software">OSS</a> and protocol that implements <a href="https://en.wikipedia.org/wiki/Virtual_private_network" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Virtual_private_network">VPN</a> by creating secure point-to-point connections over <abbr title="User Datagram Protocol">UDP</abbr> in routed configurations.
It runs as a module inside the Linux kernel and aims for better performance than the IPsec and OpenVPN tunneling protocols.
The protocol is designed to provide a general purpose <abbr title="Virtual Private Network">VPN</abbr> solution and can support <a href="/docs/guide-user/services/vpn/wireguard/serverclient" class="wikilink1" title="docs:guide-user:services:vpn:wireguard:serverclient" data-wiki-id="docs:guide-user:services:vpn:wireguard:serverclient">different configuration types</a> including point-to-point, client-server, and site-to-site connections.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Protocol&quot;,&quot;hid&quot;:&quot;protocol&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;114-692&quot;} -->
<h2 class="sectionedit7" id="key_management">Key management</h2>
<div class="level2">

<p>
WireGuard generally relies on <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Public-key_cryptography">public-key cryptography</a>.
It requires to generate a private and public key for each peer and exchange only the public keys.
The private key is best never disclosed outside the peer where it was generated.
For better security, you can also generate and exchange a pre-shared key.
Each pair of peers should use one pre-shared key.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Key management&quot;,&quot;hid&quot;:&quot;key_management&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;693-1109&quot;} -->
<h2 class="sectionedit8" id="time_synchronization">Time synchronization</h2>
<div class="level2">

<p>
WireGuard is time sensitive and can refuse to pass traffic if the peer&#039;s clock is out of sync.
It&#039;s recommended to rely on <abbr title="Network Time Protocol">NTP</abbr> for all peers.
The issue could be caused by incorrect <abbr title="Network Time Protocol">NTP</abbr> configuration, or race conditions between netifd and sysntpd services, specifically when RTC is missing.
Setting <a href="/docs/guide-user/services/vpn/wireguard/extras#race_conditions" class="wikilink1" title="docs:guide-user:services:vpn:wireguard:extras" data-wiki-id="docs:guide-user:services:vpn:wireguard:extras">time forward</a> on the client side can work around the problem.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Time synchronization&quot;,&quot;hid&quot;:&quot;time_synchronization&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;1110-1568&quot;} -->
<h2 class="sectionedit9" id="web_interface_instructions">Web interface instructions</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web interface instructions&quot;,&quot;hid&quot;:&quot;web_interface_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;1569-1607&quot;} -->
<h3 class="sectionedit10" id="installing_packages">1. Installing packages</h3>
<div class="level3">

<p>
Navigate to <strong>LuCI → System → Software</strong> and install the package <a href="/packages/pkgdata/luci-proto-wireguard" class="wikilink1" title="packages:pkgdata:luci-proto-wireguard" data-wiki-id="packages:pkgdata:luci-proto-wireguard">luci-proto-wireguard</a>.
</p>

<p>
Optionally install the package <a href="/packages/pkgdata/qrencode" class="wikilink1" title="packages:pkgdata:qrencode" data-wiki-id="packages:pkgdata:qrencode">qrencode</a> to allow creation of a QR code when creating a peer configuration for simple import onto a phone wireguard client.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;1. Installing packages&quot;,&quot;hid&quot;:&quot;installing_packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;1608-1929&quot;} -->
<h3 class="sectionedit11" id="generating_keys">2. Generating keys</h3>
<div class="level3">

<p>
Generate a key pair of private and public keys.
</p>
<pre class="code bash">wg genkey <span class="sy0">|</span> <span class="kw2">tee</span> wg.key <span class="sy0">|</span> wg pubkey <span class="sy0">&gt;</span> wg.pub</pre>
<ul>
<li class="level1"><div class="li"> Use the <strong>wg.key</strong> file to configure the WireGuard interface on this router.</div>
</li>
<li class="level1"><div class="li"> Use the <strong>wg.pub</strong> file to configure peers that will connect to <em>this</em> router through the WireGuard <abbr title="Virtual Private Network">VPN</abbr>.</div>
</li>
</ul>

<p>
Alternatively a key pair can be generated later when creating the network interface at step 4 via the Luci web interface.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;2. Generating keys&quot;,&quot;hid&quot;:&quot;generating_keys&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;1930-2389&quot;} -->
<h3 class="sectionedit12" id="restarting_services">3. Restarting services</h3>
<div class="level3">

<p>
Navigate to <strong>LuCI → System → Startup → Initscripts</strong> and click to <strong>network → Restart</strong>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;3. Restarting services&quot;,&quot;hid&quot;:&quot;restarting_services&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:12,&quot;range&quot;:&quot;2390-2517&quot;} -->
<h3 class="sectionedit13" id="setting_up_network">4. Setting up network</h3>
<div class="level3">

<p>
To create a new WireGuard interface go to <strong>LuCI → Network → Interfaces → Add new interface...</strong> and select <strong>WireGuard <abbr title="Virtual Private Network">VPN</abbr></strong> from the <strong>Protocol</strong> dropdown menu.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;4. Setting up network&quot;,&quot;hid&quot;:&quot;setting_up_network&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:13,&quot;range&quot;:&quot;2518-2716&quot;} -->
<h3 class="sectionedit14" id="monitoring_status">5. Monitoring status</h3>
<div class="level3">

<p>
The menu <strong>LuCI → Status → WireGuard</strong> shows information about the WireGuard <abbr title="Virtual Private Network">VPN</abbr>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;5. Monitoring status&quot;,&quot;hid&quot;:&quot;monitoring_status&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:14,&quot;range&quot;:&quot;2717-2832&quot;} -->
<h2 class="sectionedit15" id="enabling_debug_support">Enabling debug support</h2>
<div class="level2">

<p>
To have wireguard send debug messages to the kernel message buffer, one must compile the kernel with the following option enabled:
</p>
<ul>
<li class="level1"><div class="li"> Global build settings &gt;&gt; Kernel build options &gt;&gt; Compile the kernel with dynamic printk</div>
</li>
</ul>

<p>
The resulting option will create <strong>/sys/kernel/debug/dynamic_debug/control</strong> which can be used to enable debug logging of wireguard with the following command:
</p>
<pre class="code">echo module wireguard +p &gt; /sys/kernel/debug/dynamic_debug/control</pre>

<p>
Now wireguard transactions should be echoed to the kernel message buffer, viewable by a call to dmesg.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Enabling debug support&quot;,&quot;hid&quot;:&quot;enabling_debug_support&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:15,&quot;range&quot;:&quot;2833-&quot;} -->