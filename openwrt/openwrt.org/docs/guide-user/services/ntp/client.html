
<h1 class="sectionedit1" id="ntpclient_configuration">Ntpclient configuration</h1>
<div class="level1">

<p>
The <code>ntpclient</code> configuration file defines parameters for the <a href="http://doolittle.icarus.com/ntpclient/" class="urlextern" title="http://doolittle.icarus.com/ntpclient/" rel="ugc nofollow">ntpclient</a> program, a small daemon that will keep the local clock in sync with time servers on the internet.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Ntpclient configuration&quot;,&quot;hid&quot;:&quot;ntpclient_configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-254&quot;} -->
<h2 class="sectionedit2" id="sections">Sections</h2>
<div class="level2">

<p>
The configuration file consists of a section defining general daemon options, a section defining clock drift information, and one or more sections defining time server hosts to use.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Sections&quot;,&quot;hid&quot;:&quot;sections&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;255-458&quot;} -->
<h3 class="sectionedit3" id="ntpclient">Ntpclient</h3>
<div class="level3">

<p>
The <code>ntpclient</code> section defines general daemon options.
This is the default configuration for this section:
</p>
<pre class="code bash">config <span class="st_h">'ntpclient'</span>
        option <span class="st_h">'interval'</span> <span class="st_h">'600'</span></pre>

<p>
The <code>ntpclient</code> section contains these settings:
</p>
<div class="table sectionedit4"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>count</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>0</code> </td><td class="col4"> Number of time measurements to perform before exiting. <code>0</code> means to never stop. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>interval</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>600</code> </td><td class="col4"> Seconds to pause between measurements, i.e. 10 minutes. It is usually neither necessary not helpful to reduce this number. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>interface</code> </td><td class="col1"> text </td><td class="col2"> no </td><td class="col3 rightalign">  <em>(none)</em> </td><td class="col4"> Default value for setting <code>interface</code> in <code>host</code> section. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;713-1158&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Ntpclient&quot;,&quot;hid&quot;:&quot;ntpclient&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;459-1159&quot;} -->
<h3 class="sectionedit5" id="drift">Drift</h3>
<div class="level3">

<p>
The <code>ntpdrift</code> section defines parameters to adjust the drift of the local clock so that it can run more accurately.
Please see the <a href="http://doolittle.icarus.com/ntpclient/HOWTO" class="urlextern" title="http://doolittle.icarus.com/ntpclient/HOWTO" rel="ugc nofollow">ntpclient HOWTO</a> on how to compute these parameters.
</p>

<p>
This is the default configuration for this section:
</p>
<pre class="code bash">config <span class="st_h">'ntpdrift'</span>
        option <span class="st_h">'freq'</span> <span class="st_h">'0'</span></pre>

<p>
The <code>ntpclient</code> section contains these settings:
</p>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>freq</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Frequency adjustment for the local clock. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;1580-1715&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Drift&quot;,&quot;hid&quot;:&quot;drift&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;1160-1716&quot;} -->
<h2 class="sectionedit7" id="hosts">Hosts</h2>
<div class="level2">

<p>
To receive time, at least one host must be configured through a <code>host</code> section.
OpenWrt will try the specified hosts in order, and use the first one that is responding to time requests.
OpenWrt uses the <a href="http://www.pool.ntp.org/" class="urlextern" title="http://www.pool.ntp.org/" rel="ugc nofollow">NTP Pool</a> to locate a close-by time server.
</p>

<p>
These are the default hosts:
</p>
<pre class="code bash">config <span class="st_h">'ntpserver'</span>
        option <span class="st_h">'hostname'</span> <span class="st_h">'0.openwrt.pool.ntp.org'</span>
        option <span class="st_h">'port'</span>     <span class="st_h">'123'</span>
&nbsp;
config <span class="st_h">'ntpserver'</span>
        option <span class="st_h">'hostname'</span> <span class="st_h">'1.openwrt.pool.ntp.org'</span>
        option <span class="st_h">'port'</span>     <span class="st_h">'123'</span>
&nbsp;
config <span class="st_h">'ntpserver'</span>
        option <span class="st_h">'hostname'</span> <span class="st_h">'2.openwrt.pool.ntp.org'</span>
        option <span class="st_h">'port'</span>     <span class="st_h">'123'</span>
&nbsp;
config <span class="st_h">'ntpserver'</span>
        option <span class="st_h">'hostname'</span> <span class="st_h">'3.openwrt.pool.ntp.org'</span>
        option <span class="st_h">'port'</span>     <span class="st_h">'123'</span></pre>

<p>
A <code>host</code> section contains these settings:
</p>
<div class="table sectionedit8"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>hostname</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Hostname of the <abbr title="Network Time Protocol">NTP</abbr> server. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>port</code> </td><td class="col1"> integer </td><td class="col2"> no </td><td class="col3"> <code>123</code> </td><td class="col4"> Port number the <abbr title="Network Time Protocol">NTP</abbr> server is listening on. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>interface</code> </td><td class="col1"> text </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> Only test this host if the specified interfaces comes up. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;2519-2831&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hosts&quot;,&quot;hid&quot;:&quot;hosts&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:7,&quot;range&quot;:&quot;1717-2832&quot;} -->
<h2 class="sectionedit9" id="ntpclient_startup_details">Ntpclient startup details</h2>
<div class="level2">

<p>
The ntpclient is started via the hotplug subsystem upon any network interface startup, see <code>/etc/hotplug.d/iface/20-ntpclient</code>.
The script starts the daemon in 4 phases:
</p>
<ol>
<li class="level1"><div class="li"> <strong>preliminary test</strong> - the script checks if the ntpclient is already running.</div>
</li>
<li class="level1"><div class="li"> <strong>drift</strong> - the scripts sets the specified <code>drift</code> in system clock.</div>
</li>
<li class="level1"><div class="li"> <strong>ntp server check phase</strong> - the script tests the reachability of the ntp servers (<code>hosts</code>) from config file (uses the ntpclient for this). The script only checks <code>hosts</code> where the specified <code>interface</code> (or inherited <code>interface</code> from <code>ntpclient</code> section) matches the interface that triggered <code>hotplug.d</code> or where no <code>interface</code> is specified at all. If no ntp server is reachable the script quits.</div>
</li>
<li class="level1"><div class="li"> <strong>operational phase</strong> - the ntpclient is started with the first reachable <code>host</code> and user configuration options (<code>interval</code> etc.) of polling and time adjustment</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Ntpclient startup details&quot;,&quot;hid&quot;:&quot;ntpclient_startup_details&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:9,&quot;range&quot;:&quot;2833-3783&quot;} -->
<h2 class="sectionedit10" id="ntpclient_shutdown_details">Ntpclient shutdown details</h2>
<div class="level2">

<p>
All instances of the ntpclient are killed via the hotplug subsystem upon any network interface shutdown, see <code>/etc/hotplug.d/iface/20-ntpclient</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Ntpclient shutdown details&quot;,&quot;hid&quot;:&quot;ntpclient_shutdown_details&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:10,&quot;range&quot;:&quot;3784-&quot;} -->