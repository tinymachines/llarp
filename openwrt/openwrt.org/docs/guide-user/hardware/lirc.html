
<h1 class="sectionedit1" id="lirc_gpio_receiverblaster">LIRC GPIO receiver / blaster</h1>
<div class="level1">

<p>
<a href="http://www.lirc.org/" class="urlextern" title="http://www.lirc.org/" rel="ugc nofollow">LIRC</a> is a package that allows you to decode and send infra-red signals of many (but not all) commonly used remote controls.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_important plugin_wrap" style="width: 60%;">
<p>
The kernel module used in this howto needs <strong>GPIO IRQs</strong>, otherwise it won&#039;t work. Not all devices have IRQs implemented at the GPIO lines in the kernel.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} -->
<p>
You&#039;ll need at least 2 free GPIOs in your router. Also you need to locate VCC (3.3V) and GND, but this is a piece of cake. You can omit the blaster if only interested on receiving. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LIRC GPIO receiver \/ blaster&quot;,&quot;hid&quot;:&quot;lirc_gpio_receiverblaster&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-573&quot;} -->
<h2 class="sectionedit4" id="prepare_your_hardware">Prepare your hardware</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prepare your hardware&quot;,&quot;hid&quot;:&quot;prepare_your_hardware&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;574-607&quot;} -->
<h3 class="sectionedit5" id="receiver">Receiver</h3>
<div class="level3">

<p>
The receiver is quite simple, it&#039;s directly connected to the GPIO, Vcc and GND
</p>

<p>
<a href="/_media/media/doc/howtos/lirc-gpio-generic.png" class="media" title="media:doc:howtos:lirc-gpio-generic.png"><img src="/_media/media/doc/howtos/lirc-gpio-generic.png?w=300&amp;tok=31942c" class="media" loading="lazy" alt="" width="300" /></a>
</p>

<p>
The receiver used in the test was a TSOP4838. Any other should also work if can be fed with 3.3V.
</p>

<p>
<a href="/_media/media/datasheets/tsop4838.jpg" class="media" title="media:datasheets:tsop4838.jpg"><img src="/_media/media/datasheets/tsop4838.jpg?w=200&amp;tok=edfc70" class="media" loading="lazy" alt="" width="200" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Receiver&quot;,&quot;hid&quot;:&quot;receiver&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;608-910&quot;} -->
<h3 class="sectionedit6" id="blaster">Blaster</h3>
<div class="level3">

<p>
For the IR emitter we need a few more components because a GPIO cannot supply more than 4mA.
</p>

<p>
<img src="/_media/media/doc/howtos/lirc-gpioblaster_reduced.png?w=300&amp;tok=cd879d" class="media" loading="lazy" alt="" width="300" />
</p>

<p>
See <a href="/docs/guide-user/hardware/lirc-gpioblaster" class="wikilink1" title="docs:guide-user:hardware:lirc-gpioblaster" data-wiki-id="docs:guide-user:hardware:lirc-gpioblaster">lirc-gpioblaster</a> for more details. Although this circuit can be omited, if we are only interested on receiving. Later, we can configure the lirc-gpio-generic module with an unused dummy GPIO.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Blaster&quot;,&quot;hid&quot;:&quot;blaster&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;911-1313&quot;} -->
<h2 class="sectionedit7" id="prepare_your_software">Prepare your software</h2>
<div class="level2">

<p>
You will need to make a custom build. The module lirc-gpio-generic isn&#039;t available in the official repositories, and LIRC is not maintained an probably broken. 
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_download plugin_wrap" style="width: 60%;">
<p>
These are the kernel module lirc-gpio-generic, and LIRC package (Tested in Barrier Breaker):
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/danitool/openwrt-pkgs/tree/bb/lirc-gpio-generic" class="urlextern" title="https://github.com/danitool/openwrt-pkgs/tree/bb/lirc-gpio-generic" rel="ugc nofollow">https://github.com/danitool/openwrt-pkgs/tree/bb/lirc-gpio-generic</a> </div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/danitool/openwrt-pkgs/tree/bb/lirc" class="urlextern" title="https://github.com/danitool/openwrt-pkgs/tree/bb/lirc" rel="ugc nofollow">https://github.com/danitool/openwrt-pkgs/tree/bb/lirc</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} -->
<p>
Put the directories under the <strong><em>package</em></strong>/ subdirectory at the build root.
</p>

<p>
As usually build your custom firmware but select <code>lirc</code>
</p>
<pre class="code">Location: 
    -&gt; Utilities</pre>
<div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<td class="col0"> <pre class="code">┌─────────────────────────────────── Utilities ───────────────────────────────────┐
│ ┌─────────────────────────────────────────────────────────────────────────────┐ │  
│ │     Boot Loaders  ---&gt;                                                      │ │  
│ │     Editors  ---&gt;                                                           │ │  
│ │     Filesystem  ---&gt;                                                        │ │  
│ │     Terminal  ---&gt;                                                          │ │  
│ │     disc  ---&gt;                                                              │ │  
│ │ &lt; &gt; alsa-utils............ ALSA (Advanced Linux Sound Architecture) utilitie│ │  
│ │ &lt; &gt; alsa-utils-seq.................................. ALSA sequencer utilitie│ │  
│ │ &lt; &gt; alsa-utils-tests.......... ALSA utilities test data (adds ~1.3M to image│ │  
│ │ &lt; &gt; bzip2.................................... bzip2 is a compression utility│ │  
│ │ &lt; &gt; cal................................................... display a calenda│ │  
│ │ &lt; &gt; comgt............................... Option/Vodafone 3G/GPRS control too│ │  
│ │ &lt; &gt; dmesg............................ print or control the kernel ring buffe│ │  
│ │ &lt; &gt; dropbearconvert.......................... Utility for converting SSH key│ │  
│ │ &lt; &gt; fconfig..................................... RedBoot configuration edito│ │  
│ │ &lt; &gt; flock.................................... manage locks from shell script│ │  
│ │ &lt; &gt; gdb......................................................... GNU Debugge│ │  
│ │ &lt; &gt; gdbserver................................. Remote server for GNU Debugge│ │  
│ │ &lt; &gt; getopt.................................. parse command options (enhanced│ │  
│ │ &lt; &gt; gpioctl................................... Tool for controlling gpio pin│ │  
│ │ &lt; &gt; hwclock.................................. query or set the hardware cloc│ │  
│ │ &lt; &gt; iconv................................... Character set conversion utilit│ │  
│ │ &lt; &gt; iwcap.................................... Simple radiotap capture utilit│ │  
│ │ &lt; &gt; iwinfo.......................... Generalized Wireless Information utilit│ │  
│ │ --- jshn................................................. JSON SHell Notatio│ │  
│ │ &lt; &gt; kexec-tools.......................................... Kernel boots kerne│ │  
│ │ &lt; &gt; ldconfig............................... Shared library path configuratio│ │  
│ │ &lt; &gt; ldd.................................................... LDD trace utilit│ │  
│ │ &lt;*&gt; lirc................................ LIRC - Linux Infrared Remote Contro│ │  
│ │ &lt; &gt; logger......... a shell command interface to the syslog system log modul│ │  
│ │ &lt; &gt; look......................... display lines beginning with a given strin│ │  
│ └─v(+)────────────────────────────────────────────────────────────────────────┘ │  
├─────────────────────────────────────────────────────────────────────────────────┤  
│                        &lt;Select&gt;    &lt; Exit &gt;    &lt; Help &gt;                         │  
└─────────────────────────────────────────────────────────────────────────────────┘</pre>
</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;1957-6103&quot;} -->
<p>
Under <code>lirc</code> select <code>lirctools</code>
</p>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0"> <pre class="code">┌────────── lirc........................ LIRC - Linux Infrared Remote Control ──────────┐
│ ┌───────────────────────────────────────────────────────────────────────────────────┐ │  
│ │  --- lirc................................ LIRC - Linux Infrared Remote Control    │ │  
│ │  &lt; &gt;   lirc-audioalsa......................................... plugin audio_alsa  │ │  
│ │  &lt; &gt;   lirc-devinput............................................ plugin devinput  │ │  
│ │  &lt; &gt;   lirc-ftdi.................................................... plugin ftdi  │ │  
│ │  &lt;*&gt;   lirctools..................................................... LIRC tools  │ │  
│ └───────────────────────────────────────────────────────────────────────────────────┘ │  
├───────────────────────────────────────────────────────────────────────────────────────┤  
│            &lt;Select&gt;    &lt; Exit &gt;    &lt; Help &gt;    &lt; Save &gt;    &lt; Load &gt;                   │  
└───────────────────────────────────────────────────────────────────────────────────────┘  </pre>
</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;6141-7960&quot;} -->
<p>
Look for <code>kmod-lirc_gpio_generic</code> and select it:
</p>
<pre class="code">Location: 
    -&gt; Kernel modules
      -&gt; Other modules</pre>
<div class="table sectionedit12"><table class="inline">
	<tr class="row0">
		<td class="col0"> <pre class="code">
  ┌─────────────────────────────────── Other modules ───────────────────────────────────┐
  │ ┌─────────────────────────────────────────────────────────────────────────────────┐ │  
  │ │ &lt; &gt; kmod-bcma................................................... BCMA support   │ │  
  │ │ &lt; &gt; kmod-bluetooth......................................... Bluetooth support   │ │  
  │ │ &lt;*&gt; kmod-button-hotplug................................ Button Hotplug driver   │ │  
  │ │ &lt; &gt; kmod-eeprom-93cx6................................... EEPROM 93CX6 support   │ │  
  │ │ &lt; &gt; kmod-eeprom-at24..................................... EEPROM AT24 support   │ │  
  │ │ &lt; &gt; kmod-eeprom-at25..................................... EEPROM AT25 support   │ │  
  │ │ &lt; &gt; kmod-gpio-button-hotplug............... Simple GPIO Button Hotplug driver   │ │  
  │ │ &lt; &gt; kmod-gpio-dev........................... Generic GPIO char device support   │ │  
  │ │ &lt; &gt; kmod-gpio-nxp-74hc164.................. NXP 74HC164 GPIO expander support   │ │  
  │ │ &lt; &gt; kmod-hid..................................................... HID Devices   │ │  
  │ │ --- kmod-input-core........................................ Input device core   │ │  
  │ │ &lt; &gt; kmod-input-evdev...................................... Input event device   │ │  
  │ │ &lt; &gt; kmod-input-gpio-buttons................. Polled GPIO buttons input device   │ │  
  │ │ &lt; &gt; kmod-input-gpio-encoder............................... GPIO rotay encoder   │ │  
  │ │ &lt; &gt; kmod-input-gpio-keys.................................... GPIO key support   │ │  
  │ │ &lt;*&gt; kmod-input-gpio-keys-polled...................... Polled GPIO key support   │ │  
  │ │ &lt; &gt; kmod-input-joydev................................ Joystick device support   │ │  
  │ │ --- kmod-input-polldev........................... Polled Input device support   │ │  
  │ │ &lt;*&gt; kmod-lirc_gpio_generic.......... Driver for LIRC GPIO receiver/transmitter  │ │  
  │ │ &lt; &gt; kmod-mmc............................................. MMC/SD Card Support   │ │  
  │ │ &lt; &gt; kmod-mmc-over-gpio......................... MMC/SD card over GPIO support  -│ │  
  │ │ &lt; &gt; kmod-mtdtests........................................ MTD subsystem tests   │ │  
  │ │ &lt; &gt; kmod-nand............................................. NAND flash support   │ │  
  │ └─v(+)────────────────────────────────────────────────────────────────────────────┘ │  
  ├─────────────────────────────────────────────────────────────────────────────────────┤  
  │                          &lt;Select&gt;    &lt; Exit &gt;    &lt; Help &gt;                           │  
  └─────────────────────────────────────────────────────────────────────────────────────┘  </pre>
</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;8084-11781&quot;} -->
<p>
Build openwrt, and flash your custom firmware. Now you have LIRC prepared to work.
</p>
<div class="table sectionedit13"><table class="inline">
	<tr class="row0">
		<td class="col0"> <a href="/_detail/meta/icons/tango/dialog-information.png?id=docs%3Aguide-user%3Ahardware%3Alirc" class="media" title="meta:icons:tango:dialog-information.png"><img src="/_media/meta/icons/tango/dialog-information.png" class="media" loading="lazy" alt="" /></a> </td><td class="col1"> Note the file <strong>/etc/lirc/lircd.conf</strong> is specific for your remote. You might need to use <a href="http://www.lirc.org/html/irrecord.html" class="urlextern" title="http://www.lirc.org/html/irrecord.html" rel="ugc nofollow">irrecord</a> in a machine with a LIRC receiver to get one for your own remote if you don&#039;t find any in the <a href="https://sourceforge.net/p/lirc-remotes/code/ci/master/tree/remotes/" class="urlextern" title="https://sourceforge.net/p/lirc-remotes/code/ci/master/tree/remotes/" rel="ugc nofollow">lirc database</a>. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;11867-12241&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prepare your software&quot;,&quot;hid&quot;:&quot;prepare_your_software&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;1314-12242&quot;} -->
<h2 class="sectionedit14" id="make_it_work">Make it work</h2>
<div class="level2">

<p>
Flash your custom firmware with <em>lirc_gpio_generic</em> and the <em>LIRC</em> daemon included. If the module is loaded correctly when booting OpenWrt you should see this kernel message:<br/>

<code>[   36.240000] lirc_gpio_generic: auto-detected active low receiver on GPIO pin 10
[   36.250000] lirc_gpio_generic lirc_gpio_generic.0: lirc_dev: driver lirc_gpio_generic registered at minor = 0
[   36.260000] lirc_gpio_generic: driver registered!
</code>
</p>

<p>
After loading lirc_gpio_generic, /dev/lirc0 is created. If the LIRC utility package is installed an init script should autostart the LIRC daemon conected to /dev/lirc0.
</p>

<p>
As default the GPIO 9 for the receiver and GPIO10 for the transmitter are used, to use another for example the GPIO 17 18 you need to parse the options<br/>

<code>gpio_in_pin=17 gpio_out_pin=18</code>
</p>

<p>
You can put these options in the <strong>/etc/modules.d/99-lirc_gpio_generic</strong> file
</p>
<pre class="code">lirc_gpio_generic gpio_in_pin=17 gpio_out_pin=18</pre>

<p>
Test the receiver, execute
</p>

<p>
<code>irw</code>
</p>

<p>
Press some buttons on your remote. If all is working OK, irw will return the commands pressed on the remote:<br/>

<code>root@OpenWrt:/# irw
00000000000005e9 00 + rct3004
00000000000005ea 00 - rct3004
00000000000005ea 01 - rct3004
00000000000005dd 00 power rct3004
00000000000005d0 00 3 rct3004
00000000000005d0 01 3 rct3004
00000000000005c9 00 5 rct3004
00000000000005c9 01 5 rct3004
00000000000005c1 00 4 rct3004
00000000000005c1 01 4 rct3004</code>
</p>

<p>
Now we&#039;re ready to use irexec for executing custom scripts or commands every time a particular button is pressed on the remote.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Make it work&quot;,&quot;hid&quot;:&quot;make_it_work&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:14,&quot;range&quot;:&quot;12243-13811&quot;} -->
<h3 class="sectionedit15" id="irexec">irexec</h3>
<div class="level3">

<p>
Configure <a href="http://www.lirc.org/html/configure.html#lircrc_format" class="urlextern" title="http://www.lirc.org/html/configure.html#lircrc_format" rel="ugc nofollow">lircrc</a> as described in the LIRC website. Create the file <code>/etc/lirc/lircrc</code>. Run the <a href="http://www.lirc.org/html/irexec.html" class="urlextern" title="http://www.lirc.org/html/irexec.html" rel="ugc nofollow">irexec</a> daemon with a command like this:
</p>
<pre class="code">irexec --daemon /etc/lirc/lircrc</pre>

<p>
Now everytime you press a button in your remote, irexec will execute the associated commands in the lircrc file.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;irexec&quot;,&quot;hid&quot;:&quot;irexec&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:15,&quot;range&quot;:&quot;13812-14224&quot;} -->
<h2 class="sectionedit16" id="notes">Notes</h2>
<div class="level2">

<p>
Succesfully tested in Barrier Breaker
</p>
<ul>
<li class="level1"><div class="li"> <strong>Platform AR7240</strong>: GPIO9, GPIO10 are used for the serial port (multiplexed pins). For using these pins as regular GPIOs for our LIRC transceiver, execute the command<br/>
<code>devmem 0x18040028 32 0x48000</code><br/>
The GPIO used for the receiver shouldn&#039;t have any pull down resistor, otherwise it won&#039;t work. The lirc-gpio-generic module package should copy a patch to the kernel patches directory for having GPIO IRQs available, check if the patch is applied.</div>
</li>
<li class="level1"><div class="li"> <strong>brcm63xx</strong>: only a few GPIOs have IRQs, check <a href="/docs/techref/hardware/soc/soc.broadcom.bcm63xx#external_irqs" class="wikilink1" title="docs:techref:hardware:soc:soc.broadcom.bcm63xx" data-wiki-id="docs:techref:hardware:soc:soc.broadcom.bcm63xx">external_irqs</a>. Only those GPIOs can be used for the receiver. A patch is copied into the kernel patches directory for having gpio_to_irq function available in the lirc_gpio_generic module, check if the patch is applied when compiling the firmware.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Notes&quot;,&quot;hid&quot;:&quot;notes&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:16,&quot;range&quot;:&quot;14225-15089&quot;} -->
<h2 class="sectionedit17" id="tested_routers">Tested routers</h2>
<div class="level2">
<div class="table sectionedit18"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Target </th><th class="col1"> Platform </th><th class="col2"> Router </th><th class="col3"> Tested </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0" rowspan="2"> brcm63xx </td><td class="col1"> BCM6348 </td><td class="col2"> Livebox 1</td><td class="col3" rowspan="2"> OK </td>
	</tr>
	<tr class="row2">
		<td class="col0"> BCM6358 </td><td class="col1"> HG556a </td>
	</tr>
	<tr class="row3">
		<td class="col0"> ar71xx </td><td class="col1"> AR7240 </td><td class="col2"> TL-WR741ND </td><td class="col3"> OK </td>
	</tr>
	<tr class="row4">
		<td class="col0"> lantiq </td><td class="col1"> Danube </td><td class="col2"> ARV7518PW </td><td class="col3"> <span style='color:red; '>KO</span> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> ramips </td><td class="col1"> ? </td><td class="col2"> </td><td class="col3"> <span style='color:red; '>KO</span>? </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;15117-15364&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Tested routers&quot;,&quot;hid&quot;:&quot;tested_routers&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:17,&quot;range&quot;:&quot;15090-&quot;} -->