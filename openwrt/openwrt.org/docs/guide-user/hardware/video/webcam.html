
<h1 class="sectionedit1" id="webcam_with_the_linux_uvc_driver">Webcam with the Linux UVC driver</h1>
<div class="level1">

<p>
See <a href="/docs/guide-user/hardware/video/usb.video" class="wikilink1" title="docs:guide-user:hardware:video:usb.video" data-wiki-id="docs:guide-user:hardware:video:usb.video">USB Video Support</a>
</p>

<p>
<a href="https://en.wikipedia.org/wiki/USB video device class" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/USB video device class">USB video device class</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Webcam with the Linux UVC driver&quot;,&quot;hid&quot;:&quot;webcam_with_the_linux_uvc_driver&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-146&quot;} -->
<h2 class="sectionedit2" id="prerequisites">Prerequisites</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> follow <a href="/docs/guide-user/storage/usb-installing" class="wikilink1" title="docs:guide-user:storage:usb-installing" data-wiki-id="docs:guide-user:storage:usb-installing">usb-installing</a></div>
</li>
<li class="level1"><div class="li"> follow <a href="/docs/guide-user/hardware/video/usb.video" class="wikilink1" title="docs:guide-user:hardware:video:usb.video" data-wiki-id="docs:guide-user:hardware:video:usb.video">usb.video</a></div>
</li>
</ol>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1 leftalign"> Depends  </th><th class="col2 centeralign">  Size  </th><th class="col3 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> mjpg-streamer   </td><td class="col1"> libpthread, libjpeg </td><td class="col2 rightalign">  33738 </td><td class="col3 leftalign"> Streaming application for Linux-UVC compatible webcams  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;284-436&quot;} -->
<p>
The package <a href="http://man.cx/motion" class="interwiki iw_man" title="http://man.cx/motion">motion</a> is <del>not</del> now available in the OpenWrt repositories. <a href="http://www.lavrsen.dk/foswiki/bin/view/Motion/WebHome" class="urlextern" title="http://www.lavrsen.dk/foswiki/bin/view/Motion/WebHome" rel="ugc nofollow">http://www.lavrsen.dk/foswiki/bin/view/Motion/WebHome</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prerequisites&quot;,&quot;hid&quot;:&quot;prerequisites&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;147-580&quot;} -->
<h2 class="sectionedit4" id="installation">Installation</h2>
<div class="level2">
<pre class="code">opkg install kmod-video-uvc mjpg-streamer mjpg-streamer-input-http mjpg-streamer-input-uvc</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installation&quot;,&quot;hid&quot;:&quot;installation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;581-712&quot;} -->
<h2 class="sectionedit5" id="configuration">Configuration</h2>
<div class="level2">

<p>
→<code><a href="/doc/uci/mjpg-streamer" class="wikilink2" title="doc:uci:mjpg-streamer" rel="nofollow" data-wiki-id="doc:uci:mjpg-streamer">/etc/config/mjpg-streamer</a></code>
</p>

<p>
Don&#039;t forget change option enabled &#039;0&#039; to &#039;1&#039;.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:5,&quot;range&quot;:&quot;713-844&quot;} -->
<h2 class="sectionedit6" id="usage">Usage</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> start on boot<pre class="code">/etc/init.d/mjpg-streamer enable</pre>
</div>
</li>
<li class="level1"><div class="li"> start <code>mjpg-streamer</code> right now<pre class="code">/etc/init.d/mjpg-streamer start</pre>
</div>
</li>
</ul>

<p>
<strong>NOTE:</strong> You will need to edit the mjpeg config to enable the mjpeg streamer. Manually edit the /etc/config/mjpeg-streamer file.
</p>

<p>
Now open the <abbr title="Uniform Resource Locator">URL</abbr> <a href="http://192.168.1.1:8080/" class="urlextern" title="http://192.168.1.1:8080/" rel="ugc nofollow">http://192.168.1.1:8080/</a> in the Firefox browser or VLC and watch the MJPEG stream (the default username/password is “openwrt”/“openwrt”). In other browsers, scripts, etc., you can use <a href="http://192.168.1.1:8080?action=snapshot" class="urlextern" title="http://192.168.1.1:8080?action=snapshot" rel="ugc nofollow">http://192.168.1.1:8080?action=snapshot</a> for taking one image or <a href="http://192.168.1.1:8080?action=stream" class="urlextern" title="http://192.168.1.1:8080?action=stream" rel="ugc nofollow">http://192.168.1.1:8080?action=stream</a> for stream of images.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Usage&quot;,&quot;hid&quot;:&quot;usage&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:6,&quot;range&quot;:&quot;845-1469&quot;} -->
<h2 class="sectionedit7" id="performance">Performance</h2>
<div class="level2">

<p>
mjpeg-streamer fps, CPU load, memory usage, bandwidth at different resolutions:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?pid=296414#p296414" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=296414#p296414" rel="ugc nofollow">USB HD camera module (vid=05a3, pid=9230)</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/viewtopic.php?pid=296534#p296534" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=296534#p296534" rel="ugc nofollow">Logitech HD Pro C920 (vid=046d, pid=082d)</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Performance&quot;,&quot;hid&quot;:&quot;performance&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:7,&quot;range&quot;:&quot;1470-1792&quot;} -->
<h2 class="sectionedit8" id="embedding_video_stream_into_simple_webpages">Embedding video stream into simple webpages</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Download a package located <a href="http://mjpg-streamer.svn.sourceforge.net/viewvc/mjpg-streamer/mjpg-streamer/www/" class="urlextern" title="http://mjpg-streamer.svn.sourceforge.net/viewvc/mjpg-streamer/mjpg-streamer/www/" rel="ugc nofollow"> here</a> and unpack it into /www/webcam_www directory.</div>
</li>
<li class="level1"><div class="li"> Edit /etc/init.d/mjpg-streamer - find this line in function start():</div>
</li>
</ul>
<pre class="code">[ $enabled -gt 0 -a -c $device ] &amp;&amp; sleep 3 &amp;&amp; $SSD -S -m -p $PIDF -q -x $PROG -- --input &quot;input_uvc.so --device $device --fps $fps --resolution $resolution&quot; --output &quot;output_http.so --port $port&quot; &amp;</pre>

<p>
 and add <em>-w /www/webcam_www</em> behind --output “output_http.so. Now it should look like this:
</p>
<pre class="code">[ $enabled -gt 0 -a -c $device ] &amp;&amp; sleep 3 &amp;&amp; $SSD -S -m -p $PIDF -q -x $PROG -- --input &quot;input_uvc.so --device $device --fps $fps --resolution $resolution&quot; --output &quot;output_http.so -w /www/webcam_www --port $port&quot; &amp;</pre>
<ul>
<li class="level1"><div class="li"> Now restart mjpg-streamer and open the <abbr title="Uniform Resource Locator">URL</abbr> <a href="http://192.168.1.1:8080/" class="urlextern" title="http://192.168.1.1:8080/" rel="ugc nofollow">http://192.168.1.1:8080/</a> in your web browser.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Embedding video stream into simple webpages&quot;,&quot;hid&quot;:&quot;embedding_video_stream_into_simple_webpages&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:8,&quot;range&quot;:&quot;1793-2725&quot;} -->
<h2 class="sectionedit9" id="controlling_exposure_color_balance_etc">Controlling exposure, color balance, etc.</h2>
<div class="level2">

<p>
The opkg version of mjpg-streamer has no control options for the camera. If you want to control exposure, brightness and other options you&#039;ll need to install uvcdynctrl.
</p>

<p>
Install uvcdynctrl
</p>
<pre class="code">opkg install uvcdynctrl</pre>

<p>
List available devices.
</p>
<pre class="code">/usr/bin/uvcdynctrl -l</pre>

<p>
List available control options.
</p>
<pre class="code">/usr/bin/uvcdynctrl -c

Listing available controls for device video0:
  Brightness
  Contrast
  Saturation
  Hue
  White Balance Temperature, Auto
  Gamma
  Power Line Frequency
  White Balance Temperature
  Sharpness
  Backlight Compensation

</pre>

<p>
Create a configuration file based on the current running values.
</p>
<pre class="code">/usr/bin/uvcdynctrl -W /etc/config/uvcdynctrl</pre>

<p>
Load a configuration file, which can be edited.
</p>
<pre class="code">/usr/bin/uvcdynctrl -L /etc/config/uvcdynctrl</pre>

<p>
The above can be added to /etc/rc.local, via the <abbr title="Graphical User Interface">GUI</abbr> or command line to load settings required for your camera. I use the above to enable auto exposure and auto white balance which would otherwise be disabled from cold a start.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Controlling exposure, color balance, etc.&quot;,&quot;hid&quot;:&quot;controlling_exposure_color_balance_etc&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:9,&quot;range&quot;:&quot;2726-3828&quot;} -->
<h2 class="sectionedit10" id="webcam_pan_and_tilt_example_with_microprocessor">Webcam Pan and Tilt Example with Microprocessor</h2>
<div class="level2">

<p>
Here is a writeup of using openWrt for a pan and tilt camera.  The devices were NSLU2 for openWrt and Picaxe for microcontroller, but the idea is the same with arduino as micro and other openWrt devices:
</p>

<p>
<a href="http://www.picaxeforum.co.uk/showthread.php?13705" class="urlextern" title="http://www.picaxeforum.co.uk/showthread.php?13705" rel="ugc nofollow">http://www.picaxeforum.co.uk/showthread.php?13705</a>
</p>

<p>
Grey day today here in Nova Scotia, you can see at <a href="http://www.lyzby.com/cam.html" class="urlextern" title="http://www.lyzby.com/cam.html" rel="ugc nofollow">http://www.lyzby.com/cam.html</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Webcam Pan and Tilt Example with Microprocessor&quot;,&quot;hid&quot;:&quot;webcam_pan_and_tilt_example_with_microprocessor&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:10,&quot;range&quot;:&quot;3829-4226&quot;} -->
<h2 class="sectionedit11" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
If the control page doesn&#039;t contain any of the controls, edit the file /etc/init.d/mjpg-streamer and replace these lines
</p>
<pre class="code">service_start /usr/bin/mjpg_streamer --input &quot;input_uvc.so \
                --device $device --fps $fps --resolution $resolution&quot; \           
                --output &quot;output_http.so --www $www --port $port&quot;</pre>

<p>
by (on a single line )
</p>
<pre class="code">service_start /usr/bin/mjpg_streamer --input &quot;input_uvc.so --device $device --fps $fps --resolution $resolution&quot; --output &quot;output_http.so --www $www --port $port&quot;</pre>

<p>
The command <code>mjpg_streamer -h</code> give you usage information and examples.
</p>

<p>
If your webcam is an uvc supported by V4L but you cannot get an image (white page),
you may check that webcam output is not YUV only like output below:
</p>
<pre class="code">root@OpenWrt:~# v4l2-ctl -V
Format Video Capture:
        Width/Height  : 320/240
        Pixel Format  : &#039;YUYV&#039;
        Field         : None
        Bytes per Line: 640
        Size Image    : 153600
        Colorspace    : SRGB</pre>

<p>
The package <code>uvc-streamer</code> is no longer in the OpenWrt repositories.
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://dev.openwrt.org/browser/packages/multimedia/uvc-streamer/files/uvc-streamer.init?rev=10127" class="urlextern" title="https://dev.openwrt.org/browser/packages/multimedia/uvc-streamer/files/uvc-streamer.init?rev=10127" rel="ugc nofollow">https://dev.openwrt.org/browser/packages/multimedia/uvc-streamer/files/uvc-streamer.init?rev=10127</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://dev.openwrt.org/changeset/17003/packages/multimedia/uvc-streamer/files/uvc-streamer.init" class="urlextern" title="https://dev.openwrt.org/changeset/17003/packages/multimedia/uvc-streamer/files/uvc-streamer.init" rel="ugc nofollow">https://dev.openwrt.org/changeset/17003/packages/multimedia/uvc-streamer/files/uvc-streamer.init</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:11,&quot;range&quot;:&quot;4227-5565&quot;} -->
<h2 class="sectionedit12" id="link_dump">Link Dump</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://wiki.leipzig.freifunk.net/Diskussion:Backfire#quickcam_pro_5000" class="urlextern" title="http://wiki.leipzig.freifunk.net/Diskussion:Backfire#quickcam_pro_5000" rel="ugc nofollow">http://wiki.leipzig.freifunk.net/Diskussion:Backfire#quickcam_pro_5000</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Link Dump&quot;,&quot;hid&quot;:&quot;link_dump&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:12,&quot;range&quot;:&quot;5566-&quot;} -->