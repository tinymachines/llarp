
<h1 class="sectionedit1" id="sip_daemon_for_lantiq_devices_with_owsip">SIP daemon for Lantiq devices with owsip</h1>
<div class="level1">

<p>
The aim of this project is to provide a working <a href="https://en.wikipedia.org/wiki/Session Initiation Protocol" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Session Initiation Protocol">SIP</a> daemon for <a href="/docs/techref/hardware/soc/soc.lantiq" class="wikilink1" title="docs:techref:hardware:soc:soc.lantiq" data-wiki-id="docs:techref:hardware:soc:soc.lantiq">Lantiq SoCs</a> with MIPS CPU.
</p>

<p>
owsip utilizes available <a href="https://en.wikipedia.org/wiki/Foreign exchange service (telecommunications)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Foreign exchange service (telecommunications)">FXS</a> hardware ports for making calls.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;SIP daemon for Lantiq devices with owsip&quot;,&quot;hid&quot;:&quot;sip_daemon_for_lantiq_devices_with_owsip&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-338&quot;} -->
<h2 class="sectionedit2" id="known_problemsmissing_features">Known Problems / missing features</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> fails to work on units with more than 32MiB RAM</div>
</li>
<li class="level2"><div class="li"> only the primary voice channel works </div>
</li>
<li class="level2"><div class="li"> handling for incoming calls, while making calls does not exist</div>
</li>
<li class="level2"><div class="li"> missing answering machine</div>
</li>
<li class="level2"><div class="li"> missing fax</div>
</li>
<li class="level2"><div class="li"> missing srtp/ssl login</div>
</li>
<li class="level2"><div class="li"> missing kpi - kernel acceleration</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Known Problems \/ missing features&quot;,&quot;hid&quot;:&quot;known_problemsmissing_features&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;339-671&quot;} -->
<h2 class="sectionedit3" id="using_owsip">Using owsip</h2>
<div class="level2">

<p>
Once owsip is only and registered you can start to make and answer calls.
SIP can dial landline and sip numbers.
Currently a number dialed on a key pad is interpreted as a landline.
If you want to call a sip account, you need to add a contact entry for this.
To dial a contact, simply press the “*” key followed by the “code” sequence.
Note that owsip can do keypad letter → number conversion (for example → 3926753).
</p>

<p>
The “#” key is also mapped to handle dial backends, however “contact” is the only backend we currently have. it is mapped to “#1code”.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using owsip&quot;,&quot;hid&quot;:&quot;using_owsip&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;672-1252&quot;} -->
<h3 class="sectionedit4" id="common_options">Common Options</h3>
<div class="level3">
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>name</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> owsip </td><td class="col4"> the daemon announces this name </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>backend</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> ltq_tapi </td><td class="col4"> tell the daemon which backend to use </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>log_level</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> 3 </td><td class="col4"> verbosity </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>interface</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> nas0 </td><td class="col4"> bound to this interface, if unsure use nas0 </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>local_port</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> 5060 </td><td class="col4"> define port for SIP </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>rtp_port</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> 4000 </td><td class="col4"> define port for RTP </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>outbound</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> outbound proxy server, define like &lt;sip:192.168.1.1:9060;lr;transport=udp&gt; </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>cid</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> enable support for CID. Possible valued: telecordia, etsi_fsk, etsi_dtmf, sin, ntt, kpn_dtmf and kpn_dtmf_fsk </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>locale</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3 leftalign"> <em>(none)</em>  </td><td class="col4"> currently supporting only germany and croatia </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>revert</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3 leftalign"> 0  </td><td class="col4"> switch FXS port0 ↔ port1 (work around 2nd port not working) </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;1278-2186&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Common Options&quot;,&quot;hid&quot;:&quot;common_options&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1253-2187&quot;} -->
<h3 class="sectionedit6" id="stun_section">STUN Section</h3>
<div class="level3">

<p>
This section describes our STUN server.
</p>
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>host</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> STUN host </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>port</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> STUN port </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;2252-2403&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;STUN Section&quot;,&quot;hid&quot;:&quot;stun_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2188-2404&quot;} -->
<h3 class="sectionedit8" id="account_section">Account Section</h3>
<div class="level3">

<p>
This section describes our SIP credentials/server.
</p>
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>realm</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> SIP realm to connect to </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>username</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> SIP username </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>password</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> SIP password </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>disabled</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> by default accounts are enabled </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>port</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> -1 </td><td class="col4"> bind account to a specific port </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>default</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> use account as default one </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;2483-2914&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Account Section&quot;,&quot;hid&quot;:&quot;account_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;2405-2915&quot;} -->
<h3 class="sectionedit10" id="port_section">Port Section</h3>
<div class="level3">

<p>
This section describes a physical FXS port.
</p>
<div class="table sectionedit11"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>id</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> 0 </td><td class="col4"> the physical port described by the section </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>noring</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> if set to 1 the phone will never ring </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>nodial</code> </td><td class="col1"> int </td><td class="col2"> no </td><td class="col3"> 0 </td><td class="col4"> if set to 1 then port may not dial numbers </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>led</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> set to sysfs path of the led matching the port</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;2984-3338&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Port Section&quot;,&quot;hid&quot;:&quot;port_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;2916-3339&quot;} -->
<h3 class="sectionedit12" id="contact_section">Contact Section</h3>
<div class="level3">

<p>
This section describes a contact for short dial.
</p>
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>desc</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> the name of the contact </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>code</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> the short dial code to match (0-9a-zA-Z) </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>dial</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> the actual number to dial </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>type</code> </td><td class="col1"> string </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> sip/realm </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>account</code> </td><td class="col1"> string </td><td class="col2"> no </td><td class="col3"> <em>(none)</em> </td><td class="col4"> the account to use when making the call </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;3416-3824&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Contact Section&quot;,&quot;hid&quot;:&quot;contact_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;3340-3825&quot;} -->
<h3 class="sectionedit14" id="relay_section">Relay Section</h3>
<div class="level3">

<p>
This section describes a relay on the pcb that activates the fxs port
</p>
<div class="table sectionedit15"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Type </th><th class="col2"> Required </th><th class="col3"> Default </th><th class="col4"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>gpio</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> gpio to use </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>value</code> </td><td class="col1"> int </td><td class="col2"> yes </td><td class="col3"> <em>(none)</em> </td><td class="col4"> value to set gpio to </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;3921-4085&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Relay Section&quot;,&quot;hid&quot;:&quot;relay_section&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:14,&quot;range&quot;:&quot;3826-4086&quot;} -->
<h3 class="sectionedit16" id="configuration">Configuration</h3>
<div class="level3">

<p>
The owsip configuration file is located at /etc/conf/telephony.
This is the default configuration:
</p>
<pre class="code">config general
        option &#039;name&#039;           &#039;owsip&#039;
        option &#039;backend&#039;        &#039;ltq_tapi&#039;
        option &#039;ossdev&#039;         0
        option &#039;log_level&#039;      3
        option &#039;interface&#039;      &#039;nas0&#039;
        option &#039;local_port&#039;     5060
        option &#039;rtp_port&#039;       4000
        option &#039;locale&#039;         &#039;germany&#039;
        option &#039;revert&#039;         0

config account &#039;fxs1&#039;
        option &#039;realm&#039;          &#039;myrealm1.com&#039;
        option &#039;username&#039;       &#039;myuser1&#039;
        option &#039;password&#039;       &#039;mypass1&#039;
        option &#039;disabled&#039;       1

config account &#039;fxs2&#039;
        option &#039;realm&#039;          &#039;myrealm2.com&#039;
        option &#039;username&#039;       &#039;myuser2&#039;
        option &#039;password&#039;       &#039;mypass2&#039;
        option &#039;disabled&#039;       1

config stun
        option &#039;host&#039;           &#039;stun.myrealm.com&#039;
        option &#039;port&#039;           &#039;3478&#039;

config &#039;relay&#039; &#039;relay_31&#039;
        option &#039;gpio&#039;           &#039;31&#039;
        option &#039;value&#039;          &#039;1&#039;

config &#039;port&#039; &#039;port0&#039;
        option &#039;id&#039;             &#039;0&#039;
        option &#039;led&#039;            &#039;soc:green:fxs1&#039;
        option &#039;noring&#039;         &#039;0&#039;
        option &#039;nodial&#039;         &#039;0&#039;

config &#039;contact&#039;
        option &#039;desc&#039;           &#039;example contact description&#039;
        option &#039;code&#039;           &#039;example&#039;
        option &#039;dial&#039;           &#039;0123456789&#039;
        option &#039;type&#039;           &#039;realm&#039;</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:16,&quot;range&quot;:&quot;4087-&quot;} -->