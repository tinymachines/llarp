
<h1 class="sectionedit1" id="pulseaudio">PulseAudio</h1>
<div class="level1">

<p>
Read about <a href="https://en.wikipedia.org/wiki/PulseAudio" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/PulseAudio">PulseAudio</a> and have a look at its operational flow chart: <a href="https://en.wikipedia.org/wiki/File:Pulseaudio-diagram.svg" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/File:Pulseaudio-diagram.svg">File:Pulseaudio-diagram.svg</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;PulseAudio&quot;,&quot;hid&quot;:&quot;pulseaudio&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-138&quot;} -->
<h2 class="sectionedit2" id="preparations">Preparations</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Preparations&quot;,&quot;hid&quot;:&quot;preparations&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;139-163&quot;} -->
<h3 class="sectionedit3" id="routing">Routing</h3>
<div class="level3">

<p>
Routing describes the way which the Audio-Signal take when traversing your <abbr title="Operating System">OS</abbr>.
Here a couple of routing configurations that make sense: (it is always a good idea to configure the soundsource (e.g. audio player) specifically to use the correct output interface)
</p>

<p>
The shortest path:
</p>
<div class="table sectionedit4"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign">  Device  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Soundsource  →  ALSA driver  →  Hardware </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;464-523&quot;} -->
<p>
Many programs can communicate directly with PulseAudio:
</p>
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign">  Device  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Soundsource  →  PulseAudio  →  ALSA driver  →  Hardware </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;582-657&quot;} -->
<p>
In case the sound source cannot communicate directly with PA, it takes a detour:
</p>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign">  Device  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Soundsource  →  ALSA  →  PulseAudio  →  ALSA driver  →  Hardware </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;741-826&quot;} -->
<p>
PulseAudio works over the network:
</p>
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign">  Device 1  </th><th class="col1 centeralign">  ~  </th><th class="col2 centeralign">  Device 2  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Soundsource  →  PulseAudio → </td><td class="col1 centeralign">  Network  </td><td class="col2"> → PulseAudio  →  ALSA driver  →  Hardware </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;864-991&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Routing&quot;,&quot;hid&quot;:&quot;routing&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;164-992&quot;} -->
<h3 class="sectionedit8" id="hardware">Hardware</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Device 2 requires a <a href="https://en.wikipedia.org/wiki/Sound card" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Sound card">Sound card</a> (Hardware), Device 1 does not; <a href="https://en.wikipedia.org/wiki/Loudspeaker" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Loudspeaker">Loudspeaker</a>s are connected to the sound card</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hardware&quot;,&quot;hid&quot;:&quot;hardware&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;993-1137&quot;} -->
<h3 class="sectionedit9" id="required_packages">Required Packages</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="/packages/pkgdata/pulseaudio-daemon" class="wikilink1" title="packages:pkgdata:pulseaudio-daemon" data-wiki-id="packages:pkgdata:pulseaudio-daemon">pulseaudio-daemon</a></div>
</li>
<li class="level1"><div class="li"> <a href="/packages/pkgdata/pulseaudio-profiles" class="wikilink1" title="packages:pkgdata:pulseaudio-profiles" data-wiki-id="packages:pkgdata:pulseaudio-profiles">pulseaudio-profiles</a></div>
</li>
<li class="level1"><div class="li"> <a href="/packages/pkgdata/pulseaudio-tools" class="wikilink1" title="packages:pkgdata:pulseaudio-tools" data-wiki-id="packages:pkgdata:pulseaudio-tools">pulseaudio-tools</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Required Packages&quot;,&quot;hid&quot;:&quot;required_packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;1138-1296&quot;} -->
<h3 class="sectionedit10" id="official_documentation">Official Documentation</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://linux.die.net/man/1/pulseaudio" class="urlextern" title="http://linux.die.net/man/1/pulseaudio" rel="ugc nofollow">manpage for PulseAudio</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://man.cx/pulseaudio" class="interwiki iw_man" title="http://man.cx/pulseaudio">pulseaudio</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Official Documentation&quot;,&quot;hid&quot;:&quot;official_documentation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;1297-1422&quot;} -->
<h2 class="sectionedit11" id="configuration">Configuration</h2>
<div class="level2">

<p>
With PulseAudio it&#039;s possible to send audio over the network.
There are several ways to achieve that, here&#039;s the “tunnel”-approach described.
For other solutions see the <a href="http://pulseaudio.org/wiki/NetworkSetup" class="urlextern" title="http://pulseaudio.org/wiki/NetworkSetup" rel="ugc nofollow">PulseAudio wiki</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;1423-1680&quot;} -->
<h3 class="sectionedit12" id="server_configuration">Server configuration</h3>
<div class="level3">

<p>
For sound from the network, something like this is needed:
</p>
<pre class="code bash"><span class="co0"># /etc/pulse/system.pa</span>
load-module module-alsa-sink
load-module module-native-protocol-tcp auth-anonymous=<span class="nu0">1</span></pre>

<p>
Most programs do not need the esound module because other ways to connect to pulseaudio server are available.
(module-native,module-tunnel)
</p>
<pre class="code bash"><span class="co0"># /etc/pulse/system.pa</span>
load-module module-esound-protocol-tcp auth-anonymous=<span class="nu0">1</span></pre>

<p>
<strong>There is an issue (<a href="https://dev.openwrt.org/ticket/14175" class="urlextern" title="https://dev.openwrt.org/ticket/14175" rel="ugc nofollow">#14175</a>) with permissions in system mode with alsa.
This is an workaround which does not support hotplug.</strong>
In system mode pulseaudio runs under user pulse but it does not have the permissions to access alsa.
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> EOF <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>pulseaudio
<span class="kw2">chown</span> <span class="re5">-R</span> :<span class="nu0">51</span> <span class="sy0">/</span>dev<span class="sy0">/</span>snd
<span class="kw2">chmod</span> <span class="re5">-R</span> g+rw <span class="sy0">/</span>dev<span class="sy0">/</span>snd
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Server configuration&quot;,&quot;hid&quot;:&quot;server_configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;1681-2519&quot;} -->
<h3 class="sectionedit13" id="client_configuration">Client configuration</h3>
<div class="level3">

<p>
You can enter network-sinks manually (which is described below).
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Automatic discovery with <a href="/docs/guide-user/hardware/audio/pulseaudio#avahizeroconf" class="wikilink1" title="docs:guide-user:hardware:audio:pulseaudio" data-wiki-id="docs:guide-user:hardware:audio:pulseaudio">Avahi/Zeroconf</a> is disabled in the build system.
</p>

</div>

<h4 id="linux">Linux</h4>
<div class="level4">

<p>
Load a new tunnel-sink:
</p>
<pre class="code bash">pacmd load-module module-tunnel-sink <span class="re2">server</span>=<span class="sy0">&lt;</span>IP_OPENWRT<span class="sy0">&gt;</span></pre>

<p>
Now it can be controlled with eg gnome-volume-control:
</p>

<p>
<a href="/_detail/doc/howto/gnome-volume-control.png?id=docs%3Aguide-user%3Ahardware%3Aaudio%3Apulseaudio" class="media" title="doc:howto:gnome-volume-control.png"><img src="/_media/doc/howto/gnome-volume-control.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
To play one stream simultaneously to a local and a remote sink create a combined sink: 
</p>
<pre class="code bash">pacmd load-module module-combine <span class="re2">sink_name</span>=combined <span class="re2">slaves</span>=<span class="st0">&quot;tunnel.&lt;IP_OPENWRT&gt;,alsa_output.usb-0ccd_0077-00-U0xccd0x77.analog-stereo&quot;</span>
pacmd set-default-sink combined</pre>

<p>
The local sink (in this case alsa_output.usb-0ccd_0077-00-U0xccd0x77.analog-stereo) can be obtained via pacmd:
</p>
<pre class="code bash"><span class="co0"># pacmd list-sinks | grep -e name:</span>
        name: <span class="sy0">&lt;</span>alsa_output.pci-0000_00_1b.0.analog-stereo<span class="sy0">&gt;</span>
        name: <span class="sy0">&lt;</span>alsa_output.usb-0ccd_0077-00-U0xccd0x77.analog-stereo<span class="sy0">&gt;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Client configuration&quot;,&quot;hid&quot;:&quot;client_configuration&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:13,&quot;range&quot;:&quot;2520-3510&quot;} -->
<h2 class="sectionedit14" id="examples">Examples</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:14,&quot;range&quot;:&quot;3511-3531&quot;} -->
<h2 class="sectionedit15" id="notes">Notes</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Notes&quot;,&quot;hid&quot;:&quot;notes&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:15,&quot;range&quot;:&quot;3532-3549&quot;} -->
<h3 class="sectionedit16" id="mpd">MPD</h3>
<div class="level3">

</div>

<h4 id="generalities">Generalities</h4>
<div class="level4">

<p>
0.16.1 of MPD is needed.
It needs to be build with support for PulseAudio:
</p>
<pre class="code diff">Index: sound/mpd/Makefile
===================================================================
<span class="re3">--- sound/mpd/Makefile  <span class="br0">&#40;</span>Revision 25082<span class="br0">&#41;</span></span>
<span class="re4">+++ sound/mpd/Makefile  <span class="br0">&#40;</span>Arbeitskopie<span class="br0">&#41;</span></span>
<span class="re6">@@ -63,7 +63,6 @@</span>
        --disable-cue \
        --disable-jack \
        --disable-modplug \
<span class="re7">-       --disable-pulse \</span>
        --disable-sidplay \
        --disable-sqlite \
        --enable-shout \</pre>

</div>

<h4 id="barrier_breaker_and_chaos_calmer">Barrier Breaker and Chaos Calmer</h4>
<div class="level4">

<p>
More information on <a href="/docs/guide-developer/build.mpd-full.pulse" class="wikilink1" title="docs:guide-developer:build.mpd-full.pulse" data-wiki-id="docs:guide-developer:build.mpd-full.pulse">building MPD-full with PulseAudio</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;MPD&quot;,&quot;hid&quot;:&quot;mpd&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:16,&quot;range&quot;:&quot;3550-4198&quot;} -->
<h3 class="sectionedit17" id="avahizeroconf">Avahi/ZeroConf</h3>
<div class="level3">

<p>
:<img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" />: <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Not available in trunk
</p>

<p>
If you want to automatically discover new Pulseaudio devices on your network, you can install <a href="/packages/pkgdata/pulseaudio-daemon-avahi" class="wikilink1" title="packages:pkgdata:pulseaudio-daemon-avahi" data-wiki-id="packages:pkgdata:pulseaudio-daemon-avahi">pulseaudio-daemon-avahi</a>.
This will pull in dbus and avahi.
You are then able to use padevchooser on the client to find and connect to Pulseaudio sinks in the local network.
</p>
<pre class="code bash">opkg <span class="kw2">install</span> pulseaudio-daemon-avahi</pre>

<p>
Add module-zeroconf-publish:
</p>
<pre class="code bash"><span class="co0"># /etc/pulse/system.pa</span>
<span class="co0">### Publish local soundcards on the network</span>
load-module module-zeroconf-publish</pre>

<p>
Avahi-browse or avahi-discover on the client should list the sinks:
</p>
<pre class="code bash"><span class="co0"># avahi-browse -a</span>
+  wlan0 IPv4 root<span class="sy0">@</span>OpenWrt: Intel 82801DB-ICH4              PulseAudio Sound Sink <span class="kw3">local</span>
+  wlan0 IPv4 root<span class="sy0">@</span>OpenWrt                                  PulseAudio Sound Server <span class="kw3">local</span>
+  wlan0 IPv4 Secure Shell on OpenWrt                       SSH-Fernzugriff      <span class="kw3">local</span>
+  wlan0 IPv4 Music Player Daemon on OpenWrt                Music Player Daemon  <span class="kw3">local</span></pre>

<p>
Make sure module-zeroconf-discover is loaded on the client (pacmd load-module module-zeroconf-discover).
The new sink should show up in gnome-control-center sound:
</p>

<p>
<a href="/_detail/doc/howto/gnome-control-center-sound.png?id=docs%3Aguide-user%3Ahardware%3Aaudio%3Apulseaudio" class="media" title="doc:howto:gnome-control-center-sound.png"><img src="/_media/doc/howto/gnome-control-center-sound.png" class="media" loading="lazy" alt="" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Avahi\/ZeroConf&quot;,&quot;hid&quot;:&quot;avahizeroconf&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:17,&quot;range&quot;:&quot;4199-5431&quot;} -->
<h3 class="sectionedit18" id="issues">Issues</h3>
<div class="level3">

<p>
Some people experienced issues with fadvise (see <a href="https://forum.openwrt.org/viewtopic.php?pid=118528#p118528" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=118528#p118528" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?pid=118528#p118528</a>).
Building PulseAudio with ac_cv_func_posix_fadvise=no seems to help:
</p>
<pre class="code diff"><span class="re7">-       --without-caps </span>
<span class="re8">+       --without-caps \ </span>
<span class="re8">+       ac_cv_func_posix_fadvise=no</span></pre>

<p>
This seems to help on systems with low resources:
</p>
<pre class="code bash"><span class="co0"># /etc/pulse/daemon.conf</span>
&nbsp;
high-priority = <span class="kw2">yes</span>
nice-level = <span class="re5">-11</span>
&nbsp;
realtime-scheduling = <span class="kw2">yes</span>
&nbsp;
resample-method = trivial
&nbsp;
default-sample-format = s16le
default-sample-rate = <span class="nu0">48000</span>
default-sample-channels = <span class="nu0">2</span>
default-channel-map = front-left,front-right</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Issues&quot;,&quot;hid&quot;:&quot;issues&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:18,&quot;range&quot;:&quot;5432-6059&quot;} -->
<h2 class="sectionedit19" id="alternative_configuration_for_forwarding_sound">Alternative configuration for forwarding sound</h2>
<div class="level2">

<p>
The approach taken above might not produce acceptable results depending on the hardware.
It can lead to lagging, unpredictable, distorted sound.
Here&#039;s a different method, that uses ssh to forward a tcp port from the client to the router and then uses socat to listen to this port on the router and connect it to pulseaudio&#039;s native Unix socket.
The idea for this was found on <a href="http://razor.occams.info/blog/2009/02/11/pulseaudio-sound-forwarding-across-a-network/" class="urlextern" title="http://razor.occams.info/blog/2009/02/11/pulseaudio-sound-forwarding-across-a-network/" rel="ugc nofollow">Joshua Tauberer’s Blog</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Alternative configuration for forwarding sound&quot;,&quot;hid&quot;:&quot;alternative_configuration_for_forwarding_sound&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:19,&quot;range&quot;:&quot;6060-6613&quot;} -->
<h3 class="sectionedit20" id="required_packages1">Required Packages</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="/packages/pkgdata/pulseaudio-daemon" class="wikilink1" title="packages:pkgdata:pulseaudio-daemon" data-wiki-id="packages:pkgdata:pulseaudio-daemon">pulseaudio-daemon</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Required Packages&quot;,&quot;hid&quot;:&quot;required_packages1&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:20,&quot;range&quot;:&quot;6614-6685&quot;} -->
<h3 class="sectionedit21" id="server_configuration1">Server configuration</h3>
<div class="level3">

<p>
For sound from the network, something like this is needed:
</p>
<pre class="code bash"><span class="co0"># /etc/pulse/system.pa</span>
load-module module-native-protocol-unix auth-anonymous=<span class="nu0">1</span></pre>

<p>
The module will already be in system.pa by default, just make sure that the auth-anonymous=1 option is given, to avoid an access denied error, when you later try to stream sound.
</p>

<p>
Sometimes it helps to start udevd before pulseaudio to avoid problems.
Install the udev package, if you run into problems with pulseaudio.
</p>
<pre class="code bash">udevd <span class="re5">--daemon</span></pre>

<p>
If you still have problems, you can also try:
</p>
<pre class="code bash"><span class="kw2">chmod</span> 0777 <span class="sy0">/</span>dev<span class="sy0">/</span>snd<span class="sy0">/*</span></pre>

<p>
Pulseaudio also likes to complain that /var/lib/pulse is missing, so we create it:
</p>
<pre class="code bash"><span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>pulse</pre>

<p>
Run pulseaudio as follows:
</p>
<pre class="code bash">pulseaudio <span class="re5">--system</span> <span class="re5">--disallow-module-loading</span> <span class="re5">--disallow-exit</span> <span class="re5">--no-cpu-limit</span> <span class="sy0">&amp;</span></pre>

<p>
It will complain that pulseaudio shouldn&#039;t be run in system mode, but on many routers this is the only mode that will actually work.
</p>

<p>
Now run socat to listen on the port that will be forwarded to the router and let it redirect to the native Unix socket that pulseaudio is using on the router:
</p>
<pre class="code bash">socat TCP-LISTEN:<span class="nu0">4000</span>,fork UNIX-CONNECT:<span class="sy0">/</span>tmp<span class="sy0">/</span>run<span class="sy0">/</span>pulse<span class="sy0">/</span>native <span class="sy0">&amp;</span></pre>

<p>
You have to keep this running to keep the connection going.
</p>

<p>
You can put all of these commands in a script:
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>root<span class="sy0">/</span>pulseaudioserver.sh
<span class="co0">#!/bin/sh</span>
udevd <span class="re5">--daemon</span>
<span class="kw2">chmod</span> 0777 <span class="sy0">/</span>dev<span class="sy0">/</span>snd<span class="sy0">/*</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>pulse
pulseaudio <span class="re5">--system</span> <span class="re5">--disallow-module-loading</span> <span class="re5">--disallow-exit</span> <span class="re5">--no-cpu-limit</span> <span class="sy0">&amp;</span>
socat TCP-LISTEN:<span class="nu0">4000</span>,fork UNIX-CONNECT:<span class="sy0">/</span>tmp<span class="sy0">/</span>run<span class="sy0">/</span>pulse<span class="sy0">/</span>native <span class="sy0">&amp;</span>
EOF
<span class="kw2">chmod</span> +x <span class="sy0">/</span>root<span class="sy0">/</span>pulseaudioserver.sh
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;
<span class="es1">\$</span>i /root/pulseaudioserver.sh
&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local</pre>

<p>
Pulseaudio should now be running after reboot.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Server configuration&quot;,&quot;hid&quot;:&quot;server_configuration1&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:21,&quot;range&quot;:&quot;6686-8489&quot;} -->
<h3 class="sectionedit22" id="client_configuration1">Client configuration</h3>
<div class="level3">

<p>
The first step is to forward a tcp port to the router using ssh.
In this example we&#039;ve decided to use port 4000.
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="re5">-f</span> <span class="re5">-N</span> -L4000:localhost:<span class="nu0">4000</span> root<span class="sy0">@</span>openwrt</pre>

<p>
Option <code>-f</code> puts the ssh session the background, because we don&#039;t need to actively work with the session anyways.
Option <code>-N</code> let&#039;s ssh know that we don&#039;t want the shell to run any programs, since forwarding a port is all we want to do.
Enter your root password and the port should be forwarded.
</p>

<p>
To actually stream sound over the network open a terminal and type
</p>
<pre class="code bash"><span class="kw3">export</span> <span class="re2">PULSE_SERVER</span>=localhost:<span class="nu0">4000</span></pre>

<p>
Any pulseaudio application started from that same terminal will automatically stream its sound over the network.
Note that with this solution you won&#039;t see a second audio-output-device in pulseaudio-tools like padevchooser, so you can&#039;t move
streams back and forth between devices.
</p>

<p>
If you don&#039;t want to type as much every time you are going to use the remote pulseaudio, you can add this to your ~/.bashrc:
</p>
<pre class="code bash"><span class="kw1">function</span> P <span class="br0">&#123;</span>
	<span class="re2">C</span>=<span class="sy0">`</span><span class="kw2">netstat</span> <span class="re5">-ntap</span> <span class="nu0">2</span><span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-c</span> <span class="st0">&quot;:4000&quot;</span><span class="sy0">`</span>
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$C</span>&quot;</span> = <span class="st0">&quot;0&quot;</span> <span class="br0">&#93;</span>
	<span class="kw1">then</span>
		<span class="kw2">ssh</span> <span class="re5">-f</span> <span class="re5">-N</span> -L4000:localhost:<span class="nu0">4000</span> root<span class="sy0">@</span>openwrt <span class="nu0">2</span><span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
	<span class="kw1">fi</span>
	<span class="kw3">export</span> <span class="re2">PULSE_SERVER</span>=localhost:<span class="nu0">4000</span>
<span class="br0">&#125;</span></pre>

<p>
This will check wether the port is already forwarded and forward it if needed.
Then it will set the PULSE_SERVER environment variable, so that sound will be streamed over the network.
All you have to type in a terminal is P.
</p>

<p>
Now you can do something like this to stream over the network:
</p>
<pre class="code bash">P; <span class="kw2">mplayer</span> <span class="sy0">*</span>.ogg</pre>

<p>
Forwarding the port with ssh is not neccessary if your client can access the openWRT server directly (no firewall in between).
For mpd you can use the following output configuration:
</p>
<pre class="code bash">audio_output <span class="br0">&#123;</span>
        <span class="kw3">type</span>            <span class="st0">&quot;pulse&quot;</span>
        name            <span class="st0">&quot;openWRT Network Sink&quot;</span>
        server          <span class="st0">&quot;openWRT:4000&quot;</span>
        format          <span class="st0">&quot;48000:16:2&quot;</span>
<span class="br0">&#125;</span></pre>

<p>
For console applications you can simply set the PULSE_SERVER environment variable:
</p>
<pre class="code bash"><span class="kw3">export</span> <span class="re2">PULSE_SERVER</span>=<span class="st_h">'openWRT:4000'</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Client configuration&quot;,&quot;hid&quot;:&quot;client_configuration1&quot;,&quot;codeblockOffset&quot;:19,&quot;secid&quot;:22,&quot;range&quot;:&quot;8490-10590&quot;} -->
<h2 class="sectionedit23" id="pulseaudiowhy_software_mixing">PulseAudio: Why software mixing?</h2>
<div class="level2">

<p>
“Many people wonder why have software mixing at all if you have hardware mixing? The thing is, hardware mixing is a thing of the past, modern soundcards don&#039;t do it anymore.
Precisely for doing things like mixing in software SIMD CPU extensions like SSE have been invented.
Modern sound cards these days are kind of “dumbed” down, high-quality <a href="https://en.wikipedia.org/wiki/Digital-to-analog converter" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Digital-to-analog converter">DACs</a>.
They don&#039;t do mixing anymore, many modern chips don&#039;t even do volume control anymore.
Remember the days where having a Wavetable chip was a killer feature of a sound card? Those days are gone, today wavetable synthesizing is done almost exclusively in software – and that&#039;s exactly what happened to hardware mixing too.
And it is good that way.
In software mixing is is much easier to do fancier stuff like DRC which will increase quality of mixing.
And modern CPUs provide all the necessary SIMD command sets to implement this efficiently.” – <a href="http://0pointer.de/blog/projects/jeffrey-stedfast.html" class="urlextern" title="http://0pointer.de/blog/projects/jeffrey-stedfast.html" rel="ugc nofollow">Lennart Poettering</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;PulseAudio: Why software mixing?&quot;,&quot;hid&quot;:&quot;pulseaudiowhy_software_mixing&quot;,&quot;codeblockOffset&quot;:25,&quot;secid&quot;:23,&quot;range&quot;:&quot;10591-&quot;} -->