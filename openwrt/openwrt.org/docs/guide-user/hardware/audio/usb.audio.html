
<h1 class="sectionedit1" id="usb_audio_support">USB audio support</h1>
<div class="level1">

<p>
As long as you have the necessary hardware connected, OpenWrt can play audio, as can any other GNU/Linux distribution. Any USB Audio device supported by GNU/Linux should work with OpenWrt as well. But, because of it&#039;s lightbuild structure OpenWrt does not come with audio support. You have to install that afterwards.
</p>

<p>
Any USB sound card supported by Linux can work with OpenWrt. Many USB sound cards comply with the USB Audio Class standard and use the generic snd-usb-audio driver. Sometimes sound card manufacturers will explicitly say their devices are class compliant, but more commonly they do not. You can figure out whether a device is class compliant if it is marketed for use with iOS, as iOS only supports class compliant sound cards, or if it is marketed as working with Mac <abbr title="Operating System">OS</abbr> X but there is no driver to download for Mac <abbr title="Operating System">OS</abbr> X. (Windows partially supports the USB Audio Class standard, but often manufacturers provide a Windows driver for ASIO support.) If a device is not class compliant, you may be able to find whether it works with Linux by checking the <a href="http://alsa-project.org/main/index.php/Matrix:Main" class="urlextern" title="http://alsa-project.org/main/index.php/Matrix:Main" rel="ugc nofollow">ALSA compatibility matrix</a>, but this is often very out of date.
</p>

<p>
You could get any cheap USB sound card for use with OpenWrt, but the quality of sound cards varies as widely as their price. You generally get what you pay for; expensive sound cards do sound much better than cheap ones.
</p>

<p>
For an overview of the different software systems for sound on Linux, see <a href="http://tuxradar.com/content/how-it-works-linux-audio-explained" class="urlextern" title="http://tuxradar.com/content/how-it-works-linux-audio-explained" rel="ugc nofollow">How it works: Linux audio explained</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;USB audio support&quot;,&quot;hid&quot;:&quot;usb_audio_support&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1623&quot;} -->
<h2 class="sectionedit2" id="preparations">Preparations</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Preparations&quot;,&quot;hid&quot;:&quot;preparations&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1624-1648&quot;} -->
<h3 class="sectionedit3" id="prerequisites">Prerequisites</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Utilize a <strong>USB sound card</strong> with GNU/Linux support, see the <a href="/docs/guide-user/hardware/audio/usb.audio#notes" class="wikilink1" title="docs:guide-user:hardware:audio:usb.audio" data-wiki-id="docs:guide-user:hardware:audio:usb.audio">Notes</a> on that.</div>
</li>
<li class="level1"><div class="li"> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> You must have enabled the ALSA support in the kernel.</div>
</li>
<li class="level1"><div class="li"> Follow <a href="/docs/guide-user/storage/usb-installing" class="wikilink1" title="docs:guide-user:storage:usb-installing" data-wiki-id="docs:guide-user:storage:usb-installing">usb-installing</a> and install the packages <a href="/packages/pkgdata/kmod-usb-audio" class="wikilink1" title="packages:pkgdata:kmod-usb-audio" data-wiki-id="packages:pkgdata:kmod-usb-audio">kmod-usb-audio</a> and <a href="/packages/pkgdata/kmod-sound-core" class="wikilink1" title="packages:pkgdata:kmod-sound-core" data-wiki-id="packages:pkgdata:kmod-sound-core">kmod-sound-core</a> for Kernel audio support and ALSA drivers.</div>
</li>
<li class="level1"><div class="li"> Plug the USB sound card of your choice into the USB port of your OpenWrt router.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prerequisites&quot;,&quot;hid&quot;:&quot;prerequisites&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1649-2113&quot;} -->
<h3 class="sectionedit4" id="required_packages">Required packages</h3>
<div class="level3">

</div>

<h4 id="server_openwrt">Server (OpenWrt)</h4>
<div class="level4">
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Name   </th><th class="col1"> Size </th><th class="col2 leftalign"> Description  </th>
	</tr>
	<tr class="row1">
		<th class="col0" colspan="3"> Required </th>
	</tr>
	</thead>
	<tr class="row2">
		<td class="col0 leftalign"> kmod-usb-audio      </td><td class="col1 rightalign">   51909 </td><td class="col2 leftalign"> Kernel support for USB audio devices  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> kmod-sound-core     </td><td class="col1 rightalign">  135315 </td><td class="col2 leftalign"> Kernel modules for sound support      </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> alsa-utils          </td><td class="col1 centeralign">  ?  </td><td class="col2"> To initialize your soundcard</td>
	</tr>
	<tr class="row5">
		<th class="col0" colspan="3"> Optional </th>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> kmod-sound-cs5535audio  </td><td class="col1 rightalign">  56695 </td><td class="col2 leftalign"> support for the integrated AC97 sound device on olpc  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> kmod-sound-i8x0     </td><td class="col1 rightalign">   66521 </td><td class="col2 leftalign"> Support for the integrated AC97 sound device on motherboards  with Intel/SiS/nVidia/AMD chipsets, or ALi chipsets using the M5455 Audio Controller.     </td>
	</tr>
	<tr class="row8">
		<td class="col0"> kmod-sound-soc-core </td><td class="col1 rightalign">  25290 </td><td class="col2 leftalign"> SoC sound support  </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> usbutils            </td><td class="col1 rightalign">  186470 </td><td class="col2 leftalign"> package includes &#039;lsusb&#039;, if you want to check your usb-device is properly detected   </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;2167-2894&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Required packages&quot;,&quot;hid&quot;:&quot;required_packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2114-2895&quot;} -->
<h2 class="sectionedit6" id="configuration">Configuration</h2>
<div class="level2">

<p>
In <code>/etc/rc.local</code> add the line
</p>
<pre class="code">alsactl init            #to initialize your soundcard at boot up</pre>

<p>
There is nothing much to configure, but if you need to, you could use the package <code>alsa-utils</code> to do that.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2896-3146&quot;} -->
<h2 class="sectionedit7" id="alternative">Alternative</h2>
<div class="level2">

<p>
A diploma thesis (in German) describes in detail: <a href="http://neophob.com/serendipity/index.php?/archives/149-Diplomarbeit-Embedded-Linux-German.html" class="urlextern" title="http://neophob.com/serendipity/index.php?/archives/149-Diplomarbeit-Embedded-Linux-German.html" rel="ugc nofollow">http://neophob.com/serendipity/index.php?/archives/149-Diplomarbeit-Embedded-Linux-German.html</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Alternative&quot;,&quot;hid&quot;:&quot;alternative&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:7,&quot;range&quot;:&quot;3147-3320&quot;} -->
<h2 class="sectionedit8" id="applications">Applications</h2>
<div class="level2">

<p>
Once your sound card is up and running, you need some programs to play the sound:
</p>
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Name </th><th class="col1"> Version </th><th class="col2"> Dependencies </th><th class="col3"> Size </th><th class="col4 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> madplay </td><td class="col1"> 0.15.2b-10 </td><td class="col2"> libid3tag libmad </td><td class="col3"> 28.36 KiB </td><td class="col4 leftalign"> MAD is an MPEG audio decoder. It currently only supports the MPEG 1 standard, but fully implements all three audio layers (Layer I, Layer II, and Layer III, the latter often colloquially known as MP3.). There is also full support for ID3 tags.  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> mpd-mini </td><td class="col1"> 0.23.9-2 </td><td class="col2"> alsa-lib, libaudiofile, libfaad2, libmad, glib2, libcurl, libflac, libmms, libpthread, libshout, libvorbis, libvorbisidec, libid3tag </td><td class="col3"> 447.44 KiB </td><td class="col4 leftalign"> MPD is a music player supporting flac, mp3 and ogg files. It is typically controlled over a network using one of it&#039;s many clients including mpc(console), gmpc(gnome), phpmp(php), etc...  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> sox </td><td class="col1"> 14.4.2-4 </td><td class="col2">lame-lib, libmad, libid3tag, libvorbis, libvorbisidec, libgsm </td><td class="col3"> 267.53 KiB </td><td class="col4 leftalign"> SoX is a command line utility that can convert various formats of computer audio files in to other formats. It can also apply various effects to these sound files during the conversion. As an added bonus, SoX can play and record audio files on several unix-style platforms.  </td>
	</tr>
	<tr class="row4">
		<td class="col0"> shairport-sync-mini </td><td class="col1"> 3.3.9-1 </td><td class="col2"> libc, librt, libpthread, alsa-lib, libconfig11, libdaemon, libpopt0, libmbedtls12</td><td class="col3"> 90.25 KiB </td><td class="col4"> Shairport Sync plays audio from iTunes and AirPlay sources, including iOS devices, Quicktime Player and third party sources such as forkedDaapd. There are different flavours: -mini, -mbedtls, -openssl.</td>
	</tr>
	<tr class="row5">
		<td class="col0"> librespot </td><td class="col1"> 0.6.0 </td><td class="col2"> kmod-usb-core kmod-usb-audio kmod-sound-core alsa-utils </td><td class="col3"> ~ 10 MiB </td><td class="col4"> librespot is an open source client library for Spotify. It enables applications to use Spotify&#039;s service to control and play music via various backends, and to act as a Spotify Connect receiver. It is an alternative to the official and now deprecated closed-source libspotify. There is no official package for OpenWRT, but GitHub repositories with IPKs for different platforms exist.</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;3429-5329&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Applications&quot;,&quot;hid&quot;:&quot;applications&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:8,&quot;range&quot;:&quot;3321-5330&quot;} -->
<h3 class="sectionedit10" id="madplay">Madplay</h3>
<div class="level3">

<p>
In combination with wget it can act as an Internet radio. Find some MP3 stream and try something like:
</p>
<pre class="code bash"><span class="kw2">wget</span> <span class="re5">-O</span> - http:<span class="sy0">//</span>64.236.34.97:<span class="nu0">80</span><span class="sy0">/</span>stream<span class="sy0">/</span><span class="nu0">1014</span> <span class="sy0">|</span> madplay -</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Madplay&quot;,&quot;hid&quot;:&quot;madplay&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;5331-5528&quot;} -->
<h3 class="sectionedit11" id="mpd">MPD</h3>
<div class="level3">

<p>
MPD (Music Player Daemon) is a small music player with support for FLAC, MP3 and OGG files. It is a daemon process which is typically controlled by a client such as gmpc running on another desktop machine. For more information: <a href="http://mpd.wikia.com" class="urlextern" title="http://mpd.wikia.com" rel="ugc nofollow">http://mpd.wikia.com</a>
</p>

<p>
MPD is configured in the file <code>/etc/mpd.conf</code>. The default config file probably won&#039;t work as-is, but it should have enough comments to be edited easily. <img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> The MPD package does not currently contain a script to start MPD at boot. Check other HowTos to easily write one.
</p>
<ul>
<li class="level1"><div class="li"> For MPD, read <a href="https://forum.openwrt.org/viewtopic.php?pid=125196#p125196" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=125196#p125196" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?pid=125196#p125196</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://mpd.wikicities.com/wiki/OpenWRT_FullInstall" class="urlextern" title="http://mpd.wikicities.com/wiki/OpenWRT_FullInstall" rel="ugc nofollow">Here</a> is some documentation about an old and very complicated installation of mpd. Most stuff isn&#039;t necessary any longer, and much is optional. But you could milk that article for help not provided here.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;MPD&quot;,&quot;hid&quot;:&quot;mpd&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:11,&quot;range&quot;:&quot;5529-6417&quot;} -->
<h3 class="sectionedit12" id="sox">Sox</h3>
<div class="level3">
<pre class="code bash"><span class="kw2">sox</span> <span class="re5">-q</span> <span class="re4">$1</span> <span class="re5">-t</span> ossdsp <span class="sy0">/</span>dev<span class="sy0">/</span>sound<span class="sy0">/</span>dsp</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Sox&quot;,&quot;hid&quot;:&quot;sox&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:12,&quot;range&quot;:&quot;6418-6485&quot;} -->
<h3 class="sectionedit13" id="librespot">librespot</h3>
<div class="level3">

<p>
There is no official package for OpenWRT, but GitHub repositories with IPKs for different platforms exist:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/humaita-github/librespot-openwrt-ipk" class="urlextern" title="https://github.com/humaita-github/librespot-openwrt-ipk" rel="ugc nofollow">https://github.com/humaita-github/librespot-openwrt-ipk</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/izer-xyz/librespot-openwrt" class="urlextern" title="https://github.com/izer-xyz/librespot-openwrt" rel="ugc nofollow">https://github.com/izer-xyz/librespot-openwrt</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;librespot&quot;,&quot;hid&quot;:&quot;librespot&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:13,&quot;range&quot;:&quot;6486-6724&quot;} -->
<h3 class="sectionedit14" id="pulseaudio">PulseAudio</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/hardware/audio/pulseaudio" class="wikilink1" title="docs:guide-user:hardware:audio:pulseaudio" data-wiki-id="docs:guide-user:hardware:audio:pulseaudio">PulseAudio Server</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;PulseAudio&quot;,&quot;hid&quot;:&quot;pulseaudio&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:14,&quot;range&quot;:&quot;6725-6814&quot;} -->
<h3 class="sectionedit15" id="lirc">LIRC</h3>
<div class="level3">

<p>
If your USB sound card has a <strong>microphone input</strong>, you can use it to connect an infrared receiver module, and use any remote to send commands to the router.
</p>
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/hardware/lirc-audio_alsa" class="wikilink1" title="docs:guide-user:hardware:lirc-audio_alsa" data-wiki-id="docs:guide-user:hardware:lirc-audio_alsa"> LIRC audio_alsa</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LIRC&quot;,&quot;hid&quot;:&quot;lirc&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:15,&quot;range&quot;:&quot;6815-7053&quot;} -->
<h2 class="sectionedit16" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
Is the USB Soundcard detected?
</p>
<pre class="code bash"><span class="co4">root@OpenWrt:~# </span>lsusb
Bus 001 Device 007: ID 041e:324d Creative Technology, Ltd</pre>

<p>
Generic Alsa init:
</p>
<pre class="code">root@OpenWrt:~# alsactl init
Found hardware: &quot;USB-Audio&quot; &quot;USB Mixer&quot; &quot;USB041e:324d&quot; &quot;&quot; &quot;&quot;
Hardware is initialized using a generic method</pre>

<p>
<strong>Required for AC97 Sound in Virtual Box.</strong>
</p>

<p>
Unmute sound with:
</p>
<pre class="code">amixer sset Master unmute</pre>

<p>
Test sounds with:
</p>
<pre class="code">speaker-test -Dplug:front -c2 -tsine -f440
speaker-test -Dplug:front -c2 -twav -f440</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;7054-7611&quot;} -->
<h2 class="sectionedit17" id="internet_radio">Internet radio</h2>
<div class="level2">

<p>
Use one of the existing buttons of your router to control the radio. Modify one of the scripts in  <code>/etc/rc.buttons/...</code>  <a href="/docs/guide-user/hardware/hardware.button" class="wikilink1" title="docs:guide-user:hardware:hardware.button" data-wiki-id="docs:guide-user:hardware:hardware.button">  Attach functions to a push button  </a>.
Below script uses <code>madplay</code>. The idea was to use the minimum of available resources: <strong>One button control only</strong>
</p>
<ul>
<li class="level1"><div class="li"> Start audio stream/radio station (ON)</div>
</li>
<li class="level1"><div class="li"> Stopp audio stream/radio station (OFF)</div>
</li>
<li class="level1"><div class="li"> Switch between streams/radio stations (SWITCH)</div>
</li>
</ul>

<p>
Below script implements this structure:
</p>
<pre class="code">push the button the first time (t1)                -&gt; start first stream (ON)
push the button a second time within (t1+10sec)    -&gt; switch to second stream (SWITCH)
push the button a third  time within (t1+10sec)    -&gt; switch to third stream (SWITCH)
...
The history is gone as soon as 10 seconds passed after the last button has been pushed
push the button again                              -&gt; stop the stream (OFF) </pre>

<p>
I copied most of the parts from other sources (see comments), as my bash programming skills are quite bad. There is quite some room for improvement. <br/>

<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> There is no error handling in place. You need to know the functionality! <br/>

</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
&nbsp;
<span class="co0">#Control Time aka the time a sleep process is running -&gt; to count how often the button is pressed</span>
<span class="re2">SLEEPTIME</span>=10s   <span class="co0">#in seconds</span>
&nbsp;
<span class="co0">#Definition of radio stations</span>
<span class="re2">EGOFM</span>=<span class="st0">&quot;http://egofm-ais-edge-3002.fra-eco.cdn.addradio.net/egofm/live/mp3/high/stream.mp3?ar-distributor=ffa0&quot;</span>
<span class="re2">FM4</span>=<span class="st0">&quot;http://185.85.28.144:8000&quot;</span>
<span class="re2">ROCKANTENNE</span>=<span class="st0">&quot;http://stream.rockantenne.de/rockantenne&quot;</span>
<span class="re2">RADIOBOB</span>=<span class="st0">&quot;http://bob.hoerradar.de/mp3-radiobob&quot;</span>
<span class="re2">RADIOBOB_ALTERNATIVEROCK</span>=<span class="st0">&quot;http://bob.hoerradar.de/radiobob-alternativerock-mp3-hq&quot;</span>
<span class="re2">RADIOBOB_PUNK</span>=<span class="st0">&quot;http://bob.hoerradar.de/radiobob-punk-mp3-mq&quot;</span>
<span class="re2">DLFNOVA</span>=<span class="st0">&quot;http://st03.dlf.de/dlf/03/128/mp3/stream.mp3&quot;</span>
<span class="re2">BRPULS</span>=<span class="st0">&quot;http://br-puls-live.cast.addradio.de/br/puls/live/mp3/128/stream.mp3&quot;</span>
&nbsp;
<span class="co0">#PID(s) of stream/audio processes</span>
<span class="re2">PIDWGET</span>=<span class="st0">&quot;<span class="es4">$(ps | grep '[w]get' | awk '{print $1}')</span>&quot;</span>      <span class="co0">#https://stackoverflow.com/questions/3510673/find-and-kill-a-process-in-one-line-using-bash-and-regex</span>
<span class="re2">PIDMADPLAY</span>=<span class="st0">&quot;<span class="es4">$(ps | grep '[m]adplay' |awk '{print $1}')</span>&quot;</span>
<span class="co0">#echo &quot;wget PID $PIDWGET&quot;       #debug</span>
&nbsp;
<span class="co0">#PID(s) of sleep processes</span>
<span class="re2">PIDSLEEP</span>=<span class="st0">&quot;<span class="es4">$(ps | grep '[s]leep' | awk '{print $1}')</span>&quot;</span>
<span class="co0">#echo &quot;sleep PID $PIDSLEEP&quot;     #debug</span>
&nbsp;
<span class="co0">#number of sleep processes to count the number of buttons pressed</span>
<span class="re2">SPLITCHAR</span>=<span class="st0">&quot; &quot;</span>
<span class="re2">NOPIDWGET</span>=<span class="st0">&quot;<span class="es4">$(echo ${PIDWGET} | awk -F&quot;${SPLITCHAR}&quot; '{print NF}')</span>&quot;</span>
<span class="re2">NOPIDSLEEP</span>=<span class="st0">&quot;<span class="es4">$(echo ${PIDSLEEP} | awk -F&quot;${SPLITCHAR}&quot; '{print NF}')</span>&quot;</span> <span class="co0">#https://stackoverflow.com/questions/16679369/count-occurrences-of-a-char-in-a-string-using-bash/16</span>
<span class="co0">#echo &quot;no. PID sleep $NOPIDSLEEP&quot;       #debug</span>
&nbsp;
<span class="co0">#function to kill stream and audio process</span>
do_kill<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$PIDWGET</span>&quot;</span> <span class="re5">-eq</span> <span class="st0">&quot;<span class="es2">$PIDWGET</span>&quot;</span> <span class="br0">&#93;</span> <span class="nu0">2</span><span class="sy0">&gt;/</span>dev<span class="sy0">/</span>null    <span class="co0">#https://stackoverflow.c</span>
        <span class="kw1">then</span>
                <span class="kw3">kill</span> <span class="re5">-SIGKILL</span> <span class="re1">$PIDWGET</span>          <span class="co0">#kill wget process (streaming)</span>
                <span class="kw3">kill</span> <span class="re5">-SIGKILL</span> <span class="re1">$PIDMADPLAY</span>       <span class="co0">#kill madplay process (audio)</span>
                <span class="co0">#echo &quot;kill -SIGKILL $PIDWGET&quot;  #debug</span>
<span class="kw1">fi</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co0">#function to start the internet stream and provide audio output (madplay)</span>
do_stream<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
        <span class="co0">#-A -10 -&gt; volume -10dB</span>
        <span class="co0">#- -&gt; ???</span>
        <span class="co0">#&amp; process in background</span>
        <span class="kw2">wget</span> <span class="re5">-O</span> - <span class="re4">$1</span> <span class="sy0">|</span> madplay <span class="re5">-A</span> <span class="re5">-10</span> - <span class="sy0">&amp;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$ACTION</span>&quot;</span> = <span class="st0">&quot;released&quot;</span> <span class="re5">-a</span> <span class="st0">&quot;<span class="es2">$BUTTON</span>&quot;</span> = <span class="st0">&quot;wps&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$NOPIDSLEEP</span> == <span class="nu0">0</span> <span class="re5">-a</span> <span class="re1">$NOPIDWGET</span> == <span class="nu0">0</span> <span class="br0">&#93;</span>;<span class="kw1">then</span>         <span class="co0">#script never executed AND no stream running</span>
        <span class="kw2">sleep</span> <span class="re1">$SLEEPTIME</span> <span class="sy0">&amp;</span>     <span class="co0">#increment count of script executions within 10sec</span>
        <span class="co0">#echo &quot;0&quot;              #debug</span>
        do_stream <span class="re1">$DLFNOVA</span>
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="re1">$NOPIDSLEEP</span> == <span class="nu0">0</span> <span class="re5">-a</span>  <span class="re1">$NOPIDWGET</span> == <span class="nu0">1</span> <span class="br0">&#93;</span>;<span class="kw1">then</span>      <span class="co0">#script not exectued AND stream running</span>
        do_kill
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="re1">$NOPIDSLEEP</span> == <span class="nu0">1</span> <span class="re5">-a</span>  <span class="re1">$NOPIDWGET</span> == <span class="nu0">1</span> <span class="br0">&#93;</span>;<span class="kw1">then</span>      <span class="co0">#script executed once AND stream running</span>
        do_kill
        <span class="kw2">sleep</span> <span class="re1">$SLEEPTIME</span> <span class="sy0">&amp;</span>     <span class="co0">#increment count of script executions within 10sec</span>
        <span class="co0">#echo &quot;1&quot;              #debug</span>
        do_stream <span class="re1">$RADIOBOB</span>
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="re1">$NOPIDSLEEP</span> == <span class="nu0">2</span> <span class="re5">-a</span>  <span class="re1">$NOPIDWGET</span> == <span class="nu0">1</span> <span class="br0">&#93;</span>;<span class="kw1">then</span>      <span class="co0">#script executed twice AND stream running</span>
        do_kill
        <span class="kw2">sleep</span> <span class="re1">$SLEEPTIME</span> <span class="sy0">&amp;</span>     <span class="co0">#increment count of script executions within 10sec</span>
        <span class="co0">#echo &quot;2&quot;              #debug</span>
        do_stream <span class="re1">$BRPULS</span>
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="re1">$NOPIDSLEEP</span> == <span class="nu0">3</span> <span class="re5">-a</span>  <span class="re1">$NOPIDWGET</span> == <span class="nu0">1</span> <span class="br0">&#93;</span>;<span class="kw1">then</span>      <span class="co0">#...</span>
        do_kill
        <span class="kw2">sleep</span> <span class="re1">$SLEEPTIME</span> <span class="sy0">&amp;</span>     <span class="co0">#increment count of script executions within 10sec</span>
        <span class="co0">#echo &quot;3&quot;              #debug</span>
        do_stream <span class="re1">$EGOFM</span>
<span class="kw1">fi</span>
<span class="kw1">fi</span>
<span class="kw3">return</span> <span class="nu0">0</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Internet radio&quot;,&quot;hid&quot;:&quot;internet_radio&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:17,&quot;range&quot;:&quot;7612-&quot;} -->