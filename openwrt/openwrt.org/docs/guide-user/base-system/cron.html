
<h1 class="sectionedit1" id="scheduling_tasks_with_cron">Scheduling tasks with cron</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:howto_links">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
This article relies on the following:
</p>
<ul>
<li class="level1"><div class="li"> Accessing <a href="/docs/guide-quick-start/walkthrough_login" class="wikilink1" title="docs:guide-quick-start:walkthrough_login" data-wiki-id="docs:guide-quick-start:walkthrough_login">web interface</a> / <a href="/docs/guide-quick-start/sshadministration" class="wikilink1" title="docs:guide-quick-start:sshadministration" data-wiki-id="docs:guide-quick-start:sshadministration">command-line interface</a></div>
</li>
<li class="level1"><div class="li"> Managing <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">configs</a> / <a href="/docs/guide-user/additional-software/managing_packages" class="wikilink1" title="docs:guide-user:additional-software:managing_packages" data-wiki-id="docs:guide-user:additional-software:managing_packages">packages</a> / <a href="/docs/guide-user/base-system/managing_services" class="wikilink1" title="docs:guide-user:base-system:managing_services" data-wiki-id="docs:guide-user:base-system:managing_services">services</a> / <a href="/docs/guide-user/base-system/log.essentials" class="wikilink1" title="docs:guide-user:base-system:log.essentials" data-wiki-id="docs:guide-user:base-system:log.essentials">logs</a></div>
</li>
</ul>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:howto_links&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Scheduling tasks with cron&quot;,&quot;hid&quot;:&quot;scheduling_tasks_with_cron&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-123&quot;} -->
<h2 class="sectionedit6" id="introduction">Introduction</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> OpenWrt can run scheduled tasks using <a href="https://en.wikipedia.org/wiki/Cron" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Cron">cron</a> service.</div>
</li>
<li class="level1"><div class="li"> This how-to describes the method for setting up cron jobs.</div>
</li>
<li class="level1"><div class="li"> See also <a href="/docs/guide-user/advanced/watchcat" class="wikilink1" title="docs:guide-user:advanced:watchcat" data-wiki-id="docs:guide-user:advanced:watchcat">Watchcat</a> to reboot based on schedule or connectivity.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;124-385&quot;} -->
<h2 class="sectionedit7" id="goals">Goals</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Run programs or scripts at a specific time.</div>
</li>
<li class="level1"><div class="li"> Automate scheduled task management.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Goals&quot;,&quot;hid&quot;:&quot;goals&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;386-492&quot;} -->
<h2 class="sectionedit8" id="web_interface_instructions">Web interface instructions</h2>
<div class="level2">

<p>
Set up cron jobs using web interface.
</p>
<ol>
<li class="level1"><div class="li"> Navigate to <strong>LuCI → System → Scheduled Tasks</strong>.</div>
</li>
<li class="level1"><div class="li"> Edit the configuration and click the <strong>Save</strong> button.</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Web interface instructions&quot;,&quot;hid&quot;:&quot;web_interface_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;493-683&quot;} -->
<h2 class="sectionedit9" id="command-line_instructions">Command-line instructions</h2>
<div class="level2">

<p>
Set up cron jobs using command-line interface.
</p>
<pre class="code bash"><span class="co0"># Edit configuration</span>
crontab <span class="re5">-e</span> 
&nbsp;
<span class="co0"># Show configuration</span>
crontab <span class="re5">-l</span>
&nbsp;
<span class="co0"># Apply changes</span>
service cron restart</pre>

<p>
This will edit the configuraion <code>/etc/crontabs/root</code> file in <a href="/docs/guide-user/base-system/user.beginner.cli#editing_files" class="wikilink1" title="docs:guide-user:base-system:user.beginner.cli" data-wiki-id="docs:guide-user:base-system:user.beginner.cli">vi editor</a>.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> There should be a <abbr title="End of line">EOL</abbr> character on the last line of the crontab file.
Just leave an empty line at the end to be sure.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line instructions&quot;,&quot;hid&quot;:&quot;command-line_instructions&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;684-1157&quot;} -->
<h2 class="sectionedit10" id="task_specification">Task specification</h2>
<div class="level2">

<p>
Each line is a separate task written in the specification:
</p>
<pre class="code">* * * * * command to execute
- - - - -
| | | | |
| | | | ----- Day of week (0 - 6) (Sunday =0)
| | | ------- Month (1 - 12)
| | --------- Day (1 - 31)
| ----------- Hour (0 - 23)
------------- Minute (0 - 59)</pre>

<p>
Examples of time specification:
</p>
<div class="table sectionedit11"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign">  min<br/>
0-59  </th><th class="col1 centeralign">  hour<br/>
0-23  </th><th class="col2 centeralign">  day/month<br/>
1-31  </th><th class="col3 centeralign">  month<br/>
1-12  </th><th class="col4 centeralign">  day/week<br/>
0-6  </th><th class="col5"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 centeralign">  */5  </td><td class="col1 centeralign">  *  </td><td class="col2 centeralign">  *  </td><td class="col3 centeralign">  *  </td><td class="col4 centeralign">  *  </td><td class="col5"> Every 5 minutes </td>
	</tr>
	<tr class="row2">
		<td class="col0 centeralign">  12  </td><td class="col1 centeralign">  */3  </td><td class="col2 centeralign">  *  </td><td class="col3 centeralign">  *  </td><td class="col4 centeralign">  *  </td><td class="col5"> Every 3 hours at 12 minutes </td>
	</tr>
	<tr class="row3">
		<td class="col0 centeralign">  57  </td><td class="col1 centeralign">  11  </td><td class="col2 centeralign">  15  </td><td class="col3"> 1,6,12 </td><td class="col4 centeralign">  *  </td><td class="col5"> At 11:57 Hrs on 15th of Jan, June &amp; Dec </td>
	</tr>
	<tr class="row4">
		<td class="col0 centeralign">  25  </td><td class="col1 centeralign">  6  </td><td class="col2 centeralign">  *  </td><td class="col3 centeralign">  *  </td><td class="col4 centeralign">  1-5  </td><td class="col5"> At 6:25 AM every weekday (Mon-Fri) </td>
	</tr>
	<tr class="row5">
		<td class="col0 centeralign">  0  </td><td class="col1 centeralign">  0  </td><td class="col2 centeralign">  4,12,26  </td><td class="col3 centeralign">  *  </td><td class="col4 centeralign">  *  </td><td class="col5"> At midnight on 4th, 12th and 26th of every month </td>
	</tr>
	<tr class="row6">
		<td class="col0 centeralign">  5,10  </td><td class="col1 centeralign">  9,14  </td><td class="col2 centeralign">  10  </td><td class="col3 centeralign">  *  </td><td class="col4 centeralign">  0,4  </td><td class="col5"> At 9:05AM, 9:10AM, 2:05PM and 2:10PM every Sunday and Thursday </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;1507-2074&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> 0 (zero) is treated as Sunday.
If you set the day of the week to 7, BusyBox will go bonkers and run your command every day.
</p>

<p>
<strong>Table of shortcuts:</strong>
</p>
<div class="table sectionedit12"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Shortcut </th><th class="col1"> Equivalent </th><th class="col2"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>@reboot</code> </td><td class="col1"> </td><td class="col2"> Run once, at startup </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>@yearly</code> </td><td class="col1"> <code>0 0 1 1 *</code> </td><td class="col2"> Every year </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>@annually</code> </td><td class="col1"> <code>0 0 1 1 *</code> </td><td class="col2"> Every year </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>@monthly</code> </td><td class="col1"> <code>0 0 1 * *</code> </td><td class="col2"> Every month </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>@weekly</code> </td><td class="col1"> <code>0 0 * * 0</code> </td><td class="col2"> Every week </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>@daily</code> </td><td class="col1"> <code>0 0 * * *</code> </td><td class="col2"> Every day </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>@midnight</code> </td><td class="col1"> <code>0 0 * * *</code> </td><td class="col2"> Every day </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>@hourly</code> </td><td class="col1"> <code>0 * * * *</code> </td><td class="col2"> Every hour </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;2230-2628&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" />  Time shortcuts are not enabled by default. Shortcuts require compiling busybox with FEATURE_CROND_SPECIAL_TIMES enabled in the busybox compile options.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Task specification&quot;,&quot;hid&quot;:&quot;task_specification&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;1158-2787&quot;} -->
<h2 class="sectionedit13" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

<p>
You can read log messages with:
</p>
<pre class="code bash">logread <span class="re5">-e</span> cron</pre>

<p>
Not all messages are logged, to increase logging change <code><a href="/docs/guide-user/base-system/system_configuration" class="wikilink1" title="docs:guide-user:base-system:system_configuration" data-wiki-id="docs:guide-user:base-system:system_configuration">cronloglevel</a></code> option.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:13,&quot;range&quot;:&quot;2788-3020&quot;} -->
<h2 class="sectionedit14" id="extras">Extras</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:14,&quot;range&quot;:&quot;3021-3039&quot;} -->
<h3 class="sectionedit15" id="references">References</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://man.cx/crontab%281%29" class="interwiki iw_man" title="http://man.cx/crontab%281%29">crontab(1)</a>, <a href="http://man.cx/crontab%285%29" class="interwiki iw_man" title="http://man.cx/crontab%285%29">crontab(5)</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://busybox.net/downloads/BusyBox.html#crontab" class="urlextern" title="https://busybox.net/downloads/BusyBox.html#crontab" rel="ugc nofollow">BusyBox crontab</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://adminschoice.com/crontab-quick-reference" class="urlextern" title="http://adminschoice.com/crontab-quick-reference" rel="ugc nofollow">Crontab quick reference</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;References&quot;,&quot;hid&quot;:&quot;references&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:15,&quot;range&quot;:&quot;3040-3259&quot;} -->
<h3 class="sectionedit16" id="periodic_reboot">Periodic reboot</h3>
<div class="level3">

<p>
A simple workaround for some hard-to-solve problems (memory leak, performance degradation, ...) is to reboot the router periodically, for instance every night.
</p>

<p>
However, this is not as simple as it seems, because the router usually does not have a real-time clock.
This could lead to a never-ending loop of reboots.
</p>

<p>
In the boot process the clock is initially set by <code>sysfixtime</code> to the most recent timestamp of any file found in /etc.
The most recent file is possibly a status file or config file, modified maybe 30 seconds before the reboot initiated by cron.
So, in the boot process the clock gets set backwards a few seconds to that file&#039;s timestamp.
Then cron starts and notices a few seconds later that the required boot moment has again arrived and reboots again...
At the end of the boot process ntpd starts, and it may also take a while before ntpd gets and sets the correct time, so cron may start the reboot in between.
</p>

<p>
One solution for cron is to use a delay and touch a file in <code>/etc</code> before reboot.
</p>
<pre class="code bash"><span class="co0"># Reboot at 4:30am every day</span>
<span class="co0"># Note: To avoid infinite reboot loop, wait 70 seconds</span>
<span class="co0"># and touch a file in /etc so clock will be set</span>
<span class="co0"># properly to 4:31 on reboot before cron starts.</span>
<span class="nu0">30</span> <span class="nu0">4</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="kw2">sleep</span> <span class="nu0">70</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">touch</span> <span class="sy0">/</span>etc<span class="sy0">/</span>banner <span class="sy0">&amp;&amp;</span> reboot</pre>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> On many platforms <code>shutdown</code> does not work; it will just halt the CPU but it won&#039;t power off the device.
There is usually no programmable circuitry to actually power off the unit.
<code>reboot</code> does work, in case you should want to reboot the router periodically.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Periodic reboot&quot;,&quot;hid&quot;:&quot;periodic_reboot&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;3260-4825&quot;} -->
<h3 class="sectionedit17" id="periodic_network_restart">Periodic network restart</h3>
<div class="level3">

<p>
A simple solution for restart all your network (lan, wan and wifi) every 10 minutes is this:
</p>
<pre class="code bash"><span class="sy0">*/</span><span class="nu0">10</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Periodic network restart&quot;,&quot;hid&quot;:&quot;periodic_network_restart&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:17,&quot;range&quot;:&quot;4826-5012&quot;} -->
<h3 class="sectionedit18" id="alarm_clock">Alarm clock</h3>
<div class="level3">

<p>
If you have <a href="https://en.wikipedia.org/wiki/Daylight saving time" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Daylight saving time">DST</a> you could write yourself a nice alarm clock.
When DST starts in central Europe, clocks advance from 02:00 CET to 03:00 CEST on last Sunday in March.
Six day before that, you could make your WoL wake you 10 minutes earlier.
Later won&#039;t work, you&#039;ll be late.
When DST ends in central Europe, clocks retreat from 03:00 CEST to 02:00 CET on last Sunday in October.
</p>
<pre class="code bash"><span class="co0"># min hour day month dayofweek command</span>
<span class="nu0">59</span> 05 <span class="sy0">*</span> <span class="sy0">*</span> <span class="nu0">1</span> <span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>wol <span class="re5">-h</span> 192.168.1.255 xx:xx:xx:xx:xx:xx
<span class="co0"># crontab must end with the last line as space or a comment</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Alarm clock&quot;,&quot;hid&quot;:&quot;alarm_clock&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:18,&quot;range&quot;:&quot;5013-5620&quot;} -->
<h3 class="sectionedit19" id="keep_number_of_configssnapshots_of_config">Keep number of configs / snapshots of config</h3>
<div class="level3">

<p>
To keep a number N of configurations/settings at the directory “/root”, you can also use cron. This way you can access and restore configurations of the past N days. The cronjob can easily be extended to copy the config to another device, to be able to replicate a broken OpenWRT device from scratch.
</p>
<pre class="code bash"><span class="co0">#Make a new backup/configurations snapshot at nighttime 00:01 am, keep last N=100 snapshots</span>
<span class="co0">#01 00 * * * sysupgrade -b &quot;/root/backup-${HOSTNAME}.tar.gz&quot; # &lt;-- keep just one config</span>
01 00 <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="kw2">find</span> <span class="st0">&quot;/root&quot;</span> <span class="re5">-type</span> f <span class="re5">-name</span> <span class="st0">&quot;backup-*.tar.gz&quot;</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-r</span> <span class="sy0">|</span> <span class="kw2">awk</span> <span class="st_h">'NR &gt; 100'</span> <span class="sy0">|</span> <span class="kw2">xargs</span> <span class="kw2">rm</span> <span class="re5">-f</span>; sysupgrade <span class="re5">-b</span> <span class="st0">&quot;/root/backup-<span class="es3">${HOSTNAME}</span>-<span class="es4">$(date +\%Y-\%m-\%d-\%H-\%M-\%S)</span>.tar.gz&quot;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Keep number of configs \/ snapshots of config&quot;,&quot;hid&quot;:&quot;keep_number_of_configssnapshots_of_config&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:19,&quot;range&quot;:&quot;5621-&quot;} -->