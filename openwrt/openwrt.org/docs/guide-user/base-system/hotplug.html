
<h1 class="sectionedit1" id="hotplug">Hotplug</h1>
<div class="level1">

<p>
Procd (the init system and process management daemon) executes scripts located in <code>/etc/hotplug.d</code> when certain events happen, like for example when an interface goes up or down, when a new storage drive is detected, or when a button is pressed.
It can be very useful with PPPoE connection or in an unstable network, or to use hardware buttons.
</p>

<p>
This functionality emulates/extends what was done by the long retired Hotplug2 package.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hotplug&quot;,&quot;hid&quot;:&quot;hotplug&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-459&quot;} -->
<h2 class="sectionedit2" id="how_it_works">How it works</h2>
<div class="level2">

<p>
In the <code>/etc/hotplug.d</code> directory you will find some directories <strong>block</strong>, <strong>iface</strong>, <strong>net</strong> and <strong>ntp</strong>.
</p>

<p>
When the trigger event fires, Procd will execute all scripts in that trigger&#039;s directory, in alphabetical order.
Which is why most scripts in there use a numeric prefix.
</p>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Directory     </th><th class="col1 leftalign"> Description                                                                                               </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> <strong>block</strong>     </td><td class="col1 leftalign"> Block device events: device connected/disconnected                                                        </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong>button</strong>    </td><td class="col1 leftalign"> Buttons: not created by default, see <a href="/docs/guide-user/hardware/hardware.button" class="wikilink1" title="docs:guide-user:hardware:hardware.button" data-wiki-id="docs:guide-user:hardware:hardware.button">/etc/rc.button</a> instead  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <strong>dhcp</strong>      </td><td class="col1 leftalign"> <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>-related events                                                                                       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong>dsl</strong>       </td><td class="col1 leftalign"> DSL modem events                                                                                          </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <strong>firewall</strong>  </td><td class="col1 leftalign"> Firewall-related events (not applicable to <code>fw4</code>)                                                       </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <strong>iface</strong>     </td><td class="col1 leftalign"> Interface events: <abbr title="Local Area Network">LAN</abbr>/<abbr title="Wide Area Network">WAN</abbr>/etc. is connected/disconnected                                                  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <strong>neigh</strong>     </td><td class="col1 leftalign"> Neighbor discovery                                                                                        </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> <strong>net</strong>       </td><td class="col1 leftalign"> Network-related events                                                                                    </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> <strong>ntp</strong>       </td><td class="col1 leftalign"> Time sync events: time step, time server stratum change                                                   </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> <strong>tftp</strong>      </td><td class="col1 leftalign"> <abbr title="Trivial File Transfer Protocol">TFTP</abbr>-related events                                                                                       </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> <strong>tty</strong>       </td><td class="col1 leftalign"> TTY-related events, including but not limited to <abbr title="Wireless Wide Area Network">WWAN</abbr> modems, but pointing directly to TTY interface      </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> <strong>usb</strong>       </td><td class="col1 leftalign"> USB devices like 3g-modem and tty*                                                                        </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> <strong>usbmisc</strong>   </td><td class="col1 leftalign"> Special USB peripherals like printers (scripts in this subsystem have fewer variables available)          </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;767-2530&quot;} -->
<p>
See also:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/openwrt/openwrt/blob/master/package/system/procd/files/hotplug.json" class="urlextern" title="https://github.com/openwrt/openwrt/blob/master/package/system/procd/files/hotplug.json" rel="ugc nofollow">Buttons, sound devices, serial and USB serial dongles</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/openwrt/openwrt/blob/master/package/network/services/dnsmasq/files/dhcp-script.sh" class="urlextern" title="https://github.com/openwrt/openwrt/blob/master/package/network/services/dnsmasq/files/dhcp-script.sh" rel="ugc nofollow">DHCP, NDP, TFTP</a></div>
</li>
<li class="level1"><div class="li"> <a href="/docs/guide-user/network/protocol.dhcp#dhcp_client_scripts" class="wikilink1" title="docs:guide-user:network:protocol.dhcp" data-wiki-id="docs:guide-user:network:protocol.dhcp">DHCP client scripts</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;How it works&quot;,&quot;hid&quot;:&quot;how_it_works&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;460-2902&quot;} -->
<h2 class="sectionedit4" id="usagetroubleshooting">Usage / Troubleshooting</h2>
<div class="level2">

<p>
Simply place your script(s) into the right hotplug.d directory, if there is none just create the right one.
</p>

<p>
Procd exposes a wealth of info when executes your scripts in <code>/etc/hotplug.d</code>, usually as environmental variables.
</p>

<p>
If you want to see what environmental variables it is providing, make a script like this:
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>iface<span class="sy0">/</span>00-logger
logger <span class="re5">-t</span> hotplug $<span class="br0">&#40;</span><span class="kw2">env</span><span class="br0">&#41;</span>
EOF</pre>

<p>
Then trigger the event connected to that directory, and then you can see what envs were passed by reading the output:
</p>
<pre class="code bash">logread <span class="re5">-e</span> hotplug</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Usage \/ Troubleshooting&quot;,&quot;hid&quot;:&quot;usagetroubleshooting&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2903-3511&quot;} -->
<h2 class="sectionedit5" id="event_classesdirectories">Event classes / Directories</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Event classes \/ Directories&quot;,&quot;hid&quot;:&quot;event_classesdirectories&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;3512-3551&quot;} -->
<h3 class="sectionedit6" id="net">net</h3>
<div class="level3">

<p>
For scripts in <strong>net</strong> directory, these are the (relevant) environmental variables
</p>
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> “add” or “remove” noted </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DEVICENAME </td><td class="col1"> configured interface names (br-lan, wlan0, phy1-ap0 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> PATH </td><td class="col1"> Full path </td>
	</tr>
	<tr class="row4">
		<td class="col0"> DEVPATH </td><td class="col1"> full device path (for example “/devices/pci0000:00/0000:00:0b.0/usb1/1-1/1-1:1.0/host7/target7:0:0/7:0:0:0/block/sdc/sdc1 ” </td>
	</tr>
	<tr class="row5">
		<td class="col0"> DEVTYPE </td><td class="col1"> what the DEVICENAME are names of, ie. br-lan, phy1-ap0 </td>
	</tr>
	<tr class="row6">
		<td class="col0"> INTERFACE </td><td class="col1"> configured interfaces as in DEVTYPE </td>
	</tr>
	<tr class="row7">
		<td class="col0"> SEQNUM </td><td class="col1"> seqnum (a number) </td>
	</tr>
	<tr class="row8">
		<td class="col0"> SUBSYSTEM </td><td class="col1"> always = “net” </td>
	</tr>
	<tr class="row9">
		<td class="col0"> IFINDEX </td><td class="col1"> appears to be related to the configured interfaces. See `ifconfig` </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;3650-4211&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;net&quot;,&quot;hid&quot;:&quot;net&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:6,&quot;range&quot;:&quot;3552-4212&quot;} -->
<h3 class="sectionedit8" id="block">block</h3>
<div class="level3">

<p>
For scripts in <strong>block</strong> directory, these are the (relevant) environmental variables
</p>
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> For normal device (e.g: sda) it is either “add” or “remove”. Can be “change” if the device is dm-crypt (e.g: dm-0) </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DEVICENAME </td><td class="col1"> seems same as DEVNAME below </td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEVNAME </td><td class="col1"> Device or partition name (if I connect a drive I get a hotplug call with “sda” and another hotplug call with “sda1”)</td>
	</tr>
	<tr class="row4">
		<td class="col0"> DEVPATH </td><td class="col1"> full device path (for example “/devices/pci0000:00/0000:00:0b.0/usb1/1-1/1-1:1.0/host7/target7:0:0/7:0:0:0/block/sdc/sdc1 ” </td>
	</tr>
	<tr class="row5">
		<td class="col0"> DEVTYPE </td><td class="col1"> what the DEVNAME e DEVICENAME are names of, I&#039;ve seen “partition” here when a device with a readable partition is inserted and a “disk” when that device is removed.</td>
	</tr>
	<tr class="row6">
		<td class="col0"> MAJOR </td><td class="col1"> major device number </td>
	</tr>
	<tr class="row7">
		<td class="col0"> MINOR </td><td class="col1"> minor device number </td>
	</tr>
	<tr class="row8">
		<td class="col0"> SEQNUM </td><td class="col1"> seqnum (a number) </td>
	</tr>
	<tr class="row9">
		<td class="col0"> SUBSYSTEM </td><td class="col1"> seems this is only “block” </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;4315-5103&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;block&quot;,&quot;hid&quot;:&quot;block&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:8,&quot;range&quot;:&quot;4213-5104&quot;} -->
<h3 class="sectionedit10" id="dsl">dsl</h3>
<div class="level3">

<p>
For scripts in <strong>dsl</strong> directory, these are the (relevant) environment variables
</p>
<div class="table sectionedit11"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> DSL_NOTIFICATION_TYPE </td><td class="col1"> <code>DSL_STATUS</code>, <code>DSL_INTERFACE_STATUS</code>, <code>DSL_DATARATE_STATUS_US</code>, <code>DSL_DATARATE_STATUS_DS</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DSL_LINE_NUMBER </td><td class="col1"> <code>0</code>, <code>1</code> * </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;5201-5394&quot;} -->
<p>
When DSL_NOTIFICATION_TYPE is <code>DSL_STATUS</code>, the following environment variables are set
</p>
<div class="table sectionedit12"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> DSL_XTU_STATUS </td><td class="col1"> <code>ADSL</code>, <code>VDSL</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DSL_TC_LAYER_STATUS </td><td class="col1"> <code>ATM</code>, <code>EFM</code> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> DSL_EFM_TC_CONFIG_US </td><td class="col1"> <code>NORMAL</code>, <code>PRE_EMPTION</code>, <code>UNKNOWN</code> </td>
	</tr>
	<tr class="row4">
		<td class="col0"> DSL_EFM_TC_CONFIG_DS </td><td class="col1"> <code>NORMAL</code>, <code>UNKNOWN</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;5487-5720&quot;} -->
<p>
When DSL_NOTIFICATION_TYPE is <code>DSL_INTERFACE_STATUS</code>, the following environment variables are set
</p>
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> DSL_INTERFACE_STATUS </td><td class="col1"> <code>DOWN</code>, <code>READY</code>, <code>HANDSHAKE</code>, <code>TRAINING</code>, <code>UP</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DSL_BONDING_STATUS </td><td class="col1"> <code>INACTIVE</code>, <code>ACTIVE</code> * </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;5823-5990&quot;} -->
<p>
When DSL_NOTIFICATION_TYPE is <code>DSL_DATARATE_STATUS_US</code>, the following environment variables are set
</p>
<div class="table sectionedit14"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> DSL_DATARATE_US_BC0 </td><td class="col1"> Upstream data rate in bit/s for Channel 0 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DSL_DATARATE_US_BC1 </td><td class="col1"> Upstream data rate in bit/s for Channel 1 * </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;6095-6264&quot;} -->
<p>
When DSL_NOTIFICATION_TYPE is <code>DSL_DATARATE_STATUS_DS</code>, the following environment variables are set
</p>
<div class="table sectionedit15"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> DSL_DATARATE_DS_BC0 </td><td class="col1"> Downstream data rate in bit/s for Channel 0 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DSL_DATARATE_DS_BC1 </td><td class="col1"> Downstream data rate in bit/s for Channel 1 * </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table7&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;6369-6542&quot;} -->
<p>
NOTE: environment variables marked with an * are only available when channel bonding support is compiled in.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;dsl&quot;,&quot;hid&quot;:&quot;dsl&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:10,&quot;range&quot;:&quot;5105-6653&quot;} -->
<h3 class="sectionedit16" id="iface">iface</h3>
<div class="level3">

<p>
For scripts in <strong>iface</strong> directory, these are the (relevant) environmental variables 
</p>
<div class="table sectionedit17"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> <code>ifdown</code>, <code>ifup</code>, <code>ifup-failed</code>, <code>ifupdate</code>, <code>free</code>, <code>reload</code>, <code>iflink</code>, <code>create</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> INTERFACE </td><td class="col1"> Name of the logical interface which went up or down (e.g. <code>wan</code> or <code>lan</code>)</td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEVICE </td><td class="col1"> Name of the physical device which went up or down (e.g. <code>eth0</code> or <code>br-lan</code> or <code>pppoe-wan</code>), when applicable</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table8&quot;,&quot;secid&quot;:17,&quot;range&quot;:&quot;6757-7118&quot;} -->
<p>
The meaning of most actions should be straightforward, the maybe-not-obvious ones are:
</p>
<div class="table sectionedit18"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Value </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>ifup-failed</code> </td><td class="col1"> <code>ifdown</code> event happened while the interface was being brought up </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>free</code> </td><td class="col1"> the interface has been removed (inverse of <code>create</code>) </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>iflink</code> </td><td class="col1"> the interface reported the presence of a carrier </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table9&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;7207-7455&quot;} -->
<p>
When ACTION is <code>ifupdate</code>, the following environment variables may be set
</p>
<div class="table sectionedit19"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> IFUPDATE_ADDRESSES </td><td class="col1"> <code>1</code> if address changed since previous ifupdate event </td>
	</tr>
	<tr class="row2">
		<td class="col0"> IFUPDATE_ROUTES </td><td class="col1"> <code>1</code> if a route changed since previous ifupdate event </td>
	</tr>
	<tr class="row3">
		<td class="col0"> IFUPDATE_PREFIXES </td><td class="col1"> <code>1</code> if prefix changed since previous ifupdate event </td>
	</tr>
	<tr class="row4">
		<td class="col0"> IFUPDATE_DATA </td><td class="col1"> <code>1</code> if <code>ubus call network.interface.$INTERFACE set_data ...</code> (or equivalent) happened </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table10&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;7534-7910&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;iface&quot;,&quot;hid&quot;:&quot;iface&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:16,&quot;range&quot;:&quot;6654-7911&quot;} -->
<h3 class="sectionedit20" id="ntp">ntp</h3>
<div class="level3">

<p>
Variables based on busybox ntpd:
</p>
<div class="table sectionedit21"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> step, stratum, unsync or periodic </td>
	</tr>
	<tr class="row2">
		<td class="col0"> freq_drift_ppm </td><td class="col1"> ntp variables </td>
	</tr>
	<tr class="row3">
		<td class="col0"> offset </td><td class="col1"> Time adjustment done </td>
	</tr>
	<tr class="row4">
		<td class="col0"> stratum </td><td class="col1"> Quality (nr of servers to atomic clock) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> poll_interval </td><td class="col1"> ntp variables </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table11&quot;,&quot;secid&quot;:21,&quot;range&quot;:&quot;7960-8195&quot;} -->
<p>
Even without <abbr title="Network Time Protocol">NTP</abbr> sync, you will receive a “periodic” hotplug event, with <code>stratum=16</code>, about every 11 minutes out of the box.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ntp&quot;,&quot;hid&quot;:&quot;ntp&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:20,&quot;range&quot;:&quot;7912-8325&quot;} -->
<h3 class="sectionedit22" id="tty">tty</h3>
<div class="level3">
<div class="table sectionedit23"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> add, remove, bind, unbind as above </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DEVICENAME </td><td class="col1"> eg “ttyUSB2” </td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEVNAME </td><td class="col1"> only for bind/unbind, eg, “ttyUSB2” </td>
	</tr>
	<tr class="row4">
		<td class="col0"> DEVPATH </td><td class="col1"> eg, “/devices/platform/ahb/1b400000.usb/usb2/2-1/2-1:1.3/ttyUSB2” </td>
	</tr>
	<tr class="row5">
		<td class="col0"> SEQNUM </td><td class="col1"> (action number since boot for this subsystem) eg 335 </td>
	</tr>
	<tr class="row6">
		<td class="col0"> SUBSYSTEM </td><td class="col1"> Specific type of device, eg, “usb-serial” </td>
	</tr>
	<tr class="row7">
		<td class="col0"> MAJOR </td><td class="col1"> eg 189 </td>
	</tr>
	<tr class="row8">
		<td class="col0"> MINOR </td><td class="col1"> eg 1 </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table12&quot;,&quot;secid&quot;:23,&quot;range&quot;:&quot;8340-8739&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;tty&quot;,&quot;hid&quot;:&quot;tty&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:22,&quot;range&quot;:&quot;8326-8740&quot;} -->
<h3 class="sectionedit24" id="usb">usb</h3>
<div class="level3">
<div class="table sectionedit25"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> add, remove, bind, unbind as above </td>
	</tr>
	<tr class="row2">
		<td class="col0"> DEVICENAME </td><td class="col1"> eg “1-1” </td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEVNAME </td><td class="col1"> eg, “bus/usb/001/002” </td>
	</tr>
	<tr class="row4">
		<td class="col0"> DEVNUM </td><td class="col1"> eg 002 </td>
	</tr>
	<tr class="row5">
		<td class="col0"> DEVPATH </td><td class="col1"> eg, “/devices/platform/ehci-platform/usb1/1-1” </td>
	</tr>
	<tr class="row6">
		<td class="col0"> DEVTYPE </td><td class="col1"> eg “usb_device” </td>
	</tr>
	<tr class="row7">
		<td class="col0"> TYPE </td><td class="col1"> eg 9/0/1 </td>
	</tr>
	<tr class="row8">
		<td class="col0"> PRODUCT </td><td class="col1"> the vendor/productcode/version, eg “424/2640/0” see lsusb </td>
	</tr>
	<tr class="row9">
		<td class="col0"> SEQNUM </td><td class="col1"> (action number since boot for this subsystem) eg 335 </td>
	</tr>
	<tr class="row10">
		<td class="col0"> BUSNUM </td><td class="col1"> eg 001 </td>
	</tr>
	<tr class="row11">
		<td class="col0"> MAJOR </td><td class="col1"> eg 189 </td>
	</tr>
	<tr class="row12">
		<td class="col0"> MINOR </td><td class="col1"> eg 1 </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table13&quot;,&quot;secid&quot;:25,&quot;range&quot;:&quot;8755-9221&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;usb&quot;,&quot;hid&quot;:&quot;usb&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:24,&quot;range&quot;:&quot;8741-9222&quot;} -->
<h3 class="sectionedit26" id="usbmisc">usbmisc</h3>
<div class="level3">
<div class="table sectionedit27"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Variable name  </th><th class="col1 leftalign"> description                                             </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> ACTION         </td><td class="col1 leftalign"> add, remove as above                                    </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> DEVNAME        </td><td class="col1 leftalign"> eg, “bus/usb/001/002”                                   </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> DEVPATH        </td><td class="col1 leftalign"> eg, “/devices/platform/ehci-platform/usb1/1-1”          </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> DEVICENAME     </td><td class="col1 leftalign"> eg “1-1”                                                </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> SEQNUM         </td><td class="col1 centeralign">  (action number since boot for this subsystem) eg 335   </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> MAJOR          </td><td class="col1 leftalign"> eg 189                                                  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> MINOR          </td><td class="col1 leftalign"> eg 1                                                    </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table14&quot;,&quot;secid&quot;:27,&quot;range&quot;:&quot;9241-9856&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;usbmisc&quot;,&quot;hid&quot;:&quot;usbmisc&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:26,&quot;range&quot;:&quot;9223-9858&quot;} -->
<h2 class="sectionedit28" id="examples">Examples</h2>
<div class="level2">
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>iface<span class="sy0">/</span><span class="nu0">99</span>-my-action
<span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;ifup&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="br0">&#123;</span>
    logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Device: <span class="es3">${DEVICE}</span> / Action: <span class="es3">${ACTION}</span>&quot;</span>
<span class="br0">&#125;</span> 
EOF</pre>

<p>
Every time an interface goes up then the if/fi statement will be executed.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:28,&quot;range&quot;:&quot;9859-10124&quot;} -->
<h3 class="sectionedit29" id="symlink_instead_of_rename_a_device">Symlink instead of rename a device</h3>
<div class="level3">

<p>
An other script to create a symlink instead of renaming the device.
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">20</span>-cp210x
<span class="re2">CP210_PRODID</span>=<span class="st_h">'10c4/ea60/100'</span>
<span class="re2">SYMLINK</span>=<span class="st0">&quot;my_link&quot;</span>
&nbsp;
<span class="kw1">set</span> <span class="re5">-eu</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVTYPE:-}</span>&quot;</span> = <span class="st_h">'usb_interface'</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> \
   <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${PRODUCT:-}</span>&quot;</span> = <span class="st0">&quot;<span class="es3">${CP210_PRODID}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION:-}</span>&quot;</span> = <span class="st_h">'bind'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
		<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-L</span> <span class="st0">&quot;/dev/<span class="es3">${SYMLINK}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
			logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink '/dev/<span class="es3">${SYMLINK}</span>' already exists&quot;</span>
			<span class="kw3">exit</span> <span class="nu0">0</span>
		<span class="kw1">fi</span>
&nbsp;
		<span class="re2">DEVICE_NAME</span>=<span class="st0">&quot;<span class="es4">$(find /sys${DEVPATH:-} -maxdepth 1 -type d -iname 'ttyUSB*' -exec basename {} \;)</span>&quot;</span>
		<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es3">${DEVICE_NAME}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
			logger <span class="re5">-t</span> hotplug <span class="st_h">'Warning: DEVICE_NAME is empty'</span>
			<span class="kw3">exit</span> <span class="nu0">0</span>
		<span class="kw1">fi</span>
&nbsp;
		logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Device name of cp210 is '<span class="es3">${DEVICE_NAME}</span>'&quot;</span>
		<span class="kw2">ln</span> <span class="re5">-s</span> <span class="st0">&quot;/dev/<span class="es3">${DEVICE_NAME}</span>&quot;</span> <span class="st0">&quot;/dev/<span class="es3">${SYMLINK}</span>&quot;</span>
		logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink from '/dev/<span class="es3">${DEVICE_NAME}</span>' to '/dev/<span class="es3">${SYMLINK}</span>' created&quot;</span>
	<span class="kw1">fi</span>
&nbsp;
&nbsp;
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION:-}</span>&quot;</span> = <span class="st_h">'unbind'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
		<span class="kw2">rm</span> <span class="st0">&quot;/dev/<span class="es3">${SYMLINK}</span>&quot;</span>
		logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink '/dev/<span class="es3">${SYMLINK}</span>' removed&quot;</span>
	<span class="kw1">fi</span>
<span class="kw1">fi</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Symlink instead of rename a device&quot;,&quot;hid&quot;:&quot;symlink_instead_of_rename_a_device&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:29,&quot;range&quot;:&quot;10125-11141&quot;} -->
<h3 class="sectionedit30" id="start_ser2net_upon_hotplug">Start ser2net upon hotplug</h3>
<div class="level3">

<p>
Similarly, it is also possible to start `ser2net` to make the serial port remotely available
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">20</span>-cp210x-ser2net
<span class="re2">CP210_PRODID</span>=<span class="st_h">'10c4/ea60/100'</span>                                                                                                                                                          
<span class="re2">SER2NET_PID</span>=<span class="st_h">'/var/run/ser2net.pid'</span>                                                                                                                                                    
<span class="re2">SER2NET_PORT</span>=<span class="nu0">18888</span>                                                                                                                                                                    
<span class="re2">SER2NET_BAUDRATE</span>=<span class="nu0">115200</span>                                                                                                                                                               
<span class="re2">SER2NET_FLOWRATE</span>=<span class="st_h">'software'</span>                                                                                                                                                           
<span class="re2">SER2NET_RADIO</span>=<span class="st_h">'znp'</span>                                                                                                                                                                   
<span class="re2">SER2NET_OPTS</span>=<span class="st0">&quot;<span class="es3">${SER2NET_BAUDRATE}</span> NONE 1STOPBIT 8DATABITS -RTSCTS -LOCAL NOBREAK&quot;</span>                                                                                                     
&nbsp;
<span class="kw1">set</span> <span class="re5">-eu</span>                                                                                                                                                                               
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVTYPE:-}</span>&quot;</span> = <span class="st_h">'usb_interface'</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> \                                                                                                                                          
   <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${PRODUCT:-}</span>&quot;</span> = <span class="st0">&quot;<span class="es3">${CP210_PRODID}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                       
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION:-}</span>&quot;</span> = <span class="st_h">'bind'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                           
                <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-s</span> <span class="st0">&quot;<span class="es3">${SER2NET_PID}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                      
                        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Warning: ser2net already running as pid: <span class="es4">$(cat &quot;${SER2NET_PID}&quot;)</span> via <span class="es3">${SER2NET_PID}</span>&quot;</span>                                                       
                        <span class="kw3">exit</span> <span class="nu0">0</span>                                                                                                                                                        
                <span class="kw1">fi</span>                                                                                                                                                                    
&nbsp;
                <span class="re2">DEVICE_NAME</span>=<span class="st0">&quot;<span class="es4">$(find &quot;/sys${DEVPATH:-}&quot; -maxdepth 1 -type d -iname 'ttyUSB*' -exec basename {} \;)</span>&quot;</span>                                                                    
                <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es3">${DEVICE_NAME}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                      
                        logger <span class="re5">-t</span> hotplug <span class="st_h">'Warning: DEVICE_NAME is empty'</span>                                                                                                             
                        <span class="kw3">exit</span> <span class="nu0">0</span>                                                                                                                                                        
                <span class="kw1">fi</span>                                                                                                                                                                    
                logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Device name of cp210 is '<span class="es3">${DEVICE_NAME}</span>'&quot;</span>                                                                                                          
&nbsp;
                ser2net <span class="re5">-C</span> <span class="st0">&quot;<span class="es3">${SER2NET_PORT}</span>:raw:100:/dev/<span class="es3">${DEVICE_NAME}</span>:<span class="es3">${SER2NET_OPTS}</span>&quot;</span> <span class="re5">-P</span> <span class="st0">&quot;<span class="es3">${SER2NET_PID}</span>&quot;</span>                                                                          
                <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="st_h">'/etc/avahi/services'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                 
                        <span class="br0">&#123;</span>                                                                                                                                                             
                                <span class="kw3">printf</span> <span class="st_h">'&lt;service-group&gt;\n\n'</span>                                                                                                                          
                                <span class="kw3">printf</span> <span class="st_h">'  &lt;name replace-wildcards=&quot;yes&quot;&gt;%%h&lt;/name&gt;\n\n'</span>                                                                                  
                                <span class="kw3">printf</span> <span class="st_h">'  &lt;service&gt;\n'</span>                                                                                                                                
                                <span class="kw3">printf</span> <span class="st_h">'    &lt;type&gt;_ser2net_zigbee-gateway._tcp&lt;/type&gt;\n'</span>                                                                                               
                                <span class="kw3">printf</span> <span class="st_h">'    &lt;port&gt;%d&lt;/port&gt;\n'</span> <span class="st0">&quot;<span class="es3">${SER2NET_PORT}</span>&quot;</span>                                                                                                      
                                <span class="kw3">printf</span> <span class="st_h">'    &lt;txt-record&gt;baudrate=%d&lt;/txt-record&gt;\n'</span> <span class="st0">&quot;<span class="es3">${SER2NET_BAUDRATE:-115200}</span>&quot;</span>                                                                     
                                <span class="kw3">printf</span> <span class="st_h">'    &lt;txt-record&gt;flow-control=%s&lt;/txt-record&gt;\n'</span> <span class="st0">&quot;<span class="es3">${SER2NET_FLOWRATE:-software}</span>&quot;</span>                                                               
                                <span class="kw3">printf</span> <span class="st_h">'    &lt;txt-record&gt;radio=%s&lt;/txt-record&gt;\n'</span> <span class="st0">&quot;<span class="es3">${SER2NET_RADIO:-znp}</span>&quot;</span>                                                                              
                                <span class="kw3">printf</span> <span class="st_h">'  &lt;/service&gt;\n\n'</span>                                                                                                                             
                                <span class="kw3">printf</span> <span class="st_h">'&lt;/service-group&gt;\n'</span>                                                                                                                           
                        <span class="br0">&#125;</span> <span class="sy0">&gt;</span> <span class="st_h">'/etc/avahi/services/ser2net.service'</span>                                                                                                                     
                <span class="kw1">fi</span>                                                                                                                                                                    
&nbsp;
                logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Started ser2net on '/dev/<span class="es3">${DEVICE_NAME}</span>'&quot;</span>                                                                                                          
        <span class="kw1">fi</span>                                                                                                                                                                            
&nbsp;
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION:-}</span>&quot;</span> = <span class="st_h">'unbind'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                         
                logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Attempting to stop ser2net with pid: <span class="es4">$(cat &quot;${SER2NET_PID}&quot;)</span>&quot;</span>                                                                                      
                <span class="kw3">kill</span> <span class="re5">-3</span> <span class="st0">&quot;<span class="es4">$(cat &quot;${SER2NET_PID}&quot;)</span>&quot;</span>                                                                                                                                     
                <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-s</span> <span class="st_h">'/etc/avahi/services/ser2net.service'</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                 
                        <span class="kw2">rm</span> <span class="st_h">'/etc/avahi/services/ser2net.service'</span>                                                                                                                      
                <span class="kw1">fi</span>                                                                                                                                                                    
                <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-s</span> <span class="st0">&quot;<span class="es3">${SER2NET_PID}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>                                                                                                                                    
                        logger <span class="re5">-t</span> hotplug <span class="st_h">'Failed'</span>                                                                                                                                    
                        <span class="kw3">exit</span> <span class="nu0">0</span>                                                                                                                                                        
                <span class="kw1">fi</span>                                                                                                                                                                    
        <span class="kw1">fi</span>                                                                                                                                                                            
<span class="kw1">fi</span>     
EOF</pre>
<blockquote><div class="no">
 <em class="u">Note:</em> The above example demonstrates how to also integrate avahi which leads to an auto-discoverable serial port over the network. In this example a Zigbee device would have been connected to the serial port.</div></blockquote>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Start ser2net upon hotplug&quot;,&quot;hid&quot;:&quot;start_ser2net_upon_hotplug&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:30,&quot;range&quot;:&quot;11142-21625&quot;} -->
<h3 class="sectionedit31" id="script_that_detects_whether_plugged_usb_device_is_bluetooth_or_not">Script that detects whether plugged usb device is bluetooth or not</h3>
<div class="level3">
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">20</span>-bt_test
<span class="re2">BT_PRODID</span>=<span class="st0">&quot;a12/1/&quot;</span>
<span class="re2">BT_PRODID_HOT</span>=<span class="st0">&quot;<span class="es3">${PRODUCT::6}</span>&quot;</span>
&nbsp;
<span class="co0">#logger -t hotplug &quot;PRODUCT ID is ${BT_PRODID_HOT}&quot;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${BT_PRODID_HOT}</span>&quot;</span> = <span class="st0">&quot;<span class="es3">${BT_PRODID}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;add&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;bluetooth device has been plugged in!&quot;</span>
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${BSBTID_NEW}</span>&quot;</span> = <span class="st0">&quot;<span class="es3">${BSBTID_OLD}</span>&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            logger <span class="re5">-t</span> hotplug <span class="st0">&quot;bluetooth device hasn't changed&quot;</span>
        <span class="kw1">else</span>
            logger <span class="re5">-t</span> hotplug <span class="st0">&quot;bluetooth device has changed&quot;</span>
        <span class="kw1">fi</span>
    <span class="kw1">fi</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;remove&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;bluetooth device has been removed!&quot;</span>
    <span class="kw1">fi</span>
<span class="kw1">else</span>
    logger <span class="re5">-t</span> hotplug <span class="st0">&quot;USB device is not bluetooth&quot;</span>
<span class="kw1">fi</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Script that detects whether plugged usb device is bluetooth or not&quot;,&quot;hid&quot;:&quot;script_that_detects_whether_plugged_usb_device_is_bluetooth_or_not&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:31,&quot;range&quot;:&quot;21626-22408&quot;} -->
<h3 class="sectionedit32" id="auto_start_mjpg-streamer_when_an_usb_camera_is_plugged_in">Auto start mjpg-streamer when an usb camera is plugged in</h3>
<div class="level3">
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">20</span>-mjpg_start
<span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> <span class="kw1">in</span>
    add<span class="br0">&#41;</span>
            <span class="co0"># start process</span>
        service mjpg-streamer start
            <span class="sy0">;;</span>
    remove<span class="br0">&#41;</span>
            <span class="co0"># stop process</span>
        service mjpg-streamer stop
            <span class="sy0">;;</span>
<span class="kw1">esac</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Auto start mjpg-streamer when an usb camera is plugged in&quot;,&quot;hid&quot;:&quot;auto_start_mjpg-streamer_when_an_usb_camera_is_plugged_in&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:32,&quot;range&quot;:&quot;22409-22751&quot;} -->
<h3 class="sectionedit33" id="custom_automount_script_for_xfs">Custom automount script for XFS</h3>
<div class="level3">
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>block<span class="sy0">/</span>xfs_automount
<span class="co0"># if a new block device is connected</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;add&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="co0"># getting device UUID</span>
    <span class="re2">detected_uuid</span>=<span class="st0">&quot;<span class="es4">$(xfs_admin -u /dev/${DEVICENAME} | awk '{print $3}')</span>&quot;</span>
    <span class="co0"># deciding mountpoint for known UUID</span>
    <span class="re2">mountpoint</span>=<span class="st0">&quot;&quot;</span>
    <span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${detected_uuid}</span>&quot;</span> <span class="kw1">in</span>
        6a5d7c5c-c9d0-41cc-8f19-78d97f839c05<span class="br0">&#41;</span>
            <span class="re2">mountpoint</span>=<span class="st0">&quot;/path/to/first/mountpoint&quot;</span>
            <span class="sy0">;;</span>
        02880b1f-0c67-46b6-9b05-5535680ccc89<span class="br0">&#41;</span>
            <span class="re2">mountpoint</span>=<span class="st0">&quot;/path/to/second/mountpoint&quot;</span>
            <span class="sy0">;;</span>
    <span class="kw1">esac</span>
&nbsp;
    <span class="co0"># if we have a known UUID we have a mountpoint so we can mount it</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${mountpoint}</span>&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span> 
        <span class="kw2">mount</span> <span class="sy0">/</span>dev<span class="sy0">/</span><span class="co1">${DEVICENAME}</span> <span class="co1">${mountpoint}</span>
    <span class="kw1">fi</span>
<span class="kw1">fi</span>
<span class="co0"># unmounting happens automatically at device disconnection anyway so no logic for that</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Custom automount script for XFS&quot;,&quot;hid&quot;:&quot;custom_automount_script_for_xfs&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:33,&quot;range&quot;:&quot;22752-23617&quot;} -->
<h3 class="sectionedit34" id="coldplug">Coldplug</h3>
<div class="level3">

<p>
You may have noticed that the udev and eudev were removed in the openwrt 18.0.* release. Don&#039;t worry, because you still can make things work.
You can use hotplug scripts as coldplug.
Pay attention to the ACTION environment variable, at boot &#039;bind&#039; actions are executed.
So, just add this option to hotplug and run accordingly.
</p>

<p>
In my case I used this:
</p>
<pre class="code bash"><span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">22</span>-symlinks
<span class="co0"># Description: Action executed on boot (bind) and with the system on the fly</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;bind&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
  <span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${PRODUCT}</span>&quot;</span> <span class="kw1">in</span>
    1bc7<span class="sy0">*</span><span class="br0">&#41;</span> <span class="co0"># Telit HE910 3g modules product id prefix</span>
      <span class="re2">DEVICE_NAME</span>=<span class="st0">&quot;<span class="es4">$(ls /sys/${DEVPATH} | grep tty)</span>&quot;</span>
      <span class="re2">DEVICE_TTY</span>=<span class="st0">&quot;<span class="es4">$(ls /sys/${DEVPATH}/tty/)</span>&quot;</span>
      <span class="co0"># Module Telit HE910-* connected to minipciexpress slot MAIN</span>
      <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.3:1.0&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>dev<span class="sy0">/</span><span class="co1">${DEVICE_TTY}</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO1_DIAL
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink from /dev/<span class="es3">${DEVICE_TTY}</span> to /dev/ttyMODULO1_DIAL created&quot;</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.3:1.6&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>dev<span class="sy0">/</span><span class="co1">${DEVICE_TTY}</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO1_DATA
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink from /dev/<span class="es3">${DEVICE_TTY}</span> to /dev/ttyMODULO1_DATA created&quot;</span>
      <span class="co0"># Module Telit HE910-* connected to minipciexpress slot SECONDARY</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.2:1.0&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>dev<span class="sy0">/</span><span class="co1">${DEVICE_TTY}</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO2_DIAL
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink from /dev/<span class="es3">${DEVICE_TTY}</span> to /dev/ttyMODULO2_DIAL created&quot;</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.2:1.6&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">ln</span> <span class="re5">-s</span> <span class="sy0">/</span>dev<span class="sy0">/</span><span class="co1">${DEVICE_TTY}</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO2_DATA
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink from /dev/<span class="es3">${DEVICE_TTY}</span> to /dev/ttyMODULO2_DATA created&quot;</span>
      <span class="kw1">fi</span>
    <span class="sy0">;;</span>
  <span class="kw1">esac</span>
<span class="kw1">fi</span>
<span class="co0"># Action to remove the symlinks</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;remove&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
  <span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${PRODUCT}</span>&quot;</span> <span class="kw1">in</span>
    1bc7<span class="sy0">*</span><span class="br0">&#41;</span>  <span class="co0"># Telit HE910 3g modules product id prefix</span>
     <span class="co0"># Module Telit HE910-* connected to minipciexpress slot MAIN</span>
      <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.3:1.0&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">rm</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO1_DIAL
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink /dev/ttyMODULO1_DIAL removed&quot;</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.3:1.6&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">rm</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO1_DATA
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink /dev/ttyMODULO1_DATA removed&quot;</span>
      <span class="co0"># Module Telit HE910-* connected to minipciexpress slot SECONDARY</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.2:1.0&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">rm</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO2_DIAL
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink /dev/ttyMODULO2_DIAL removed&quot;</span>
      <span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> = <span class="st0">&quot;1-1.2:1.6&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw2">rm</span> <span class="sy0">/</span>dev<span class="sy0">/</span>ttyMODULO2_DATA
        logger <span class="re5">-t</span> hotplug <span class="st0">&quot;Symlink /dev/ttyMODULO2_DATA removed&quot;</span>
      <span class="kw1">fi</span>
    <span class="sy0">;;</span>
  <span class="kw1">esac</span>
<span class="kw1">fi</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Coldplug&quot;,&quot;hid&quot;:&quot;coldplug&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:34,&quot;range&quot;:&quot;23618-26226&quot;} -->
<h3 class="sectionedit35" id="log_dsl_status_changes">Log DSL status changes</h3>
<div class="level3">

<p>
If you have a DSL modem you can add logging of DSL status changes and connection data rates.
</p>

<p>
This can be helpful if your DSL connection is affected by Seamless Rate Adaptation (SRA) or
Dynamic Line Management (DLM) events; for SRA events data rate changes will be logged, while
for DLM events connection status changes will be logged as the modem is forced to retrain and then the new
data rates will be logged.
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>dsl<span class="sy0">/</span><span class="nu0">20</span>-dsl_status
<span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${DSL_NOTIFICATION_TYPE}</span>&quot;</span> <span class="kw1">in</span>
<span class="br0">&#40;</span>DSL_INTERFACE_STATUS<span class="br0">&#41;</span>
  logger <span class="re5">-p</span> daemon.notice <span class="re5">-t</span> dsl-notify <span class="st0">&quot;<span class="es3">${DSL_XTU_STATUS}</span> link status: <span class="es3">${DSL_INTERFACE_STATUS}</span>&quot;</span> <span class="sy0">;;</span>
<span class="br0">&#40;</span>DSL_DATARATE_STATUS_US<span class="br0">&#41;</span>
  logger <span class="re5">-p</span> daemon.notice <span class="re5">-t</span> dsl-notify <span class="st0">&quot;DSL upstream actual data rate: <span class="es3">${DSL_DATARATE_US_BC0}</span>&quot;</span> <span class="sy0">;;</span>
<span class="br0">&#40;</span>DSL_DATARATE_STATUS_DS<span class="br0">&#41;</span>
  logger <span class="re5">-p</span> daemon.notice <span class="re5">-t</span> dsl-notify <span class="st0">&quot;DSL downstream actual data rate: <span class="es3">${DSL_DATARATE_DS_BC0}</span>&quot;</span> <span class="sy0">;;</span>
<span class="kw1">esac</span>
EOF</pre>

<p>
This script assumes that channel bonding is not compiled in to the DSL support.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Log DSL status changes&quot;,&quot;hid&quot;:&quot;log_dsl_status_changes&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:35,&quot;range&quot;:&quot;26227-27240&quot;} -->
<h3 class="sectionedit36" id="utilize_wireless_usb_adapter">Utilize wireless USB adapter</h3>
<div class="level3">

<p>
Restart Wi-Fi when plugging in a wireless USB adapter.
</p>
<pre class="code bash"><span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>usb<span class="sy0">/</span><span class="nu0">20</span>-rtl8188su
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${PRODUCT}</span>&quot;</span> = <span class="st0">&quot;bda/8171/200&quot;</span> <span class="br0">&#93;</span> \
<span class="sy0">&amp;&amp;</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;add&quot;</span> <span class="br0">&#93;</span>
<span class="kw1">then</span> wifi
<span class="kw1">fi</span>
EOF</pre>

<p>
The above code matches the following device.
</p>
<pre class="code bash"><span class="co0"># lsusb -v</span>
	idVendor	0x0bda Realtek Semiconductor Corp.
	idProduct	0x8171 RTL8188SU 802.11n WLAN Adapter
	bcdDevice	<span class="nu0">2.00</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Utilize wireless USB adapter&quot;,&quot;hid&quot;:&quot;utilize_wireless_usb_adapter&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:36,&quot;range&quot;:&quot;27241-27702&quot;} -->
<h3 class="sectionedit37" id="get_specific_ip_address">Get specific IP address</h3>
<div class="level3">

<p>
Assuming your <abbr title="Internet Service Provider">ISP</abbr> provides a dynamic <abbr title="Internet Protocol">IP</abbr> address.
Reconnect until you get the one matching a specific regexp.
Delay for 10 seconds between reconnects.
Set up <a href="/docs/guide-user/advanced/hotplug_extras" class="wikilink1" title="docs:guide-user:advanced:hotplug_extras" data-wiki-id="docs:guide-user:advanced:hotplug_extras">Hotplug extras</a> to trigger the script upon connecting <abbr title="Wide Area Network">WAN</abbr> interface.
</p>
<pre class="code bash"><span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>online
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>online<span class="sy0">/</span><span class="nu0">10</span>-wan-ipaddr
. <span class="sy0">/</span>lib<span class="sy0">/</span>functions<span class="sy0">/</span>network.sh
network_flush_cache
network_find_wan WAN_IF
network_get_ipaddr WAN_ADDR <span class="st0">&quot;<span class="es3">${WAN_IF}</span>&quot;</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${WAN_IF}</span>&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;<span class="es3">${INTERFACE}</span>&quot;</span> <span class="br0">&#93;</span>
<span class="kw1">then</span> <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
<span class="kw1">case</span> <span class="co1">${WAN_ADDR}</span> <span class="kw1">in</span>
<span class="br0">&#40;</span>??.???.<span class="sy0">*</span><span class="br0">&#41;</span> <span class="kw3">exit</span> <span class="nu0">0</span> <span class="sy0">;;</span>
<span class="kw1">esac</span>
<span class="kw2">sleep</span> <span class="nu0">10</span>
<span class="kw2">ifup</span> <span class="co1">${INTERFACE}</span>
EOF</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Get specific IP address&quot;,&quot;hid&quot;:&quot;get_specific_ip_address&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:37,&quot;range&quot;:&quot;27703-28350&quot;} -->
<h3 class="sectionedit38" id="rename_interfaces_by_mac_address">Rename interfaces by MAC address</h3>
<div class="level3">

<p>
Assuming pre-configured upstream interfaces <code>wana</code> and <code>wanb</code>.
Set up persistent interface names by MAC address.
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>hotplug.d<span class="sy0">/</span>iface<span class="sy0">/</span>00-dev-rename
dev_rename<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
<span class="kw3">local</span> <span class="re2">DEV_CONF</span>=<span class="st0">&quot;<span class="es3">${1}</span>&quot;</span>
<span class="kw3">local</span> DEV_MAC DEV_NAME DEV_ONAME
config_get DEV_MAC <span class="st0">&quot;<span class="es3">${DEV_CONF}</span>&quot;</span> mac
config_get DEV_NAME <span class="st0">&quot;<span class="es3">${DEV_CONF}</span>&quot;</span> name
<span class="re2">DEV_ONAME</span>=<span class="st0">&quot;$(grep -l -e &quot;</span><span class="co1">${DEV_MAC}</span><span class="st0">&quot; <span class="es1">\
</span>$(find /sys/class/net/*/device/uevent <span class="es1">\
</span>| sed -e &quot;</span>s<span class="sy0">|/</span>device<span class="sy0">/</span>uevent$<span class="sy0">|/</span>address<span class="sy0">|</span><span class="st0">&quot;) <span class="es1">\
</span>| awk -F '/' '{print $5}')&quot;</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-n</span> <span class="st0">&quot;<span class="es3">${DEV_MAC}</span>&quot;</span> <span class="br0">&#93;</span> \
<span class="sy0">&amp;&amp;</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${DEV_ONAME}</span>&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;<span class="es3">${DEV_NAME}</span>&quot;</span> <span class="br0">&#93;</span>
<span class="kw1">then</span> <span class="kw2">ip link</span> <span class="kw1">set</span> <span class="st0">&quot;<span class="es3">${DEV_ONAME}</span>&quot;</span> name <span class="st0">&quot;<span class="es3">${DEV_NAME}</span>&quot;</span>
<span class="kw1">fi</span>
<span class="br0">&#125;</span>
. <span class="sy0">/</span>lib<span class="sy0">/</span>functions.sh
config_load network
config_foreach dev_rename device
EOF
&nbsp;
<span class="kw1">while</span> <span class="kw3">read</span> <span class="re5">-r</span> DEV_NAME DEV_MAC
<span class="kw1">do</span>
uci <span class="kw1">set</span> network.<span class="co1">${DEV_NAME}</span>.device=<span class="st0">&quot;<span class="es3">${DEV_NAME}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${DEV_NAME}</span><span class="nu0">6</span>.device=<span class="st0">&quot;<span class="es3">${DEV_NAME}</span>&quot;</span>
uci <span class="re5">-q</span> delete network.<span class="co1">${DEV_NAME}</span>_dev
uci <span class="kw1">set</span> network.<span class="co1">${DEV_NAME}</span><span class="re2">_dev</span>=<span class="st0">&quot;device&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${DEV_NAME}</span>_dev.mac=<span class="st0">&quot;<span class="es3">${DEV_MAC}</span>&quot;</span>
uci <span class="kw1">set</span> network.<span class="co1">${DEV_NAME}</span>_dev.name=<span class="st0">&quot;<span class="es3">${DEV_NAME}</span>&quot;</span>
<span class="kw1">done</span> <span class="co2">&lt;&lt; EOI
wana 11:22:33:44:55:66
wanb aa:bb:cc:dd:ee:ff
EOI</span>
uci commit network
service network restart</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Rename interfaces by MAC address&quot;,&quot;hid&quot;:&quot;rename_interfaces_by_mac_address&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:38,&quot;range&quot;:&quot;28351-29492&quot;} -->
<h3 class="sectionedit39" id="create_deterministicpersistent_links_to_usb-serial_devices">Create deterministic/persistent links to USB-serial devices</h3>
<div class="level3">

<p>
Resulting links will be placed in /dev/serial/by-id and /dev/serial/by-path,
with a name structure closely resembling links created by udev, but not fully exact.
</p>
<pre class="code bash"><span class="kw1">set</span> <span class="re5">-o</span> pipefail
<span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;bind&quot;</span> <span class="re5">-o</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;unbind&quot;</span> <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${SUBSYSTEM}</span>&quot;</span> = <span class="st0">&quot;usb-serial&quot;</span> <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="br0">&#91;</span> <span class="re5">-n</span> <span class="st0">&quot;<span class="es3">${DEVICENAME}</span>&quot;</span> <span class="re5">-a</span> <span class="re5">-n</span> <span class="st0">&quot;<span class="es3">${DEVPATH}</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">1</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;bind&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="re2">subsystem</span>=<span class="st0">&quot;<span class="es4">$(basename $(readlink /sys${DEVPATH}/../subsystem)</span>)&quot;</span>
&nbsp;
        <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$subsystem</span>&quot;</span> = <span class="st0">&quot;usb&quot;</span> <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">0</span>
&nbsp;
        <span class="re2">replace_whitespace</span>=<span class="st0">&quot;s/^[ <span class="es1">\t</span>]*|[ <span class="es1">\t</span>]*$//g; s/[ <span class="es1">\t</span>]+/_/g&quot;</span>
        <span class="re2">manufacturer</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../../manufacturer | sed -E &quot;${replace_whitespace}&quot;)</span>&quot;</span> <span class="sy0">||</span> <span class="re2">manufacturer</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../../idVendor)</span>&quot;</span>
        <span class="re2">product</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../../product | sed -E &quot;${replace_whitespace}&quot;)</span>&quot;</span> <span class="sy0">||</span> <span class="re2">product</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../../idProduct)</span>&quot;</span>
        <span class="re2">serial</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../../serial | sed -E &quot;${replace_whitespace}&quot;)</span>&quot;</span>
        <span class="re2">interface</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/../bInterfaceNumber)</span>&quot;</span>
        <span class="re2">port</span>=<span class="st0">&quot;<span class="es4">$(cat /sys${DEVPATH}/port_number)</span>&quot;</span>
&nbsp;
        <span class="re2">replace_chars</span>=<span class="st0">&quot;s/[^0-9A-Za-z#+.:=@-]/_/g&quot;</span>
        <span class="re2">id_link</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${subsystem}</span>&quot;</span>-<span class="st0">&quot;<span class="es3">${manufacturer}</span>&quot;</span>_<span class="st0">&quot;<span class="es3">${product}</span><span class="es3">${serial:+_}</span><span class="es3">${serial}</span>&quot;</span><span class="re5">-if</span><span class="st0">&quot;<span class="es3">${interface}</span><span class="es3">${port:+-port}</span><span class="es3">${port}</span>&quot;</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;<span class="es3">${replace_chars}</span>&quot;</span><span class="br0">&#41;</span>
        <span class="re2">path_link</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${DEVPATH}</span><span class="es3">${port:+-port}</span><span class="es3">${port}</span>&quot;</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s%/devices/%%; s%/<span class="es3">${DEVICENAME}</span>%%g; <span class="es3">${replace_chars}</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
        <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>dev<span class="sy0">/</span>serial<span class="sy0">/</span>by-id <span class="sy0">/</span>dev<span class="sy0">/</span>serial<span class="sy0">/</span>by-path
        <span class="kw2">ln</span> <span class="re5">-sf</span> <span class="st0">&quot;/dev/<span class="es3">${DEVICENAME}</span>&quot;</span> <span class="st0">&quot;/dev/serial/by-id/<span class="es3">${id_link}</span>&quot;</span>
        <span class="kw2">ln</span> <span class="re5">-sf</span> <span class="st0">&quot;/dev/<span class="es3">${DEVICENAME}</span>&quot;</span> <span class="st0">&quot;/dev/serial/by-path/<span class="es3">${path_link}</span>&quot;</span>
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es3">${ACTION}</span>&quot;</span> = <span class="st0">&quot;unbind&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
        <span class="kw1">for</span> <span class="kw2">link</span> <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">find</span> <span class="sy0">/</span>dev<span class="sy0">/</span>serial <span class="re5">-type</span> l<span class="br0">&#41;</span>; <span class="kw1">do</span>
                <span class="br0">&#91;</span> <span class="re5">-L</span> <span class="co1">${link}</span> <span class="re5">-a</span> <span class="st0">&quot;<span class="es4">$(readlink ${link})</span>&quot;</span> = <span class="st0">&quot;/dev/<span class="es2">$DEVICENAME</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">rm</span> <span class="co1">${link}</span>
        <span class="kw1">done</span>
<span class="kw1">fi</span></pre>

<p>
<a href="https://gist.github.com/Leo-PL/b5ee737e49b34c1551dba6c182707c8e" class="urlextern" title="https://gist.github.com/Leo-PL/b5ee737e49b34c1551dba6c182707c8e" rel="ugc nofollow">(Source)</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Create deterministic\/persistent links to USB-serial devices&quot;,&quot;hid&quot;:&quot;create_deterministicpersistent_links_to_usb-serial_devices&quot;,&quot;codeblockOffset&quot;:14,&quot;secid&quot;:39,&quot;range&quot;:&quot;29493-&quot;} -->