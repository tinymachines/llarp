
<h1 class="sectionedit1" id="opkg_package_manager">Opkg package manager</h1>
<div class="level1">

<p>
Like most Linux distributions (or mobile device operating systems like say Android or iOS), the functionality of the system can be upgraded rather significantly by downloading and installing pre-made packages from package repositories (local or on the Internet).
</p>

<p>
The <code>opkg</code> utility is the lightweight package manager used for this job.
Opkg is a fork of <code>ipkg</code>, the package manager used in NSLU2&#039;s <a href="https://web.archive.org/web/20200919214711if_/http://www2.nslu2-linux.org/wiki/pmwiki.php?pagename=Optware/HomePage" class="urlextern" title="https://web.archive.org/web/20200919214711if_/http://www2.nslu2-linux.org/wiki/pmwiki.php?pagename=Optware/HomePage" rel="ugc nofollow">Optware</a><sup>(archive link)</sup>, which is designed to add software to stock firmware of embedded devices.
</p>

<p>
Opkg is a full package manager for the root file system, including kernel modules and drivers, while ipkg is just a way to add software to a separate directory (e.g. <code>/opt</code>).
</p>

<p>
Opkg is sometimes called <em>Entware</em>, as it is also the package manager used by the <a href="https://github.com/Entware/Entware/wiki" class="urlextern" title="https://github.com/Entware/Entware/wiki" rel="ugc nofollow">Entware repository</a> for embedded devices (itself a fork of OpenWrt&#039;s community packages repository).
</p>

<p>
The package manager <code>opkg</code> attempts to resolve dependencies with packages in the repositories - if this fails, it will report an error and abort the installation of that package.
</p>

<p>
Missing dependencies with third-party packages are probably available from the source of the package.<br/>

To ignore dependency errors, pass the <code>--force-depends</code> flag.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> If you are using a snapshot / trunk / bleeding edge version, installing packages may fail if the package in the repository is for a newer kernel version than the kernel version you have.<br/>

In this case, you will get the error message <em>“Cannot satisfy the following dependencies for…”</em>.<br/>

For such usage of OpenWrt firmware, it&#039;s warmly recommended to use the <a href="/docs/guide-user/additional-software/imagebuilder" class="wikilink1" title="docs:guide-user:additional-software:imagebuilder" data-wiki-id="docs:guide-user:additional-software:imagebuilder">Image Builder</a> to make a flashable image containing all packages you need.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> When on trunk/snapshot, kernel and kmod packages are flagged as <em>hold</em>, the <code>opkg upgrade</code> command won&#039;t attempt to update them.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Opkg package manager&quot;,&quot;hid&quot;:&quot;opkg_package_manager&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-2063&quot;} -->
<h2 class="sectionedit2" id="invocation">Invocation</h2>
<div class="level2">
<pre class="code bash"><span class="co0"># opkg</span>
opkg must have one sub-command argument:
usage: opkg <span class="br0">&#91;</span>options...<span class="br0">&#93;</span> sub-command <span class="br0">&#91;</span>arguments...<span class="br0">&#93;</span>
where sub-command is one of:</pre>

<p>
You can use <a href="https://en.wikipedia.org/wiki/Glob_(programming)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Glob_(programming)">glob patterns</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Invocation&quot;,&quot;hid&quot;:&quot;invocation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;2064-2290&quot;} -->
<h2 class="sectionedit3" id="package_manipulation">Package manipulation</h2>
<div class="level2">
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code><strong>update</strong></code> </td><td class="col1"> Update list of available packages<br/>
This simply retrieves a file like this one: <a href="https://downloads.lede-project.org/snapshots/packages/aarch64_armv8-a/base/Packages" class="urlextern" title="https://downloads.lede-project.org/snapshots/packages/aarch64_armv8-a/base/Packages" rel="ugc nofollow">example</a>, for your installation and stores it on your <a href="https://en.wikipedia.org/wiki/tmpfs" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/tmpfs">RAM partition</a> under <code>/tmp/opkg-lists</code>. As of LEDE 17.01, after the opkg upgrade, this folder occupies about 450 KiB of space. OPKG needs the content of this folder in order to install or upgrade packages or to print info about them. You can safely delete the contents of this folder anytime to free up some RAM (its content is also lost on reboot), don&#039;t forget to run <code>opkg update</code> again before you install a new package. </td>
	</tr>
	<tr class="row1">
		<td class="col0"> <code><strong>upgrade</strong> &lt;pkgs&gt;</code> </td><td class="col1"> Upgrade packages<br/>
To upgrade a group of packages, run <code>opkg upgrade <em>packagename1</em> <em>packagename2</em></code>.<br/>
A list of upgradeable packages can be obtained with the <code>opkg list-upgradable</code> command.<br/>
------------<br/>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Since OpenWrt firmware stores the base system in a compressed read-only partition, any update to base system packages will be written in the read-write partition and therefore use more space than it would if it was just overwriting the older version in the compressed base system partition. It&#039;s recommended to check the available space in internal flash memory and the space requirements for updates of base system packages.<br/>
Upgrading packages you installed should not have this issue as they are already in the read-write partition so the new one will overwrite the older one, although checking before upgrading never hurts.<br/>
As a general rule of thumb, devices that have 8 MiB or more total flash size and no user-installed packages should not have space issues when updating base packages, and of course devices set up for <a href="/docs/guide-user/additional-software/extroot_configuration" class="wikilink1" title="docs:guide-user:additional-software:extroot_configuration" data-wiki-id="docs:guide-user:additional-software:extroot_configuration">Extroot</a> won&#039;t have any space issue.<br/>
To check for free space, write <code>df -h /</code> from <abbr title="Secure Shell">SSH</abbr> or go in Software page in Luci webinterface (System submenu -→ Software) to see how much space is left in the internal storage.<br/>
Check the size of packages you want to update by writing <code>opkg info package-name</code> in <abbr title="Secure Shell">SSH</abbr> or by checking the package size listed in the table in Software page, or you can check the <a href="/packages/start" class="wikilink1" title="packages:start" data-wiki-id="packages:start">Table of Packages</a> here in the wiki. While the “size” in opkg is the size of package in a compressed archive, the jffs2 or ubifs read-write partition will use the same compression algorithm on the installed files, so it should have similar size when installed.<br/>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> The package repositories in the development snapshots are updated by the build bots to new versions very often, so it&#039;s very likely you won&#039;t be able to upgrade some packages due to broken dependencies with kernel or kernel-related packages. In that case, it&#039;s recommended to use the <a href="/docs/guide-user/additional-software/imagebuilder" class="wikilink1" title="docs:guide-user:additional-software:imagebuilder" data-wiki-id="docs:guide-user:additional-software:imagebuilder">Image Builder</a> and make a new firmware image with all packages you need and flash that instead of upgrading through opkg. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code><strong>install</strong> &lt;pkgs|url&gt;</code> </td><td class="col1"> Install package(s)<br/>
Examples: <pre class="code bash">opkg <span class="kw2">install</span> hiawatha
opkg <span class="kw2">install</span> http:<span class="sy0">//</span>downloads.openwrt.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>trunk<span class="sy0">/</span>ar71xx<span class="sy0">/</span>packages<span class="sy0">/</span>hiawatha_7.7-<span class="nu0">2</span>_ar71xx.ipk
opkg <span class="kw2">install</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>hiawatha_7.7-<span class="nu0">2</span>_ar71xx.ipk</pre>

<p>
 If you are installing a package to &#039;replace&#039; a busybox applet, you may need to invalidate your shell&#039;s command hash table entry in order to use the new command. To do this, either log out and back in again, or use <code>hash -r</code>.
</p>
</td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code><strong>configure</strong> &lt;pkgs&gt;</code> </td><td class="col1"> Configure unpacked package(s) </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code><strong>remove</strong> &lt;pkgs|globp&gt;</code> </td><td class="col1"> Remove package(s) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code><strong>flag</strong> &lt;flag&gt; &lt;pkgs&gt;</code> </td><td class="col1"> Flag one or multiple package(s). Only one flag per invocation is allowed. Available flags:<br/>
hold • noprune • user • ok • installed • unpacked </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;2324-6065&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Package manipulation&quot;,&quot;hid&quot;:&quot;package_manipulation&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;2291-6066&quot;} -->
<h2 class="sectionedit5" id="informational_commands">Informational commands</h2>
<div class="level2">
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code><strong>list</strong> [pkg|globp]</code> </td><td class="col1"> List available packages<br/>
<pre class="code bash">Package name - Version - Description</pre>

<p>
 The Description can contain line breaks, so using merely grep is inapt since grep is line-based. 
</p>
</td>
	</tr>
	<tr class="row1">
		<td class="col0"> <code><strong>list-installed</strong></code> </td><td class="col1"> List installed packages </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code><strong>list-upgradable</strong></code> </td><td class="col1"> List installed and upgradable packages </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code><strong>list-changed-conffiles</strong></code> </td><td class="col1"> List user modified configuration files </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code><strong>files</strong> &lt;pkg&gt;</code> </td><td class="col1"> List files belonging to &lt;pkg&gt;. The package has to be already installed for this to work. Example:<pre class="code bash">opkg files asterisk18
Package asterisk18 <span class="br0">&#40;</span>1.8.4.4-<span class="nu0">1</span><span class="br0">&#41;</span> is installed on root and has the following files:
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>res_rtp_multicast.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>codec_ulaw.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>features.conf
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>format_wav_gsm.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>app_macro.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>chan_sip.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>app_dial.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>app_playback.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>format_gsm.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>func_callerid.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>func_timeout.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>asterisk.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules.conf
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>format_wav.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>extensions.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>asterisk
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>manager.conf
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>res_rtp_asterisk.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>logger.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>rtp.conf
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>codec_gsm.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>indications.conf
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>func_strings.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>app_echo.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>format_pcm.so
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>sip_notify.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>asterisk<span class="sy0">/</span>sip.conf
<span class="sy0">/</span>etc<span class="sy0">/</span>default<span class="sy0">/</span>asterisk
<span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>asterisk
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>pbx_config.so
<span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>asterisk<span class="sy0">/</span>modules<span class="sy0">/</span>func_logic.so</pre>
</td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code><strong>search</strong> &lt;file|globp&gt;</code> </td><td class="col1"> List package providing &lt;file&gt; </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code><strong>info</strong> [pkg|globp]</code> </td><td class="col1"> Display all info for &lt;pkg&gt;<br/>
<pre class="code bash">Package: horst
Version: <span class="nu0">2.0</span>-rc1-<span class="nu0">2</span>
Depends: libncurses
Provides:
Status: <span class="kw2">install</span> user installed
Section: net
Architecture: ar71xx
Maintainer: Bruno Randolf <span class="sy0">&lt;</span>br1<span class="sy0">@</span>einfach.org<span class="sy0">&gt;</span>
MD5Sum: 378cea9894ec971c419876e822666a6a
Size: <span class="nu0">19224</span>
Filename: horst_2.0-rc1-<span class="nu0">2</span>_ar71xx.ipk
Source: feeds<span class="sy0">/</span>packages<span class="sy0">/</span>net<span class="sy0">/</span>horst
Description: <span class="br0">&#91;</span>horst<span class="br0">&#93;</span> is a scanning and analysis tool <span class="kw1">for</span> <span class="nu0">802.11</span> wireless networks and
 especially IBSS <span class="br0">&#40;</span>ad-hoc<span class="br0">&#41;</span> mode and mesh networks <span class="br0">&#40;</span>OLSR<span class="br0">&#41;</span>.</pre>

<p>
 <strong>Note 1:</strong> The <em>Size</em> is the size of the gzip compressed tar archive. At installation package gets un-tared and decompressed, but then again JFFS2 uses compression itself.<br/>
<strong>Note 2:</strong> Since the compression of JFFS2 is transparent, commands like <code>ls</code> will always report the size of the uncompressed file. 
</p>
</td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code><strong>status</strong> [pkg|globp]</code> </td><td class="col1"> Display all status for &lt;pkg&gt; </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code><strong>download</strong> &lt;pkg&gt;</code> </td><td class="col1"> Download &lt;pkg&gt; to current directory </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code><strong>compare-versions</strong> &lt;v1&gt; &lt;op&gt; &lt;v2&gt;</code> </td><td class="col1"> Compare versions <code>v1</code> and <code>v2</code> using the operators <code>&lt;=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>=</code>, <code>&lt;&lt;</code> or <code>&gt;&gt;</code> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code><strong>print-architecture</strong></code> </td><td class="col1"> List installable package architectures </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code><strong>whatdepends</strong> [-A] [pkgname|pat]+</code> </td><td class="col1"> This only works for installed packages. So if you would like to know how much storage a package and all of its dependencies would need, at the moment, you will have to piece this information together with the <code>info</code>-option. </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code><strong>whatdependsrec</strong> [-A] [pkgname|pat]+</code> </td><td class="col1"> This only works for installed packages. So if you would like to know how much storage a package and all of its dependencies would need, at the moment, you will have to piece this information together with the <code>info</code>-option. </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code><strong>whatprovides</strong> [-A] [pkgname|pat]+</code> </td><td class="col1"> </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code><strong>whatconflicts</strong> [-A] [pkgname|pat]+</code> </td><td class="col1"> </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code><strong>whatreplaces</strong> [-A] [pkgname|pat]+</code> </td><td class="col1"> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;6102-9775&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Informational commands&quot;,&quot;hid&quot;:&quot;informational_commands&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;6067-9776&quot;} -->
<h2 class="sectionedit7" id="options">Options</h2>
<div class="level2">
<div class="table sectionedit8"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Option </th><th class="col1"> Long </th><th class="col2"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>-A</code> </td><td class="col1"> </td><td class="col2"> Query all packages not just those installed </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>-V[&lt;level&gt;]</code> </td><td class="col1"> <code>--verbosity[=&lt;level&gt;]</code> </td><td class="col2"> Set verbosity level to &lt;level&gt;. Available verbosity levels:<br/>
0 errors only<br/>
1 normal messages (default)<br/>
2 informative messages<br/>
3 debug<br/>
4 debug level 2 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>-f &lt;conf_file&gt;</code> </td><td class="col1"> <code>--conf &lt;conf_file&gt;</code> </td><td class="col2"> Use &lt;conf_file&gt; as the opkg configuration file. Default is <code>/etc/opkg.conf</code> </td>
	</tr>
	<tr class="row4">
		<td class="col0"> </td><td class="col1"> <code>--cache &lt;directory&gt;</code> </td><td class="col2"> Use a package cache </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>-d &lt;dest_name&gt;</code> </td><td class="col1"> <code>--dest &lt;dest_name&gt;</code> </td><td class="col2"> Use &lt;dest_name&gt; as the the root directory for package installation, removal, upgrading. &lt;dest_name&gt; should be a defined dest name from the configuration file, (but can also be a directory name in a pinch). </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>-o &lt;dir&gt;</code> </td><td class="col1"> <code>--offline-root &lt;dir&gt;</code> </td><td class="col2"> Use &lt;dir&gt; as the root directory for offline installation of packages. </td>
	</tr>
	<tr class="row7">
		<td class="col0"> </td><td class="col1"> <code>--add-arch &lt;arch&gt;:&lt;prio&gt;</code> </td><td class="col2"> Register architecture with given priority </td>
	</tr>
	<tr class="row8">
		<td class="col0"> </td><td class="col1"> <code>--add-dest &lt;name&gt;:&lt;path&gt;</code> </td><td class="col2"> Register destination with given path </td>
	</tr>
	<tr class="row9">
		<th class="col0" colspan="3"> Force Options </th>
	</tr>
	<tr class="row10">
		<td class="col0"> </td><td class="col1"> <code>--force-depends</code> </td><td class="col2"> Install/remove despite failed dependencies </td>
	</tr>
	<tr class="row11">
		<td class="col0"> </td><td class="col1"> <code>--force-maintainer</code> </td><td class="col2"> Overwrite preexisting config files </td>
	</tr>
	<tr class="row12">
		<td class="col0"> </td><td class="col1"> <code>--force-reinstall</code> </td><td class="col2"> Reinstall package(s) </td>
	</tr>
	<tr class="row13">
		<td class="col0"> </td><td class="col1"> <code>--force-overwrite</code> </td><td class="col2"> Overwrite files from other package(s) </td>
	</tr>
	<tr class="row14">
		<td class="col0"> </td><td class="col1"> <code>--force-downgrade</code> </td><td class="col2"> Allow opkg to downgrade packages </td>
	</tr>
	<tr class="row15">
		<td class="col0"> </td><td class="col1"> <code>--force-space</code> </td><td class="col2"> Disable free space checks </td>
	</tr>
	<tr class="row16">
		<td class="col0"> </td><td class="col1"> <code>--force-checksum</code> </td><td class="col2"> Ignore checksum mismatches </td>
	</tr>
	<tr class="row17">
		<td class="col0"> </td><td class="col1"> <code>--force-postinstall</code> </td><td class="col2"> Run postinstall scripts even in offline mode </td>
	</tr>
	<tr class="row18">
		<td class="col0"> </td><td class="col1"> <code>--noaction</code> </td><td class="col2"> No action -- test only </td>
	</tr>
	<tr class="row19">
		<td class="col0"> </td><td class="col1"> <code>--download-only</code> </td><td class="col2"> No action -- download only </td>
	</tr>
	<tr class="row20">
		<td class="col0"> </td><td class="col1"> <code>--nodeps</code> </td><td class="col2"> Do not follow dependencies </td>
	</tr>
	<tr class="row21">
		<td class="col0"> </td><td class="col1"> <code>--force-removal-of-dependent-packages</code> </td><td class="col2"> Remove package and all dependencies </td>
	</tr>
	<tr class="row22">
		<td class="col0"> </td><td class="col1"> <code>--autoremove</code> </td><td class="col2"> Remove packages that were installed automatically to satisfy dependencies </td>
	</tr>
	<tr class="row23">
		<td class="col0"> <code>-t</code> </td><td class="col1"> <code>--tmp-dir</code> </td><td class="col2"> Specify tmp-dir. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;9797-11789&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Options&quot;,&quot;hid&quot;:&quot;options&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:7,&quot;range&quot;:&quot;9777-11790&quot;} -->
<h2 class="sectionedit9" id="examples">Examples</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:9,&quot;range&quot;:&quot;11791-11811&quot;} -->
<h3 class="sectionedit10" id="basics">Basics</h3>
<div class="level3">
<pre class="code bash"><span class="co0"># Install a package</span>
opkg update
opkg <span class="kw2">install</span> <span class="sy0">&lt;</span>package<span class="sy0">&gt;</span>
&nbsp;
<span class="co0"># List packages</span>
opkg list
&nbsp;
<span class="co0"># Display package information</span>
opkg info <span class="sy0">&lt;</span>package<span class="sy0">&gt;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Basics&quot;,&quot;hid&quot;:&quot;basics&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:10,&quot;range&quot;:&quot;11812-11982&quot;} -->
<h3 class="sectionedit11" id="extras">Extras</h3>
<div class="level3">

<p>
You can make use of <a href="https://en.wikipedia.org/wiki/Glob_(programming)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Glob_(programming)">glob patterns</a> directly and also write a little <a href="https://en.wikipedia.org/wiki/Shell script" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Shell script">shell script</a> to use <a href="https://en.wikipedia.org/wiki/Regular expression" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Regular expression">regular expressions</a> and otherwise further process information.
Use a <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Pipeline_(Unix)">pipeline</a> and <a href="http://man.cx/grep%281%29" class="interwiki iw_man" title="http://man.cx/grep%281%29">grep</a>, or <a href="http://man.cx/awk%281%29" class="interwiki iw_man" title="http://man.cx/awk%281%29">awk</a>, or <a href="http://man.cx/sed%281%29" class="interwiki iw_man" title="http://man.cx/sed%281%29">sed</a> to filter that output:
</p>
<pre class="code bash">opkg list <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-e</span> <span class="sy0">&lt;</span>pattern1<span class="sy0">&gt;</span> <span class="re5">-e</span> <span class="sy0">&lt;</span>pattern2<span class="sy0">&gt;</span>
opkg list <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-e</span> <span class="st_h">'/&lt;pattern&gt;/{print $0}'</span>
opkg info kmod-nf-\<span class="sy0">*</span> <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-e</span> <span class="st_h">'/length/{print $0}'</span>
opkg list-installed <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-e</span> <span class="st_h">'{print $1}'</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st_h">'\n'</span> <span class="st_h">' '</span>
<span class="kw1">for</span> pkg <span class="kw1">in</span> <span class="sy0">&lt;</span>package1<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>package2<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>package3<span class="sy0">&gt;</span>; <span class="kw1">do</span> opkg info <span class="co1">${pkg}</span>; <span class="kw1">done</span>
opkg depends dropbear</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Extras&quot;,&quot;hid&quot;:&quot;extras&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:11,&quot;range&quot;:&quot;11983-12663&quot;} -->
<h3 class="sectionedit12" id="upgrading_packages">Upgrading packages</h3>
<div class="level3">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_important plugin_wrap">
<p>
Mass upgrade of all packages is <a href="/meta/infobox/upgrade_packages_warning" class="wikilink1" title="meta:infobox:upgrade_packages_warning" data-wiki-id="meta:infobox:upgrade_packages_warning">strongly discouraged</a>.
The chance of soft-bricking your device is significant, so be fully prepared to perform a <a href="/docs/guide-user/troubleshooting/failsafe_and_factory_reset" class="wikilink1" title="docs:guide-user:troubleshooting:failsafe_and_factory_reset" data-wiki-id="docs:guide-user:troubleshooting:failsafe_and_factory_reset">recovery and factory reset in failsafe mode</a>.
Proceed at your own risk.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;0-&quot;} --><pre class="code bash"><span class="co0"># Upgrade all installed packages</span>
opkg list-upgradable <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-f</span> <span class="nu0">1</span> <span class="re5">-d</span> <span class="st_h">' '</span> <span class="sy0">|</span> <span class="kw2">xargs</span> opkg upgrade</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Upgrading packages&quot;,&quot;hid&quot;:&quot;upgrading_packages&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:12,&quot;range&quot;:&quot;12664-13152&quot;} -->
<h2 class="sectionedit15" id="configuration">Configuration</h2>
<div class="level2">

<p>
The main configuration file is <code>/etc/opkg.conf</code>.
It could look like this:
</p>
<pre class="code bash">dest root <span class="sy0">/</span>
dest ram <span class="sy0">/</span>tmp
lists_dir ext <span class="sy0">/</span>var<span class="sy0">/</span>opkg-lists
option overlay_root <span class="sy0">/</span>overlay</pre>

<p>
As you can see, it sets default folders:
</p>
<ul>
<li class="level1"><div class="li"> default root directory (default <code>/</code> )</div>
</li>
<li class="level1"><div class="li"> default ram disk (default <code>/tmp</code> )</div>
</li>
<li class="level1"><div class="li"> default folder to store package lists (default <code>/var/opkg-lists</code>, still a ram disk)</div>
</li>
<li class="level1"><div class="li"> what is the overlay directory (default <code>/overlay</code>)</div>
</li>
</ul>

<p>
Most of these options must be left to default, or have no real reason to be changed.
</p>

<p>
You might want to change the <code>lists_dir ext /var/opkg-lists</code> to <code>lists_dir ext /path/on/disk</code> if your device has 32 MiB or less of RAM and <a href="/docs/guide-user/additional-software/extroot_configuration" class="wikilink1" title="docs:guide-user:additional-software:extroot_configuration" data-wiki-id="docs:guide-user:additional-software:extroot_configuration">you expanded your firmware&#039;s storage space in an external drive</a>, so you can use opkg without causing Out Of Memory errors.
</p>

<p>
This file is accessible and can be modified from Luci Web interface too, Click on <strong>Services</strong> then on <strong>Software</strong>.
Click on <strong>Configuration</strong> tab.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:15,&quot;range&quot;:&quot;13153-14200&quot;} -->
<h3 class="sectionedit16" id="adjust_repositories">Adjust repositories</h3>
<div class="level3">

<p>
Feeds are set in <code>/etc/opkg/distfeeds.conf</code>:
</p>
<pre class="code bash">src<span class="sy0">/</span>gz reboot_core http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>targets<span class="sy0">/</span>ramips<span class="sy0">/</span>mt7620<span class="sy0">/</span>packages
src<span class="sy0">/</span>gz reboot_base http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>packages<span class="sy0">/</span>mipsel_24kc<span class="sy0">/</span>base
src<span class="sy0">/</span>gz reboot_telephony http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>packages<span class="sy0">/</span>mipsel_24kc<span class="sy0">/</span>telephony
src<span class="sy0">/</span>gz reboot_packages http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>packages<span class="sy0">/</span>mipsel_24kc<span class="sy0">/</span>packages
src<span class="sy0">/</span>gz reboot_routing http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>packages<span class="sy0">/</span>mipsel_24kc<span class="sy0">/</span>routing
src<span class="sy0">/</span>gz reboot_luci http:<span class="sy0">//</span>downloads.lede-project.org<span class="sy0">/</span>snapshots<span class="sy0">/</span>packages<span class="sy0">/</span>mipsel_24kc<span class="sy0">/</span>luci</pre>

<p>
There is also another file for custom feeds called <code>/etc/opkg/customfeeds.conf</code>:
</p>
<pre class="code bash"><span class="co0"># add your custom package feeds here</span>
<span class="co0">#</span>
<span class="co0"># src/gz example_feed_name http://www.example.com/path/to/files</span></pre>

<p>
Both files are accessible and can be modified from Luci Web interface too, Click on <strong>Services</strong> then on <strong>Software</strong>.
Click on <strong>Configuration</strong> tab, then scroll down.
</p>

</div>

<h4 id="local_repositories">Local repositories</h4>
<div class="level4">

<p>
You can configure opkg to fetch the packages locally:
</p>
<pre class="code bash">src<span class="sy0">/</span>gz <span class="kw3">local</span> file:<span class="sy0">///</span>path<span class="sy0">/</span>to<span class="sy0">/</span>packagesDirectory</pre>

<p>
OpenWrt uses multiple repositories, where every repository requires a unique identifier.
It is logical to use their original names, e.g.:
</p>
<pre class="code bash">...
src<span class="sy0">/</span>gz base file:<span class="sy0">///</span>path<span class="sy0">/</span>to<span class="sy0">/</span>packages<span class="sy0">/</span>directory<span class="sy0">/</span>packages<span class="sy0">/</span>base
src<span class="sy0">/</span>gz luci file:<span class="sy0">///</span>path<span class="sy0">/</span>to<span class="sy0">/</span>packages<span class="sy0">/</span>directory<span class="sy0">/</span>packages<span class="sy0">/</span>luci
src<span class="sy0">/</span>gz packages file:<span class="sy0">///</span>path<span class="sy0">/</span>to<span class="sy0">/</span>packages<span class="sy0">/</span>directory<span class="sy0">/</span>packages<span class="sy0">/</span>packages
src<span class="sy0">/</span>gz oldpackages file:<span class="sy0">///</span>path<span class="sy0">/</span>to<span class="sy0">/</span>packages<span class="sy0">/</span>directory<span class="sy0">/</span>packages<span class="sy0">/</span>oldpackages
... etc ...</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Adjust repositories&quot;,&quot;hid&quot;:&quot;adjust_repositories&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:16,&quot;range&quot;:&quot;14201-15832&quot;} -->
<h3 class="sectionedit17" id="change_architectures">Change architectures</h3>
<div class="level3">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_todo plugin_wrap">
<p>
OpenWrt is using package architectures.
Many devices pull packages from the same pool.
</p>

<p>
The following paragraph requires proofreading and likely some modification to be adapted for the current OpenWrt status.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;0-&quot;} -->
<p>
By default, opkg only allows packages with the architecture <code>all</code> (= architecture independent) and the architecture of the installed target.
In order to download and install packages for a foreign target architecture, the list of allowed architectures can be overridden in <code>/etc/opkg.conf</code> with the use of <code>arch</code> options:
</p>
<pre class="code bash"><span class="kw2">arch</span> all <span class="nu0">100</span>
<span class="kw2">arch</span> brcm4716 <span class="nu0">200</span>
<span class="kw2">arch</span> brcm47xx <span class="nu0">300</span></pre>

<p>
This example would allow installing <code>brcm47xx</code> packages (compiled to run on <code>brcm47xx</code> family of SoC/devices) on the <code>brcm4716</code> (a specific SoC) target.
The number specifies a priority index which is used by <code>opkg</code> to determine which package to prefer in case it is available in multiple architectures.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Change architectures&quot;,&quot;hid&quot;:&quot;change_architectures&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:17,&quot;range&quot;:&quot;15833-16804&quot;} -->
<h3 class="sectionedit20" id="proxy_support">Proxy support</h3>
<div class="level3">

<p>
OpenWrt 21.02:
</p>
<pre class="code bash"><span class="co0"># Configure profile</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>etc<span class="sy0">/</span>profile.d
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>profile.d<span class="sy0">/</span>custom.sh
<span class="kw3">export</span> <span class="re2">https_proxy</span>=http:<span class="sy0">//</span>proxy.example.org:<span class="nu0">8080</span><span class="sy0">/</span>
EOF
. <span class="sy0">/</span>etc<span class="sy0">/</span>profile
&nbsp;
<span class="co0"># Workaround</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;s/https/http/&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>opkg<span class="sy0">/</span>distfeeds.conf</pre>

<p>
To use <code>opkg</code> through a proxy, add the following to <code>/etc/opkg.conf</code>:
</p>
<pre class="code bash">option http_proxy http:<span class="sy0">//</span>proxy.example.org:<span class="nu0">8080</span><span class="sy0">/</span>
option ftp_proxy ftp:<span class="sy0">//</span>proxy.example.org:<span class="nu0">2121</span><span class="sy0">/</span></pre>

<p>
Use the options below to authenticate against the proxy server:
</p>
<pre class="code bash">option proxy_user xxxx
option proxy_passwd xxxx</pre>

<p>
Alternatively, a username and password may be provided as part of the <abbr title="Uniform Resource Locator">URL</abbr> if busybox wget is installed:
</p>
<pre class="code bash">option http_proxy http:<span class="sy0">//</span>username:password<span class="sy0">@</span>proxy.example.org:<span class="nu0">8080</span><span class="sy0">/</span>
option ftp_proxy http:<span class="sy0">//</span>username:password<span class="sy0">@</span>proxy.example.org:<span class="nu0">2121</span><span class="sy0">/</span></pre>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Authentication currently fails when using uclient-fetch as wget due to <code>Proxy-Authorization</code> not yet being implemented.
</p>

<p>
If you are running apt-cacher-ng and want to use that for OpenWRT, you may experience problems downloading .sig files through apt-cacher-ng.
In that case put the following line in your <code>acng.conf</code> file:
</p>
<pre class="code bash">VfilePatternEx: <span class="sy0">|</span>\.sig$</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Proxy support&quot;,&quot;hid&quot;:&quot;proxy_support&quot;,&quot;codeblockOffset&quot;:14,&quot;secid&quot;:20,&quot;range&quot;:&quot;16805-18046&quot;} -->
<h2 class="sectionedit21" id="troubleshooting">Troubleshooting</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshooting&quot;,&quot;hid&quot;:&quot;troubleshooting&quot;,&quot;codeblockOffset&quot;:19,&quot;secid&quot;:21,&quot;range&quot;:&quot;18047-18074&quot;} -->
<h3 class="sectionedit22" id="verbose_opkg_update">Verbose opkg update</h3>
<div class="level3">
<pre class="code bash"><span class="co0"># Save the script</span>
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> opkg-update.sh
<span class="co0">#!/bin/sh</span>
<span class="kw2">rm</span> <span class="re5">-f</span> <span class="re5">-R</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists
<span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists
<span class="kw1">while</span> <span class="kw3">read</span> TYPE REPO URL
<span class="kw1">do</span>
<span class="kw2">wget</span> <span class="re5">-O</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span>.gz <span class="st0">&quot;<span class="es3">${URL}</span>&quot;</span><span class="sy0">/</span>Packages.gz
<span class="kw2">wget</span> <span class="re5">-O</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span>.sig <span class="st0">&quot;<span class="es3">${URL}</span>&quot;</span><span class="sy0">/</span>Packages.sig
<span class="kw2">gunzip</span> <span class="re5">-k</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span>.gz
usign <span class="re5">-V</span> <span class="re5">-P</span> <span class="sy0">/</span>etc<span class="sy0">/</span>opkg<span class="sy0">/</span>keys <span class="re5">-m</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span> <span class="nu0">2</span><span class="sy0">&gt;&amp;</span><span class="nu0">1</span> \
<span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-e</span> <span class="st0">&quot;^OK$&quot;</span> \
<span class="sy0">&amp;&amp;</span> <span class="kw2">mv</span> <span class="re5">-f</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span>.gz <span class="sy0">/</span>tmp<span class="sy0">/</span>opkg-lists<span class="sy0">/</span><span class="st0">&quot;<span class="es3">${REPO}</span>&quot;</span>
<span class="kw1">done</span> <span class="sy0">&lt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>opkg<span class="sy0">/</span>distfeeds.conf
EOF
<span class="kw2">chmod</span> +x opkg-update.sh
&nbsp;
<span class="co0"># Run the script</span>
.<span class="sy0">/</span>opkg-update.sh</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Verbose opkg update&quot;,&quot;hid&quot;:&quot;verbose_opkg_update&quot;,&quot;codeblockOffset&quot;:19,&quot;secid&quot;:22,&quot;range&quot;:&quot;18075-18659&quot;} -->
<h3 class="sectionedit23" id="out_of_space">Out of space</h3>
<div class="level3">

<p>
Remove partly installed packages and their dependencies if <em>opkg</em> runs out of space during a transaction.
</p>
<pre class="code bash"><span class="co0"># Save the script</span>
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> opkg-rm-pkg-deps.sh
<span class="co0">#!/bin/sh</span>
opkg update
<span class="re2">URL</span>=<span class="st0">&quot;$(opkg --force-space --noaction install &quot;</span><span class="co1">${@}</span><span class="st0">&quot; <span class="es1">\
</span>| sed -n -e &quot;</span><span class="sy0">/</span>^Downloading\s<span class="sy0">*/</span>s<span class="sy0">///</span>p<span class="st0">&quot;)&quot;</span>
<span class="kw2">rm</span> <span class="re5">-f</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>opkg<span class="sy0">/</span>lock
<span class="kw1">for</span> URL <span class="kw1">in</span> <span class="co1">${URL}</span>
<span class="kw1">do</span> <span class="re2">FILE</span>=<span class="st0">&quot;$(wget -q -O - &quot;</span><span class="co1">${URL}</span><span class="st0">&quot; <span class="es1">\
</span>| tar -O -x -z ./data.tar.gz <span class="es1">\
</span>| tar -t -z <span class="es1">\
</span>| sort -r <span class="es1">\
</span>| sed -e &quot;</span>s<span class="sy0">|</span>^\.<span class="sy0">|/</span>overlay<span class="sy0">/</span>upper<span class="sy0">|</span><span class="st0">&quot;)&quot;</span>
<span class="kw1">for</span> FILE <span class="kw1">in</span> <span class="co1">${FILE}</span>
<span class="kw1">do</span> <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-f</span> <span class="st0">&quot;<span class="es3">${FILE}</span>&quot;</span> <span class="br0">&#93;</span>
<span class="kw1">then</span> <span class="kw2">rm</span> <span class="re5">-f</span> <span class="st0">&quot;<span class="es3">${FILE}</span>&quot;</span>
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="st0">&quot;<span class="es3">${FILE}</span>&quot;</span> <span class="br0">&#93;</span>
<span class="kw1">then</span> <span class="kw2">rmdir</span> <span class="st0">&quot;<span class="es3">${FILE}</span>&quot;</span>
<span class="kw1">fi</span>
<span class="kw1">done</span>
<span class="kw1">done</span>
EOF
<span class="kw2">chmod</span> +x opkg-rm-pkg-deps.sh</pre>
<pre class="code bash"><span class="co0"># Run the script</span>
.<span class="sy0">/</span>opkg-rm-pkg-deps.sh package_name
&nbsp;
<span class="co0"># Reboot to make the free space visible</span>
reboot</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Out of space&quot;,&quot;hid&quot;:&quot;out_of_space&quot;,&quot;codeblockOffset&quot;:20,&quot;secid&quot;:23,&quot;range&quot;:&quot;18660-19425&quot;} -->
<h3 class="sectionedit24" id="local_repository">Local repository</h3>
<div class="level3">

<p>
There may be use cases where having a package repository on the device itself is advantageous:
</p>
<ul>
<li class="level1"><div class="li"> Unreliable WANs, where the connectivity upstream of the device to a remote repository goes down for an unacceptable period of time.</div>
</li>
<li class="level1"><div class="li"> Bandwidth Caps, where the connectivity upstream of the device to a remote repository has a limited amount of data that can be fetched before the connectivity is throttled or goes down until the next period where the cap resets.</div>
</li>
<li class="level1"><div class="li"> A repository with customization; built from source, which isn&#039;t available from remote repositories.</div>
</li>
<li class="level1"><div class="li"> The device acts as a reference device for other systems, to ensure that the package versions across the devices local to the network remain consistent.</div>
</li>
</ul>

<p>
Set up a local repository for your target.
Assuming about 2-3 <abbr title="Gigabyte">GB</abbr> of free space is available.
</p>
<pre class="code bash"><span class="co0"># Install packages</span>
opkg update
opkg <span class="kw2">install</span> rsync
&nbsp;
<span class="co0"># Save the script</span>
<span class="kw2">cat</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;EOF&quot;</span> <span class="sy0">&gt;</span> local-repo-sync.sh
<span class="co0">#!/bin/sh</span>
. <span class="sy0">/</span>etc<span class="sy0">/</span>os-release
<span class="re2">REPO_LOCAL</span>=<span class="st0">&quot;file://<span class="es3">${1:-/${ID}</span>}/&quot;</span>
<span class="re2">REPO_URL</span>=<span class="st0">&quot;rsync://rsync.<span class="es3">${HOME_URL#*//}</span>&quot;</span>
<span class="kw1">case</span> <span class="st0">&quot;<span class="es3">${VERSION_ID}</span>&quot;</span> <span class="kw1">in</span>
<span class="br0">&#40;</span>snapshot<span class="br0">&#41;</span> <span class="re2">REPO_DIR</span>=<span class="st0">&quot;downloads/snapshots&quot;</span> <span class="sy0">;;</span>
<span class="br0">&#40;</span><span class="sy0">*</span><span class="br0">&#41;</span> <span class="re2">REPO_DIR</span>=<span class="st0">&quot;downloads/releases/<span class="es3">${VERSION_ID}</span>&quot;</span> <span class="sy0">;;</span>
<span class="kw1">esac</span>
<span class="re2">REPO_CORE</span>=<span class="st0">&quot;<span class="es3">${REPO_DIR}</span>/targets/<span class="es3">${OPENWRT_BOARD}</span>&quot;</span>
<span class="re2">REPO_PKGS</span>=<span class="st0">&quot;<span class="es3">${REPO_DIR}</span>/packages/<span class="es3">${OPENWRT_ARCH}</span>&quot;</span>
<span class="kw1">for</span> REPO_DIR <span class="kw1">in</span> <span class="st0">&quot;<span class="es3">${REPO_CORE}</span>&quot;</span> <span class="st0">&quot;<span class="es3">${REPO_PKGS}</span>&quot;</span>
<span class="kw1">do</span> <span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="st0">&quot;<span class="es3">${REPO_LOCAL#*//}</span><span class="es3">${REPO_DIR#*/}</span>&quot;</span>
rsync <span class="re5">--bwlimit</span>=<span class="st0">&quot;8M&quot;</span> <span class="re5">--del</span> <span class="re5">-r</span> <span class="re5">-t</span> <span class="re5">-v</span> \
<span class="st0">&quot;<span class="es3">${REPO_URL}</span><span class="es3">${REPO_DIR}</span>/&quot;</span> \
<span class="st0">&quot;<span class="es3">${REPO_LOCAL#*//}</span><span class="es3">${REPO_DIR#*/}</span>/&quot;</span>
<span class="kw1">done</span>
EOF
<span class="kw2">chmod</span> +x local-repo-sync.sh
&nbsp;
<span class="co0"># Run the script</span>
.<span class="sy0">/</span>local-repo-sync.sh <span class="sy0">/</span>openwrt
&nbsp;
<span class="co0"># Configure Opkg to use local repo</span>
. <span class="sy0">/</span>etc<span class="sy0">/</span>os-release
<span class="re2">REPO_LOCAL</span>=<span class="st0">&quot;file:///<span class="es3">${ID}</span>/&quot;</span>
<span class="re2">REPO_URL</span>=<span class="st0">&quot;https://downloads.<span class="es3">${HOME_URL#*//}</span>&quot;</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;s|<span class="es3">${REPO_URL}</span>|<span class="es3">${REPO_LOCAL}</span>|&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>opkg<span class="sy0">/</span>distfeeds.conf
&nbsp;
<span class="co0"># Share the repository on the LAN</span>
<span class="kw2">ln</span> <span class="re5">-f</span> <span class="re5">-s</span> <span class="co1">${REPO_LOCAL#*//}</span> <span class="sy0">/</span>www<span class="sy0">/</span><span class="co1">${ID}</span>
&nbsp;
<span class="co0"># Configure Opkg on the clients</span>
. <span class="sy0">/</span>etc<span class="sy0">/</span>os-release
<span class="re2">REPO_LOCAL</span>=<span class="st0">&quot;http://192.168.1.1/<span class="es3">${ID}</span>/&quot;</span>
<span class="re2">REPO_URL</span>=<span class="st0">&quot;https://downloads.<span class="es3">${HOME_URL#*//}</span>&quot;</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;s|<span class="es3">${REPO_URL}</span>|<span class="es3">${REPO_LOCAL}</span>|&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>opkg<span class="sy0">/</span>distfeeds.conf</pre>

<p>
See also: <a href="/downloads#how_to_mirror" class="wikilink1" title="downloads" data-wiki-id="downloads">How to mirror</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Local repository&quot;,&quot;hid&quot;:&quot;local_repository&quot;,&quot;codeblockOffset&quot;:22,&quot;secid&quot;:24,&quot;range&quot;:&quot;19426-21519&quot;} -->
<h2 class="sectionedit25" id="non-standard_installation_destinations">Non-standard installation destinations</h2>
<div class="level2">

<p>
Due to its history (fork of ipkg), opkg can specify a destination different than root for package installation, but since most packages don&#039;t support this natively, it&#039;s more a curiosity than actually useful.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:26,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_info plugin_wrap">
<p>
The recommended way to have more space to install your packages is <a href="/docs/guide-user/additional-software/extroot_configuration" class="wikilink1" title="docs:guide-user:additional-software:extroot_configuration" data-wiki-id="docs:guide-user:additional-software:extroot_configuration">Extroot</a>
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:27,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:28,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_important plugin_wrap">
<p>
This solution will NOT work out-of-the-box in most cases, OpenWrt packages are designed to be installed in root filesystem and may need additional symlinks or modifications to work at all under the changed path!
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:29,&quot;range&quot;:&quot;0-&quot;} -->
<p>
The default <code>/etc/opkg.conf</code> actually contains three destinations:
</p>
<pre class="code bash">dest root <span class="sy0">/</span>
dest ram <span class="sy0">/</span>tmp
dest mnt <span class="sy0">/</span>mnt</pre>

<p>
The format of destination lines is simply the keyword dest, followed by a name for this destination (this can be anything), followed by a filesystem location.
Any destination that has been thus configured can then be specified on the opkg command line like this:
</p>
<pre class="code bash">opkg <span class="re5">-d</span> destination_name <span class="kw2">install</span> somepackage</pre>

<p>
The <em>dest</em> argument must refer to one of the defined destinations in <code>/etc/opkg.conf</code>, e.g. <code>-d ram</code> to install packages to <code>/tmp/</code>.
</p>

<p>
If you want to install kernel modules on any other destination than root, you might want to read this first: <a href="https://dev.openwrt.org/ticket/10739" class="urlextern" title="https://dev.openwrt.org/ticket/10739" rel="ugc nofollow">https://dev.openwrt.org/ticket/10739</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Non-standard installation destinations&quot;,&quot;hid&quot;:&quot;non-standard_installation_destinations&quot;,&quot;codeblockOffset&quot;:23,&quot;secid&quot;:25,&quot;range&quot;:&quot;21520-&quot;} -->