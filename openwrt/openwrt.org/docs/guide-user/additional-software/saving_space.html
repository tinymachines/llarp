
<h1 class="sectionedit1" id="saving_firmware_space_and_ram">Saving firmware space and RAM</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Saving firmware space and RAM&quot;,&quot;hid&quot;:&quot;saving_firmware_space_and_ram&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-44&quot;} -->
<h2 class="sectionedit2" id="excluding_packages">Excluding packages</h2>
<div class="level2">

<p>
Flash space is scarce on devices with only 4MB flash.
You can save some space while compiling your own image (e.g. with the <a href="/docs/guide-user/additional-software/imagebuilder" class="wikilink1" title="docs:guide-user:additional-software:imagebuilder" data-wiki-id="docs:guide-user:additional-software:imagebuilder">imagebuilder</a>) by removing packages that are not needed for your usecase.
In order to completely remove <abbr title="Internet Protocol version 6">IPv6</abbr> support and related packages you also need to ask the imagebuilder to do so by also passing this option to the make command: <code>CONFIG_IPV6=n</code>.
</p>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Action </th><th class="col1"> Packages </th><th class="col2"> Menu path </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> remove pppoe </td><td class="col1"> <code>-<a href="/packages/pkgdata/ppp" class="wikilink1" title="packages:pkgdata:ppp" data-wiki-id="packages:pkgdata:ppp">ppp</a> -<a href="/packages/pkgdata/ppp-mod-pppoe" class="wikilink1" title="packages:pkgdata:ppp-mod-pppoe" data-wiki-id="packages:pkgdata:ppp-mod-pppoe">ppp-mod-pppoe</a></code> </td><td class="col2"> Network </td>
	</tr>
	<tr class="row2">
		<td class="col0"> remove <abbr title="Internet Protocol version 6">IPv6</abbr> </td><td class="col1"> <code>-<a href="/packages/pkgdata/ip6tables" class="wikilink2" title="packages:pkgdata:ip6tables" rel="nofollow" data-wiki-id="packages:pkgdata:ip6tables">ip6tables</a> -<a href="/packages/pkgdata/odhcp6c" class="wikilink1" title="packages:pkgdata:odhcp6c" data-wiki-id="packages:pkgdata:odhcp6c">odhcp6c</a> -kmod-ipv6 -<a href="/packages/pkgdata/kmod-ip6tables" class="wikilink1" title="packages:pkgdata:kmod-ip6tables" data-wiki-id="packages:pkgdata:kmod-ip6tables">kmod-ip6tables</a> -<a href="/packages/pkgdata/odhcpd-ipv6only" class="wikilink1" title="packages:pkgdata:odhcpd-ipv6only" data-wiki-id="packages:pkgdata:odhcpd-ipv6only">odhcpd-ipv6only</a></code> </td><td class="col2"> Global build settings / Enable <abbr title="Internet Protocol version 6">IPv6</abbr> support in packages </td>
	</tr>
	<tr class="row3">
		<td class="col0"> remove dhcp server </td><td class="col1"> <code>-<a href="/packages/pkgdata/odhcpd" class="wikilink1" title="packages:pkgdata:odhcpd" data-wiki-id="packages:pkgdata:odhcpd">odhcpd</a></code> </td><td class="col2"> Network </td>
	</tr>
	<tr class="row4">
		<td class="col0"> remove iptables </td><td class="col1"> <code>-<a href="/packages/pkgdata/iptables" class="wikilink2" title="packages:pkgdata:iptables" rel="nofollow" data-wiki-id="packages:pkgdata:iptables">iptables</a></code> </td><td class="col2"> Network / Firewall </td>
	</tr>
	<tr class="row5">
		<td class="col0"> remove opkg </td><td class="col1"> <code>-<a href="/packages/pkgdata/opkg" class="wikilink1" title="packages:pkgdata:opkg" data-wiki-id="packages:pkgdata:opkg">opkg</a></code> </td><td class="col2"> Base system </td>
	</tr>
	<tr class="row6">
		<td class="col0"> add LuCI minimal </td><td class="col1"> <code><a href="/packages/pkgdata/uhttpd" class="wikilink1" title="packages:pkgdata:uhttpd" data-wiki-id="packages:pkgdata:uhttpd">uhttpd</a> <a href="/packages/pkgdata/uhttpd-mod-ubus" class="wikilink1" title="packages:pkgdata:uhttpd-mod-ubus" data-wiki-id="packages:pkgdata:uhttpd-mod-ubus">uhttpd-mod-ubus</a></code></td><td class="col2"> Network / Web Servers/Proxies </td>
	</tr>
	<tr class="row7">
		<td class="col0"> </td><td class="col1"> <code><a href="/packages/pkgdata/libiwinfo-lua" class="wikilink1" title="packages:pkgdata:libiwinfo-lua" data-wiki-id="packages:pkgdata:libiwinfo-lua">libiwinfo-lua</a></code> </td><td class="col2"> Languages / Lua </td>
	</tr>
	<tr class="row8">
		<td class="col0"> </td><td class="col1"> <code><a href="/packages/pkgdata/luci-base" class="wikilink1" title="packages:pkgdata:luci-base" data-wiki-id="packages:pkgdata:luci-base">luci-base</a> <a href="/packages/pkgdata/luci-app-firewall" class="wikilink1" title="packages:pkgdata:luci-app-firewall" data-wiki-id="packages:pkgdata:luci-app-firewall">luci-app-firewall</a> <a href="/packages/pkgdata/luci-mod-admin-full" class="wikilink1" title="packages:pkgdata:luci-mod-admin-full" data-wiki-id="packages:pkgdata:luci-mod-admin-full">luci-mod-admin-full</a> <a href="/packages/pkgdata/luci-theme-bootstrap" class="wikilink1" title="packages:pkgdata:luci-theme-bootstrap" data-wiki-id="packages:pkgdata:luci-theme-bootstrap">luci-theme-bootstrap</a></code> </td><td class="col2"> LuCI </td>
	</tr>
	<tr class="row9">
		<td class="col0"> add zram </td><td class="col1"> <code><a href="/packages/pkgdata/zram-swap" class="wikilink1" title="packages:pkgdata:zram-swap" data-wiki-id="packages:pkgdata:zram-swap">zram-swap</a></code> </td><td class="col2"> Base system </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;506-1501&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Do not use zram-swap for 4MB flash devices as it <em>increases</em> the amount of firmware space used.
It is listed here as it is helpful on machines with very little RAM memory.
</p>

<p>
<img src="/lib/images/smileys/question.svg" class="icon smiley" alt=":?:" /> The minus <code>-PACKAGE_NAME</code> prefix removes a package, no prefix adds one.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Excluding packages&quot;,&quot;hid&quot;:&quot;excluding_packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;45-1760&quot;} -->
<h3 class="sectionedit4" id="build_image_for_devices_with_only_4mb_flash">Build image for devices with only 4MB flash</h3>
<div class="level3">

<p>
<strong>Example image builder command line</strong>
</p>

<p>
<strong>Note:</strong> In the command line shown below, you need to adjust <code>PROFILE=tl-wr941nd-v6</code> to your device.
Use <code>make info</code> to list possibilities.
</p>
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> LuCI </th><th class="col1"> Action </th><th class="col2"> Imagebuilder commandline </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> with LuCI </td><td class="col1"> - remove pppoe and <abbr title="Internet Protocol version 6">IPv6</abbr><br/>
+ include only needed luci components, not full luci package. </td><td class="col2"> <code>make image PROFILE=tl-wr941nd-v6 \
PACKAGES=“uhttpd uhttpd-mod-ubus libiwinfo-lua luci-base \
luci-app-firewall luci-mod-admin-full luci-theme-bootstrap \
-ppp -ppp-mod-pppoe -ip6tables -odhcp6c \
-kmod-ipv6 -kmod-ip6tables -odhcpd-ipv6only”</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> without LuCI </td><td class="col1"> - remove pppoe and <abbr title="Internet Protocol version 6">IPv6</abbr> </td><td class="col2"> <code>make image PROFILE=tl-wr941nd-v6 \
PACKAGES=“-ppp -ppp-mod-pppoe -ip6tables -odhcp6c \
-kmod-ipv6 -kmod-ip6tables -odhcpd-ipv6only”</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;2001-2578&quot;} -->
<p>
Resources:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/can-i-strip-the-ipv6-out-with-the-imagebuilder/3465/5" class="urlextern" title="https://forum.openwrt.org/t/can-i-strip-the-ipv6-out-with-the-imagebuilder/3465/5" rel="ugc nofollow">https://forum.openwrt.org/t/can-i-strip-the-ipv6-out-with-the-imagebuilder/3465/5</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/build-lede-without-ipv6/2043" class="urlextern" title="https://forum.openwrt.org/t/build-lede-without-ipv6/2043" rel="ugc nofollow">https://forum.openwrt.org/t/build-lede-without-ipv6/2043</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/make-image-problem/898" class="urlextern" title="https://forum.openwrt.org/t/make-image-problem/898" rel="ugc nofollow">https://forum.openwrt.org/t/make-image-problem/898</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/tp-link-tl-mr-3420-v3-build/855/8" class="urlextern" title="https://forum.openwrt.org/t/tp-link-tl-mr-3420-v3-build/855/8" rel="ugc nofollow">https://forum.openwrt.org/t/tp-link-tl-mr-3420-v3-build/855/8</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/possible-ppp-removal-from-base-image/42024/3" class="urlextern" title="https://forum.openwrt.org/t/possible-ppp-removal-from-base-image/42024/3" rel="ugc nofollow">https://forum.openwrt.org/t/possible-ppp-removal-from-base-image/42024/3</a></div>
</li>
<li class="level1"><div class="li"> Talk <a href="https://youtu.be/M3yUjHKvde8?t=846" class="urlextern" title="https://youtu.be/M3yUjHKvde8?t=846" rel="ugc nofollow">Fight for the bytes! Fun with Four Megabytes Flash</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Build image for devices with only 4MB flash&quot;,&quot;hid&quot;:&quot;build_image_for_devices_with_only_4mb_flash&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1761-3055&quot;} -->
<h3 class="sectionedit6" id="build_image_for_devices_with_only_1632mb_ram">Build image for devices with only 16/32MB RAM</h3>
<div class="level3">

<p>
If the device has 16MB or less of RAM, then it should only be used as Internal <abbr title="Access Point">AP</abbr> (e.g. to extend Wi-Fi coverage).<br/>

</p>

<p>
<strong>Example image builder command line</strong>
</p>

<p>
<strong>Note:</strong> In the command line shown below, you need to adjust <code>PROFILE=tl-wr941nd-v6</code> to your device.
Use <code>make info</code> to list possibilities.
</p>
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> RAM </th><th class="col1"> Action </th><th class="col2"> Imagebuilder commandline </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> 16MB </td><td class="col1"> - remove pppoe and <abbr title="Internet Protocol version 6">IPv6</abbr><br/>
- remove all related elements to iptables<br/>
- remove dhcp servers <br/>
+ add LUCI<br/>
+ add zram-swap<br/>
- remove opkg - not needed after making these adjustments </td><td class="col2"> <code>make image PROFILE=tl-wr941nd-v6 \
PACKAGES=“uhttpd uhttpd-mod-ubus libiwinfo-lua \
luci-base luci-app-firewall luci-mod-admin-full \
luci-theme-bootstrap zram-swap \
-ppp -ppp-mod-pppoe -iptables -ip6tables -odhcp6c -kmod-ipv6 \
-kmod-ip6tables -odhcpd-ipv6only -odhcpd -opkg”</code></td>
	</tr>
	<tr class="row2">
		<td class="col0"> 32MB </td><td class="col1"> - remove pppoe and <abbr title="Internet Protocol version 6">IPv6</abbr><br/>
+ add LUCI<br/>
+ add zram-swap<br/>
- remove opkg - not needed after making these adjustments </td><td class="col2"> <code>make image PROFILE=tl-wr941nd-v6 \
PACKAGES=“uhttpd uhttpd-mod-ubus libiwinfo-lua luci-base \
luci-app-firewall luci-mod-admin-full luci-theme-bootstrap zram-swap \
-ppp -ppp-mod-pppoe -ip6tables -odhcp6c -kmod-ipv6 \
-kmod-ip6tables -odhcpd-ipv6only -opkg”</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;3416-4327&quot;} -->
<p>
Resources:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/zram-configuration/3560" class="urlextern" title="https://forum.openwrt.org/t/zram-configuration/3560" rel="ugc nofollow">https://forum.openwrt.org/t/zram-configuration/3560</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/best-practices-for-32-mb-ram/5050" class="urlextern" title="https://forum.openwrt.org/t/best-practices-for-32-mb-ram/5050" rel="ugc nofollow">https://forum.openwrt.org/t/best-practices-for-32-mb-ram/5050</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.openwrt.org/t/luci-slow-down-to-death-wr1043n-v1/1992" class="urlextern" title="https://forum.openwrt.org/t/luci-slow-down-to-death-wr1043n-v1/1992" rel="ugc nofollow">https://forum.openwrt.org/t/luci-slow-down-to-death-wr1043n-v1/1992</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Build image for devices with only 16\/32MB RAM&quot;,&quot;hid&quot;:&quot;build_image_for_devices_with_only_1632mb_ram&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;3056-4546&quot;} -->
<h2 class="sectionedit8" id="making_all_kernel_modules_built-in">Making all kernel modules built-in</h2>
<div class="level2">

<p>
This option compiles the kernel modules inside the kernel, you can either pick what modules you think can be integrated and make them built-in by pressing “y” on them when in the menuconfig, or do a quick-and-dirty change of the kernel config with (adjust the path in this example to point to your target&#039;s actual kernel config)
</p>
<pre class="code bash"><span class="kw2">sed</span> <span class="re5">-i</span> <span class="re5">-e</span> <span class="st0">&quot;s/=m/=y/g&quot;</span> build_dir<span class="sy0">/</span>target-mipsel_24kc_musl<span class="sy0">/</span>linux-ramips_mt7620<span class="sy0">/</span>linux-4.14.63<span class="sy0">/</span>.config</pre>

<p>
This will work only if your device&#039;s kernel partition is big enough to accomodate the slightly larger kernel, or if the device is using dynamic partitions.
</p>

<p>
This was reported by Daniel Santos in an <a href="https://lists.infradead.org/pipermail/openwrt-devel/2018-October/014459.html" class="urlextern" title="https://lists.infradead.org/pipermail/openwrt-devel/2018-October/014459.html" rel="ugc nofollow">email to the OpenWrt developer mailing list</a>, 30 Oct 2018.
</p>

<p>
His comments:
</p>

<p>
<em>I did a quick experiment of this and <strong>instead of saving 4k, my *image* is a full 256k smaller</strong>.
I haven&#039;t analysed the specifics, but also this means less RAM consumed because squashfs uses the page cache for uncompressed files.
Further, modules inherently have greater overhead, even after __init sections have been discarded.

The only downside is that built-ins cannot be unloaded and will always occupy a portion of RAM.
But having them built into the kernel is far more efficient.</em>
</p>

<p>
(The “surprising” change in image size may be due to the block size of the squashfs image.
See, for example <code>include/image-commands.mk</code> and <code>include/image.mk</code> in November, 2018 sources)
</p>

<p>
In a follow up mail by Phillip Prindeville pointed out the main drawback of this method.
</p>

<p>
<em>Some hardware (it’s rare but not unheard of) can only be reset by unloading and reloading the module that controls it.
Otherwise, you have to reboot the box.
If you build all of your drivers in, then rebooting is all you have.</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Making all kernel modules built-in&quot;,&quot;hid&quot;:&quot;making_all_kernel_modules_built-in&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;4547-6403&quot;} -->
<h2 class="sectionedit9" id="modifying_build_configuration_variables">Modifying build configuration variables</h2>
<div class="level2">

<p>
You can also save space by changing configuration variables using <code>make menuconfig</code>.
In addition to the ones mentioned here you can save a tiny bit of space by disabling commands in busybox.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Modifying build configuration variables&quot;,&quot;hid&quot;:&quot;modifying_build_configuration_variables&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:9,&quot;range&quot;:&quot;6404-6649&quot;} -->
<h3 class="sectionedit10" id="saving_space">Saving space</h3>
<div class="level3">
<div class="table sectionedit11"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Config variable<br/>
(<code>n</code> = disable, <code>y</code> = enable) </th><th class="col1"> Menu path </th><th class="col2"> Comments </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>CONFIG_KERNEL_PRINTK=n</code> </td><td class="col1"> Global build settings / Kernel build options / Enable support for printk </td><td class="col2"></td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>CONFIG_KERNEL_CRASHLOG=n</code> </td><td class="col1"> Global build settings / Kernel build options / Crash logging </td><td class="col2"></td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>CONFIG_KERNEL_SWAP=n</code> </td><td class="col1"> Global build settings / Kernel build options / Support for paging of anonymous memory (swap) </td><td class="col2"></td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>CONFIG_KERNEL_KALLSYMS=n</code> </td><td class="col1"> Global build settings / Kernel build options / Compile the kernel with symbol table information </td><td class="col2"></td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>CONFIG_KERNEL_DEBUG_INFO=n</code> </td><td class="col1"> Global build settings / Kernel build options / Compile the kernel with debug information </td><td class="col2"></td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>CONFIG_KERNEL_ELF_CORE=n</code> </td><td class="col1"> Global build settings / Kernel build options / Enable process core dump support </td><td class="col2"></td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>CONFIG_IPV6=n</code> </td><td class="col1"> Global build settings / Enable <abbr title="Internet Protocol version 6">IPv6</abbr> support in packages </td><td class="col2"></td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>CONFIG_KERNEL_MAGIC_SYSRQ=n</code> </td><td class="col1"> Global build settings / Kernel build options / Compile the kernel with SysRq support </td><td class="col2"></td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>CONFIG_KERNEL_PRINTK_TIME=n</code> </td><td class="col1"> Global build settings / Kernel build options / Enable printk timestamps </td><td class="col2"></td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>CONFIG_PACKAGE_MAC80211_DEBUGFS=n</code> </td><td class="col1"> Kernel modules / Wireless Drivers / kmod-mac80211 / Export mac80211 internals in DebugFS </td><td class="col2"> Estimated savings: 21 KB </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>CONFIG_PACKAGE_MAC80211_MESH=n</code> </td><td class="col1"> Kernel modules / Wireless Drivers / kmod-mac80211 / Enable 802.11s mesh support </td><td class="col2"> Estimated savings: 29 KB </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>CONFIG_STRIP_KERNEL_EXPORTS=y</code> </td><td class="col1"> Global build settings / Strip unnecessary exports from the kernel image </td><td class="col2"></td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>CONFIG_USE_MKLIBS=y</code> </td><td class="col1"> Global build settings / Strip unnecessary functions from libraries </td><td class="col2"></td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>CONFIG_SERIAL_8250=n</code> </td><td class="col1"> Device Drivers / Character devices / Serial drivers / 8250/16550 and compatible serial support </td><td class="col2"> This will also save RAM by preventing /sbin/askfirst from running. However, this will break sysupgrade. This menu is available only via <code>make kernel_menuconfig</code> </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>CONFIG_EARLY_PRINTK=n</code> </td><td class="col1"> Kernel hacking / Early printk </td><td class="col2"> This menu is available only via <code>make kernel_menuconfig</code> </td>
	</tr>
	<tr class="row16">
		<td class="col0"> <code>KERNEL_SQUASHFS_FRAGMENT_CACHE_SIZE</code> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /></td><td class="col1"> Global build settings / Kernel build options / Number of squashfs fragments cached </td><td class="col2"> Reduce the number of cached blocks. This menu is available only via <code>make kernel_menuconfig</code> </td>
	</tr>
	<tr class="row17">
		<td class="col0"> <code>TARGET_SQUASHFS_BLOCK_SIZE</code> <img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /></td><td class="col1"> Target Images / squashfs / Block size </td><td class="col2"> Increase block size from the default 256 KB to improve compression </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;6673-9069&quot;} -->
<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> Block size must be a power of 2, between 4096 bytes and 1 Megabyte. By default, 3 blocks will be cached so this will also make the router use more RAM (if 3 blocks are cached, and a block size of 1024 KB is used, this will use 2,304 KB more RAM (3 * 1024 KB - 3 * 256 KB)). It may also make the router use more CPU to decompress the larger blocks.
</p>

<p>
<img src="/lib/images/smileys/exclaim.svg" class="icon smiley" alt=":!:" /> To <strong>build a kernel that only works with a specific device</strong>, run <code>make kernel_menuconfig CONFIG_TARGET=subtarget</code> to edit <code>target/linux/&lt;platform&gt;/*/config-default</code> and go to <code>Machine selection / &lt;Platform&gt; machine selection</code> and disable all devices except for the specific device.
<a href="https://forum.openwrt.org/t/building-a-smaller-kernel-for-a-specific-device/30370/8" class="urlextern" title="https://forum.openwrt.org/t/building-a-smaller-kernel-for-a-specific-device/30370/8" rel="ugc nofollow">This can save some disk space and RAM</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Saving space&quot;,&quot;hid&quot;:&quot;saving_space&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;6650-9844&quot;} -->
<h3 class="sectionedit12" id="saving_ram">Saving RAM</h3>
<div class="level3">
<div class="table sectionedit13"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Config variable<br/>
(<code>n</code> = disable, <code>y</code> = enable) </th><th class="col1"> Menu path </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>CONFIG_PACKAGE_zram-swap=y</code> </td><td class="col1"> Base system / zram-swap </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>CONFIG_PROCD_ZRAM_TMPFS=y</code> </td><td class="col1"> Base system / procd Configuration / Mount <em>/tmp</em> using zram </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>CONFIG_KERNEL_SWAP=y</code> </td><td class="col1"> Global build settings / Kernel build options / Support for paging of anonymous memory (swap) </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;9866-10216&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Saving RAM&quot;,&quot;hid&quot;:&quot;saving_ram&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:12,&quot;range&quot;:&quot;9845-10217&quot;} -->
<h2 class="sectionedit14" id="replace_luci_icons_with_a_blank_pixel">Replace LuCI icons with a blank pixel</h2>
<div class="level2">

<p>
The icons in LuCI are not strictly necessary and replacing them with a blank image will save about 15 KB.
This bash script will take an OpenWrt git path as parameter and replace the images with a blank using the <a href="/docs/guide-developer/toolchain/use-buildsystem#custom_files" class="wikilink1" title="docs:guide-developer:toolchain:use-buildsystem" data-wiki-id="docs:guide-developer:toolchain:use-buildsystem">files</a> path:
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody"><pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;$1&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span> <span class="kw3">echo</span> Need <span class="kw2">git</span> path <span class="kw2">as</span> parameter; <span class="kw3">exit</span> <span class="nu0">1</span>; <span class="kw1">fi</span>
<span class="kw3">cd</span> <span class="st0">&quot;$1&quot;</span> <span class="sy0">||</span> <span class="kw3">exit</span> <span class="nu0">1</span>
<span class="re2">gitpath</span>=<span class="sy0">`</span><span class="kw3">pwd</span><span class="sy0">`</span>
<span class="kw3">echo</span> Installing to <span class="re1">$gitpath</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>icons<span class="sy0">/</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>cbi<span class="sy0">/</span>
<span class="kw2">wget</span> <span class="re5">-O</span> files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>cbi<span class="sy0">/</span>blank.gif <span class="st_h">'https://raw.githubusercontent.com/mathiasbynens/small/master/gif-transparent.gif'</span>
<span class="kw2">wget</span> <span class="re5">-O</span> files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>cbi<span class="sy0">/</span>blank.png <span class="st_h">'https://raw.githubusercontent.com/mathiasbynens/small/master/png-transparent.png'</span>
<span class="kw3">cd</span> feeds<span class="sy0">/</span>luci<span class="sy0">/</span>modules<span class="sy0">/</span>luci-base<span class="sy0">/</span>htdocs<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>cbi
<span class="kw1">for</span> a <span class="kw1">in</span> <span class="sy0">*</span>.gif; <span class="kw1">do</span> <span class="kw2">ln</span> <span class="re5">-s</span> blank.gif <span class="st0">&quot;<span class="es2">$gitpath</span>&quot;</span><span class="sy0">/</span>files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>cbi<span class="sy0">/</span><span class="re1">$a</span>; <span class="kw1">done</span>
<span class="kw3">cd</span> ..<span class="sy0">/</span>icons
<span class="kw1">for</span> a <span class="kw1">in</span> <span class="sy0">*</span>.gif; <span class="kw1">do</span> <span class="kw2">ln</span> <span class="re5">-s</span> ..<span class="sy0">/</span>cbi<span class="sy0">/</span>blank.gif <span class="st0">&quot;<span class="es2">$gitpath</span>&quot;</span><span class="sy0">/</span>files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>icons<span class="sy0">/</span><span class="re1">$a</span>; <span class="kw1">done</span>
<span class="kw1">for</span> a <span class="kw1">in</span> <span class="sy0">*</span>.png; <span class="kw1">do</span> <span class="kw2">ln</span> <span class="re5">-s</span> ..<span class="sy0">/</span>cbi<span class="sy0">/</span>blank.png <span class="st0">&quot;<span class="es2">$gitpath</span>&quot;</span><span class="sy0">/</span>files<span class="sy0">/</span>www<span class="sy0">/</span>luci-static<span class="sy0">/</span>resources<span class="sy0">/</span>icons<span class="sy0">/</span><span class="re1">$a</span>; <span class="kw1">done</span></pre>
</div></div>
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Replace LuCI icons with a blank pixel&quot;,&quot;hid&quot;:&quot;replace_luci_icons_with_a_blank_pixel&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:14,&quot;range&quot;:&quot;10218-11467&quot;} -->
<h1 class="sectionedit15" id="external_links">External links</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="https://wiki.yoctoproject.org/wiki/Minimal_Image" class="urlextern" title="https://wiki.yoctoproject.org/wiki/Minimal_Image" rel="ugc nofollow">https://wiki.yoctoproject.org/wiki/Minimal_Image</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://wiki.yoctoproject.org/wiki/Linux_kernel/Image_Size" class="urlextern" title="https://wiki.yoctoproject.org/wiki/Linux_kernel/Image_Size" rel="ugc nofollow">https://wiki.yoctoproject.org/wiki/Linux_kernel/Image_Size</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://elinux.org/System_Size" class="urlextern" title="https://elinux.org/System_Size" rel="ugc nofollow">https://elinux.org/System_Size</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://elinux.org/Runtime_Memory_Measurement" class="urlextern" title="https://elinux.org/Runtime_Memory_Measurement" rel="ugc nofollow">https://elinux.org/Runtime_Memory_Measurement</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://tiny.wiki.kernel.org/" class="urlextern" title="https://tiny.wiki.kernel.org/" rel="ugc nofollow">https://tiny.wiki.kernel.org/</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/yurt-page/docs" class="urlextern" title="https://github.com/yurt-page/docs" rel="ugc nofollow">https://github.com/yurt-page/docs</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;External links&quot;,&quot;hid&quot;:&quot;external_links&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:15,&quot;range&quot;:&quot;11468-&quot;} -->