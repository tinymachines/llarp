
<h1 class="sectionedit1" id="how_to_prepare_buildbot_for_major_release">How to prepare buildbot for major release</h1>
<div class="level1">

<p>
These are collected notes of the steps we&#039;ve done during preparation of buildbot infrastructure for 21.02 release.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;How to prepare buildbot for major release&quot;,&quot;hid&quot;:&quot;how_to_prepare_buildbot_for_major_release&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-173&quot;} -->
<h2 class="sectionedit2" id="generate_usign_key">Generate usign key</h2>
<div class="level2">
<pre class="code bash">usign <span class="re5">-G</span> <span class="re5">-c</span> <span class="st0">&quot;Public usign key for 22.03 release builds&quot;</span> <span class="re5">-s</span> secret.key <span class="re5">-p</span> public.key</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Generate usign key&quot;,&quot;hid&quot;:&quot;generate_usign_key&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;174-310&quot;} -->
<h3 class="sectionedit3" id="add_usign_public_key_to_keyring">Add usign public key to keyring</h3>
<div class="level3">
<pre class="code bash">usign <span class="re5">-F</span> <span class="re5">-p</span> public.key
2f8b0b98e08306bf
&nbsp;
<span class="kw2">mv</span> public.key openwrt<span class="sy0">/</span>keyring.git<span class="sy0">/</span>usign<span class="sy0">/</span>2f8b0b98e08306bf</pre>

<p>
Add usign secret.key to <em>ansible/inventories/openwrt-secrets.yml</em>:
</p>
<pre class="code yaml">vault_buildbot_usign_key_openwrt_22_03:</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Add usign public key to keyring&quot;,&quot;hid&quot;:&quot;add_usign_public_key_to_keyring&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;311-603&quot;} -->
<h2 class="sectionedit4" id="add_gpgusign_keys_to_keyringgit_repo">Add GPG/usign keys to keyring.git repo</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> <a href="https://git.openwrt.org/?p=keyring.git;a=commit;h=bc4d80f064f2af385a78705d5de0fc8e882c3991" class="interwiki iw_commit" title="https://git.openwrt.org/?p=keyring.git;a=commit;h=bc4d80f064f2af385a78705d5de0fc8e882c3991">gpg: add OpenWrt 21.02 signing key</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://git.openwrt.org/?p=keyring.git;a=commit;h=49283916005d7868923d34ab34f14188cf74812d" class="interwiki iw_commit" title="https://git.openwrt.org/?p=keyring.git;a=commit;h=49283916005d7868923d34ab34f14188cf74812d">usign: add 21.02 release build pubkey</a></div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Add GPG\/usign keys to keyring.git repo&quot;,&quot;hid&quot;:&quot;add_gpgusign_keys_to_keyringgit_repo&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:4,&quot;range&quot;:&quot;604-893&quot;} -->
<h3 class="sectionedit5" id="update_packagesystemopenwrt-keyringmakefile_package">Update package/system/openwrt-keyring/Makefile package</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> <a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=1bf6d70e60fdb45d81a8f10b90904cef38c73f70" class="interwiki iw_commit" title="https://git.openwrt.org/?p=openwrt/openwrt.git;a=commit;h=1bf6d70e60fdb45d81a8f10b90904cef38c73f70">openwrt-keyring: add OpenWrt 21.02 GPG/usign keys</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://git.openwrt.org/2d03f27f0f0768e25f3b00fb5b4f2974144c66e3" class="interwiki iw_commit" title="https://git.openwrt.org/2d03f27f0f0768e25f3b00fb5b4f2974144c66e3">openwrt-keyring: make opkg use 22.03 usign key</a> (NOTE: this needs to be done only in the release branch)</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Update package\/system\/openwrt-keyring\/Makefile package&quot;,&quot;hid&quot;:&quot;update_packagesystemopenwrt-keyringmakefile_package&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:5,&quot;range&quot;:&quot;894-1260&quot;} -->
<h3 class="sectionedit6" id="add_new_gpg_key_information_to_the_release_signatures_page">Add new GPG key information to the release signatures page</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Add new key info to <a href="/docs/guide-user/security/signatures" class="wikilink1" title="docs:guide-user:security:signatures" data-wiki-id="docs:guide-user:security:signatures">signatures</a> page</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Add new GPG key information to the release signatures page&quot;,&quot;hid&quot;:&quot;add_new_gpg_key_information_to_the_release_signatures_page&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:6,&quot;range&quot;:&quot;1261-1401&quot;} -->
<h2 class="sectionedit7" id="prepare_buildbot_infra_and_assign_buildworkers">Prepare buildbot infra and assign buildworkers</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> <a href="https://git.openwrt.org/?p=admin/ansible.git;a=commit;h=ec7b5803e269911aa45e86ad694f72eec57e68fd" class="interwiki iw_commit" title="https://git.openwrt.org/?p=admin/ansible.git;a=commit;h=ec7b5803e269911aa45e86ad694f72eec57e68fd">inventory: add setup for 21.02 release</a></div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Prepare buildbot infra and assign buildworkers&quot;,&quot;hid&quot;:&quot;prepare_buildbot_infra_and_assign_buildworkers&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:7,&quot;range&quot;:&quot;1402-1589&quot;} -->
<h3 class="sectionedit8" id="apply_new_build_infra_2102">Apply new build infra 21.02</h3>
<div class="level3">
<pre class="code bash">ansible-playbook <span class="re5">--diff</span> <span class="re5">-i</span> inventories<span class="sy0">/</span>prod buildworker.yml <span class="re5">--tags</span> cfg,recreate-slave <span class="re5">--limit</span> fsf-02,fsf-04,osuosl-vm-03,osuosl-vm-04,truecz-01,truecz-02,buildmaster</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Apply new build infra 21.02&quot;,&quot;hid&quot;:&quot;apply_new_build_infra_2102&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:8,&quot;range&quot;:&quot;1590-&quot;} -->