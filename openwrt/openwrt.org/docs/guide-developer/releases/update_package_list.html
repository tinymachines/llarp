
<h2 class="sectionedit1" id="update_package_lists">Update package lists</h2>
<div class="level2">

<p>
The package list and package Indexes are generated by a script, so we will first need to move the current data to a permanent place (so it can still be viewed in the wiki as a “old stable” release), rename it, and then edit two strings in the script to make it point to the new release.<br/>

</p>

<p>
In the following instructions, the “new release” is 21.02, the “old release” is 19.07 and the “legacy/older release” is lede 17.1. Adjust the versions accordingly to your current situation.
</p>

<p>
Download the current release of the “CSV dump of the package database, updated daily” from <a href="/packages/start" class="wikilink1" title="packages:start" data-wiki-id="packages:start"> this page</a> and rename it to have the release version in it. For example <strong>packages_dump_tab_separated_19.07.zip</strong>. We will upload this later when we adjust the page.
</p>

<p>
You will need ssh access and after you became root user in the openwrt.org server to do the following
</p>

<p>
we can find current package files in this folder
</p>
<pre class="code">root@wiki-01:~# ls -l /var/www/dokuwiki/data/pages/packages
total 1120
-rw-r--r-- 1 www-data www-data   4021 Jan 16  2017 _template.txt
-rw-r--r-- 1 www-data www-data    146 Nov 26  2016 architectures.txt
drwxr-xr-x 2 www-data www-data   4096 Sep 12 03:57 index
drwxr-xr-x 2 www-data www-data   4096 Mar 23  2019 index_lede17_1
drwxr-xr-x 2 www-data www-data   4096 Feb  2  2020 index_owrt18_6
-rw-r--r-- 1 www-data www-data 384579 Sep 12 21:44 logfile.txt
-rw-r--r-- 1 www-data www-data   1823 Aug  5  2018 maintainer-view.txt
drwxr-xr-x 2 www-data www-data 290816 Sep 12 03:57 pkgdata
drwxr-xr-x 2 www-data www-data 176128 Mar 10  2019 pkgdata_lede17_1
drwxr-xr-x 2 www-data www-data 245760 Feb 14  2021 pkgdata_owrt18_6
-rw-r--r-- 1 www-data www-data   3098 Dec 19  2020 start.txt
drwxr-xr-x 2 www-data www-data   4096 Aug  5  2018 table
drwxr-xr-x 2 www-data www-data   4096 Aug  5  2018 table_lede17_1
drwxr-xr-x 2 www-data www-data   4096 Feb  3  2020 table_owrt18_6</pre>

<p>
We start by deleting older package tables and indexes.
Legacy releases only get the CSV file with the data export (which is why you saved that file above).
</p>
<pre class="code">rm -Rv /var/www/dokuwiki/data/pages/packages/pkgdata_lede17_1/
rm -Rv /var/www/dokuwiki/data/pages/packages/index_lede17_1/
rm -Rv /var/www/dokuwiki/data/pages/packages/table_lede17_1/</pre>

<p>
Then we rename the current pkgdata/index folders to a folder with release version in them (the ones with the current release will be re-generated later by the script), and copy the table folder (we will edit it later to load the data from these package lists)
</p>
<pre class="code">cd /var/www/dokuwiki/data/pages/packages 
mv pkgdata pkgdata_owrt19_7
mv index index_owrt19_7
cp -R table table_owrt19_7
chown www-data:www-data -R /var/www/dokuwiki/data/pages/packages</pre>

<p>
Now we mass-edit the package indexes to point to the right package data folder
</p>
<pre class="code">cd /var/www/dokuwiki/data/pages/packages/index_owrt19_7/
sed -i &#039;s/pkgdata/pkgdata_owrt19_7/g&#039; *</pre>

<p>
Now we mass-edit the package data to use different variable names
</p>
<pre class="code">cd /var/www/dokuwiki/data/pages/packages/pkgdata_owrt19_7/
sed -i &#039;s/Dependencies_pkg-dependencies/Dependencies_pkg-dependency_19s/g&#039; *
sed -i &#039;s/Categories_pkg-categorys/Categories_pkg-category_19s/g&#039; *</pre>

<p>
Now we mass-edit the table page to use different variable names (and be consistent with the changes above)
</p>
<pre class="code">cd /var/www/dokuwiki/data/pages/packages/table_owrt19_7
sed -i &#039;s/Dependencies_pkg-dependencies/Dependencies_pkg-dependency_19s/g&#039; *
sed -i &#039;s/Categories_pkg-categorys/Categories_pkg-category_19s/g&#039; *
sed -i &#039;s/Name_pkg-dependencies/%pageid%/g&#039; *
sed -i &#039;s/Package table/Package table 19.07/g&#039; *</pre>

<p>
Now we edit the package indexing script
</p>
<pre class="code">cd /root
nano listpackages-server</pre>

<p>
Scroll down a bit and edit 
</p>
<pre class="code">#package list generic link
package_list_main_URL=&quot;https://downloads.openwrt.org/releases/19.07.0/packages/&quot;
#&quot;https://downloads.openwrt.org/snapshots/packages/&quot;

#targets list
OpenWrt_targets_link=&quot;https://downloads.openwrt.org/releases/19.07.0/targets&quot;
#&quot;https://downloads.openwrt.org/snapshots/targets/&quot;

#types of repos there are currently
OpenWrt_repos=&quot;base luci routing telephony packages&quot;

#the only release we have currently
package_release=&quot;OpenWrt-19.07.0&quot;   #&quot;snapshot&quot;

#setting variables for release

github_folder=&quot;openwrt-19.07&quot;  #&quot;master&quot;</pre>

<p>
The first two links are the folders you find in the release folder from this webpage on the download server
<a href="https://downloads.openwrt.org/releases/" class="urlextern" title="https://downloads.openwrt.org/releases/" rel="ugc nofollow">https://downloads.openwrt.org/releases/</a>
</p>

<p>
The “package_release” variable is just a description string that is used to write the release version in the packages
</p>

<p>
Thhe “github_folder” variable is the name of the branch of the release in the git source, you can see the branch names on this github page from OpenWrt&#039;s github mirror <a href="https://github.com/openwrt/openwrt/branches" class="urlextern" title="https://github.com/openwrt/openwrt/branches" rel="ugc nofollow">https://github.com/openwrt/openwrt/branches</a>
</p>

<p>
So with this in mind, the above becomes
</p>
<pre class="code">#package list generic link
package_list_main_URL=&quot;https://downloads.openwrt.org/releases/21.02.0/packages/&quot;
#&quot;https://downloads.openwrt.org/snapshots/packages/&quot;

#targets list
OpenWrt_targets_link=&quot;https://downloads.openwrt.org/releases/21.02.0/targets&quot;
#&quot;https://downloads.openwrt.org/snapshots/targets/&quot;

#types of repos there are currently
OpenWrt_repos=&quot;base luci routing telephony packages&quot;

#the only release we have currently
package_release=&quot;OpenWrt-21.02.0&quot;   #&quot;snapshot&quot;

#setting variables for release

github_folder=&quot;openwrt-21.02&quot;  #&quot;master&quot;</pre>

<p>
Save and close the script.
</p>

<p>
start the script so it starts to index the new packages. 
</p>
<pre class="code">nohup /root/listpackages-server &amp;</pre>

<p>
If launched this way it is run as background task. You can disconnect from <abbr title="Secure Shell">SSH</abbr> and it will still run.
</p>

<p>
Now it&#039;s time to edit the page in <a href="/packages/start" class="wikilink1" title="packages:start" data-wiki-id="packages:start"> here </a> to point to the right package lists and indexes, and remove legacy release entries. You can also upload the CSV file.
</p>

<p>
If you don&#039;t want to wait for the script to finish, you can also launch a page rescan so the wiki will re-read all text files and notice this manual change.
</p>
<pre class="code">nohup  sudo -u www-data /usr/bin/php7.0 /var/www/dokuwiki/bin/indexer.php -c  &amp;</pre>

</div>
