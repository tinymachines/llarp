
<h1 class="sectionedit1" id="revision_number_calculation">Revision number calculation</h1>
<div class="level1">

<p>
LEDE continues to use the svn-like rXXXX revision, but as source code is stored in git repository, the rXXXX revision needs to be calculated separately.
</p>

<p>
LEDE uses the shell script scripts/getver.sh for calculating the revision. It calculates the revision by counting the number of commits since the LEDE repository was initially cloned from Openwrt.
</p>
<ul>
<li class="level1"><div class="li"> The counting is not global, but is done separately for master and stable branches. E.g. currently 17.01 branch is at r3300 while master is at r3921.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Revision number calculation&quot;,&quot;hid&quot;:&quot;revision_number_calculation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-549&quot;} -->
<h2 class="sectionedit2" id="convert_between_source_revision_and_git_commit_hash">Convert between source revision and git commit hash</h2>
<div class="level2">

<p>
You can use ./scripts/getver.sh in your buildroot in four ways:
</p>
<ul>
<li class="level1"><div class="li"> Without arguments, it gives you current HEAD revision as “rxxxx-hash”. That is the normal use.</div>
</li>
<li class="level1"><div class="li"> If you give a version like “r3298” as an argument, it fetches you the git hash</div>
</li>
<li class="level1"><div class="li"> If you give a git hash as argument, it calculates the rxxxx revision for it</div>
</li>
<li class="level1"><div class="li"> If you give it its own output (“version string”) it will return the hash for the git commit</div>
</li>
</ul>

</div>

<h4 id="example">Example</h4>
<div class="level4">
<pre class="code">$ git log --oneline
53fcaed1f7 image.mk: force kernel rebuild on every run
638ca50f3b kernel: Fix the incorrect i_nlink count after jffs2&#039;s RENAME_EXCHANGE operations.
47bf110cbb mac80211: backport an upstream fix for queue start/stop handling
a49503bbc7 sysntpd: restore support for peer-less (standalone) mode
1bdd23231b ar71xx: fix Wallys DR344 ethernet MAC addresses offsets
0cb669b469 ugps: fix and improve init script
0dcc4d239d kernel: update kernel 4.4 to 4.4.59

$ ./scripts/getver.sh 
r3300-53fcaed1f7

$ ./scripts/getver.sh 0cb669b469
r3295-0cb669b469

$ ./scripts/getver.sh r3296
1bdd23231b9de6f98b5c51360167abc7b5e92716</pre>

<p>
Recovering git commit from version string
</p>
<pre class="code">lede_source$ git describe
v17.01.4-215-g05f0fac

lede_source$ ./scripts/getver.sh 
r2993+783-b9a408c

lede_source$ ./scripts/getver.sh r2993+783-b9a408c
05f0fac189984981e3f28288e44d9afdd088dd77</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Convert between source revision and git commit hash&quot;,&quot;hid&quot;:&quot;convert_between_source_revision_and_git_commit_hash&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;550-&quot;} -->