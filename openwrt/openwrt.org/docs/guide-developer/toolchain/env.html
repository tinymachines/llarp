
<h1 class="sectionedit1" id="using_build_environments">Using build environments</h1>
<div class="level1">

<p>
OpenWrt provides a means of building images for multiple configurations which can use multiple targets in one single checkout.
These environments store a copy of the <code>.config</code> file generated by <code>make menuconfig</code> and the contents of the <code>files</code> folder.
The script <code>./scripts/env</code> is used to manage these environments, it uses git (which needs to be installed on your system) as backend for version control.
</p>

<p>
Setting up git:
</p>
<pre class="code bash"><span class="kw2">git config</span> <span class="re5">--global</span> user.name <span class="st0">&quot;Your Name&quot;</span>
<span class="kw2">git config</span> <span class="re5">--global</span> user.email <span class="st0">&quot;user@email.com&quot;</span></pre>

<p>
Git requires some name and email address to work so we set them here.
</p>

<p>
A short help text with a list of commands:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> <span class="kw3">help</span></pre>

<p>
Create a new environment named current:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> new current</pre>

<p>
This will move your <code>.config</code> file and <code>files</code> (if it exists) to the <code>env</code> subdirectory and create symlinks in the base folder.
</p>

<p>
After running <code>make menuconfig</code> or changing things in <code>files</code>, your current state will differ from what has been saved before.
To show these changes, use:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> <span class="kw2">diff</span></pre>

<p>
If you want to save these changes, run:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> save</pre>

<p>
If you want to revert your changes to the previously saved copy, run:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> revert</pre>

<p>
If you want, you can now create a second environment using the new command.
It will ask you whether you want to make it a clone of the current environment (e.g. for minor changes) or if you want to start with a clean version (e.g. for selecting a new target).
</p>

<p>
To switch to a different environment (e.g. <code>test1</code>), use:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> switch test1</pre>

<p>
To rename the current branch to a new name (e.g. <code>test2</code>), use:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> rename test2</pre>

<p>
If you want to get rid of environment switching and keep everything in the base directory again, use:
</p>
<pre class="code bash">.<span class="sy0">/</span>scripts<span class="sy0">/</span><span class="kw2">env</span> <span class="kw2">clear</span> </pre>

</div>
