<div class="docnavbar"><div class="leftnav">← <a href="/docs/guide-developer/helloworld/chapter7" class="wikilink1" title="docs:guide-developer:helloworld:chapter7" data-wiki-id="docs:guide-developer:helloworld:chapter7">Previous Chapter </a>&nbsp;</div><div class="rightnav">&nbsp;<a href="/docs/guide-developer/helloworld/chapter8" class="wikilink1" title="docs:guide-developer:helloworld:chapter8" data-wiki-id="docs:guide-developer:helloworld:chapter8">start</a> →</div></div>
<h1 class="sectionedit1" id="patching_your_applicationediting_existing_files">Patching your application: Editing existing files</h1>
<div class="level1">

<p>
This is the seventh chapter in the “Hello, world!” for OpenWrt article series. At this point, you should&#039;ve already accomplished the following tasks:
</p>
<ul>
<li class="level1"><div class="li"> Commissioned your development environment</div>
</li>
<li class="level1"><div class="li"> Prepared, configured and built the tools and the cross-compilation toolchain</div>
</li>
<li class="level1"><div class="li"> Configured the <code>PATH</code> environment variable</div>
</li>
<li class="level1"><div class="li"> Created a simple “Hello, world!” application using native compilation tools</div>
</li>
<li class="level1"><div class="li"> Created a local package feed for your application</div>
</li>
<li class="level1"><div class="li"> Created a package manifest file for your application</div>
</li>
<li class="level1"><div class="li"> Included your new package feed into the OpenWrt build system</div>
</li>
<li class="level1"><div class="li"> Updated the package index, and installed your package from the feed</div>
</li>
<li class="level1"><div class="li"> Built, deployed and tested the application on your target device</div>
</li>
<li class="level1"><div class="li"> Migrated your application to use GNU make</div>
</li>
<li class="level1"><div class="li"> Tested building your application using GNU make</div>
</li>
<li class="level1"><div class="li"> Updated the package manifest to use GNU make as a build tool</div>
</li>
<li class="level1"><div class="li"> Prepared the source code, and created a patch to add new files to the package</div>
</li>
</ul>

<p>
If you missed one or more of these steps, review the previous chapters.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Patching your application: Editing existing files&quot;,&quot;hid&quot;:&quot;patching_your_applicationediting_existing_files&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;92-1207&quot;} -->
<h2 class="sectionedit2" id="creating_the_second_patch">Creating the second patch</h2>
<div class="level2">

<p>
Our first patch that we created in our previous chapter added two new files, and implemented a new function called <code>add</code>. However, this function is not being called yet, so the functionality it provides is going to waste.
</p>

<p>
In order to utilize the functionality, we create an additional patch which modifies the <code>helloworld.c</code> file. First, we prepare the source codes for patching, and create a new patch context:
</p>
<pre class="code bash"><span class="kw3">cd</span> <span class="sy0">/</span>home<span class="sy0">/</span>buildbot<span class="sy0">/</span><span class="kw3">source</span>
<span class="kw2">make</span> package<span class="sy0">/</span>helloworld<span class="sy0">/</span><span class="br0">&#123;</span>clean,prepare<span class="br0">&#125;</span> <span class="re2">QUILT</span>=<span class="nu0">1</span>
<span class="kw3">cd</span> build_dir<span class="sy0">/</span>target-...<span class="sy0">/</span>helloworld-<span class="nu0">1.0</span><span class="sy0">/</span>
quilt push <span class="re5">-a</span>
quilt new <span class="nu0">101</span>-use_module.patch</pre>

<p>
Our task is to modify the <code>helloworld.c</code> file, so we issue the following command to add the file into the patch context, and open it for editing:
</p>
<pre class="code bash">quilt edit helloworld.c</pre>

<p>
Note that since the file already exists, it is not necessary to add the file into the patch context using <code>quilt add</code>. In the previous chapter, we intentionally used this command to highlight the difference between adding a file and editing an existing file.
</p>

<p>
Let&#039;s modify the source file to include our header file, and call the new function:
</p>
<dl class="code">
<dt><a href="/_export/code/docs/guide-developer/helloworld/chapter8?codeblock=2" title="Download Snippet" class="mediafile mf_c">helloworld.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;functions.h&quot;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw4">int</span> result <span class="sy0">=</span> add<span class="br0">&#40;</span><span class="nu0">2</span><span class="sy0">,</span> <span class="nu0">3</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\n</span>Hello, world!<span class="es1">\n</span>The sum is '%d'&quot;</span><span class="sy0">,</span> result<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>     
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
Save your changes, review them using <code>quilt diff</code> and move them to the patch context using <code>quilt refresh</code>. 
</p>

<p>
Finally navigate back to the back to the root folder of the OpenWrt build system and update the package with our new patch. To do so, issue:
</p>
<pre class="code bash"><span class="kw3">cd</span> <span class="sy0">/</span>home<span class="sy0">/</span>buildbot<span class="sy0">/</span><span class="kw3">source</span>
<span class="kw2">make</span> package<span class="sy0">/</span>helloworld<span class="sy0">/</span>update</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Creating the second patch&quot;,&quot;hid&quot;:&quot;creating_the_second_patch&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1208-2915&quot;} -->
<h2 class="sectionedit3" id="conclusion">Conclusion</h2>
<div class="level2">

<p>
In this chapter, we created a second patch that edits existing files in order to take our newly added <code>add</code> function into use. We then finalized the patch and migrated it into the package proper.
</p>

<p>
This concludes the “Hello, world!” for OpenWrt article series.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Conclusion&quot;,&quot;hid&quot;:&quot;conclusion&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:3,&quot;range&quot;:&quot;2916-&quot;} --><div class="clearer"></div><div class="docnavbar showtoc"><div class="leftnav">← <a href="/docs/guide-developer/helloworld/chapter7" class="wikilink1" title="docs:guide-developer:helloworld:chapter7" data-wiki-id="docs:guide-developer:helloworld:chapter7">Previous Chapter </a>&nbsp;</div><div class="centernav"><a href="/docs/guide-developer/helloworld/start" class="wikilink1" title="docs:guide-developer:helloworld:start" data-wiki-id="docs:guide-developer:helloworld:start">Helloworld overview </a>&nbsp;</div><div class="rightnav">&nbsp;<a href="/docs/guide-developer/helloworld/chapter8" class="wikilink1" title="docs:guide-developer:helloworld:chapter8" data-wiki-id="docs:guide-developer:helloworld:chapter8">start</a> →</div></div>