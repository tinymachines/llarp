
<h1 class="sectionedit1" id="hotplug_--_legacy">Hotplug -- Legacy</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:historic&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:historic" id="plugin_include__meta__infobox__historic">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_historic plugin_wrap" style="width: 70%;">
<p>
<strong>Historic information!</strong><br/>

This page contains archived information that is only kept for research purposes. The contents are most likely outdated.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:historic&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="/_media/meta/icons/tango/48px-outdated.svg.png" class="media" loading="lazy" alt="" /> </td><td class="col1 leftalign"> See the <a href="/docs/guide-user/base-system/hotplug" class="wikilink1" title="docs:guide-user:base-system:hotplug" data-wiki-id="docs:guide-user:base-system:hotplug"> Hotplug article</a> for information on the current approach. <br/>
<br/>
The “hotplug2” daemon was removed in 2013 (<a href="https://dev.openwrt.org/changeset/36987" class="urlextern" title="https://dev.openwrt.org/changeset/36987" rel="ugc nofollow">r36987</a>) and replaced with <a href="/docs/techref/procd" class="wikilink1" title="docs:techref:procd" data-wiki-id="docs:techref:procd">procd</a>.   </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;93-406&quot;} -->
<p>
Hotplug2 was a trivial replacement of some of the UDev functionality in a tiny pack, intended for Linux early userspace: Init RAM FS and InitRD. Hotplug executes scripts located in the respective hotplug directory: <code><a href="https://dev.openwrt.org/browser/trunk/package/base-files/files/etc/hotplug.d" class="urlextern" title="https://dev.openwrt.org/browser/trunk/package/base-files/files/etc/hotplug.d" rel="ugc nofollow">/etc/hotplug.d/</a></code> on certain events, like when an interface goes up or down or when a button gets pressed.
It can be very useful with <a href="https://en.wikipedia.org/wiki/Point-to-Point Protocol over Ethernet" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Point-to-Point Protocol over Ethernet">PPPoE</a>-connection or in an unstable network. Hotplug has been available since OpenWrt &#039;Kamikaze&#039; 7.06 and was removed in 2013, prior to the release of “Attitude Adjustment”.
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://dev.openwrt.org/browser/trunk/package/hotplug2?rev=36446" class="urlextern" title="https://dev.openwrt.org/browser/trunk/package/hotplug2?rev=36446" rel="ugc nofollow">https://dev.openwrt.org/browser/trunk/package/hotplug2?rev=36446</a></div>
</li>
</ul>
<div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="/_media/meta/icons/tango/48px-outdated.svg.png" class="media" loading="lazy" alt="" /> </td><td class="col1"> Example: See  <a href="https://dev.openwrt.org/changeset/37336" class="urlextern" title="https://dev.openwrt.org/changeset/37336" rel="ugc nofollow">r37336: procd: make old button hotplug rules work until all packages are migrated</a> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;1133-1329&quot;} -->
<p>
It is also used by <a href="/docs/guide-user/hardware/hardware.button" class="wikilink1" title="docs:guide-user:hardware:hardware.button" data-wiki-id="docs:guide-user:hardware:hardware.button">hardware.button</a>
</p>

</div>

<h4 id="what_is_hotplug">What is hotplug?</h4>
<div class="level4">

<p>
Best answer to this question is found on <a href="http://www.bangmoney.org/presentations/hotplug/" class="urlextern" title="http://www.bangmoney.org/presentations/hotplug/" rel="ugc nofollow">Chris Lumens&#039;s website</a>.
</p>

</div>

<h4 id="how_it_works">How it works</h4>
<div class="level4">

<p>
Every time an interface goes up or down, all scripts in the <code>/etc/hotplug.d/iface/</code> directory are executed, in alphabetical order. According to an informal convention a numeric prefix is added to each script name to set the correct order of running. That&#039;s why the scripts there are named like this:
<code>/etc/hotplug.d/iface/&lt;nn&gt;-&lt;scriptname&gt;</code> e.g.: 10-routes, 20-firewall
</p>

<p>
Kernel module: <code><a href="https://dev.openwrt.org/browser/trunk/package/button-hotplug/src/button-hotplug.c" class="urlextern" title="https://dev.openwrt.org/browser/trunk/package/button-hotplug/src/button-hotplug.c" rel="ugc nofollow">button-hotplug</a></code>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hotplug -- Legacy&quot;,&quot;hid&quot;:&quot;hotplug_--_legacy&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-2056&quot;} -->
<h2 class="sectionedit8" id="configuration">Configuration</h2>
<div class="level2">

<p>
Modify <code>/etc/hotplug2.rules</code> to enable Hotplug execute your script(s) in <code>/etc/hotplug.d/&lt;type&gt;</code>. <code>&lt;type&gt;</code> is a kind of hotplug device; such as usb. In /etc/hotplug2.rules, remove &#039;^&#039; before <code>&lt;type&gt;</code> which can be net, input, button, usb etc.
</p>
<pre class="code">$include /etc/hotplug2-common.rules

SUBSYSTEM ~~ (^net$|^input$|^button$|^usb$|^ieee1394$|^block$|^atm$|^zaptel$|^tty$) {
	exec /sbin/hotplug-call %SUBSYSTEM%
}

DEVICENAME == watchdog {
	exec /sbin/watchdog -t 5 /dev/watchdog
	next-event
}</pre>

<p>
Simply place your script(s) into the respective hotplug subdirectory. Script looks like this:
</p>

<p>
There are three main environment variables that are passed to each iface hotplug-script:
</p>
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Variable name </th><th class="col1"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> ACTION </td><td class="col1"> Either “ifup”  or “ifdown” </td>
	</tr>
	<tr class="row2">
		<td class="col0"> INTERFACE </td><td class="col1"> Name of the interface which went up or down (e.g. “wan” or “ppp0”)</td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEVICE </td><td class="col1"> Physical device name which interface went up or down (e.g. “eth0.1” or “br-lan”)</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;2776-3022&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;2057-3023&quot;} -->
<h2 class="sectionedit10" id="examples">Examples</h2>
<div class="level2">

<p>
Save the example script at <code>/etc/hotplug.d/iface/99-my-action</code>.
</p>
<div class="table sectionedit11"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>#!/bin/sh

[ “$ACTION” = ifup ] &amp;&amp; {
  logger -t button-hotplug Device: $DEVICE / Action: $ACTION
}</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;3112-3219&quot;} -->
<p>
Every time an interface goes up then the if/fi statement will be executed.
</p>

<p>
→ <a href="/docs/guide-user/hardware/hardware.button" class="wikilink1" title="docs:guide-user:hardware:hardware.button" data-wiki-id="docs:guide-user:hardware:hardware.button">hardware.button</a> makes ample use of hotplug.
</p>

<p>
Niii has posted this quick example for a USB WiFi device hotplug event to trigger an init.d network restart wlan0 script.
</p>

<p>
For determine RTL8188SU_PRODID variable, use “lsusb -v”:
</p>
<pre class="code">idVendor           0x0bda Realtek Semiconductor Corp.
idProduct          0x8171 RTL8188SU 802.11n WLAN Adapter
bcdDevice            2.00</pre>

<p>
<strong>/etc/hotplug.d/usb/20-rtl8188su</strong>
</p>
<div class="table sectionedit12"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>#!/bin/sh

BINARY=“/sbin/wifi up”
RTL8188SU_PRODID=“bda/8171/200”

if [ “${PRODUCT}” = “${RTL8188SU_PRODID}” ]; then
    if [ “${ACTION}” = “add” ]; then
        ${BINARY}
    fi
fi</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;3737-3926&quot;} -->
<p>
<strong><code>/etc/hotplug.d/usb/20-cp210x</code></strong>
</p>

<p>
An other script to create a symlink instead of renaming the device.<br/>

I test if DEVICE_NAME is empty because when I plug usb device I retrieve two add event, and the first come before created device, so symlink fails.
</p>
<div class="table sectionedit13"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>#!/bin/sh

CP210_PRODID=“10c4/ea60/100”
SYMLINK=“my_link”

if [ “${PRODUCT}” = “${CP210_PRODID}” ];
   then if [ “${ACTION}” = “add” ];
      then
         DEVICE_NAME=$(ls /sys/$DEVPATH | grep tty)
         if [ -z ${DEVICE_NAME} ];
            then logger -t Hotplug Warning DEVICE_NAME is empty
            exit
         fi
         logger -t Hotplug Device name of cp210 is $DEVICE_NAME
         ln -s /dev/$DEVICE_NAME /dev/${SYMLINK}
         logger -t Hotplug Symlink from /dev/$DEVICE_NAME to /dev/${SYMLINK} created
   fi
fi

if [ “${PRODUCT}” = “${CP210_PRODID}” ];
   then if [ “${ACTION}” = “remove” ];
         then 
         rm /dev/${SYMLINK}
         logger -t Hotplug Symlink /dev/${SYMLINK} removed
   fi
fi</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;4186-4919&quot;} -->
<p>
Script that detects if plugged usb device is bluetooth or not.
</p>
<div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<td class="col0"> <code>#!/bin/sh
BT_PRODID=“a12/1/”
BT_PRODID_HOT=`echo $PRODUCT | cut -c 1-6`

#logger -t HOTPLUG “PRODUCT ID is” $BT_PRODID_HOT

if [ “$BT_PRODID_HOT” = “$BT_PRODID” ]; then
    if [ “$ACTION” = “add” ]; then
        logger -t HOTPLUG “bluetooth device has been plugged in!”
        if [ “$BSBTID_NEW” = “$BSBTID_OLD” ]; then
            logger -t HOTPLUG “bluetooth device hasn&#039;t changed”
        else
            logger -t HOTPLUG “bluetooth device has changed”
        fi
    fi
    if [ “$ACTION” = “remove” ]; then
        logger -t HOTPLUG “bluetooth device has been removed!”
    fi
else
    logger -t HOTPLUG “USB device is not bluetooth”
fi</code> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:14,&quot;range&quot;:&quot;4985-5637&quot;} -->
<p>
Auto start mjpg-streamer when an usb camera is plugged in.
Firstly, remove &#039;^&#039; before &#039;input&#039; in <code>/etc/hotplug2.rules</code> to enable Hotplug execute script(s) in <code>/etc/hotplug.d/input</code>.
Secondly, add <code>/etc/hotplug.d/input/30-mjpg-streamer</code>
</p>
<pre class="code">case &quot;$ACTION&quot; in
    add)
            # start process
        /etc/init.d/mjpg-streamer start
            ;;
    remove)
            # stop process
        /etc/init.d/mjpg-streamer stop
            ;;
esac</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:10,&quot;range&quot;:&quot;3024-6105&quot;} -->
<h2 class="sectionedit15" id="coldplug">Coldplug</h2>
<div class="level2">

<p>
If you had notice the udev and eudev were removed in the openwrt 18.0.* release, don&#039;t be afraid because you still can make the things works.<br/>

<strong>Using hotplug scripts as coldplug</strong><br/>

You just need to pay atention at the ACTION env var, at the boot are executed &#039;bind&#039; actions.<br/>

So, just add this option to hotplug run accordinly. In my case I used this:
</p>

<p>
Take a look into file <code>/etc/hotplug.d/usb/22-symlinks</code>
</p>
<pre class="code">#!/bin/sh
# Description: Action executed on boot (bind) and with the system on the fly
if [ &quot;$ACTION&quot; = &#039;bind&#039; ] ; then
  case &quot;${PRODUCT}&quot; in
    1bc7*) # Telit HE910 3g modules product id prefix
      DEVICE_NAME=$(ls /sys/$DEVPATH | grep tty)
      DEVICE_TTY=$(ls /sys/$DEVPATH/tty/)
      # Module Telit HE910-* connected to minipciexpress slot MAIN
      if [ ${DEVICENAME} = &#039;1-1.3:1.0&#039; ] ; then
        ln -s /dev/$DEVICE_TTY /dev/ttyMODULO1_DIAL
        logger -t Hotplug Symlink from /dev/$DEVICE_TTY to /dev/ttyMODULO1_DIAL created
      elif [ ${DEVICENAME} = &#039;1-1.3:1.6&#039; ] ; then
        ln -s /dev/$DEVICE_TTY /dev/ttyMODULO1_DATA
        logger -t Hotplug Symlink from /dev/$DEVICE_TTY to /dev/ttyMODULO1_DATA created
      # Module Telit HE910-* connected to minipciexpress slot SECONDARY
      elif [ ${DEVICENAME} = &#039;1-1.2:1.0&#039; ] ; then
        ln -s /dev/$DEVICE_TTY /dev/ttyMODULO2_DIAL
        logger -t Hotplug Symlink from /dev/$DEVICE_TTY to /dev/ttyMODULO2_DIAL created
      elif [ ${DEVICENAME} = &#039;1-1.2:1.6&#039; ] ; then
        ln -s /dev/$DEVICE_TTY /dev/ttyMODULO2_DATA
        logger -t Hotplug Symlink from /dev/$DEVICE_TTY to /dev/ttyMODULO2_DATA created
      fi
    ;;
  esac
fi
# Action to remove the symlinks
if [ &quot;$ACTION&quot; = &#039;remove&#039; ]  ; then
  case &quot;${PRODUCT}&quot; in
    1bc7*)  # Telit HE910 3g modules product id prefix
     # Module Telit HE910-* connected to minipciexpress slot MAIN
      if [ ${DEVICENAME} = &#039;1-1.3:1.0&#039; ] ; then
        rm /dev/ttyMODULO1_DIAL
        logger -t Hotplug Symlink /dev/ttyMODULO1_DIAL removed
      elif [ ${DEVICENAME} = &#039;1-1.3:1.6&#039; ] ; then
        rm /dev/ttyMODULO1_DATA
        logger -t Hotplug Symlink /dev/ttyMODULO1_DATA removed
      # Module Telit HE910-* connected to minipciexpress slot SECONDARY
      elif [ ${DEVICENAME} = &#039;1-1.2:1.0&#039; ] ; then
        rm /dev/ttyMODULO2_DIAL
        logger -t Hotplug Symlink /dev/ttyMODULO2_DIAL removed
      elif [ ${DEVICENAME} = &#039;1-1.2:1.6&#039; ] ; then
        rm /dev/ttyMODULO2_DATA
        logger -t Hotplug Symlink /dev/ttyMODULO2_DATA removed
      fi
    ;;
  esac
fi</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Coldplug&quot;,&quot;hid&quot;:&quot;coldplug&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:15,&quot;range&quot;:&quot;6106-8658&quot;} -->
<h3 class="sectionedit16" id="logs_generated_by_coldplug_script_below">Logs generated by Coldplug script below</h3>
<div class="level3">
<pre class="code">root@OpenWrt:~#logread | grep Hotplug
Fri Sep 21 15:31:00 2018 user.notice Hotplug: Symlink from /dev/ttyACM0 to /dev/ttyMODULO2_DIAL created
Fri Sep 21 15:31:06 2018 user.notice Hotplug: Symlink from /dev/ttyACM3 to /dev/ttyMODULO2_DATA created
Fri Sep 21 15:31:39 2018 user.notice Hotplug: Symlink from /dev/ttyACM6 to /dev/ttyMODULO1_DIAL created
Fri Sep 21 15:31:46 2018 user.notice Hotplug: Symlink from /dev/ttyACM9 to /dev/ttyMODULO1_DATA created
Fri Sep 21 15:32:03 2018 user.notice Hotplug: Symlink /dev/ttyMODULO1_DIAL removed
Fri Sep 21 15:32:10 2018 user.notice Hotplug: Symlink /dev/ttyMODULO1_DATA removed
Fri Sep 21 15:33:17 2018 user.notice Hotplug: Symlink /dev/ttyMODULO2_DIAL removed
Fri Sep 21 15:33:24 2018 user.notice Hotplug: Symlink /dev/ttyMODULO2_DATA removed
root@OpenWrt:~#</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Logs generated by Coldplug script below&quot;,&quot;hid&quot;:&quot;logs_generated_by_coldplug_script_below&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;8659-9526&quot;} -->
<h2 class="sectionedit17" id="troubleshoot">Troubleshoot</h2>
<div class="level2">

<p>
If you wish to troubleshoot hotplug of some type of device this can be done via simple debug script. For example to troubleshoot adding and removing of any type of usb devices, simply create this <strong>/etc/hotplug.d/usb/10-usb_debug</strong> script with all variables:
</p>
<pre class="code">#!/bin/sh
logger -t DEBUG &quot;hotplug usb: action=&#039;$ACTION&#039; devicename=&#039;$DEVICENAME&#039; devname=&#039;$DEVNAME&#039; devpath=&#039;$DEVPATH&#039; product=&#039;$PRODUCT&#039; type=&#039;$TYPE&#039; interface=&#039;$INTERFACE&#039;&quot;</pre>

<p>
or this one with only essential ones used:
</p>
<pre class="code">#!/bin/sh
logger -t DEBUG &quot;hotplug usb: action=&#039;$ACTION&#039; product=&#039;$PRODUCT&#039; type=&#039;$TYPE&#039; interface=&#039;$INTERFACE&#039;&quot;</pre>

<p>
So with debuging enabled here is how it looks like when you plug two different usb bluetooth dongles:
</p>
<pre class="code">action=&#039;add&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;&#039;
action=&#039;add&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;
action=&#039;add&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;
action=&#039;add&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;254/1/0&#039;
action=&#039;remove&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;
action=&#039;remove&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;
action=&#039;remove&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;254/1/0&#039;
action=&#039;remove&#039; product=&#039;a12/1/1915&#039; type=&#039;224/1/1&#039; interface=&#039;&#039;
action=&#039;add&#039; product=&#039;a12/1/134&#039; type=&#039;224/1/1&#039; interface=&#039;&#039;
action=&#039;add&#039; product=&#039;a12/1/134&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;
action=&#039;add&#039; product=&#039;a12/1/134&#039; type=&#039;224/1/1&#039; interface=&#039;224/1/1&#039;</pre>

<p>
So my using some (maybe flawed) logic we can deduce that match bluetooth is possible if we use product=&#039;a12/1*&#039;
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Troubleshoot&quot;,&quot;hid&quot;:&quot;troubleshoot&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:17,&quot;range&quot;:&quot;9527-11152&quot;} -->
<h2 class="sectionedit18" id="notes">Notes</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Notes&quot;,&quot;hid&quot;:&quot;notes&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:18,&quot;range&quot;:&quot;11153-&quot;} -->