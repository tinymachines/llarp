
<h1 class="sectionedit1" id="openwrt_file_system_hierarchymemory_usage">OpenWrt File System Hierarchy / Memory Usage</h1>
<div class="level1">
<div class="table sectionedit2"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign" colspan="10">  OpenWrt File System Hierarchy  </th>
	</tr>
	<tr class="row1">
		<th class="col0"> </th><th class="col1 centeralign" colspan="5">  Flash Storage Partitioning (TP-Link WR1043ND)  </th><th class="col6 centeralign" colspan="4">  Main Memory Usage  </th>
	</tr>
	<tr class="row2">
		<th class="col0"> Hardware </th><td class="col1 centeralign" colspan="5">  m25p80 <a href="https://en.wikipedia.org/wiki/spi" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/spi">spi</a>0.0: m25p64 8192 KiB  </td><td class="col6 centeralign" colspan="4">  main memory 32 768 KiB  </td>
	</tr>
	<tr class="row3">
		<th class="col0"> Layer1 </th><td class="col1 centeralign" bgcolor=#de401d>mtd0 <strong><em>u-boot</em></strong> 128 KiB  </td><td class="col2 centeralign" colspan="3" bgcolor=#25540b>mtd5 <strong><em>firmware</em></strong> 8000 KiB  </td><td class="col5 centeralign" bgcolor=#1dbade>mtd4 <strong><em>art</em></strong> 64 KiB  </td><td class="col6 centeralign" bgcolor=#ff00ff>Kernel space 3828 KiB  </td><td class="col7 rightalign" colspan="3" bgcolor=#00ffff>User space 28 940 KiB </td>
	</tr>
	<tr class="row4">
		<th class="col0"> Layer2 </th><td class="col1" bgcolor=#de401d> </td><td class="col2 centeralign" bgcolor=#a11dde>mtd1 <strong><em>kernel</em></strong> 1280 KiB  </td><td class="col3 centeralign" colspan="2" bgcolor=#378712>mtd2 <strong><em>rootfs</em></strong> 6720 KiB  </td><td class="col5" bgcolor=#1dbade> </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7 centeralign" bgcolor=#00ffff>up to 50%  </td><td class="col8 centeralign" bgcolor=#00ffff>512 KiB  </td><td class="col9 centeralign" bgcolor=#00ffff>remaining  </td>
	</tr>
	<tr class="row5">
		<th class="col0"> mountpoint </th><td class="col1" bgcolor=#de401d> </td><td class="col2" bgcolor=#a11dde> </td><td class="col3 centeralign" colspan="2" bgcolor=#378712>/  </td><td class="col5" bgcolor=#1dbade> </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7" bgcolor=#00ffff> </td><td class="col8" bgcolor=#00ffff> </td><td class="col9" bgcolor=#00ffff> </td>
	</tr>
	<tr class="row6">
		<th class="col0"> filesystem </th><td class="col1" bgcolor=#de401d> </td><td class="col2" bgcolor=#a11dde> </td><td class="col3 centeralign" colspan="2" bgcolor=#378712><a href="/docs/techref/filesystems#overlayfs" class="wikilink1" title="docs:techref:filesystems" data-wiki-id="docs:techref:filesystems">overlayfs</a>  </td><td class="col5" bgcolor=#1dbade> </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7" bgcolor=#00ffff> </td><td class="col8" bgcolor=#00ffff> </td><td class="col9" bgcolor=#00ffff> </td>
	</tr>
	<tr class="row7">
		<th class="col0"> Layer3 </th><td class="col1" bgcolor=#de401d> </td><td class="col2" bgcolor=#a11dde> </td><td class="col3 rightalign" bgcolor=#dea11d>1536 KiB </td><td class="col4 centeralign" bgcolor=#5ade1d>mtd3 <strong><em>rootfs_data</em></strong> 5184 KiB  </td><td class="col5" bgcolor=#1dbade> </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7" bgcolor=#00ffff> </td><td class="col8" bgcolor=#00ffff> </td><td class="col9" bgcolor=#00ffff> </td>
	</tr>
	<tr class="row8">
		<th class="col0"> mountpoint </th><td class="col1 centeralign" bgcolor=#de401d>none  </td><td class="col2 centeralign" bgcolor=#a11dde>none  </td><td class="col3 centeralign" bgcolor=#dea11d>/rom  </td><td class="col4 centeralign" bgcolor=#5ade1d>/overlay  </td><td class="col5 centeralign" bgcolor=#1dbade>none  </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7 centeralign" bgcolor=#00ffff>/tmp  </td><td class="col8 centeralign" bgcolor=#00ffff>/dev  </td><td class="col9" bgcolor=#00ffff> </td>
	</tr>
	<tr class="row9">
		<th class="col0"> filesystem </th><td class="col1 centeralign" bgcolor=#de401d>none  </td><td class="col2 centeralign" bgcolor=#a11dde>none  </td><td class="col3 centeralign" bgcolor=#dea11d><a href="/docs/techref/filesystems#squashfs" class="wikilink1" title="docs:techref:filesystems" data-wiki-id="docs:techref:filesystems">SquashFS</a>  </td><td class="col4 centeralign" bgcolor=#5ade1d><a href="/docs/techref/filesystems#jffs2" class="wikilink1" title="docs:techref:filesystems" data-wiki-id="docs:techref:filesystems">JFFS2</a>  </td><td class="col5 centeralign" bgcolor=#1dbade>none  </td><td class="col6" bgcolor=#ff00ff> </td><td class="col7 centeralign" bgcolor=#00ffff><a href="/docs/techref/filesystems#tmpfs" class="wikilink1" title="docs:techref:filesystems" data-wiki-id="docs:techref:filesystems">tmpfs</a>  </td><td class="col8 centeralign" bgcolor=#00ffff><a href="/docs/techref/filesystems#tmpfs" class="wikilink1" title="docs:techref:filesystems" data-wiki-id="docs:techref:filesystems">tmpfs</a>  </td><td class="col9" bgcolor=#00ffff> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;61-1624&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;OpenWrt File System Hierarchy \/ Memory Usage&quot;,&quot;hid&quot;:&quot;openwrt_file_system_hierarchymemory_usage&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1624&quot;} -->
<h3 class="sectionedit3" id="mount_points">Mount Points</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <span style='color:magenta; '><code>/</code></span> this is your entire root filesystem, it comprises <code>/rom</code> and <code>/overlay</code>. Please ignore <code>/rom</code> and <code>/overlay</code> and use exclusively <code>/</code> for your daily routines!</div>
</li>
<li class="level1"><div class="li"> <span style='color:magenta; '><code>/rom</code></span>  contains all the basic files, like <code>busybox</code>, <code>dropbear</code> or <code>iptables</code>. It also includes default configuration files used when booting into <a href="/docs/guide-user/troubleshooting/failsafe_and_factory_reset" class="wikilink1" title="docs:guide-user:troubleshooting:failsafe_and_factory_reset" data-wiki-id="docs:guide-user:troubleshooting:failsafe_and_factory_reset">OpenWrt Failsafe mode</a>. It does not contain the Linux kernel. All files in this directory are located on the SqashFS partition, and thus cannot be altered or deleted. But, because we use overlay_fs filesystem, so called <em>overlay-whiteout</em>-symlinks can be created on the JFFS2 partition.</div>
</li>
<li class="level1"><div class="li"> <span style='color:magenta; '><code>/overlay</code></span>  is the writable part of the file system that gets merged with <code>/rom</code> to create a uniform <code>/</code>-tree. It contains anything that was written to the router after <a href="/docs/guide-user/installation/generic.flashing" class="wikilink1" title="docs:guide-user:installation:generic.flashing" data-wiki-id="docs:guide-user:installation:generic.flashing">installation</a>, e.g. changed configuration files, additional packages installed with <code><a href="/docs/guide-user/additional-software/opkg" class="wikilink1" title="docs:guide-user:additional-software:opkg" data-wiki-id="docs:guide-user:additional-software:opkg">opkg</a></code>, etc. It is formated with JFFS2.<br/>
Rather than deleting the files, insert a whiteout, a special high-priority entry that marks the file as deleted. File system code that sees a whiteout entry for file F behaves as if F does not exist.<br/>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="co0"># shows all overlay-whiteout symlinks in the directory /overlay</span>
&nbsp;
<span class="kw2">find</span> <span class="sy0">/</span>overlay <span class="re5">-type</span> l <span class="sy0">|</span> <span class="kw1">while</span> <span class="kw3">read</span> FILE
  <span class="kw1">do</span>
    <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$FILE</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">break</span>
    <span class="kw1">if</span> <span class="kw2">ls</span> <span class="re5">-la</span> <span class="st0">&quot;<span class="es2">$FILE</span>&quot;</span> <span class="nu0">2</span><span class="sy0">&gt;&amp;</span>- <span class="sy0">|</span> <span class="kw2">grep</span> <span class="re5">-q</span> <span class="st_h">'(overlay-whiteout)'</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;<span class="es2">$FILE</span>&quot;</span>
    <span class="kw1">fi</span>
  <span class="kw1">done</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <span style='color:magenta; '><code>/tmp</code></span> is a tmpfs-partition  <pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="co0"># shows current size of the tmpfs-partition mounted to /tmp</span>
calc_tmpfs_size<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="re2">pi_size</span>=$<span class="br0">&#40;</span><span class="kw2">awk</span> <span class="st_h">'/MemTotal:/ {l=10485760;mt=($2*1024);print((s=mt/2)&lt;l)&amp;&amp;(mt&gt;l)?mt-l:s}'</span> <span class="sy0">/</span>proc<span class="sy0">/</span>meminfo<span class="br0">&#41;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>
<span class="kw3">echo</span> <span class="re1">$pi_size</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <span style='color:magenta; '><code>/dev</code></span> <a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=2b2af54a5bb6f7e80ccf78f20084b93c398c3a8b" class="urlextern" title="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=2b2af54a5bb6f7e80ccf78f20084b93c398c3a8b" rel="ugc nofollow">Driver Core: devtmpfs - kernel-maintained tmpfs-based /dev</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Mount Points&quot;,&quot;hid&quot;:&quot;mount_points&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1625-3766&quot;} -->
<h2 class="sectionedit4" id="history">History</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> early OpenWrt-versions: the rootfs was readonly and only NVRAM-variables could be edited</div>
</li>
<li class="level1"><div class="li"> symlink approach</div>
</li>
<li class="level1"><div class="li"> mini_fo <a href="https://dev.openwrt.org/changeset/3667" class="urlextern" title="https://dev.openwrt.org/changeset/3667" rel="ugc nofollow">r3667 add mini_fo patches to mount_root and firstboot</a> and <a href="https://dev.openwrt.org/changeset/3669" class="urlextern" title="https://dev.openwrt.org/changeset/3669" rel="ugc nofollow">r3669 mini_fo works</a> and <a href="https://dev.openwrt.org/changeset/3928" class="urlextern" title="https://dev.openwrt.org/changeset/3928" rel="ugc nofollow">r3928  enabled mini_fo by default</a></div>
</li>
<li class="level1"><div class="li"> overlayfs <a href="https://dev.openwrt.org/changeset/26209" class="urlextern" title="https://dev.openwrt.org/changeset/26209" rel="ugc nofollow">r26209 kernel: replace mini_fo with overlayfs for 2.6.37</a> and <a href="https://dev.openwrt.org/changeset/26213" class="urlextern" title="https://dev.openwrt.org/changeset/26213" rel="ugc nofollow">r26213 kernel: replace mini_fo with overlayfs for 2.6.38</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;History&quot;,&quot;hid&quot;:&quot;history&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;3767-&quot;} -->