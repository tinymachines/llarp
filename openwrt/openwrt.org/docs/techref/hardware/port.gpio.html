
<h1 class="sectionedit1" id="gpio">GPIO</h1>
<div class="level1">

<p>
Read <a href="https://en.wikipedia.org/wiki/General Purpose Input/Output" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/General Purpose Input/Output">General Purpose Input/Output</a> and <a href="https://www.kernel.org/doc/Documentation/gpio/" class="urlextern" title="https://www.kernel.org/doc/Documentation/gpio/" rel="ugc nofollow">GPIO documentation in Linux</a>.
</p>
<ul>
<li class="level1"><div class="li"> <a href="/docs/guide-user/hardware/mmc_over_gpio" class="wikilink1" title="docs:guide-user:hardware:mmc_over_gpio" data-wiki-id="docs:guide-user:hardware:mmc_over_gpio">mmc_over_gpio</a></div>
</li>
<li class="level1"><div class="li"> <a href="/toh/tp-link/tl-wr1043nd#gpios" class="wikilink1" title="toh:tp-link:tl-wr1043nd" data-wiki-id="toh:tp-link:tl-wr1043nd">GPIOs of AR913x SoC</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://oldwiki.archive.openwrt.org/oldwiki/port.gpio" class="urlextern" title="https://oldwiki.archive.openwrt.org/oldwiki/port.gpio" rel="ugc nofollow">oldwiki GPIO</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;GPIO&quot;,&quot;hid&quot;:&quot;gpio&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-325&quot;} -->
<h2 class="sectionedit2" id="hardware">Hardware</h2>
<div class="level2">

<p>
GPIOs are commonly used in router devices for buttons or leds. They only safely supply or sink (pull to GND) a maximum of 4mA approx., and the voltage is usually 3.3V when active. Only two states are possible: high or low. Depending on how a device is activated by a GPIO, active low or active high is defined.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Active high</strong>: the device is activated when the GPIO is HIGH</div>
</li>
<li class="level1"><div class="li"> <strong>Active low</strong>: the device is activated when the GPIO is LOW</div>
</li>
</ul>

<p>
In this image you can see how a GPIO is wired to buttons or leds, to work as active low or high
<br/>
<br/>
<a href="/_detail/media/doc/hardware/gpio_high_low.png?id=docs%3Atechref%3Ahardware%3Aport.gpio" class="media" title="media:doc:hardware:gpio_high_low.png"><img src="/_media/media/doc/hardware/gpio_high_low.png?w=600&amp;tok=f643a7" class="media" loading="lazy" alt="" width="600" /></a><br/>
<br/>

</p>

<p>
<strong>GPIOs can be used for complex tasks:</strong>
</p>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<td class="col0"> </td><th class="col1"> kernel module </th><th class="col2"> packaged </th><th class="col3"> description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <a href="/docs/techref/hardware/port.gpio/1-wire" class="wikilink1" title="docs:techref:hardware:port.gpio:1-wire" data-wiki-id="docs:techref:hardware:port.gpio:1-wire">1-wire</a> </td><td class="col1"> kmod-w1-master-gpio </td><td class="col2"> ✔ </td><td class="col3"> 1-wire bus master </td>
	</tr>
	<tr class="row2">
		<td class="col0" rowspan="3"> <a href="/docs/techref/hardware/port.gpio/expanders" class="wikilink2" title="docs:techref:hardware:port.gpio:expanders" rel="nofollow" data-wiki-id="docs:techref:hardware:port.gpio:expanders">GPIO expanders</a> </td><td class="col1"> kmod-gpio-pcf857x<br/>
kmod-gpio-pca953x </td><td class="col2"> ✔ </td><td class="col3"> i2c GPIO expander </td>
	</tr>
	<tr class="row3">
		<td class="col0"> kmod-gpio-nxp-74hc164 </td><td class="col1"> ✔ </td><td class="col2"> SPI GPIO expander </td>
	</tr>
	<tr class="row4">
		<td class="col0"> kmod-gpio-mcp23s08 </td><td class="col1"> ✔ </td><td class="col2"> i2c/SPI GPIO expander </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <a href="/docs/guide-user/hardware/pwm" class="wikilink1" title="docs:guide-user:hardware:pwm" data-wiki-id="docs:guide-user:hardware:pwm">pwm</a> </td><td class="col1"> kmod-pwm-gpio </td><td class="col2"> removed since <a href="https://dev.openwrt.org/changeset/37490" class="urlextern" title="https://dev.openwrt.org/changeset/37490" rel="ugc nofollow">r37490</a> </td><td class="col3"> pulse width modulator </td>
	</tr>
	<tr class="row6">
		<td class="col0" rowspan="2"> <a href="/docs/techref/hardware/port.gpio/spi" class="wikilink2" title="docs:techref:hardware:port.gpio:spi" rel="nofollow" data-wiki-id="docs:techref:hardware:port.gpio:spi">spi</a> </td><td class="col1"> kmod-spi-gpio </td><td class="col2"> ✔ </td><td class="col3"> bitbanging Serial Peripheral Interface </td>
	</tr>
	<tr class="row7">
		<td class="col0"> kmod-mmc-over-gpio </td><td class="col1"> ✔ </td><td class="col2"> <a href="/docs/guide-user/hardware/mmc_over_gpio" class="wikilink1" title="docs:guide-user:hardware:mmc_over_gpio" data-wiki-id="docs:guide-user:hardware:mmc_over_gpio">MMC/SD card over GPIO</a> </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <a href="/docs/techref/hardware/port.i2c" class="wikilink1" title="docs:techref:hardware:port.i2c" data-wiki-id="docs:techref:hardware:port.i2c">I2C</a> </td><td class="col1"> kmod-i2c-gpio </td><td class="col2"> ✔ </td><td class="col3"> bitbanging I2C </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <a href="/docs/guide-user/hardware/lirc" class="wikilink1" title="docs:guide-user:hardware:lirc" data-wiki-id="docs:guide-user:hardware:lirc">lirc</a> </td><td class="col1"> kmod-lirc_gpio_generic </td><td class="col2"> ☐ </td><td class="col3"> Linux Infrared Remote Control </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <a href="/docs/guide-user/hardware/lirc-gpioblaster" class="wikilink1" title="docs:guide-user:hardware:lirc-gpioblaster" data-wiki-id="docs:guide-user:hardware:lirc-gpioblaster">LIRC GPIO blaster</a> </td><td class="col1"> kmod-lirc_gpioblaster </td><td class="col2"> ☐ </td><td class="col3"> LIRC transmitter only </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <a href="/docs/techref/hardware/port.gp/pps" class="wikilink2" title="docs:techref:hardware:port.gp:pps" rel="nofollow" data-wiki-id="docs:techref:hardware:port.gp:pps">PPS</a> </td><td class="col1"> kmod-pps-gpio </td><td class="col2"> ✔ </td><td class="col3"> Pulse Per Second GPIO client </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <a href="/docs/techref/hardware/port.gpio/rotary_encoder" class="wikilink2" title="docs:techref:hardware:port.gpio:rotary_encoder" rel="nofollow" data-wiki-id="docs:techref:hardware:port.gpio:rotary_encoder">rotary_encoder</a> </td><td class="col1"> kmod-input-gpio-encoder </td><td class="col2"> ✔ </td><td class="col3"> GPIO rotary encoder </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <a href="/docs/techref/hardware/port.gpio/custom_rotary_encoder" class="wikilink2" title="docs:techref:hardware:port.gpio:custom_rotary_encoder" rel="nofollow" data-wiki-id="docs:techref:hardware:port.gpio:custom_rotary_encoder">custom_rotary_encoder</a> </td><td class="col1"> kmod-rotary-gpio-custom </td><td class="col2"> ✔ </td><td class="col3"> Custom GPIO rotary encoder </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <a href="https://github.com/wendlers/rcswitch-kmod" class="urlextern" title="https://github.com/wendlers/rcswitch-kmod" rel="ugc nofollow">rcswitch-kmod</a> </td><td class="col1"> rcswitch-kmod </td><td class="col2"> ☐ </td><td class="col3"> 433 <abbr title="Megahertz">MHz</abbr> RC power outlets (switches) </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;987-2509&quot;} -->
<p>
You can connect 5V digital signal sensors if you use a voltage divider to get a 3.3V range signal.You need to get acces to GND and 5V-power from the router and connect the sensor to them.
Sensor signal output is in the 5V range, connect it to the voltage divider!
<br/>
<br/>
<a href="/_detail/media/voltagedividergpio.jpg?id=docs%3Atechref%3Ahardware%3Aport.gpio" class="media" title="media:voltagedividergpio.jpg"><img src="/_media/media/voltagedividergpio.jpg?w=200&amp;tok=003831" class="media" loading="lazy" alt="" width="200" /></a> <a href="/_detail/media/5vsignal.jpg?id=docs%3Atechref%3Ahardware%3Aport.gpio" class="media" title="media:5vsignal.jpg"><img src="/_media/media/5vsignal.jpg?w=200&amp;tok=b76ae7" class="media" loading="lazy" alt="" width="200" /></a><br/>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Hardware&quot;,&quot;hid&quot;:&quot;hardware&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;326-2855&quot;} -->
<h3 class="sectionedit4" id="pin_multiplexing">Pin Multiplexing</h3>
<div class="level3">

<p>
Pin <a href="https://en.wikipedia.org/wiki/multiplexer" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/multiplexer">multiplexing</a> is used by manufacturers to accommodate the largest number of peripheral functions in the smallest possible package. 
</p>

<p>
Many times some GPIOs cannot be controlled by the kernel because they are multiplexed, and they are not acting as GPIOs. It might be possible to undo the multiplexing by writing some particular software programmable register settings, and then recover the GPIO functionality. But probably on most cases those GPIOs were multiplexed for some good reason, like using a <a href="/docs/techref/hardware/soc" class="wikilink1" title="docs:techref:hardware:soc" data-wiki-id="docs:techref:hardware:soc">SoC</a> pin  for a signal on an ethernet phy, SPI, PCI, UART or another purpose.
</p>
<ul>
<li class="level1"><div class="li"> Example 1: on the Broadcom BCM6328 SoC, GPIO pins 25, 26, 27 and 28 are used to indicate the <abbr title="Local Area Network">LAN</abbr> activity with hardware controlled LEDs. The memory register for setting this multiplexing is at 0x1000009C address, 64bits wide. Let&#039;s read it in OpenWrt<br/>
<pre class="code">root@OpenWrt:/# devmem 0x1000009C 64
0x0154000000000000</pre>

<p>
<br/>
<img src="/_media/media/doc/hardware/bcm6328-lan-led_pinmux-bits.png" class="media" loading="lazy" alt="" /><br/>
These enabled bits are enabling every <abbr title="Local Area Network">LAN</abbr> LED to be controlled by hardware, therefore they cannot be controlled as regular GPIO&#039;s<br/>
 Let&#039;s disable this multiplexing for all LEDs<br/>

</p>
<pre class="code">root@OpenWrt:/# devmem 0x1000009C 64 0x0</pre>

<p>
<br/>
Now we can export these GPIOs and control them via software.
</p>
</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> Example 2: on the Atheros AR7240 SoC, GPIO pins 6, 7 and 8 are used by the JTAG interface. The memory register for AR7240 GPIO pinmux is at 0x18040028 address, 32 bits wide. Let&#039;s read it:<br/>
<pre class="code">root@OpenWrt:/# devmem 0x18040028 32
0x48002</pre>

<p>
<br/>
The bit0 disables JTAG multiplexing, then we must set this bit to 1, in other words, write the value 0x48003<br/>

</p>
<pre class="code">root@OpenWrt:/# devmem 0x18040028 32 0x48003</pre>

<p>
<br/>
Now we can control these GPIO pins (GPIO6, GPIO7 and GPIO8)
</p>
</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Pin Multiplexing&quot;,&quot;hid&quot;:&quot;pin_multiplexing&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2856-4690&quot;} -->
<h3 class="sectionedit5" id="gpio_interrupts">GPIO Interrupts</h3>
<div class="level3">

<p>
GPIO interrupts are useful when a GPIO is used as input and you need to manage high signal frequencies. Without interrupts, GPIO inputs must be managed using the <strong>polling</strong> method. With polling you cannot manage signal inputs with high frequencies, but still can be used for simple tasks like reading the input on the device buttons. 
</p>

<p>
GPIO IRQs are also useful for detecting the edge from an input, it can be rising or falling. Some GPIO drivers also need this feature.
</p>

<p>
Not all boards have GPIO interrupts, or the GPIO kernel drivers don&#039;t provide IRQs because they aren&#039;t still implemented. As a result of this, some input drivers listed above (requiring GPIO IRQs) won&#039;t work in these boards.
</p>

<p>
Example: ar71xx target has GPIO IRQs since <a href="https://dev.openwrt.org/changeset/46339/" class="urlextern" title="https://dev.openwrt.org/changeset/46339/" rel="ugc nofollow">r46339</a> (Linux kernel 3.18)<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;GPIO Interrupts&quot;,&quot;hid&quot;:&quot;gpio_interrupts&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:5,&quot;range&quot;:&quot;4691-5533&quot;} -->
<h2 class="sectionedit6" id="software">Software</h2>
<div class="level2">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_round wrap_info plugin_wrap" style="width: 100%;">
<p>
<strong>The GPIO SYSFS interface has been marked as obsolete in 2015. I couldn&#039;t get the following scripts to work. This page needs an overhaul.</strong>
</p>

<p>
The new interface is the linux GPIO character device. One way to access it is <a href="https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/tree/README" class="urlextern" title="https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/tree/README" rel="ugc nofollow">libgpiod</a>.
</p>

<p>
You can install it with the <a href="/packages/pkgdata/gpiod-tools" class="wikilink1" title="packages:pkgdata:gpiod-tools" data-wiki-id="packages:pkgdata:gpiod-tools">gpiod-tools</a> package like this:
</p>
<pre class="code bash">opkg update
opkg <span class="kw2">install</span> gpiod-tools</pre>

<p>
A good article on how to use the new CLI and why we should move on: <a href="https://www.thegoodpenguin.co.uk/blog/stop-using-sys-class-gpio-its-deprecated/" class="urlextern" title="https://www.thegoodpenguin.co.uk/blog/stop-using-sys-class-gpio-its-deprecated/" rel="ugc nofollow">Stop using /sys/class/gpio – it’s deprecated</a>
</p>

<p>
The biggest differences are:
</p>
<ul>
<li class="level1"><div class="li"> The new interface isn&#039;t stateless like the old one. Processes are able to take exclusive control over a gpio line now</div>
</li>
<li class="level1"><div class="li"> There is a character device /dev/gpiochipX for each gpio chip found in the system</div>
</li>
<li class="level1"><div class="li"> TODO</div>
</li>
</ul>

<p>
As I said: This page needs an overhaul. This info box is just to prevent people from wasting their time on a deprecated ABI.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} -->
<p>
In linux GPIOs can be accessed through GPIO SYSFS interface: <strong>/sys/class/gpio/</strong>
</p>

<p>
<strong>Example</strong><br/>

In this example we will use GPIO29 and use it as a switch.
</p>

<p>
With latest linux kernels you may need to first get the gpio base
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span>base <span class="sy0">|</span> <span class="kw2">head</span> <span class="re5">-n1</span>
<span class="nu0">200</span></pre>

<p>
and sum the base to your GPIO:<br/>
<code>200 + 29 = 229</code>
</p>

<p>
Now first step is making GPIO available in Linux:
</p>
<pre class="code">echo &quot;229&quot; &gt; /sys/class/gpio/export</pre>

<p>
then you need to decide if it will be input or output, as we will use it as a switch so we need output
</p>
<pre class="code">echo &quot;out&quot; &gt; /sys/class/gpio/gpio229/direction</pre>

<p>
and last line turns GPIO on or off with 1 or 0:
</p>
<pre class="code">echo &quot;1&quot; &gt; /sys/class/gpio/gpio229/value</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Software&quot;,&quot;hid&quot;:&quot;software&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:6,&quot;range&quot;:&quot;5534-7311&quot;} -->
<h3 class="sectionedit9" id="utilities">Utilities</h3>
<div class="level3">

<p>
To control GPIOs you can use <strong>gpioctl-sysfs</strong>. Also with this simple script you can control GPIOs not used by buttons or leds.
</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
&nbsp;
show_usage<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw3">printf</span> <span class="st0">&quot;<span class="es1">\n</span>gpio.sh &lt;gpio pin number&gt; [in|out [&lt;value&gt;]]<span class="es1">\n</span>&quot;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> \<span class="br0">&#40;</span> <span class="re4">$#</span> <span class="re5">-eq</span> <span class="nu0">0</span> \<span class="br0">&#41;</span> <span class="re5">-o</span> \<span class="br0">&#40;</span> <span class="re4">$#</span> <span class="re5">-gt</span> <span class="nu0">3</span> \<span class="br0">&#41;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
    show_usage
    <span class="kw3">printf</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>ERROR: incorrect number of parameters<span class="es1">\n</span>&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">255</span>
<span class="kw1">fi</span>
&nbsp;
<span class="re2">GPIOBASE</span>=<span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span>base <span class="sy0">|</span> <span class="kw2">head</span> -n1<span class="sy0">`</span>
<span class="re2">GPIO</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$1</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
&nbsp;
<span class="co0">#doesn't hurt to export a gpio more than once</span>
<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$GPIO</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span><span class="kw3">export</span><span class="br0">&#41;</span> <span class="sy0">&gt;&amp;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span>  <span class="re4">$#</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
   <span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$GPIO</span><span class="sy0">/</span>value
   <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> \<span class="br0">&#40;</span> <span class="st0">&quot;$2&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;in&quot;</span> \<span class="br0">&#41;</span> <span class="re5">-a</span>  \<span class="br0">&#40;</span> <span class="st0">&quot;$2&quot;</span> <span class="sy0">!</span>= <span class="st0">&quot;out&quot;</span> \<span class="br0">&#41;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
    show_usage
    <span class="kw3">printf</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es1">\n</span>ERROR: second parameter must be 'in' or 'out'<span class="es1">\n</span>&quot;</span>
    <span class="kw3">exit</span> <span class="nu0">255</span>
<span class="kw1">fi</span>
&nbsp;
<span class="kw3">echo</span> <span class="re4">$2</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$GPIO</span><span class="sy0">/</span>direction
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span>  <span class="re4">$#</span> <span class="re5">-eq</span> <span class="nu0">2</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
   <span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$GPIO</span><span class="sy0">/</span>value
   <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
&nbsp;
&nbsp;
<span class="re2">VAL</span>=<span class="re4">$3</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$VAL</span> <span class="re5">-ne</span> <span class="nu0">0</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
    <span class="re2">VAL</span>=<span class="nu0">1</span>
<span class="kw1">fi</span>
&nbsp;
<span class="kw3">echo</span> <span class="re1">$VAL</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$GPIO</span><span class="sy0">/</span>value  </pre>

<p>
Save the script  somewhere with the name <em>gpiocontrol.sh</em> an give it execution permissions:
</p>
<blockquote><div class="no">
<code>chmod +x gpiocontrol.sh</code></div></blockquote>

<p>
Example, put the GPIO14 on HIGH state:
</p>
<blockquote><div class="no">
<code>./gpiocontrol.sh 14 out 1</code></div></blockquote>

<p>
Read the input value of GPIO14:
</p>
<blockquote><div class="no">
<code>./gpiocontrol.sh 14 in</code></div></blockquote>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Utilities&quot;,&quot;hid&quot;:&quot;utilities&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:9,&quot;range&quot;:&quot;7312-8605&quot;} -->
<h2 class="sectionedit10" id="finding_gpio_pins_on_the_pcb">Finding GPIO pins on the PCB</h2>
<div class="level2">

<p>
Sometimes you do not know where the physical GPIO pins are on your device&#039;s PCB. In that case, you can use this little script and a multimeter to find out.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Finding GPIO pins on the PCB&quot;,&quot;hid&quot;:&quot;finding_gpio_pins_on_the_pcb&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:10,&quot;range&quot;:&quot;8606-8804&quot;} -->
<h3 class="sectionedit11" id="script_blink">script &quot;blink&quot;</h3>
<div class="level3">
<pre class="code bash"><span class="co0">#!/bin/sh</span>
&nbsp;
<span class="re2">GPIOBASE</span>=<span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span>base <span class="sy0">|</span> <span class="kw2">head</span> -n1<span class="sy0">`</span>
<span class="re2">GPIOmin</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$1</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
<span class="re2">GPIOmax</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$2</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
<span class="re2">nums</span>=<span class="sy0">`</span><span class="kw2">seq</span> <span class="re1">$GPIOmin</span> <span class="re1">$GPIOmax</span><span class="sy0">`</span> 
&nbsp;
<span class="kw3">cd</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio
<span class="kw1">for</span> i <span class="kw1">in</span> <span class="re1">$nums</span>; <span class="kw1">do</span>
<span class="kw3">echo</span> <span class="re1">$i</span> <span class="sy0">&gt;</span> <span class="kw3">export</span>; <span class="kw3">echo</span> out <span class="sy0">&gt;</span>gpio<span class="re1">$i</span><span class="sy0">/</span>direction
<span class="kw1">done</span>
&nbsp;
<span class="kw1">while</span> <span class="kw2">true</span>; <span class="kw1">do</span>
  <span class="kw1">for</span> i <span class="kw1">in</span> <span class="re1">$nums</span>; <span class="kw1">do</span>
     <span class="kw3">echo</span> <span class="nu0">0</span> <span class="sy0">&gt;</span> gpio<span class="re1">$i</span><span class="sy0">/</span>value
 <span class="kw1">done</span>
  <span class="kw2">sleep</span> <span class="nu0">1</span>
  <span class="kw1">for</span> i <span class="kw1">in</span> <span class="re1">$nums</span>; <span class="kw1">do</span>
     <span class="kw3">echo</span> <span class="nu0">1</span> <span class="sy0">&gt;</span> gpio<span class="re1">$i</span><span class="sy0">/</span>value
  <span class="kw1">done</span>
  <span class="kw2">sleep</span> <span class="nu0">1</span>
<span class="kw1">done</span></pre>
<ol>
<li class="level1"><div class="li"> Start with <code>./gpio 0 30</code>, which means pin 0 to 30</div>
</li>
<li class="level1"><div class="li"> Press ctrl-c to stop the script, then check which GPIOs have been created: <code>find /sys/class/gpio/gpio*</code></div>
</li>
<li class="level1"><div class="li"> Restart the script and measure with a multimeter which pins “blink”.</div>
</li>
<li class="level1"><div class="li"> When you find one, then cut the 0-30 range from above in half;</div>
</li>
<li class="level1"><div class="li"> Repeat until you have identified the gpio number</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;script \&quot;blink\&quot;&quot;,&quot;hid&quot;:&quot;script_blink&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:11,&quot;range&quot;:&quot;8805-9608&quot;} -->
<h3 class="sectionedit12" id="script_static">script &quot;static&quot;</h3>
<div class="level3">
<pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="re2">GPIOBASE</span>=<span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span>base <span class="sy0">|</span> <span class="kw2">head</span> -n1<span class="sy0">`</span>
<span class="re2">GPIOmin</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$1</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
<span class="re2">GPIOmax</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$2</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
&nbsp;
<span class="kw3">cd</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio
<span class="kw1">for</span> i <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">seq</span> <span class="re1">$GPIOmin</span> <span class="re1">$GPIOmax</span><span class="sy0">`</span>; <span class="kw1">do</span>
     <span class="kw3">echo</span> <span class="st0">&quot;[GPIO<span class="es2">$i</span>] Trying value $3&quot;</span>
     <span class="kw3">echo</span> <span class="re1">$i</span> <span class="sy0">&gt;</span> <span class="kw3">export</span>; <span class="kw3">echo</span> out <span class="sy0">&gt;</span>gpio<span class="re1">$i</span><span class="sy0">/</span>direction
     <span class="kw3">echo</span> <span class="re4">$3</span> <span class="sy0">&gt;</span> gpio<span class="re1">$i</span><span class="sy0">/</span>value
     <span class="kw3">echo</span> <span class="re1">$i</span> <span class="sy0">&gt;</span> unexport
<span class="kw1">done</span></pre>
<ol>
<li class="level1"><div class="li"> Measure continuosuly the voltage of the pin where you suspect there is a GPIO wired, with a multimeter or another device.</div>
</li>
<li class="level1"><div class="li"> Put all GPIOs on HIGH state <code>./gpio 0 31 1</code> </div>
</li>
<li class="level1"><div class="li"> Put all GPIOs on LOW state <code>./gpio 0 31 0</code> </div>
</li>
<li class="level1"><div class="li"> If the pin changes the voltage, then cut the 0-31 range from above in half <code>./gpio 16 31 1</code></div>
</li>
<li class="level1"><div class="li"> If the pin doesn&#039;t change the voltage,then use the other half range <code>./gpio 0 15 1</code></div>
</li>
<li class="level1"><div class="li"> Cut again the new range.</div>
</li>
<li class="level1"><div class="li"> Repeat until you have identified the gpio number</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;script \&quot;static\&quot;&quot;,&quot;hid&quot;:&quot;script_static&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:12,&quot;range&quot;:&quot;9609-10481&quot;} -->
<h3 class="sectionedit13" id="script_blink_all">script &quot;blink all&quot;</h3>
<div class="level3">

<p>
Another script to look for GPIO connected to LED
</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="co0"># Modified from https://gist.github.com/huzhifeng/e3c222e6b780d82967db</span>
<span class="kw3">echo</span> GPIO LED Test
<span class="kw3">echo</span>   Usage: <span class="re4">$0</span> <span class="br0">&#91;</span><span class="kw3">wait</span> <span class="kw1">time</span><span class="br0">&#93;</span> <span class="br0">&#91;</span>gpio start<span class="br0">&#93;</span> <span class="br0">&#91;</span>gpio end<span class="br0">&#93;</span>
<span class="kw3">echo</span> Example: <span class="re4">$0</span> 3s <span class="nu0">0</span> <span class="nu0">1</span>
<span class="kw3">echo</span> leave gpio range blank to <span class="kw3">test</span> all GPIOs.
<span class="kw3">echo</span>
<span class="re2">wait</span>=<span class="co1">${1:-&quot;3s&quot;}</span>
<span class="kw1">for</span> GPIOCHIP <span class="kw1">in</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span> ; <span class="kw1">do</span>
    <span class="re2">BASE</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="co1">${GPIOCHIP}</span>base<span class="br0">&#41;</span>
    <span class="re2">SIZE</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="co1">${GPIOCHIP}</span>ngpio<span class="br0">&#41;</span>
    <span class="re2">MAX</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$BASE</span>+<span class="re1">$SIZE</span>-<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="re2">gpio_end</span>=<span class="co1">${3:-$MAX}</span>
    <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$gpio</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="re2">gpio</span>=<span class="co1">${2:-$BASE}</span>
    <span class="kw1">while</span> <span class="br0">&#91;</span> <span class="re1">$gpio</span> <span class="re5">-ge</span> <span class="re1">$BASE</span> <span class="re5">-a</span> <span class="re1">$gpio</span> <span class="re5">-le</span> <span class="re1">$MAX</span> <span class="re5">-a</span> <span class="re1">$gpio</span> <span class="re5">-le</span> <span class="re1">$gpio_end</span> <span class="br0">&#93;</span> ; <span class="kw1">do</span>
        <span class="co0"># Save original value if needed</span>
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            <span class="re2">DIRECTION</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>direction<span class="br0">&#41;</span>
            <span class="re2">UNEXPORT</span>=<span class="nu0">0</span>
            <span class="re2">VALUE</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$gpio</span><span class="sy0">/</span>value<span class="br0">&#41;</span>
        <span class="kw1">else</span>
            <span class="kw3">echo</span> <span class="re1">$gpio</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span><span class="kw3">export</span>
            <span class="re2">UNEXPORT</span>=<span class="nu0">1</span>
            <span class="re2">DIRECTION</span>=<span class="st0">&quot;&quot;</span>
            <span class="re2">VALUE</span>=<span class="st0">&quot;&quot;</span>
        <span class="kw1">fi</span>
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            <span class="kw3">echo</span> out <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$gpio</span><span class="sy0">/</span>direction
&nbsp;
            <span class="kw3">echo</span> <span class="st0">&quot;[gpiochip<span class="es3">${BASE}</span>:<span class="es2">$gpio</span>:out] = 0&quot;</span>
            <span class="kw3">echo</span> <span class="nu0">0</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$gpio</span><span class="sy0">/</span>value
            <span class="kw2">sleep</span> <span class="re1">$wait</span>
&nbsp;
            <span class="kw3">echo</span> <span class="st0">&quot;[gpiochip<span class="es3">${BASE}</span>:<span class="es2">$gpio</span>:out] = 1&quot;</span>
            <span class="kw3">echo</span> <span class="nu0">1</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$gpio</span><span class="sy0">/</span>value
            <span class="kw2">sleep</span> <span class="re1">$wait</span>
&nbsp;
            <span class="co0"># Restore original value</span>
            <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$DIRECTION</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="re1">$DIRECTION</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>direction
            <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$VALUE</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="re1">$VALUE</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>value
            <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$UNEXPORT</span>&quot;</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="co1">${gpio}</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>unexport
        <span class="kw1">else</span>
            <span class="kw3">echo</span> <span class="st0">&quot;[gpiochip<span class="es3">${BASE}</span>:<span class="es3">${gpio}</span>] = Failed to export&quot;</span>
        <span class="kw1">fi</span>
&nbsp;
        <span class="re2">gpio</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span>gpio+<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="kw1">done</span>
<span class="kw1">done</span></pre>
<ol>
<li class="level1"><div class="li"> Run the script, the script can loop all GPIOs</div>
</li>
<li class="level1"><div class="li"> Look at the LED and record the number printed when LED is on or off</div>
</li>
</ol>

<p>
Note: some GPIOs may return an error because they&#039;re already used by the Linux kernel (i.e LEDS).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;script \&quot;blink all\&quot;&quot;,&quot;hid&quot;:&quot;script_blink_all&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:13,&quot;range&quot;:&quot;10482-12537&quot;} -->
<h2 class="sectionedit14" id="finding_gpio_pins_input_on_the_pcb">Finding GPIO pins (input) on the PCB</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Finding GPIO pins (input) on the PCB&quot;,&quot;hid&quot;:&quot;finding_gpio_pins_input_on_the_pcb&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:14,&quot;range&quot;:&quot;12538-12587&quot;} -->
<h3 class="sectionedit15" id="script_gpio_in">script &quot;gpio in&quot;</h3>
<div class="level3">

<p>
Sometimes you do not know where the physical GPIO pins (input) are on your device&#039;s PCB. In that case, you can use this little script and see screen to find the input.
</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="re2">GPIOBASE</span>=<span class="sy0">`</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span>base <span class="sy0">|</span> <span class="kw2">head</span> -n1<span class="sy0">`</span>
<span class="re2">GPIOmin</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$1</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
<span class="re2">GPIOmax</span>=<span class="sy0">`</span><span class="kw2">expr</span> <span class="re4">$2</span> + <span class="re1">$GPIOBASE</span><span class="sy0">`</span>
&nbsp;
<span class="kw3">cd</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio
<span class="kw1">for</span> i <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">seq</span> <span class="re1">$GPIOmin</span> <span class="re1">$GPIOmax</span><span class="sy0">`</span>; <span class="kw1">do</span>
<span class="kw3">echo</span> <span class="re1">$i</span> <span class="sy0">&gt;</span> <span class="kw3">export</span>; <span class="kw3">echo</span> <span class="kw1">in</span> <span class="sy0">&gt;</span>gpio<span class="re1">$i</span><span class="sy0">/</span>direction
<span class="kw1">done</span>
<span class="re2">nums</span>=<span class="sy0">`</span><span class="kw2">seq</span> <span class="re1">$GPIOmin</span> <span class="re1">$GPIOmax</span><span class="sy0">`</span>
<span class="kw1">while</span> <span class="kw2">true</span>; <span class="kw1">do</span>
  <span class="kw1">for</span> i <span class="kw1">in</span> <span class="re1">$nums</span>; <span class="kw1">do</span>
     <span class="kw3">echo</span> <span class="kw3">read</span> gpio<span class="re1">$i</span> 
     <span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="re1">$i</span><span class="sy0">/</span>value
 <span class="kw1">done</span>
  <span class="kw2">sleep</span> <span class="nu0">1</span>
<span class="kw1">done</span></pre>
<ol>
<li class="level1"><div class="li"> Start with <code>./gpio 0 30</code>, which means pin 0 to 30</div>
</li>
<li class="level1"><div class="li"> Press button or change the value input.</div>
</li>
<li class="level1"><div class="li"> The script returns on screen: &#039;read gpio+number&#039; followed by &#039;0&#039; or &#039;1&#039;.</div>
</li>
<li class="level1"><div class="li"> Press ctrl-c to stop the script, then check which GPIOs have been created: <code>find /sys/class/gpio/gpio*</code></div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;script \&quot;gpio in\&quot;&quot;,&quot;hid&quot;:&quot;script_gpio_in&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:15,&quot;range&quot;:&quot;12588-13473&quot;} -->
<h3 class="sectionedit16" id="script_gpio_in1">script &quot;gpio in&quot;</h3>
<div class="level3">

<p>
Another script which check each GPIO one-by-one
</p>
<pre class="code bash"><span class="co0">#!/bin/sh</span>
<span class="co0"># Modified from https://gist.github.com/huzhifeng/e3c222e6b780d82967db</span>
<span class="kw3">echo</span> GPIO Button Test
<span class="kw3">echo</span>   Usage: <span class="re4">$0</span> <span class="br0">&#91;</span>gpio start<span class="br0">&#93;</span> <span class="br0">&#91;</span>gpio end<span class="br0">&#93;</span>
<span class="kw3">echo</span> Example: <span class="re4">$0</span> <span class="nu0">0</span> <span class="nu0">1</span>
<span class="kw3">echo</span> leave gpio range blank to <span class="kw3">test</span> all GPIOs.
<span class="kw3">echo</span> 
<span class="kw1">for</span> GPIOCHIP <span class="kw1">in</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpiochip<span class="sy0">*/</span> ; <span class="kw1">do</span>
    <span class="re2">BASE</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="co1">${GPIOCHIP}</span>base<span class="br0">&#41;</span>
    <span class="re2">SIZE</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="co1">${GPIOCHIP}</span>ngpio<span class="br0">&#41;</span>
    <span class="re2">MAX</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$BASE</span>+<span class="re1">$SIZE</span>-<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="re2">gpio_end</span>=<span class="co1">${2:-$MAX}</span>
    <span class="br0">&#91;</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$gpio</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="re2">gpio</span>=<span class="co1">${1:-$BASE}</span>
    <span class="kw1">while</span> <span class="br0">&#91;</span> <span class="re1">$gpio</span> <span class="re5">-ge</span> <span class="re1">$BASE</span> <span class="re5">-a</span> <span class="re1">$gpio</span> <span class="re5">-le</span> <span class="re1">$MAX</span> <span class="re5">-a</span> <span class="re1">$gpio</span> <span class="re5">-le</span> <span class="re1">$gpio_end</span> <span class="br0">&#93;</span> ; <span class="kw1">do</span>
        <span class="co0"># Save original value if needed</span>
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            <span class="re2">DIRECTION</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>direction<span class="br0">&#41;</span>
            <span class="re2">UNEXPORT</span>=<span class="nu0">0</span>
        <span class="kw1">else</span>
            <span class="kw3">echo</span> <span class="re1">$gpio</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span><span class="kw3">export</span>
            <span class="re2">UNEXPORT</span>=<span class="nu0">1</span>
            <span class="re2">DIRECTION</span>=<span class="st0">&quot;&quot;</span>
        <span class="kw1">fi</span>
        <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
            <span class="kw3">echo</span> <span class="kw1">in</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>direction
            <span class="kw3">echo</span> <span class="st0">&quot;[gpiochip<span class="es3">${BASE}</span>:<span class="es3">${gpio}</span>:in] = <span class="es4">$(cat /sys/class/gpio/gpio${gpio}/value)</span>&quot;</span>
&nbsp;
            <span class="co0"># Restore original value</span>
            <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-z</span> <span class="st0">&quot;<span class="es2">$DIRECTION</span>&quot;</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="re1">$DIRECTION</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>gpio<span class="co1">${gpio}</span><span class="sy0">/</span>direction
            <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$UNEXPORT</span>&quot;</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="co1">${gpio}</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>sys<span class="sy0">/</span>class<span class="sy0">/</span>gpio<span class="sy0">/</span>unexport
        <span class="kw1">else</span>
            <span class="kw3">echo</span> <span class="st0">&quot;[gpiochip<span class="es3">${BASE}</span>:<span class="es3">${gpio}</span>] = Failed to export&quot;</span>
        <span class="kw1">fi</span>
&nbsp;
        <span class="re2">gpio</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span>gpio+<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="kw1">done</span>
<span class="kw1">done</span></pre>
<ol>
<li class="level1"><div class="li"> Start with <code>./gpio</code>, which means all GPIOs</div>
</li>
<li class="level1"><div class="li"> Hold a button and run again, release only after the script has been finished</div>
</li>
<li class="level1"><div class="li"> Compare the changed GPIO value which corresponding to the button held</div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;script \&quot;gpio in\&quot;&quot;,&quot;hid&quot;:&quot;script_gpio_in1&quot;,&quot;codeblockOffset&quot;:14,&quot;secid&quot;:16,&quot;range&quot;:&quot;13474-15133&quot;} -->
<h2 class="sectionedit17" id="links">Links</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/driver-api/gpio" class="urlextern" title="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/driver-api/gpio" rel="ugc nofollow">Kernel gpio documentation</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.mjmwired.net/kernel/Documentation/gpio.txt" class="urlextern" title="http://www.mjmwired.net/kernel/Documentation/gpio.txt" rel="ugc nofollow">other kernel gpio doc</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Links&quot;,&quot;hid&quot;:&quot;links&quot;,&quot;codeblockOffset&quot;:15,&quot;secid&quot;:17,&quot;range&quot;:&quot;15134-15372&quot;} -->
<h2 class="sectionedit18" id="devices">Devices</h2>
<div class="level2">

<p>
The list of related devices:
<a href="/tag/gpio?do=showtag&amp;tag=gpio" class="wikilink1 tag label label-default mx-1" title="tag:gpio" rel="tag"><span class="iconify"  data-icon="mdi:tag-text-outline"></span> gpio</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Devices&quot;,&quot;hid&quot;:&quot;devices&quot;,&quot;codeblockOffset&quot;:15,&quot;secid&quot;:18,&quot;range&quot;:&quot;15373-&quot;} -->