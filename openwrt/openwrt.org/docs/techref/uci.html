
<h1 class="sectionedit1" id="uci_unified_configuration_interface_technical_reference">UCI (Unified Configuration Interface) – Technical Reference</h1>
<div class="level1">

<p>
This is the Technical Reference. Please see <strong><a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">UCI (Unified Configuration Interface) – Usage</a></strong>
</p>

<p>
Source code is available here <a href="http://git.openwrt.org/project/uci.git" class="urlextern" title="http://git.openwrt.org/project/uci.git" rel="ugc nofollow">http://git.openwrt.org/project/uci.git</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;UCI (Unified Configuration Interface) \u2013 Technical Reference&quot;,&quot;hid&quot;:&quot;uci_unified_configuration_interface_technical_reference&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-283&quot;} -->
<h3 class="sectionedit2" id="what_is_uci">What is UCI?</h3>
<div class="level3">

<p>
<code>UCI</code> is a small utility written in <a href="https://en.wikipedia.org/wiki/C (programming language)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/C (programming language)">C</a> (a <a href="https://en.wikipedia.org/wiki/shell script" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/shell script">shell script</a>-wrapper is available as well) and is intended to <em>centralize</em> the whole configuration of a device running OpenWrt. UCI is the successor of the NVRAM based configuration found in the historical OpenWrt branch <a href="/about/history" class="wikilink1" title="about:history" data-wiki-id="about:history">White Russian</a> and a wrapper for the standard configuration files programs bring with them, like e.g. <code>/etc/network/interfaces</code>, <code>/etc/exports</code>, <code>/etc/dnsmasq.conf</code>, <code>/etc/samba/samba.conf</code> etc.
</p>
<div class="table sectionedit3"><table class="inline">
	<tr class="row0">
		<td class="col0"> <img src="/_media/meta/icons/tango/dialog-information.png" class="media" loading="lazy" alt="" /> </td><td class="col1"> UCI configuration files are located  in the directory <strong><code>/etc/config/</code></strong><br/>
Their documentation can be accessed online in the OpenWrt-Wiki under <a href="/docs/guide-user/base-system/uci" class="wikilink1" title="docs:guide-user:base-system:uci" data-wiki-id="docs:guide-user:base-system:uci">UCI configuration files</a>. </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;833-1097&quot;} -->
<p>
They can be altered with any text editor or with the command line utility program <code>uci</code> or through various programming APIs (like Shell, Lua and C). The WUI <a href="/docs/techref/luci" class="wikilink1" title="docs:techref:luci" data-wiki-id="docs:techref:luci">luci</a> e.g. uses Lua to manipulate them.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;What is UCI?&quot;,&quot;hid&quot;:&quot;what_is_uci&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;284-1314&quot;} -->
<h3 class="sectionedit4" id="dependencies_of_uci">Dependencies of UCI</h3>
<div class="level3">
<ul>
<li class="level1 node"><div class="li"> <code>libuci</code> a small library for UCI written in <a href="https://en.wikipedia.org/wiki/C (programming language)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/C (programming language)">C</a></div>
<ul>
<li class="level2"><div class="li"> <code>libuci-lua</code> is a libuci-plugin for <a href="https://en.wikipedia.org/wiki/Lua (programming language)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Lua (programming language)">Lua</a> which is utilized by e.g. <a href="/docs/techref/luci" class="wikilink1" title="docs:techref:luci" data-wiki-id="docs:techref:luci">luci</a></div>
</li>
</ul>
</li>
</ul>

<p>
Both are maintained in the same git as UCI.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dependencies of UCI&quot;,&quot;hid&quot;:&quot;dependencies_of_uci&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1315-1604&quot;} -->
<h2 class="sectionedit5" id="packages">Packages</h2>
<div class="level2">

<p>
The functionality is provided by the two packages <code>uci</code> and <code>libuci</code>. The package <code>libuci-lua</code> is also available.
</p>
<div class="table sectionedit6"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Name    </th><th class="col1"> Size in Bytes </th><th class="col2"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> uci        </td><td class="col1 rightalign">   7196 </td><td class="col2 leftalign"> Utility for the Unified Configuration Interface (UCI)    </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> libuci     </td><td class="col1 rightalign">  18765 </td><td class="col2 leftalign"> C library for the Unified Configuration Interface (UCI)  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> libuci-lua </td><td class="col1 rightalign">  ~6000 </td><td class="col2 leftalign"> libuci-plugin for <a href="https://en.wikipedia.org/wiki/Lua (programming language)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Lua (programming language)">Lua</a>, e.g. <a href="/docs/techref/luci" class="wikilink1" title="docs:techref:luci" data-wiki-id="docs:techref:luci">luci</a> makes use of it  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;1746-2080&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Packages&quot;,&quot;hid&quot;:&quot;packages&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;1605-2081&quot;} -->
<h3 class="sectionedit7" id="installed_files">Installed Files</h3>
<div class="level3">

</div>

<h4 id="uci">uci</h4>
<div class="level4">
<div class="table sectionedit8"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> path/file                 </th><th class="col1"> file type </th><th class="col2 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> /sbin/uci                 </td><td class="col1 centeralign">  binary        </td><td class="col2 leftalign"> uci executable  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> /lib/config/uci.sh        </td><td class="col1 centeralign">  shell script  </td><td class="col2 leftalign"> Shell script compatibility wrappers for <code>/sbin/uci</code>  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;2120-2345&quot;} -->
</div>

<h4 id="libuci">libuci</h4>
<div class="level4">
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> path/file                  </th><th class="col1"> file type </th><th class="col2 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> /lib/libuci.so             </td><td class="col1 centeralign">  symlink  </td><td class="col2 leftalign"> symlink to libuci.so.xxx  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> /lib/libuci.so.2011-01-19  </td><td class="col1 centeralign">  binary   </td><td class="col2 leftalign"> Library  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;2362-2544&quot;} -->
</div>

<h4 id="libuci-lua">libuci-lua</h4>
<div class="level4">
<div class="table sectionedit10"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> path/file                  </th><th class="col1"> file type </th><th class="col2 leftalign"> Description  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> /usr/lib/lua/uci.so        </td><td class="col1 centeralign">  binary  </td><td class="col2 leftalign"> Library  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;2565-2675&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Installed Files&quot;,&quot;hid&quot;:&quot;installed_files&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2082-2677&quot;} -->
<h2 class="sectionedit11" id="cli_behaviour">CLI behaviour</h2>
<div class="level2">

<p>
All <code>uci set</code>, <code>uci add</code>, <code>uci rename</code> and <code>uci delete</code> commands are staged in <code>/tmp/.uci</code> and written to flash at once with <code>uci commit</code>. Note that subsequent calls to uci get before uci commit will return the staged value.
</p>

<p>
The reload_config script will reload the necessary configurations based on the last <code>uci commit</code>.
</p>

<p>
This obviously does not apply to people using text editors, but to scripts, GUIs and other programs working with uci files.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CLI behaviour&quot;,&quot;hid&quot;:&quot;cli_behaviour&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;2678-3168&quot;} -->
<h2 class="sectionedit12" id="cli_usage">CLI Usage</h2>
<div class="level2">

<p>
Let&#039;s create a new section in <code>/etc/config/firewall</code> that looks like that:
</p>
<pre class="code">config zone &#039;guest_zone&#039;
	option enabled &#039;1&#039;
	option name &#039;guest&#039;
	option input &#039;REJECT&#039;
	option forward &#039;REJECT&#039;
	option output &#039;ACCEPT&#039;
	list network &#039;guest_network&#039;</pre>

<p>
Execute commands:
</p>
<pre class="code bash"><span class="co0"># delete a section 'guest_zone' if any to start from scratch</span>
uci <span class="re5">-q</span> delete network.guest_dev
<span class="co0"># creates a section called 'guest_zone'</span>
uci add firewall guest_zone
<span class="co0"># specify the section type</span>
uci <span class="kw1">set</span> firewall.guest_zone=zone
<span class="co0"># set enabled option</span>
uci <span class="kw1">set</span> firewall.guest_zone.enabled=<span class="nu0">1</span>
uci <span class="kw1">set</span> firewall.guest_zone.name=<span class="st_h">'guest'</span>
uci <span class="kw1">set</span> firewall.guest_zone.input=<span class="st_h">'REJECT'</span>
uci <span class="kw1">set</span> firewall.guest_zone.forward=<span class="st_h">'REJECT'</span>
uci <span class="kw1">set</span> firewall.guest_zone.output=<span class="st_h">'ACCEPT'</span>
<span class="co0"># add a list option</span>
uci add_list firewall.guest_zone.network=<span class="st_h">'guest_network'</span>
<span class="co0"># get the enabled option of the guest_zone section</span>
uci get firewall.guest_zone.enabled
<span class="co0"># show the new added section</span>
uci show firewall.guest_zone
<span class="co0"># show the full firewall config before commit</span>
uci show firewall
<span class="co0"># save the changes to /etc/config/firewall</span>
uci commit firewall</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CLI Usage&quot;,&quot;hid&quot;:&quot;cli_usage&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;3169-4294&quot;} -->
<h2 class="sectionedit13" id="ubus_interface_rpcd">ubus interface (rpcd)</h2>
<div class="level2">

<p>
If you want to access or modify uci configuration via ubus, <a href="https://git.openwrt.org/?p=project/rpcd.git;a=blob;f=uci.c;h=3cd2b829efd055e3096da1499fbf2e70f5f1850b;hb=HEAD" class="interwiki iw_commit" title="https://git.openwrt.org/?p=project/rpcd.git;a=blob;f=uci.c;h=3cd2b829efd055e3096da1499fbf2e70f5f1850b;hb=HEAD">rpcd implements this</a>. It has its own set of commands which are not exactly the same as those in the CLI.
</p>

<p>
<strong>Significantly</strong>, it has its own apply/confirm/reload_config mechanism designed to support the LuCI frontend, and it does not do exactly the same thing as the reload_config script. Also, if provided with a ubus_rpc_session as the LuCI does, rather than storing staged changes in <code>/tmp/.uci</code> it stores them in <code>/tmp/run/rpcd/uci-&lt;ubus_rpc_session&gt;</code> (you can get the CLI to use or view these changes with <code>-t/-p/-P</code>).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ubus interface (rpcd)&quot;,&quot;hid&quot;:&quot;ubus_interface_rpcd&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:13,&quot;range&quot;:&quot;4295-5016&quot;} -->
<h2 class="sectionedit14" id="luci">LuCI</h2>
<div class="level2">

<p>
The LuCI frontend most commonly interacts with UCI via <a href="https://openwrt.github.io/luci/jsapi/LuCI.uci.html" class="urlextern" title="https://openwrt.github.io/luci/jsapi/LuCI.uci.html" rel="ugc nofollow">uci.js</a>. This pretends that it has ordinary get/set methods, but these get/set methods do not make calls of the backend, as it maintains its own staged changes (i.e. separate from the staged changes on the backend). The basic flow is:
</p>
<ul>
<li class="level1"><div class="li"> <code>uci.load(&#039;someconfig&#039;)</code>  # loads all of someconfig into memory via ubus</div>
</li>
<li class="level1"><div class="li"> <code>uci.set(&#039;someconfig&#039;, &#039;somesection&#039;, &#039;someoption&#039;, &#039;somevalue&#039;)</code>  # adds to the list of changes to someconfig (similar to how staged changes work in the backend)</div>
</li>
<li class="level1"><div class="li"> <code>uci.save()</code>  # stage the changes in the backend via ubus</div>
</li>
<li class="level1"><div class="li"> <code>uci.apply()</code>  # apply the changes in the backend, but with a 10 sec automatic rollback if not confirmed, implemented via ubus</div>
</li>
</ul>

<p>
However, the standard frontend handleSave/handleSaveApply methods do _not_ call uci.apply(), but instead call <a href="https://openwrt.github.io/luci/jsapi/LuCI.ui.changes.html" class="urlextern" title="https://openwrt.github.io/luci/jsapi/LuCI.ui.changes.html" rel="ugc nofollow">ui.changes.apply</a>. This in turn calls a separate <abbr title="Hypertext Transfer Protocol">HTTP</abbr> endpoint (not via uhttp-mod-ubus) implemented in lua (⇐OpenWrt 22) or ucode (&gt;=OpenWrt 23), which itself calls ubus.
</p>

<p>
<strong>Warning</strong>: as well as the backend uci maintaining staged changes, and the frontend uci.js maintaining staged changes, the form elements (AbstractValues) have their own view of the config (cfgvalue) which is used to determine if they should save changes (i.e. saves only occur if the cfgvalue is different from the formvalue).
</p>
<hr />

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;LuCI&quot;,&quot;hid&quot;:&quot;luci&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:14,&quot;range&quot;:&quot;5017-6505&quot;} -->
<h2 class="sectionedit15" id="lua_bindings_for_uci">Lua Bindings for UCI</h2>
<div class="level2">

<p>
For those who like lua, UCI can be accessed in your code via the package libuci-lua.  Just install the package then, in your lua code do 
</p>
<pre class="code lua"><span class="kw3">require</span><span class="br0">&#40;</span><span class="st0">&quot;uci&quot;</span><span class="br0">&#41;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Lua Bindings for UCI&quot;,&quot;hid&quot;:&quot;lua_bindings_for_uci&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:15,&quot;range&quot;:&quot;6506-6709&quot;} -->
<h2 class="sectionedit16" id="api">API</h2>
<div class="level2">

<p>
The api is quite simple
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;API&quot;,&quot;hid&quot;:&quot;api&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:16,&quot;range&quot;:&quot;6710-6750&quot;} -->
<h3 class="sectionedit17" id="top_level_entry_point">top level entry point</h3>
<div class="level3">

<p>
uci.cursor() instantiates a uci context instance, e.g:
</p>
<pre class="code lua">x <span class="sy0">=</span> uci<span class="sy0">.</span>cursor<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>

<p>
if you want to involve state vars:
</p>
<pre class="code lua">x <span class="sy0">=</span> uci<span class="sy0">.</span>cursor<span class="br0">&#40;</span><span class="kw4">nil</span><span class="sy0">,</span> <span class="st0">&quot;/var/state&quot;</span><span class="br0">&#41;</span></pre>

<p>
if you need to work on UCI config files that are located in a non standard directory:
</p>
<pre class="code lua">x <span class="sy0">=</span> uci<span class="sy0">.</span>cursor<span class="br0">&#40;</span><span class="st0">&quot;/etc/mypackage/config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;/tmp/mypackage/.uci&quot;</span><span class="br0">&#41;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;top level entry point&quot;,&quot;hid&quot;:&quot;top_level_entry_point&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:17,&quot;range&quot;:&quot;6751-7130&quot;} -->
<h3 class="sectionedit18" id="on_that_you_can_call_the_usual_operations">on that you can call the usual operations</h3>
<div class="level3">

<p>
Get value (returns <code>string</code> or <code>nil</code> if not found):
</p>
<pre class="code lua">x<span class="sy0">:</span>get<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;sectionname&quot;</span><span class="sy0">,</span> <span class="st0">&quot;option&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>get<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;lan&quot;</span><span class="sy0">,</span> <span class="st0">&quot;proto&quot;</span><span class="br0">&#41;</span></pre>

<p>
Set simple string value:
</p>
<pre class="code lua">x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;sectionname&quot;</span><span class="sy0">,</span> <span class="st0">&quot;option&quot;</span><span class="sy0">,</span> <span class="st0">&quot;value&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;lan&quot;</span><span class="sy0">,</span> <span class="st0">&quot;proto&quot;</span><span class="sy0">,</span> <span class="st0">&quot;dhcp&quot;</span><span class="br0">&#41;</span></pre>

<p>
Set list value:
</p>
<pre class="code lua">x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;sectionname&quot;</span><span class="sy0">,</span> <span class="st0">&quot;option&quot;</span><span class="sy0">,</span> <span class="br0">&#123;</span> <span class="st0">&quot;foo&quot;</span><span class="sy0">,</span> <span class="st0">&quot;bar&quot;</span> <span class="br0">&#125;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;system&quot;</span><span class="sy0">,</span> <span class="st0">&quot;ntp&quot;</span><span class="sy0">,</span> <span class="st0">&quot;server&quot;</span><span class="sy0">,</span> <span class="br0">&#123;</span>
  <span class="st0">&quot;0.openwrt.pool.ntp.org&quot;</span><span class="sy0">,</span>
  <span class="st0">&quot;1.openwrt.pool.ntp.org&quot;</span><span class="sy0">,</span>
  <span class="st0">&quot;2.openwrt.pool.ntp.org&quot;</span><span class="sy0">,</span>
  <span class="st0">&quot;3.openwrt.pool.ntp.org&quot;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span></pre>

<p>
Delete option:
</p>
<pre class="code lua">x<span class="sy0">:</span>delete<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;section&quot;</span><span class="sy0">,</span> <span class="st0">&quot;option&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>delete<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;lan&quot;</span><span class="sy0">,</span> <span class="st0">&quot;force_link&quot;</span><span class="br0">&#41;</span></pre>

<p>
Delete section:
</p>
<pre class="code lua">x<span class="sy0">:</span>delete<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;section&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>delete<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;wan6&quot;</span><span class="br0">&#41;</span></pre>

<p>
Add new anonymous section “type” and return its name:
</p>
<pre class="code lua">x<span class="sy0">:</span>add<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;type&quot;</span><span class="br0">&#41;</span></pre>
<pre class="code lua"><span class="sy0">&gt;</span> <span class="co1">-- real world example from interpreter:</span>
<span class="sy0">&gt;</span> name <span class="sy0">=</span> x<span class="sy0">:</span>add<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;switch&quot;</span><span class="br0">&#41;</span>
<span class="sy0">&gt;</span> <span class="kw3">print</span><span class="br0">&#40;</span>name<span class="br0">&#41;</span>
cfg0e3777</pre>

<p>
Add new section “name” with type “type”:
</p>
<pre class="code lua">x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;name&quot;</span><span class="sy0">,</span> <span class="st0">&quot;type&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co1">-- real world example:</span>
x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;network&quot;</span><span class="sy0">,</span> <span class="st0">&quot;wan6&quot;</span><span class="sy0">,</span> <span class="st0">&quot;interface&quot;</span><span class="br0">&#41;</span></pre>

<p>
Iterate over all section of type “type” and invoke a callback function:
</p>
<pre class="code lua">x<span class="sy0">:</span><span class="kw3">foreach</span><span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;type&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span> <span class="sy0">...</span> <span class="kw1">end</span><span class="br0">&#41;</span></pre>

<p>
In the preceding example, s is a table containing all options and two special properties:
</p>
<ul>
<li class="level1"><div class="li"> <code>s[&#039;.type&#039;]</code> → section type</div>
</li>
<li class="level1"><div class="li"> <code>s[&#039;.name&#039;]</code>  → section name</div>
</li>
</ul>

<p>
If the callback function returns <code>false</code> [NB: <em class="u">not</em> <code>nil</code>!], <code>foreach()</code> will terminate at that point without iterating over any remaining sections.
<code>foreach()</code> returns <code>true</code> if at least one section exists and the callback function didn&#039;t raise an error for it; <code>false</code> otherwise.
</p>

<p>
Here&#039;s another example:
</p>
<pre class="code lua"><span class="sy0">&gt;</span> <span class="co1">-- real world example from interpreter:</span>
<span class="sy0">&gt;</span> x<span class="sy0">:</span><span class="kw3">foreach</span><span class="br0">&#40;</span><span class="st0">&quot;system&quot;</span><span class="sy0">,</span> <span class="st0">&quot;led&quot;</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span>
<span class="sy0">&gt;&gt;</span>     <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">'------------------'</span><span class="br0">&#41;</span>
<span class="sy0">&gt;&gt;</span>     <span class="kw1">for</span> key<span class="sy0">,</span> value <span class="kw2">in</span> <span class="kw3">pairs</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span> <span class="kw1">do</span>
<span class="sy0">&gt;&gt;</span>         <span class="kw3">print</span><span class="br0">&#40;</span>key <span class="sy0">..</span> <span class="st0">': '</span> <span class="sy0">..</span> <span class="kw3">tostring</span><span class="br0">&#40;</span>value<span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="sy0">&gt;&gt;</span>     <span class="kw1">end</span>
<span class="sy0">&gt;&gt;</span> <span class="kw1">end</span><span class="br0">&#41;</span>
<span class="co1">------------------</span>
dev<span class="sy0">:</span> <span class="nu0">1</span><span class="sy0">-</span><span class="nu0">1.1</span>
<span class="sy0">.</span>anonymous<span class="sy0">:</span> <span class="kw4">false</span>
trigger<span class="sy0">:</span> usbdev
<span class="sy0">.</span>index<span class="sy0">:</span> <span class="nu0">2</span>
name<span class="sy0">:</span> USB1
interval<span class="sy0">:</span> <span class="nu0">50</span>
<span class="sy0">.</span>name<span class="sy0">:</span> led_usb1
<span class="sy0">.</span><span class="kw3">type</span><span class="sy0">:</span> led
sysfs<span class="sy0">:</span> tp<span class="sy0">-</span>link<span class="sy0">:</span>green<span class="sy0">:</span>usb1
<span class="co1">------------------</span>
dev<span class="sy0">:</span> <span class="nu0">1</span><span class="sy0">-</span><span class="nu0">1.2</span>
<span class="sy0">.</span>anonymous<span class="sy0">:</span> <span class="kw4">false</span>
trigger<span class="sy0">:</span> usbdev
<span class="sy0">.</span>index<span class="sy0">:</span> <span class="nu0">3</span>
name<span class="sy0">:</span> USB2
interval<span class="sy0">:</span> <span class="nu0">50</span>
<span class="sy0">.</span>name<span class="sy0">:</span> led_usb2
<span class="sy0">.</span><span class="kw3">type</span><span class="sy0">:</span> led
sysfs<span class="sy0">:</span> tp<span class="sy0">-</span>link<span class="sy0">:</span>green<span class="sy0">:</span>usb2
<span class="co1">------------------</span>
<span class="sy0">.</span>name<span class="sy0">:</span> led_wlan2g
<span class="sy0">.</span><span class="kw3">type</span><span class="sy0">:</span> led
name<span class="sy0">:</span> WLAN2G
trigger<span class="sy0">:</span> phy0tpt
sysfs<span class="sy0">:</span> tp<span class="sy0">-</span>link<span class="sy0">:</span>blue<span class="sy0">:</span>wlan2g
<span class="sy0">.</span>anonymous<span class="sy0">:</span> <span class="kw4">false</span>
<span class="sy0">.</span>index<span class="sy0">:</span> <span class="nu0">4</span></pre>

<p>
Move a section to another position. Position starts at 0. 
This is for example handy to change the wireless config order (changing priority). 
</p>
<pre class="code lua">x<span class="sy0">:</span>reorder<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="sy0">,</span> <span class="st0">&quot;sectionname&quot;</span><span class="sy0">,</span> position<span class="br0">&#41;</span></pre>

<p>
Discard any changes made to the configuration, that have not yet been committed:
</p>
<pre class="code lua">x<span class="sy0">:</span>revert<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="br0">&#41;</span></pre>

<p>
commits (saves) the changed configuration to the corresponding file in <code>/etc/config</code>
</p>
<pre class="code lua">x<span class="sy0">:</span>commit<span class="br0">&#40;</span><span class="st0">&quot;config&quot;</span><span class="br0">&#41;</span></pre>

<p>
That&#039;s basically all you need.
</p>

</div>

<h4 id="about_uci_structure">About uci structure</h4>
<div class="level4">

<p>
It took me some time to understand the difference between “section” and “type”. Let&#039;s start with an example:
</p>
<pre class="code">#uci show system
system.@system[0]=system
system.@system[0].hostname=OpenWrt
system.@system[0].timezone=UTC
system.@rdate[0]=rdate
system.@rdate[0].server=ac-ntp0.net.cmu.edu ptbtime1.ptb.de ac-ntp1.net.cmu.edu ntp.xs4all.nl ptbtime2.ptb.de cudns.cit.cornell.edu ptbtime3.ptb.de</pre>

<p>
Here, <code>x:get(“system”,“@rdate[0]”,“server”)</code> won&#039;t work. rdate is a type, not a section.
</p>

<p>
Here is the return of <code>x:get_all(“system”)</code>:
</p>
<pre class="code lua"><span class="br0">&#123;</span>
  cfg02f02f <span class="sy0">=</span> <span class="br0">&#123;</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.name&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;cfg02f02f&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.type&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;system&quot;</span><span class="sy0">,</span>
    hostname <span class="sy0">=</span> <span class="st0">&quot;OpenWrt&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.index&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.anonymous&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw4">true</span><span class="sy0">,</span>
    timezone <span class="sy0">=</span> <span class="st0">&quot;UTC&quot;</span>
  <span class="br0">&#125;</span><span class="sy0">,</span>
  cfg04e10c <span class="sy0">=</span> <span class="br0">&#123;</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.name&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;cfg04e10c&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.type&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;rdate&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.index&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.anonymous&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw4">true</span><span class="sy0">,</span>
    server <span class="sy0">=</span> <span class="br0">&#123;</span>
      <span class="st0">&quot;ac-ntp0.net.cmu.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime1.ptb.de&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ac-tp1.net.cmu.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ntp.xs4all.nl&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime2.ptb.de&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;cudns.cit.cornell.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime3.ptb.de&quot;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<code>[“.type”]</code> gives the type of the section;
</p>

<p>
<code>[“.name”]</code> gives the real name of the section (note that these names are auto-generated);
</p>

<p>
<code>[“.index”]</code> is the index of the list (starting from 1);
</p>

<p>
From what I know, there seem to be no way to access <code>“@rdate[0]”</code> directly. You have to iterate with <code>x:foreach</code> to list all the elements of a given type.
</p>

<p>
I use the following function:
</p>
<pre class="code lua">uci<span class="sy0">=</span><span class="kw3">require</span><span class="br0">&#40;</span><span class="st0">&quot;uci&quot;</span><span class="br0">&#41;</span>
<span class="kw1">function</span> getConfType<span class="br0">&#40;</span>conf<span class="sy0">,</span><span class="kw3">type</span><span class="br0">&#41;</span>
   <span class="kw1">local</span> curs<span class="sy0">=</span>uci<span class="sy0">.</span>cursor<span class="br0">&#40;</span><span class="br0">&#41;</span>
   <span class="kw1">local</span> ifce<span class="sy0">=</span><span class="br0">&#123;</span><span class="br0">&#125;</span>
   curs<span class="sy0">:</span><span class="kw3">foreach</span><span class="br0">&#40;</span>conf<span class="sy0">,</span><span class="kw3">type</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span> ifce<span class="br0">&#91;</span>s<span class="br0">&#91;</span><span class="st0">&quot;.index&quot;</span><span class="br0">&#93;</span><span class="br0">&#93;</span><span class="sy0">=</span>s <span class="kw1">end</span><span class="br0">&#41;</span>
   <span class="kw1">return</span> ifce
<span class="kw1">end</span></pre>

<p>
<code>getConfType(“system”,“rdate”)</code> returns:
</p>
<pre class="code lua"><span class="br0">&#123;</span>
  <span class="br0">&#123;</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.name&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;cfg04e10c&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.type&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="st0">&quot;rdate&quot;</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.index&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span>
    <span class="br0">&#91;</span><span class="st0">&quot;.anonymous&quot;</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw4">true</span><span class="sy0">,</span>
    server <span class="sy0">=</span> <span class="br0">&#123;</span>
      <span class="st0">&quot;ac-ntp0.net.cmu.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime1.ptb.de&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ac-ntp1.net.cmu.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ntp.xs4all.nl&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime2.ptb.de&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;cudns.cit.cornell.edu&quot;</span><span class="sy0">,</span>
      <span class="st0">&quot;ptbtime3.ptb.de&quot;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
So if you want to modify <code>system.@rdate[0].server</code> you need to iterate the type, retrieve the section name <code>[“.name”]</code> and then call:
</p>
<pre class="code lua">x<span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;system&quot;</span><span class="sy0">,</span><span class="st0">&quot;cfg04e10c&quot;</span><span class="sy0">,</span><span class="st0">&quot;server&quot;</span><span class="sy0">,</span><span class="st0">&quot;zzz.com&quot;</span><span class="br0">&#41;</span></pre>

<p>
Hope this helps.
</p>

<p>
Sophana
</p>

<p>
(Luci has however a <a href="https://openwrt.github.io/luci/api/modules/luci.model.uci.html#Cursor.get_first" class="urlextern" title="https://openwrt.github.io/luci/api/modules/luci.model.uci.html#Cursor.get_first" rel="ugc nofollow">Cursor:get_first</a> function that is similar to get except it takes a type instead as section as second argument.)
</p>
<hr />

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;on that you can call the usual operations&quot;,&quot;hid&quot;:&quot;on_that_you_can_call_the_usual_operations&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:18,&quot;range&quot;:&quot;7131-12735&quot;} -->
<h2 class="sectionedit19" id="usage_outside_of_openwrt">Usage outside of  OpenWrt</h2>
<div class="level2">

<p>
If you want to use the libuci apart from OpenWrt (for e.g. you are developing an application in C on your host computer) then prepare as follows:
Note that libuci depends on [libubox]
</p>

<p>
Grab the source.
</p>
<pre class="code">git clone https://git.openwrt.org/project/uci.git</pre>

<p>
Go to the source directory (where the CMakeLists.txt lives) and optionally configure the build without Lua bindings:
</p>
<pre class="code">cd uci/; cmake [-D BUILD_LUA:BOOL=OFF] .</pre>

<p>
Build and install uci as root (this will install uci into /usr/local/, see this thread on how to install and use uci without root permissions in your home directory: <a href="https://forum.openwrt.org/viewtopic.php?id=40547" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?id=40547" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?id=40547</a>):
</p>
<pre class="code">make install</pre>

<p>
<strong>Setup library search paths using <code>ld.so.conf</code></strong>
</p>

<p>
Setting your system library search path can be done in many ways, and is largely out of scope of the OpenWrt wiki.
</p>

<p>
Open /etc/ld.so.conf and add the place where you installed the uci library:
</p>
<pre class="code">vi /etc/ld.so.conf</pre>

<p>
Add this line somewhere to /etc/ld.so.conf
</p>
<pre class="code">/usr/local/lib</pre>

<p>
Execute ldconfig as root to apply the changes to /etc/ld.so.conf
</p>
<pre class="code">ldconfig</pre>

<p>
<strong>Setup library search paths using <code>Using LD_LIBRARY_PATH</code></strong>
</p>

<p>
Alternatively, just 
</p>
<pre class="code">export LD_LIBRARY_PATH=&lt;where/you/installed/the/.so&gt;</pre>

<p>
<strong>Building your own application</strong>
</p>

<p>
To compile your application you have to link it against the uci library. Append -luci in your Makefile:
</p>
<pre class="code">$(CC) test.o -o test -luci</pre>

<p>
And examples on how to use UCI in C can be found in this thread: <a href="https://forum.openwrt.org/viewtopic.php?pid=183335#p183335" class="urlextern" title="https://forum.openwrt.org/viewtopic.php?pid=183335#p183335" rel="ugc nofollow">https://forum.openwrt.org/viewtopic.php?pid=183335#p183335</a>
To get more examples look into the source directory of uci which you got by git clone and open cli.c or ucimap-example.c
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Usage outside of  OpenWrt&quot;,&quot;hid&quot;:&quot;usage_outside_of_openwrt&quot;,&quot;codeblockOffset&quot;:24,&quot;secid&quot;:19,&quot;range&quot;:&quot;12736-14473&quot;} -->
<h2 class="sectionedit20" id="see_also">See also</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> <a href="https://wiki.teltonika-networks.com/view/UCI_command_usage" class="urlextern" title="https://wiki.teltonika-networks.com/view/UCI_command_usage" rel="ugc nofollow">UCI command usage</a></div>
</li>
</ol>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;See also&quot;,&quot;hid&quot;:&quot;see_also&quot;,&quot;codeblockOffset&quot;:32,&quot;secid&quot;:20,&quot;range&quot;:&quot;14474-&quot;} -->