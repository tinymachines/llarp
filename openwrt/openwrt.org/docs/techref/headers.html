
<h1 class="sectionedit1" id="trx_vs_trx2_vs_bin">TRX vs. TRX2 vs. BIN</h1>
<div class="level1">

<p>
<a href="http://skaya.enix.org/wiki/FirmwareFormat" class="urlextern" title="http://skaya.enix.org/wiki/FirmwareFormat" rel="ugc nofollow">Broadcom Firmware Format</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;TRX vs. TRX2 vs. BIN&quot;,&quot;hid&quot;:&quot;trx_vs_trx2_vs_bin&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-109&quot;} -->
<h1 class="sectionedit2" id="the_various_headers">The various headers</h1>
<div class="level1">

<p>
Some devices have firmware files with different file name endings. While the overall content of the files are identical, there are some slight differences at their beginnings:
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;The various headers&quot;,&quot;hid&quot;:&quot;the_various_headers&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;110-321&quot;} -->
<h2 class="sectionedit3" id="trx_v1">TRX v1</h2>
<div class="level2">
<pre class="code">  0                   1                   2                   3   
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
 +---------------------------------------------------------------+
 |                     magic number (&#039;HDR0&#039;)                     |
 +---------------------------------------------------------------+
 |                  length (header size + data)                  |
 +---------------+---------------+-------------------------------+
 |                       32-bit CRC value                        |
 +---------------+---------------+-------------------------------+
 |           TRX flags           |          TRX version          |
 +-------------------------------+-------------------------------+
 |                      Partition offset[0]                      |
 +---------------------------------------------------------------+
 |                      Partition offset[1]                      |
 +---------------------------------------------------------------+
 |                      Partition offset[2]                      |
 +---------------------------------------------------------------+</pre>
<ul>
<li class="level1"><div class="li"> offset[0] = lzma-loader</div>
</li>
<li class="level1"><div class="li"> offset[1] = Linux-Kernel</div>
</li>
<li class="level1"><div class="li"> offset[2] = rootfs</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;TRX v1&quot;,&quot;hid&quot;:&quot;trx_v1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;322-1576&quot;} -->
<h2 class="sectionedit4" id="trx_v2">TRX v2</h2>
<div class="level2">
<pre class="code">  0                   1                   2                   3   
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
 +---------------------------------------------------------------+
 |                     magic number (&#039;HDR0&#039;)                     |
 +---------------------------------------------------------------+
 |                  length (header size + data)                  |
 +---------------+---------------+-------------------------------+
 |                       32-bit CRC value                        |
 +---------------+---------------+-------------------------------+
 |           TRX flags           |          TRX version          |
 +-------------------------------+-------------------------------+
 |                      Partition offset[0]                      |
 +---------------------------------------------------------------+
 |                      Partition offset[1]                      |
 +---------------------------------------------------------------+
 |                      Partition offset[2]                      |
 +---------------------------------------------------------------+
 |                      Partition offset[3]                      |
 +---------------------------------------------------------------+</pre>
<ul>
<li class="level1"><div class="li"> offset[0] = lzma-loader</div>
</li>
<li class="level1"><div class="li"> offset[1] = Linux-Kernel</div>
</li>
<li class="level1"><div class="li"> offset[2] = rootfs</div>
</li>
<li class="level1"><div class="li"> offset[3] = bin-Header</div>
</li>
</ul>

<p>
Source: <a href="http://git.openwrt.org/?p=14.07/openwrt.git;a=blob;f=tools/firmware-utils/src/trx.c;h=aa1f5be4b65b66ac9a1a48d7304d9bef131080e1;hb=HEAD#l69" class="urlextern" title="http://git.openwrt.org/?p=14.07/openwrt.git;a=blob;f=tools/firmware-utils/src/trx.c;h=aa1f5be4b65b66ac9a1a48d7304d9bef131080e1;hb=HEAD#l69" rel="ugc nofollow">openwrt/tools/firmware-utils/src/trx.c</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;TRX v2&quot;,&quot;hid&quot;:&quot;trx_v2&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;1577-3181&quot;} -->
<h2 class="sectionedit5" id="bin-header">BIN-Header</h2>
<div class="level2">

<p>
<img src="/lib/images/smileys/fixme.svg" class="icon smiley" alt="FIXME" /> (which bin header?)
</p>
<pre class="code">  0                   1                   2                   3   
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
 +---------------------------------------------------------------+
 |                            magic                              |
 +---------------------------------------------------------------+
 |                            res1                               |
 +---------------------------------------------------------------+
 |                fwdate                         |   fwvern...   |
 +---------------------------------------------------------------+
 |    ...fwvern                  |              ID...            |
 +---------------------------------------------------------------+
 |         ...ID                 |  hw_ver       |    s/n        |
 +---------------------------------------------------------------+
 |           flags               |           stable              |
 +---------------------------------------------------------------+
 |           try1                |           try2                |
 +---------------------------------------------------------------+
 |           try3                |           res3                |
 +---------------------------------------------------------------+</pre>
<ul>
<li class="level1"><div class="li"> magic: firmware magic depends on board etc. s.th. like &#039;3G2V&#039; or &#039;W54U&#039;</div>
</li>
<li class="level1"><div class="li"> res1: reserved for extra magic??</div>
</li>
<li class="level1"><div class="li"> char fwdate[3]: fwdate[0]: Year, fwdate[1]: Month, fwdate[2]: Day</div>
</li>
<li class="level1"><div class="li"> fwvern: version informations a.b.c.</div>
</li>
<li class="level1"><div class="li"> ID: fix “U2ND”</div>
</li>
<li class="level1"><div class="li"> hw_ver: depends on board</div>
</li>
<li class="level1"><div class="li"> s/n: depends on board</div>
</li>
<li class="level1"><div class="li"> flags: </div>
</li>
<li class="level1"><div class="li"> stable: Marks the firmware stable, this is 0xFF in the image and will be written to 0x73 by the running system once it completed booting.</div>
</li>
<li class="level1"><div class="li"> try1-3: 0xFF in firmware image. CFE will set try1 to 0x74 on first boot and continue with try2 and try3 unless “stable” was written by the running image. After writing try3 and the stable flag was not written yet, the CFE assumes that the image is broken and starts a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server</div>
</li>
<li class="level1"><div class="li"> res3: unused?</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;BIN-Header&quot;,&quot;hid&quot;:&quot;bin-header&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;3182-5273&quot;} -->
<h2 class="sectionedit6" id="tp-link_bin_header">TP-LINK BIN Header</h2>
<div class="level2">
<pre class="code">  0   1   2   3   4   5   6   7   8   9   a   b   c   d   e   f  
+---------------------------------------------------------------+
|    version    |          vendor_name...                       |
+---------------------------------------------------------------+
|                       ...vendor_name          | fw_version... |
+---------------------------------------------------------------+
|                       ...fw_version...                        |
+---------------------------------------------------------------+
|                       ...fw_version                           |
+---------------------------------------------------------------+
|     hw_id     |    hw_rev     |     unk1      |    md5sum1... |
+---------------------------------------------------------------+
|                         ...md5sum1            |     unk2      |
+---------------------------------------------------------------+
|                            md5sum2                            |
+---------------------------------------------------------------+
|     unk3      |   kernel_la   |   kernel_ep   |   fw_length   |
+---------------------------------------------------------------+
|  kernel_ofs   |   kernel_len  |   rootfs_ofs  |  rootfs_len   |
+---------------------------------------------------------------+
|   boot_ofs    |   boot_len    |ver_hi |ver_mid| ver_lo| pad...|
+---------------------------------------------------------------+
|                           ...pad...                           |
+---------------------------------------------------------------+</pre>

<p>
source: <a href="http://git.openwrt.org/?p=openwrt.git;a=blob;f=tools/firmware-utils/src/mktplinkfw.c;h=a6aab598a1ffa677e64307ee4234479d45de9140;hb=HEAD#l78" class="urlextern" title="http://git.openwrt.org/?p=openwrt.git;a=blob;f=tools/firmware-utils/src/mktplinkfw.c;h=a6aab598a1ffa677e64307ee4234479d45de9140;hb=HEAD#l78" rel="ugc nofollow">openwrt/tools/firmware-utils/src/mktplinkfw.c</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;TP-LINK BIN Header&quot;,&quot;hid&quot;:&quot;tp-link_bin_header&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:6,&quot;range&quot;:&quot;5274-&quot;} -->