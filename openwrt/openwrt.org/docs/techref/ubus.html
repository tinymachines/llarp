
<h1 class="sectionedit1" id="ubus_openwrt_micro_bus_architecture">ubus (OpenWrt micro bus architecture)</h1>
<div class="level1">

<p>
See also:
<a href="https://hackmd.io/@rYMqzC-9Rxy0Isn3zClURg/H1BY98bRw" class="urlextern" title="https://hackmd.io/@rYMqzC-9Rxy0Isn3zClURg/H1BY98bRw" rel="ugc nofollow">What is UBUS?</a>
</p>

<p>
To provide <a href="https://en.wikipedia.org/wiki/Inter-process_communication" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Inter-process_communication">Inter-process communication</a> between various daemons and applications in OpenWrt a project called <code>ubus</code> has been developed.
It consists of several parts including daemon, library and some extra helpers.
</p>

<p>
The heart of this project is the <code>ubusd</code> daemon.
It provides an interface for other daemons to register themselves as well as sending messages.
For those curious, this interface is implemented using Unix sockets and it uses <a href="https://en.wikipedia.org/wiki/Type-length-value" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Type-length-value">TLV (type-length-value)</a> messages.
</p>

<p>
To simplify development of software using <code>ubus</code> (connecting to it) a library called <code>libubus</code> has been created.
</p>

<p>
Every daemon registers a set of paths under a specific namespace.
Every path can provide multiple procedures with any number of arguments.
Procedures can reply with a message.
</p>

<p>
The code is published under <a href="https://en.wikipedia.org/wiki/GNU_Lesser_General_Public_License" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/GNU_Lesser_General_Public_License">LGPL 2.1 license</a> and can be found via git at <a href="https://git.openwrt.org/project/ubus.git" class="urlextern" title="https://git.openwrt.org/project/ubus.git" rel="ugc nofollow">https://git.openwrt.org/project/ubus.git</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ubus (OpenWrt micro bus architecture)&quot;,&quot;hid&quot;:&quot;ubus_openwrt_micro_bus_architecture&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1127&quot;} -->
<h2 class="sectionedit2" id="command-line_ubus_tool">Command-line ubus tool</h2>
<div class="level2">

<p>
The <code>ubus</code> command line tool allows to interact with the <code>ubusd</code> server (with all currently registered services).
It&#039;s useful for investigating/debugging registered namespaces as well as writing shell scripts.
For calling procedures with parameters and returning responses it uses the user-friendly JSON format.
Below is an explanation of its commands.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Command-line ubus tool&quot;,&quot;hid&quot;:&quot;command-line_ubus_tool&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1128-1520&quot;} -->
<h3 class="sectionedit3" id="help_output">Help output</h3>
<div class="level3">
<pre class="code"># ubus
Usage: ubus [&lt;options&gt;] &lt;command&gt; [arguments...]
Options:
 -s &lt;socket&gt;:		Set the unix domain socket to connect to
 -t &lt;timeout&gt;:		Set the timeout (in seconds) for a command to complete
 -S:			Use simplified output (for scripts)
 -v:			More verbose output
 -m &lt;type&gt;:		(for monitor): include a specific message type
			(can be used more than once)
 -M &lt;r|t&gt;		(for monitor): only capture received or transmitted traffic

Commands:
 - list [&lt;path&gt;]			List objects
 - call &lt;path&gt; &lt;method&gt; [&lt;message&gt;]	Call an object method
 - listen [&lt;path&gt;...]			Listen for events
 - send &lt;type&gt; [&lt;message&gt;]		Send an event
 - wait_for &lt;object&gt; [&lt;object&gt;...]	Wait for multiple objects to appear on ubus
 - monitor				Monitor ubus traffic</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Help output&quot;,&quot;hid&quot;:&quot;help_output&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1521-2282&quot;} -->
<h3 class="sectionedit4" id="list">list</h3>
<div class="level3">

<p>
To find out which services are currently running on the bus simply use the <code>ubus list</code> command.
This will show a complete list of all namespaces registered with the RPC server:
</p>
<pre class="code"># ubus list
dhcp
dnsmasq
file
iwinfo
log
luci
luci-rpc
network
network.device
network.interface
network.interface.lan
network.interface.loopback
network.interface.wan
network.interface.wan6
network.rrdns
network.wireless
service
session
system
uci</pre>

<p>
You can filter the list by specifying a service path:
</p>
<pre class="code"># ubus list network.interface.*
network.interface.lan
network.interface.loopback
network.interface.wan
network.interface.wan6</pre>

<p>
To find out which procedures/methods and their argument signatures a specific service provides add <code>-v</code> in addition to the namespace path:
</p>
<pre class="code"># ubus -v list network.interface.lan
&#039;network.interface.lan&#039; @099f0c8b
	&quot;up&quot;: {  }
	&quot;down&quot;: {  }
	&quot;status&quot;: {  }
	&quot;prepare&quot;: {  }
	&quot;add_device&quot;: { &quot;name&quot;: &quot;String&quot; }
	&quot;remove_device&quot;: { &quot;name&quot;: &quot;String&quot; }
	&quot;notify_proto&quot;: {  }
	&quot;remove&quot;: {  }
	&quot;set_data&quot;: {  }</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;list&quot;,&quot;hid&quot;:&quot;list&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;2283-3357&quot;} -->
<h3 class="sectionedit5" id="call">call</h3>
<div class="level3">

<p>
Calls a given procedure within a given namespace and optionally pass arguments to it:
</p>
<pre class="code bash"><span class="co0"># ubus call network.interface.wan status</span>
<span class="br0">&#123;</span>
	<span class="st0">&quot;up&quot;</span>: <span class="kw2">true</span>,
	<span class="st0">&quot;pending&quot;</span>: <span class="kw2">false</span>,
	<span class="st0">&quot;available&quot;</span>: <span class="kw2">true</span>,
	<span class="st0">&quot;autostart&quot;</span>: <span class="kw2">true</span>,
	<span class="st0">&quot;uptime&quot;</span>: <span class="nu0">86017</span>,
	<span class="st0">&quot;l3_device&quot;</span>: <span class="st0">&quot;eth1&quot;</span>,
	<span class="st0">&quot;device&quot;</span>: <span class="st0">&quot;eth1&quot;</span>,
	<span class="st0">&quot;address&quot;</span>: <span class="br0">&#91;</span>
		<span class="br0">&#123;</span>
			<span class="st0">&quot;address&quot;</span>: <span class="st0">&quot;178.25.65.236&quot;</span>,
			<span class="st0">&quot;mask&quot;</span>: <span class="nu0">21</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#93;</span>,
	<span class="st0">&quot;route&quot;</span>: <span class="br0">&#91;</span>
		<span class="br0">&#123;</span>
			<span class="st0">&quot;target&quot;</span>: <span class="st0">&quot;0.0.0.0&quot;</span>,
			<span class="st0">&quot;mask&quot;</span>: <span class="nu0">0</span>,
			<span class="st0">&quot;nexthop&quot;</span>: <span class="st0">&quot;178.25.71.254&quot;</span>
		<span class="br0">&#125;</span>
	<span class="br0">&#93;</span>,
	<span class="st0">&quot;data&quot;</span>: <span class="br0">&#123;</span>
&nbsp;
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
The arguments must be a valid JSON string, with keys and values set according to the function signature:
</p>
<pre class="code bash"><span class="co0"># ubus call network.device status '{ &quot;name&quot;: &quot;eth0&quot; }'</span>
<span class="br0">&#123;</span>
	<span class="st0">&quot;type&quot;</span>: <span class="st0">&quot;Network device&quot;</span>,
	<span class="st0">&quot;up&quot;</span>: <span class="kw2">true</span>,
	<span class="st0">&quot;link&quot;</span>: <span class="kw2">true</span>,
	<span class="st0">&quot;mtu&quot;</span>: <span class="nu0">1500</span>,
	<span class="st0">&quot;macaddr&quot;</span>: <span class="st0">&quot;c6:3d:c7:90:aa:da&quot;</span>,
	<span class="st0">&quot;txqueuelen&quot;</span>: <span class="nu0">1000</span>,
	<span class="st0">&quot;statistics&quot;</span>: <span class="br0">&#123;</span>
		<span class="st0">&quot;collisions&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_frame_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_compressed&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;multicast&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_length_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_dropped&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_bytes&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_missed_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_compressed&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_over_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_fifo_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_crc_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_packets&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_heartbeat_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_dropped&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_aborted_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_packets&quot;</span>: <span class="nu0">184546</span>,
		<span class="st0">&quot;rx_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_bytes&quot;</span>: <span class="nu0">17409452</span>,
		<span class="st0">&quot;tx_window_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;rx_fifo_errors&quot;</span>: <span class="nu0">0</span>,
		<span class="st0">&quot;tx_carrier_errors&quot;</span>: <span class="nu0">0</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;call&quot;,&quot;hid&quot;:&quot;call&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:5,&quot;range&quot;:&quot;3358-4671&quot;} -->
<h3 class="sectionedit6" id="listen">listen</h3>
<div class="level3">

<p>
Set up a listening socket and observe incoming events:
</p>
<pre class="code bash"><span class="co0"># ubus listen &amp;</span>
<span class="co0"># ubus call network.interface.wan down</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifdown&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;wan&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>
<span class="co0"># ubus call network.interface.wan up</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifup&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;wan&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifdown&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;he&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifdown&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;v6&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifup&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;he&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span>
<span class="br0">&#123;</span> <span class="st0">&quot;network.interface&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;action&quot;</span>: <span class="st0">&quot;ifup&quot;</span>, <span class="st0">&quot;interface&quot;</span>: <span class="st0">&quot;v6&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;listen&quot;,&quot;hid&quot;:&quot;listen&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:6,&quot;range&quot;:&quot;4672-5255&quot;} -->
<h3 class="sectionedit7" id="send">send</h3>
<div class="level3">

<p>
Send an event notification:
</p>
<pre class="code bash"><span class="co0"># ubus listen &amp;</span>
<span class="co0"># ubus send foo '{ &quot;bar&quot;: &quot;baz&quot; }'</span>
<span class="br0">&#123;</span> <span class="st0">&quot;foo&quot;</span>: <span class="br0">&#123;</span> <span class="st0">&quot;bar&quot;</span>: <span class="st0">&quot;baz&quot;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;send&quot;,&quot;hid&quot;:&quot;send&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:7,&quot;range&quot;:&quot;5256-5399&quot;} -->
<h2 class="sectionedit8" id="access_to_ubus_over_http">Access to ubus over HTTP</h2>
<div class="level2">

<p>
There is an <code>uhttpd</code> plugin called <code>uhttpd-mod-ubus</code> that allows <code>ubus</code> calls using <abbr title="Hypertext Transfer Protocol">HTTP</abbr> protocol.
For example this is used in <a href="/docs/techref/luci2" class="wikilink1" title="docs:techref:luci2" data-wiki-id="docs:techref:luci2">LuCI2</a>.
Requests have to be sent to the <code>/ubus</code> <abbr title="Uniform Resource Locator">URL</abbr> (unless changed by <code>ubus_prefix</code> option) using the <code>POST</code> method.
This interface uses <a href="https://www.jsonrpc.org/specification" class="urlextern" title="https://www.jsonrpc.org/specification" rel="ugc nofollow">jsonrpc v2.0</a>  There are a few steps that you will need to understand.
</p>

<p>
If uhttpd-mod-ubus is installed, uhttpd automatically configures it and enables it, by default at /ubus, but you can <a href="/docs/guide-user/services/webserver/uhttpd" class="wikilink1" title="docs:guide-user:services:webserver:uhttpd" data-wiki-id="docs:guide-user:services:webserver:uhttpd">configure this</a>
Also if you want to use the <code>/ubus</code> directly from a web client you need to specify <code>ubus_cors=1</code> option.
</p>

<p>
If you are using Nginx then you may try <a href="https://github.com/Ansuel/nginx-ubus-module" class="urlextern" title="https://github.com/Ansuel/nginx-ubus-module" rel="ugc nofollow">nginx-ubus-module</a>.
For other web servers like Lighttpd you may use the <a href="https://github.com/yurt-page/cgi-ubus" class="urlextern" title="https://github.com/yurt-page/cgi-ubus" rel="ugc nofollow">ubus as CGI</a>.
</p>

<p>
See the <a href="https://documenter.getpostman.com/view/5972215/TVzNHeej#154b5d84-4065-4887-a5a8-c1f3b51fe9a6" class="urlextern" title="https://documenter.getpostman.com/view/5972215/TVzNHeej#154b5d84-4065-4887-a5a8-c1f3b51fe9a6" rel="ugc nofollow">Postman collection</a> with some examples of calling UBUS over <abbr title="Hypertext Transfer Protocol">HTTP</abbr>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Access to ubus over HTTP&quot;,&quot;hid&quot;:&quot;access_to_ubus_over_http&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:8,&quot;range&quot;:&quot;5400-6522&quot;} -->
<h3 class="sectionedit9" id="acls">ACLs</h3>
<div class="level3">

<p>
While logged in via ssh, you have direct, full access to ubus.
When you&#039;re accessing the <code>/ubus</code> url in uhttpd however, uhttpd first queries whether your call is allowed, and whoever is providing the ubus <code>session.*</code> namespace is in charge of implementing the access control:
</p>
<pre class="code bash">ubus call session access <span class="st_h">'{ &quot;ubus_rpc_session&quot;: &quot;xxxxx&quot;, &quot;object&quot;: &quot;requested-object&quot;, &quot;function&quot;: &quot;requested-method&quot; }'</span></pre>

<p>
This happens to be <code>rpcd</code> at the moment, with the <code>http-json</code> interface, for friendly operation with browser code, but this is just one possible implementation.
Because we&#039;re using rpcd to implement the ACLs at this time, this allows/requires (depending on your point of view) ACLs to be configured in <code>/usr/share/rpcd/acl.d/*.json</code>.
The <em class="u">names</em> of the files in <code>/usr/share/rpcd/acl.d/*.json</code> don&#039;t matter, but the top level keys define roles.
The default <abbr title="Access Control List">ACL</abbr>, listed below, <em class="u">only</em> defines the login methods, so you can log in, but you still wouldn&#039;t be able to do anything.
</p>
<pre class="code yaml"><span class="br0">&#123;</span><span class="co3">
        &quot;unauthenticated&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;description&quot;</span><span class="sy2">: </span><span class="st0">&quot;Access controls for unauthenticated requests&quot;</span>,<span class="co3">
                &quot;read&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;session&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;access&quot;</span>, <span class="st0">&quot;login&quot;</span> <span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>
                <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
An example of a complicated <abbr title="Access Control List">ACL</abbr>, allowing quite fine grained access to different ubus modules and methods is <a href="https://git.openwrt.org/?p=project/luci2/ui.git;a=blob;f=luci2/share/acl.d/luci2.json" class="urlextern" title="https://git.openwrt.org/?p=project/luci2/ui.git;a=blob;f=luci2/share/acl.d/luci2.json" rel="ugc nofollow">available in the Luci2 project</a>
</p>

<p>
An example of a “security is for suckers” config, where a <code>superuser</code> <abbr title="Access Control List">ACL</abbr> group is defined, allowing unrestricted access to everything, is shown below.
This illustrates the usage of <code>*</code> definitions in the ACLs, but keep reading for better examples.
</p>

<p>
Placing this file in <code>/usr/share/rpcd/acl.d/superuser.json</code> will help you move forward to the next steps.
</p>
<pre class="code yaml"><span class="br0">&#123;</span><span class="co3">
        &quot;superuser&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;description&quot;</span><span class="sy2">: </span><span class="st0">&quot;Super user access role&quot;</span>,<span class="co3">
                &quot;read&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;*&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>,<span class="co3">
                        &quot;uci&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                        &quot;file&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;*&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span><span class="st0">&quot;*&quot;</span><span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>
                <span class="br0">&#125;</span>,<span class="co3">
                &quot;write&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;*&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>,<span class="co3">
                        &quot;uci&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                        &quot;file&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;*&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span><span class="st0">&quot;*&quot;</span><span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>,<span class="co3">
                        &quot;cgi-io&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span><span class="st0">&quot;*&quot;</span><span class="br0">&#93;</span>
                <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
Below is an example of an <abbr title="Access Control List">ACL</abbr> definition that only allows access to some specific ubus modules, rather than unrestricted access to everything.
</p>
<pre class="code yaml"><span class="br0">&#123;</span><span class="co3">
        &quot;lesssuperuser&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;description&quot;</span><span class="sy2">: </span><span class="st0">&quot;not quite as super user&quot;</span>,<span class="co3">
                &quot;read&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;file&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                                &quot;log&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                                &quot;service&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,
                        <span class="br0">&#125;</span>,
                <span class="br0">&#125;</span>,<span class="co3">
                &quot;write&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;file&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                                &quot;log&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                                &quot;service&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;*&quot;</span> <span class="br0">&#93;</span>,
                        <span class="br0">&#125;</span>,
                <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<strong>Note:</strong> Before we leave this section, you may have noticed that there&#039;s both a <code>ubus</code> and a <code>uci</code> section, even though ubus has a uci method.
The <code>uci</code> scope is used for the <a href="/docs/techref/uci" class="wikilink1" title="docs:techref:uci" data-wiki-id="docs:techref:uci">uci api</a> provided by rpcd to allow defining per-file permissions because using the ubus scope you can only say <code>uci set</code> is allowed or not, but not specify that it is allowed to e.g. modify <code>/etc/config/system</code> but not <code>/etc/config/network</code>.
If your application/<abbr title="Access Control List">ACL</abbr> doesn&#039;t need UCI access, you can just leave out the UCI section altogether.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;ACLs&quot;,&quot;hid&quot;:&quot;acls&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:9,&quot;range&quot;:&quot;6523-10523&quot;} -->
<h3 class="sectionedit10" id="authentication">Authentication</h3>
<div class="level3">

<p>
Now that we have an <abbr title="Access Control List">ACL</abbr> that allows operations beyond just logging in, we can actually try this out.
As mentioned, <code>rpcd</code> is handling this, so you need an entry in <code>/etc/config/rpcd</code>
</p>
<pre class="code bash">config <span class="kw2">login</span>
	option username <span class="st_h">'root'</span>
	option password <span class="st_h">'$p$root'</span>
	list <span class="kw3">read</span> <span class="st_h">'*'</span>
	list <span class="kw2">write</span> <span class="st_h">'*'</span>
&nbsp;
config <span class="kw2">login</span>
        option username <span class="st_h">'blaer'</span>
        option password <span class="st_h">'$p$blaer'</span>
        list <span class="kw3">read</span> lesssuperuser
        list <span class="kw2">write</span> lesssuperuser</pre>

<p>
The <code>$p</code> magic means to look in <code>/etc/shadow</code> and the <code>$root</code> part means to use the password for the root user in that file.
The list of read and write sections, those map <abbr title="Access Control List">ACL</abbr> roles to user accounts.
So <code>list read *</code> means the read credential of any group listed in the merged ACLs.
Write implies read.
</p>

<p>
You can also use <code>$1$&lt;hash&gt;</code> which is a <a href="https://en.wikipedia.org/wiki/Crypt_(Unix)" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Crypt_(Unix)">crypt</a> hash, using SHA1, exactly as used in <code>/etc/shadow</code>.
You can generate these with <code>uhttpd -m secret</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Authentication&quot;,&quot;hid&quot;:&quot;authentication&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:10,&quot;range&quot;:&quot;10524-11483&quot;} -->
<h3 class="sectionedit11" id="session_management">Session management</h3>
<div class="level3">

<p>
To login and receive a session id:
</p>
<pre class="code bash">$ curl <span class="re5">-H</span> <span class="st_h">'Content-Type: application/json'</span> <span class="re5">-d</span> <span class="st_h">'{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;call&quot;, &quot;params&quot;: [ &quot;00000000000000000000000000000000&quot;, &quot;session&quot;, &quot;login&quot;, { &quot;username&quot;: &quot;root&quot;, &quot;password&quot;: &quot;secret&quot;  } ] }'</span>  http:<span class="sy0">//</span>your.server.ip<span class="sy0">/</span>ubus
&nbsp;
<span class="br0">&#123;</span><span class="st0">&quot;jsonrpc&quot;</span>:<span class="st0">&quot;2.0&quot;</span>,<span class="st0">&quot;id&quot;</span>:<span class="nu0">1</span>,<span class="st0">&quot;result&quot;</span>:<span class="br0">&#91;</span><span class="nu0">0</span>,<span class="br0">&#123;</span><span class="st0">&quot;ubus_rpc_session&quot;</span>:<span class="st0">&quot;c1ed6c7b025d0caca723a816fa61b668&quot;</span>,<span class="st0">&quot;timeout&quot;</span>:<span class="nu0">300</span>,<span class="st0">&quot;expires&quot;</span>:<span class="nu0">299</span>,<span class="st0">&quot;acls&quot;</span>:<span class="br0">&#123;</span><span class="st0">&quot;access-group&quot;</span>:<span class="br0">&#123;</span><span class="st0">&quot;superuser&quot;</span>:<span class="br0">&#91;</span><span class="st0">&quot;read&quot;</span>,<span class="st0">&quot;write&quot;</span><span class="br0">&#93;</span>,<span class="st0">&quot;unauthenticated&quot;</span>:<span class="br0">&#91;</span><span class="st0">&quot;read&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,<span class="st0">&quot;ubus&quot;</span>:<span class="br0">&#123;</span><span class="st0">&quot;*&quot;</span>:<span class="br0">&#91;</span><span class="st0">&quot;*&quot;</span><span class="br0">&#93;</span>,<span class="st0">&quot;session&quot;</span>:<span class="br0">&#91;</span><span class="st0">&quot;access&quot;</span>,<span class="st0">&quot;login&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>,<span class="st0">&quot;uci&quot;</span>:<span class="br0">&#123;</span><span class="st0">&quot;*&quot;</span>:<span class="br0">&#91;</span><span class="st0">&quot;read&quot;</span>,<span class="st0">&quot;write&quot;</span><span class="br0">&#93;</span><span class="br0">&#125;</span><span class="br0">&#125;</span>,<span class="st0">&quot;data&quot;</span>:<span class="br0">&#123;</span><span class="st0">&quot;username&quot;</span>:<span class="st0">&quot;root&quot;</span><span class="br0">&#125;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span></pre>

<p>
The session id <code>00000000000000000000000000000000</code> (32 zeros) is a special null-session which only has the rights from the <code>unauthenticated</code> access group, only enabling the <code>session.login</code> ubus call.
A session has a timeout that can be specified when you login, otherwise it defaults to 5 minutes.
</p>

<p>
If you ever receive a response like <code>{“jsonrpc”:“2.0”,“id”:1,“result”:[6]}</code>, that is a valid jsonrpc response, 6 is the ubus code for <code>UBUS_STATUS_PERMISSION_DENIED</code> (you&#039;ll get this if you try and login before setting up the <code>superuser</code> file, or any file that gives you more rights than just being allowed to attempt logins).
</p>

<p>
To list all active sessions, try <code>ubus call session list</code>
</p>

<p>
The session timeout is automatically reset on every use.
There are plans to use these sessions even for luci1, but at present, if you use this interface in a luci1 environment, you&#039;ll need to manage sessions yourself.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Session management&quot;,&quot;hid&quot;:&quot;session_management&quot;,&quot;codeblockOffset&quot;:13,&quot;secid&quot;:11,&quot;range&quot;:&quot;11484-13037&quot;} -->
<h3 class="sectionedit12" id="actually_making_calls">Actually making calls</h3>
<div class="level3">

<p>
Now that you have a <code>ubus_rpc_session</code> you can make calls, based on your ACLs and the available ubus services.
<code>ubus -v list</code> is your primary documentation on what can be done, but see the rest of this page for more information.
For example, <code>ubus -v list file</code> returns 
</p>
<pre class="code javascript"><span class="st0">'file'</span> <span class="sy0">@</span>ff0a2c92
	<span class="st0">&quot;read&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;path&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="sy0">,</span><span class="st0">&quot;base64&quot;</span><span class="sy0">:</span><span class="st0">&quot;Boolean&quot;</span><span class="br0">&#125;</span>
	<span class="st0">&quot;write&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;path&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="sy0">,</span><span class="st0">&quot;data&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="sy0">,</span><span class="st0">&quot;append&quot;</span><span class="sy0">:</span><span class="st0">&quot;Boolean&quot;</span><span class="sy0">,</span><span class="st0">&quot;mode&quot;</span><span class="sy0">:</span><span class="st0">&quot;Integer&quot;</span><span class="sy0">,</span><span class="st0">&quot;base64&quot;</span><span class="sy0">:</span><span class="st0">&quot;Boolean&quot;</span><span class="br0">&#125;</span>
	<span class="st0">&quot;list&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;path&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="br0">&#125;</span>
	<span class="st0">&quot;stat&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;path&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="br0">&#125;</span>
	<span class="st0">&quot;md5&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;path&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="br0">&#125;</span>
	<span class="st0">&quot;exec&quot;</span><span class="sy0">:</span><span class="br0">&#123;</span><span class="st0">&quot;command&quot;</span><span class="sy0">:</span><span class="st0">&quot;String&quot;</span><span class="sy0">,</span><span class="st0">&quot;params&quot;</span><span class="sy0">:</span><span class="st0">&quot;Array&quot;</span><span class="sy0">,</span><span class="st0">&quot;env&quot;</span><span class="sy0">:</span><span class="st0">&quot;Table&quot;</span><span class="br0">&#125;</span></pre>

<p>
The RPC-JSON container format is:   
</p>
<pre class="code javascript"><span class="br0">&#123;</span> <span class="st0">&quot;jsonrpc&quot;</span><span class="sy0">:</span> <span class="st0">&quot;2.0&quot;</span><span class="sy0">,</span>
  <span class="st0">&quot;id&quot;</span><span class="sy0">:</span> <span class="sy0">&lt;</span>unique<span class="sy0">-</span>id<span class="sy0">-</span>to<span class="sy0">-</span>identify<span class="sy0">-</span>request<span class="sy0">&gt;,</span> 
  <span class="st0">&quot;method&quot;</span><span class="sy0">:</span> <span class="st0">&quot;call&quot;</span><span class="sy0">,</span>
  <span class="st0">&quot;params&quot;</span><span class="sy0">:</span> <span class="br0">&#91;</span>
             <span class="sy0">&lt;</span>ubus_rpc_session<span class="sy0">&gt;,</span> <span class="sy0">&lt;</span>ubus_object<span class="sy0">&gt;,</span> <span class="sy0">&lt;</span>ubus_method<span class="sy0">&gt;,</span> 
             <span class="br0">&#123;</span> <span class="sy0">&lt;</span>ubus_arguments<span class="sy0">&gt;</span> <span class="br0">&#125;</span>
            <span class="br0">&#93;</span>
<span class="br0">&#125;</span></pre>

<p>
The “id” key is merely echo&#039;ed by the server, so it needs not be strictly unique, it&#039;s mainly intended for client software to easily correlate responses to previously made requests.
Its type is either a string or a number, so it can be an UUID, sha1 hash, md5 sum, sequence counter, unix timestamp, etc.
</p>

<p>
An example request to read a file <code>/etc/board.json</code> which contains device info would be: 
</p>
<pre class="code bash">$ curl <span class="re5">-H</span> <span class="st_h">'Content-Type: application/json'</span> <span class="re5">-d</span> <span class="st_h">'{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;call&quot;, &quot;params&quot;: [ &quot;c1ed6c7b025d0caca723a816fa61b668&quot;, &quot;file&quot;, &quot;read&quot;, { &quot;path&quot;: &quot;/etc/board.json&quot; } ] }'</span>  http:<span class="sy0">//</span>your.server.ip<span class="sy0">/</span>ubus
<span class="br0">&#123;</span><span class="st0">&quot;jsonrpc&quot;</span>:<span class="st0">&quot;2.0&quot;</span>,<span class="st0">&quot;id&quot;</span>:<span class="nu0">1</span>,<span class="st0">&quot;result&quot;</span>:<span class="br0">&#91;</span><span class="nu0">0</span>,<span class="br0">&#123;</span><span class="st0">&quot;data&quot;</span>:<span class="st0">&quot;{<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\&quot;</span>model<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>id<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>innotek-gmbh-virtualbox<span class="es1">\&quot;</span>,<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>name<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>innotek GmbH VirtualBox<span class="es1">\&quot;</span><span class="es1">\n</span><span class="es1">\t</span>},<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\&quot;</span>network<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>lan<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>ifname<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>eth0<span class="es1">\&quot;</span>,<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>protocol<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>static<span class="es1">\&quot;</span><span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span>}<span class="es1">\n</span><span class="es1">\t</span>}<span class="es1">\n</span>}<span class="es1">\n</span>&quot;</span><span class="br0">&#125;</span><span class="br0">&#93;</span><span class="br0">&#125;</span></pre>

<p>
Here the first param <code>c1ed6c7b025d0caca723a816fa61b668</code> is the <code>ubus_rpc_session</code> received during the login call.
If you received a response like <code>{“jsonrpc”:“2.0”,“id”:1,“error”:{“code”:-32002,“message”:“Access denied”}}</code> then probably your session token was expired and you need to request a new one.
</p>

<p>
To beautify output you can use <a href="https://stedolan.github.io/jq/" class="urlextern" title="https://stedolan.github.io/jq/" rel="ugc nofollow">jq</a> utility:
</p>
<pre class="code bash">curl <span class="re5">-s</span> <span class="re5">-H</span> <span class="st_h">'Content-Type: application/json'</span> <span class="re5">-d</span> <span class="st_h">'{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;call&quot;, &quot;params&quot;: [ &quot;c1ed6c7b025d0caca723a816fa61b668&quot;, &quot;file&quot;, &quot;read&quot;, { &quot;path&quot;: &quot;/etc/board.json&quot; } ] }'</span>  http:<span class="sy0">//</span>your.server.ip<span class="sy0">/</span>ubus <span class="sy0">|</span> jq
<span class="br0">&#123;</span>
  <span class="st0">&quot;jsonrpc&quot;</span>: <span class="st0">&quot;2.0&quot;</span>,
  <span class="st0">&quot;id&quot;</span>: <span class="nu0">1</span>,
  <span class="st0">&quot;result&quot;</span>: <span class="br0">&#91;</span>
    <span class="nu0">0</span>,
    <span class="br0">&#123;</span>
      <span class="st0">&quot;data&quot;</span>: <span class="st0">&quot;{<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\&quot;</span>model<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>id<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>innotek-gmbh-virtualbox<span class="es1">\&quot;</span>,<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>name<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>innotek GmbH VirtualBox<span class="es1">\&quot;</span><span class="es1">\n</span><span class="es1">\t</span>},<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\&quot;</span>network<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>lan<span class="es1">\&quot;</span>: {<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>ifname<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>eth0<span class="es1">\&quot;</span>,<span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\t</span><span class="es1">\&quot;</span>protocol<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>static<span class="es1">\&quot;</span><span class="es1">\n</span><span class="es1">\t</span><span class="es1">\t</span>}<span class="es1">\n</span><span class="es1">\t</span>}<span class="es1">\n</span>}<span class="es1">\n</span>&quot;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#93;</span>
<span class="br0">&#125;</span></pre>

<p>
In the response JSON document in the <code>result[1].data</code> field contains escaped JSON with the <code>model</code> and <code>network</code> objects.
To fetch the concrete model name you can parse the response with the <a href="https://stedolan.github.io/jq/" class="urlextern" title="https://stedolan.github.io/jq/" rel="ugc nofollow">jq</a> program:
</p>
<pre class="code">curl -s -H &#039;Content-Type: application/json&#039; -d &#039;{ &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;id&quot;: 1, &quot;method&quot;: &quot;call&quot;, &quot;params&quot;: [ &quot;c1ed6c7b025d0caca723a816fa61b668&quot;, &quot;file&quot;, &quot;read&quot;, { &quot;path&quot;: &quot;/etc/board.json&quot; } ] }&#039;  http://your.server.ip/ubus | jq -r &#039;.result[1].data&#039; | jq .model.name
&quot;innotek GmbH VirtualBox&quot;</pre>

<p>
As you can see in the example the router model is in fact just a OpenWrt runned on <a href="/docs/guide-user/virtualization/virtualbox-vm" class="wikilink1" title="docs:guide-user:virtualization:virtualbox-vm" data-wiki-id="docs:guide-user:virtualization:virtualbox-vm">virtual machine in VirtualBox</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Actually making calls&quot;,&quot;hid&quot;:&quot;actually_making_calls&quot;,&quot;codeblockOffset&quot;:14,&quot;secid&quot;:12,&quot;range&quot;:&quot;13038-16518&quot;} -->
<h2 class="sectionedit13" id="lua_module_for_ubus">Lua module for ubus</h2>
<div class="level2">

<p>
This is even possible to use <code>ubus</code> in <code>lua</code> scripts.
Of course it&#039;s not possible to use native libraries directly in <code>lua</code>, so an extra module has been created.
It&#039;s simply called <code>ubus</code> and is a simple interface between <code>lua</code> scripts and the <code>ubus</code> (it uses <code>libubus</code> internally).
</p>
<pre class="code lua"><span class="co1">-- Load module</span>
<span class="kw3">require</span> <span class="st0">&quot;ubus&quot;</span>
<span class="co1">-- Establish connection</span>
<span class="kw1">local</span> conn <span class="sy0">=</span> ubus<span class="sy0">.</span>connect<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="kw1">if</span> <span class="kw2">not</span> conn <span class="kw1">then</span>
    <span class="kw3">error</span><span class="br0">&#40;</span><span class="st0">&quot;Failed to connect to ubusd&quot;</span><span class="br0">&#41;</span>
<span class="kw1">end</span>
&nbsp;
<span class="co1">-- Iterate all namespaces and procedures</span>
<span class="kw1">local</span> namespaces <span class="sy0">=</span> conn<span class="sy0">:</span>objects<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="kw1">for</span> i<span class="sy0">,</span> n <span class="kw2">in</span> <span class="kw3">ipairs</span><span class="br0">&#40;</span>namespaces<span class="br0">&#41;</span> <span class="kw1">do</span>
    <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">&quot;namespace=&quot;</span> <span class="sy0">..</span> n<span class="br0">&#41;</span>
    <span class="kw1">local</span> signatures <span class="sy0">=</span> conn<span class="sy0">:</span>signatures<span class="br0">&#40;</span>n<span class="br0">&#41;</span>
    <span class="kw1">for</span> p<span class="sy0">,</span> s <span class="kw2">in</span> <span class="kw3">pairs</span><span class="br0">&#40;</span>signatures<span class="br0">&#41;</span> <span class="kw1">do</span>
        <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\t</span>procedure=&quot;</span> <span class="sy0">..</span> p<span class="br0">&#41;</span>
        <span class="kw1">for</span> k<span class="sy0">,</span> v <span class="kw2">in</span> <span class="kw3">pairs</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span> <span class="kw1">do</span>
            <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">&quot;<span class="es1">\t</span><span class="es1">\t</span>attribute=&quot;</span> <span class="sy0">..</span> k <span class="sy0">..</span> <span class="st0">&quot; type=&quot;</span> <span class="sy0">..</span> v<span class="br0">&#41;</span>
        <span class="kw1">end</span>
    <span class="kw1">end</span>
<span class="kw1">end</span>
&nbsp;
<span class="co1">-- Call a procedure</span>
<span class="kw1">local</span> status <span class="sy0">=</span> conn<span class="sy0">:</span><span class="kw3">call</span><span class="br0">&#40;</span><span class="st0">&quot;network.device&quot;</span><span class="sy0">,</span> <span class="st0">&quot;status&quot;</span><span class="sy0">,</span> <span class="br0">&#123;</span> name <span class="sy0">=</span> <span class="st0">&quot;eth0&quot;</span> <span class="br0">&#125;</span><span class="br0">&#41;</span>
<span class="kw1">for</span> k<span class="sy0">,</span> v <span class="kw2">in</span> <span class="kw3">pairs</span><span class="br0">&#40;</span>status<span class="br0">&#41;</span> <span class="kw1">do</span>
    <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">&quot;key=&quot;</span> <span class="sy0">..</span> k <span class="sy0">..</span> <span class="st0">&quot; value=&quot;</span> <span class="sy0">..</span> <span class="kw3">tostring</span><span class="br0">&#40;</span>v<span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="kw1">end</span>
&nbsp;
<span class="co1">-- Close connection</span>
conn<span class="sy0">:</span>close<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>

<p>
Optional arguments to <code>connect()</code> are a path to use for sockets (pass nil to use the default) and a per call timeout value (in milliseconds)
</p>
<pre class="code lua"><span class="kw1">local</span> conn <span class="sy0">=</span> ubus<span class="sy0">.</span>connect<span class="br0">&#40;</span><span class="kw4">nil</span><span class="sy0">,</span> <span class="nu0">500</span><span class="br0">&#41;</span> <span class="co1">-- default socket path, 500ms per call timeout</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Lua module for ubus&quot;,&quot;hid&quot;:&quot;lua_module_for_ubus&quot;,&quot;codeblockOffset&quot;:19,&quot;secid&quot;:13,&quot;range&quot;:&quot;16519-17836&quot;} -->
<h2 class="sectionedit14" id="namespaces_procedures">Namespaces &amp; Procedures</h2>
<div class="level2">

<p>
As explained earlier, there can be many different daemons (services) registered in <code>ubus</code>.
Below you will find a list of the most common projects with namespaces, paths and procedures they provide.
</p>

<p>
<strong>Path only contains the first context, e.g. network for network.interface.wan</strong>
</p>
<div class="table sectionedit15"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> path </th><th class="col1"> Description </th><th class="col2"> Package </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <a href="/docs/guide-developer/ubus/dhcp" class="wikilink2" title="docs:guide-developer:ubus:dhcp" rel="nofollow" data-wiki-id="docs:guide-developer:ubus:dhcp">dhcp</a> </td><td class="col1"> dhcp server </td><td class="col2"> odhcpd </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <a href="/docs/guide-developer/ubus/file" class="wikilink1" title="docs:guide-developer:ubus:file" data-wiki-id="docs:guide-developer:ubus:file">file</a> </td><td class="col1"> file </td><td class="col2"> rpcd </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <a href="/docs/guide-developer/ubus/hostapd" class="wikilink2" title="docs:guide-developer:ubus:hostapd" rel="nofollow" data-wiki-id="docs:guide-developer:ubus:hostapd">hostapd</a> </td><td class="col1"> acesspoints </td><td class="col2"> wpad/hostapd </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <a href="/docs/guide-developer/ubus/iwinfo" class="wikilink1" title="docs:guide-developer:ubus:iwinfo" data-wiki-id="docs:guide-developer:ubus:iwinfo">iwinfo</a> </td><td class="col1"> wireless informations </td><td class="col2"> rpcd iwinfo </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <a href="/docs/guide-developer/ubus/log" class="wikilink2" title="docs:guide-developer:ubus:log" rel="nofollow" data-wiki-id="docs:guide-developer:ubus:log">log</a> </td><td class="col1"> logging </td><td class="col2"> procd </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <a href="/docs/guide-developer/ubus/mdns" class="wikilink2" title="docs:guide-developer:ubus:mdns" rel="nofollow" data-wiki-id="docs:guide-developer:ubus:mdns">mdns</a> </td><td class="col1"> mdns avahi replacement </td><td class="col2"> mdnsd </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <a href="/docs/guide-developer/ubus/network" class="wikilink1" title="docs:guide-developer:ubus:network" data-wiki-id="docs:guide-developer:ubus:network">network</a> </td><td class="col1"> network </td><td class="col2"> netifd </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <a href="/docs/guide-developer/ubus/service" class="wikilink1" title="docs:guide-developer:ubus:service" data-wiki-id="docs:guide-developer:ubus:service">service</a> </td><td class="col1"> init/service </td><td class="col2"> procd </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <a href="/docs/guide-developer/ubus/session" class="wikilink1" title="docs:guide-developer:ubus:session" data-wiki-id="docs:guide-developer:ubus:session">session</a> </td><td class="col1"> Session management </td><td class="col2"> rpcd </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <a href="/docs/guide-developer/ubus/system" class="wikilink1" title="docs:guide-developer:ubus:system" data-wiki-id="docs:guide-developer:ubus:system">system</a> </td><td class="col1"> system misc </td><td class="col2"> procd </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <a href="/docs/guide-developer/ubus/uci" class="wikilink1" title="docs:guide-developer:ubus:uci" data-wiki-id="docs:guide-developer:ubus:uci">uci</a> </td><td class="col1"> Unified Configuration Interface </td><td class="col2"> rpcd </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:15,&quot;range&quot;:&quot;18156-18919&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Namespaces &amp; Procedures&quot;,&quot;hid&quot;:&quot;namespaces_procedures&quot;,&quot;codeblockOffset&quot;:21,&quot;secid&quot;:14,&quot;range&quot;:&quot;17837-18920&quot;} -->
<h3 class="sectionedit16" id="procd">procd</h3>
<div class="level3">

<p>
Project <a href="/docs/techref/procd" class="wikilink1" title="docs:techref:procd" data-wiki-id="docs:techref:procd">procd: Procd system init and daemon management</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:system&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:17,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:system" id="plugin_include__docs__guide-developer__ubus__system">

<h4 id="ubus_system">ubus system</h4>
<div class="level4">

<p>
<strong>Package: procd</strong>
</p>
<div class="table sectionedit19"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Procedure </th><th class="col1"> Signature </th><th class="col2"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> board </td><td class="col1"> {} </td><td class="col2"> returns board specific information like model and distribution code name, revision </td>
	</tr>
	<tr class="row2">
		<td class="col0"> info </td><td class="col1"> {} </td><td class="col2"> returns real-time information about the system. <code>
        “uptime”: 20756,
        “localtime”: 1444142264,
        “load”: [
                7264,
                3040,
                3520
        ],
        “memory”: {
                “total”: 29601792,
                “free”: 7344128,
                “shared”: 458752,
                “buffered”: 2166784
        },
        “swap”: {
                “total”: 0,
                “free”: 0
        }</code> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> upgrade </td><td class="col1"> {} </td><td class="col2"> *TODO* </td>
	</tr>
	<tr class="row4">
		<td class="col0"> watchdog </td><td class="col1"> {“frequency”:“Integer”,“timeout”:“Integer”,“stop”:“Boolean”,“magicclose”:“Boolean”} </td><td class="col2"> controls the watchdog. *ubus call system watchdog &#039;{ “stop”: true“}&#039;* only stops the thread triggering the watchdog. The watchdog is still counting down unless a second process is triggering the watchdog unless you enable &#039;magicclose&#039;, then you can manually tickle &#039;/dev/watchdog&#039;. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> signal </td><td class="col1"> {“pid”:“Integer”,”signum“:“Integer”} </td><td class="col2"> send a signal to a process. See man kill </td>
	</tr>
	<tr class="row6">
		<td class="col0"> nandupgrade </td><td class="col1"> {“path”:“String”} </td><td class="col2"> *TODO* </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:19,&quot;range&quot;:&quot;48-1206&quot;} -->
<p>
The values in load are the load averages over 1, 5, and 15 minutes. to get to the familiar values reported by uptime divide these numbers by 65536.0 and round to 2 decimals.
</p>

<p>
There is a detailed <a href="http://kernelreloaded.com/manually-controlling-openwrt-hardware-watchdog/" class="urlextern" title="http://kernelreloaded.com/manually-controlling-openwrt-hardware-watchdog/" rel="ugc nofollow">blog post</a> showing how to use, configure and manually take control over hardware watchdog with ubus commands.
</p>

</div>

<h5 id="examples">Examples</h5>
<div class="level5">

<p>
See all methods of <code>system</code> (to see all methods of all services registered to ubusd: <code>ubus -v list</code>):
</p>
<pre class="code">root@OpenWrt:/# ubus -v list system
&#039;system&#039; @651f206c
        &quot;board&quot;:{}
        &quot;info&quot;:{}
        &quot;reboot&quot;:{}
        &quot;watchdog&quot;:{&quot;frequency&quot;:&quot;Integer&quot;,&quot;timeout&quot;:&quot;Integer&quot;,&quot;magicclose&quot;:&quot;Boolean&quot;,&quot;stop&quot;:&quot;Boolean&quot;}
        &quot;signal&quot;:{&quot;pid&quot;:&quot;Integer&quot;,&quot;signum&quot;:&quot;Integer&quot;}
        &quot;validate_firmware_image&quot;:{&quot;path&quot;:&quot;String&quot;}
        &quot;sysupgrade&quot;:{&quot;path&quot;:&quot;String&quot;,&quot;force&quot;:&quot;Boolean&quot;,&quot;backup&quot;:&quot;String&quot;,&quot;prefix&quot;:&quot;String&quot;,&quot;command&quot;:&quot;String&quot;,&quot;options&quot;:&quot;Table&quot;}</pre>

<p>
You can now call a remote method and receive a reply. A reply may be a simple integer return code or a more complete reply. Internally the bus uses a blob format, the CLI conveniently converts this to JSON.
</p>
<pre class="code">root@OpenWrt:/# ubus call system board
{
        &quot;kernel&quot;: &quot;4.9.198&quot;,
        &quot;hostname&quot;: &quot;OpenWrt&quot;,
        &quot;system&quot;: &quot;Qualcomm Atheros QCA956X ver 1 rev 0&quot;,
        &quot;model&quot;: &quot;TP-Link TL-WR1043N\/ND v4&quot;,
        &quot;board_name&quot;: &quot;tl-wr1043nd-v4&quot;,
        &quot;release&quot;: {
                &quot;distribution&quot;: &quot;OpenWrt&quot;,
                &quot;version&quot;: &quot;18.06.5&quot;,
                &quot;revision&quot;: &quot;r7897-9d401013fc&quot;,
                &quot;target&quot;: &quot;ar71xx\/generic&quot;,
                &quot;description&quot;: &quot;OpenWrt 18.06.5 r7897-9d401013fc&quot;
        }
}</pre>

<p>
You can call a method and pass it some parameters by simply appending a JSON structure to the CLI command.
</p>
<pre class="code">root@OpenWrt:/# ubus call system signal &#039;{ &quot;pid&quot;: 123, &quot;signum&quot;: 9 }&#039;
root@OpenWrt:/# echo $?
0</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:system&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__system&quot;,&quot;secid&quot;:20,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:system&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:18,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:service&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:21,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:service" id="plugin_include__docs__guide-developer__ubus__service">

<h4 id="ubus_service">ubus service</h4>
<div class="level4">

<p>
<strong>Package: procd</strong>
</p>

<p>
<code>service</code> used by init scripts as well to register new services
</p>
<div class="table sectionedit23"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Procedure </th><th class="col2"> Signature </th><th class="col3"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>set</code> </td><td class="col2"> <code>{“name”:“String”,“script”:“String”,“instances”:“Table”,“triggers”:“Array”,“validate”:“Array”,“autostart”:“Boolean”,“data”:“Table”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>add</code> </td><td class="col2"> <code>{“name”:“String”,“script”:“String”,“instances”:“Table”,“triggers”:“Array”,“validate”:“Array”,“autostart”:“Boolean”,“data”:“Table”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>list</code> </td><td class="col2"> <code>{“name”:“String”,“verbose”:“Boolean”}</code> </td><td class="col3"> Return a list of all services and their instances. Can be filtered by name </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>delete</code> </td><td class="col2"> <code>{“name”:“String”,“instance”:“String”}</code> </td><td class="col3"> Delete instance of a service </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>update_start</code> </td><td class="col2"> <code>{“name”:“String”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>event</code> </td><td class="col2"> <code>{“type”:“String”,“data”:“Table”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>validate</code> </td><td class="col2"> <code>{“package”:“String”,“type”:“String”,“service”:“String”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>get_data</code> </td><td class="col2"> <code>{“name”:“String”,“instance”:“String”,“type”:“String”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>service</code> </td><td class="col1"> <code>state</code> </td><td class="col2"> <code>{“spawn”:“Boolean”,“name”:“String”}</code> </td><td class="col3"> *TODO* </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:23,&quot;range&quot;:&quot;115-1182&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:service&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__service&quot;,&quot;secid&quot;:24,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:service&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:22,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:log&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:25,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:log" id="plugin_include__docs__guide-developer__ubus__log">
<div class="level3">
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:log&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__log&quot;,&quot;secid&quot;:27,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:log&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:26,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;procd&quot;,&quot;hid&quot;:&quot;procd&quot;,&quot;codeblockOffset&quot;:21,&quot;secid&quot;:16,&quot;range&quot;:&quot;18921-19167&quot;} -->
<h3 class="sectionedit28" id="netifd">netifd</h3>
<div class="level3">

<p>
Project <a href="/docs/techref/netifd" class="wikilink1" title="docs:techref:netifd" data-wiki-id="docs:techref:netifd">netifd: Network Interface Daemon</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:network&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:29,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:network" id="plugin_include__docs__guide-developer__ubus__network">

<h4 id="ubus_network">ubus network</h4>
<div class="level4">

<p>
<strong>Package: netifd</strong>
</p>

<p>
<a href="https://git.openwrt.org/?p=project/netifd.git;a=blob;f=DESIGN;hb=HEAD" class="urlextern" title="https://git.openwrt.org/?p=project/netifd.git;a=blob;f=DESIGN;hb=HEAD" rel="ugc nofollow">DESIGN document at repo of netifd</a>
</p>
<div class="table sectionedit31"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Path                            </th><th class="col1 leftalign"> Procedure          </th><th class="col2 leftalign"> Signature                                            </th><th class="col3 leftalign"> Description                                                                                                                  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> <code>network</code>                     </td><td class="col1 leftalign"> <code>restart</code>        </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Restart the network, reconfigures all interfaces                                                                             </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>network</code>                     </td><td class="col1 leftalign"> <code>reload</code>         </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Reload the network, reconfigure as needed                                                                                    </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>network.device</code>              </td><td class="col1 leftalign"> <code>status</code>         </td><td class="col2 leftalign"> <code>{ “name”: “<em>ifname</em>” }</code>                         </td><td class="col3 leftalign"> Dump status of given network device <code><em>ifname</em></code> or all network devices if none given                                      </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>network.device</code>              </td><td class="col1 leftalign"> <code>set_state</code>      </td><td class="col2 leftalign"> <code>{ “name”: “<em>ifname</em>”, “defer”: <em>deferred</em> }</code>  </td><td class="col3 leftalign"> Defer or ready the given network device <code><em>ifname</em></code>, depending on the boolean value <em>deferred</em>                          </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>up</code>             </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Bring interface <code><em>name</em></code> up                                                                                              </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>down</code>           </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Bring interface <code><em>name</em></code> down                                                                                            </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>status</code>         </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Dump status of interface <code><em>name</em></code>                                                                                        </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>prepare</code>        </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Prepare setup of interface <code><em>name</em></code>                                                                                      </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>add_device</code>     </td><td class="col2 leftalign"> <code>{ “name”: “<em>ifname</em>” }</code>                         </td><td class="col3 leftalign"> Add network device <code><em>ifname</em></code> to interface <code><em>name</em></code> (e.g. for bridges: <code>brctl addif br-<em>name</em> <em>ifname</em></code>)       </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>remove_device</code>  </td><td class="col2 leftalign"> <code>{ “name”: “<em>ifname</em>” }</code>                         </td><td class="col3 leftalign"> Remove network device <code><em>ifname</em></code> from interface <code><em>name</em></code> (e.g. for bridges: <code>brctl delif br-<em>name</em> <em>ifname</em></code>)  </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> <code>network.interface.<em>name</em></code>  </td><td class="col1 leftalign"> <code>remove</code>         </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign"> Remove interface <code><em>name</em></code> (?)                                                                                            </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> <code>network.wireless</code>            </td><td class="col1 leftalign"> <code>status</code>         </td><td class="col2 leftalign"> <code>{ }</code>                                              </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row16">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row17">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row18">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row19">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
	<tr class="row20">
		<td class="col0 leftalign">                                 </td><td class="col1 leftalign">                    </td><td class="col2 leftalign">                                                      </td><td class="col3 leftalign">                                                                                                                              </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:31,&quot;range&quot;:&quot;159-5177&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:network&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__network&quot;,&quot;secid&quot;:32,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:network&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:30,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;netifd&quot;,&quot;hid&quot;:&quot;netifd&quot;,&quot;codeblockOffset&quot;:24,&quot;secid&quot;:28,&quot;range&quot;:&quot;19168-19303&quot;} -->
<h3 class="sectionedit33" id="rpcd">rpcd</h3>
<div class="level3">

<p>
Project <a href="/docs/techref/rpcd" class="wikilink1" title="docs:techref:rpcd" data-wiki-id="docs:techref:rpcd">rpcd: OpenWrt ubus RPC daemon for backend server</a> is a set of small plugins providing sets of <code>ubus</code> procedures in separated namespaces.
These plugins are not strictly related to any particular software (like <code>netifd</code> or <code>dhcp</code>) so it wasn&#039;t worth it to implement them as separated projects.
rpcd and the desired plugins must be available or installed via opkg.
After installing remember to enable and start the service via <code>service rpcd enable</code> and <code>service rpcd start</code> .
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:file&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:34,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:file" id="plugin_include__docs__guide-developer__ubus__file">

<h4 id="ubus_file">ubus file</h4>
<div class="level4">

<p>
<strong>Package: rpcd</strong>
</p>

<p>
With plugin <code>rpcd-mod-file</code> enabled:
</p>
<div class="table sectionedit36"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Procedure </th><th class="col2"> Signature </th><th class="col3"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>read</code> </td><td class="col2"> <code>{ “path”: “<em>String</em>”, “base64”: <em>Boolean</em> }</code> </td><td class="col3"> Read a file contents. The file path is encoded in Base64 if the <code><em>base64</em></code> param set to “true” </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>write</code> </td><td class="col2"> <code>{ “path”: “<em>String</em>”, “data”: “<em>String</em>”,
  “append”: <em>Boolean</em>, “mode”: <em>Integer</em>, “base64”: <em>Boolean</em> }</code> </td><td class="col3"> Write a <code><em>data</em></code> to a file by <code><em>path</em></code>. The file path is encoded in Base64 if the <code><em>base64</em></code> param set to “true”. If the <code><em>append</em></code> param is “true” then file is not overwritten but the new content is added to the end of the file. The <code><em>mode</em></code> param if specified represent file permission mode. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>list</code> </td><td class="col2"> <code>{ “path”: “<em>String</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>stat</code> </td><td class="col2"> <code>{ “path”: “<em>String</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>md5</code> </td><td class="col2"> <code>{ “path”: “<em>String</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>file</code> </td><td class="col1"> <code>exec</code> </td><td class="col2"> <code>{ “command”: “<em>String</em>”, “params”: “<em>Array</em>”, “env”: “<em>Table</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:36,&quot;range&quot;:&quot;84-1053&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:file&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__file&quot;,&quot;secid&quot;:37,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:file&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:35,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:iwinfo&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:38,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:iwinfo" id="plugin_include__docs__guide-developer__ubus__iwinfo">

<h4 id="ubus_iwinfo">ubus iwinfo</h4>
<div class="level4">

<p>
With plugin <code>rpcd-mod-iwinfo</code> enabled:
</p>
<div class="table sectionedit40"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Procedure </th><th class="col2"> Signature </th><th class="col3"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>devices</code> </td><td class="col2"> <code>{ }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>info</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>scan</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>assoclist</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>”, “mac”: “<em>mac</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>freqlist</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>txpowerlist</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>countrylist</code> </td><td class="col2"> <code>{ “device”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>iwinfo</code> </td><td class="col1"> <code>phyname</code> </td><td class="col2"> <code>{ “section”: “<em>device</em>” }</code> </td><td class="col3"> ? </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:40,&quot;range&quot;:&quot;70-645&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:iwinfo&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__iwinfo&quot;,&quot;secid&quot;:41,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:iwinfo&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:39,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

<p>
Always included in <code>rpcd</code>:
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:session&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:42,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:session" id="plugin_include__docs__guide-developer__ubus__session">

<h4 id="ubus_session">ubus session</h4>
<div class="level4">
<div class="table sectionedit44"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Procedure </th><th class="col2"> Signature </th><th class="col3"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>create</code> </td><td class="col2"> <code>{ “timeout”: <em>timeout</em> }</code> </td><td class="col3 leftalign"> Create a new session and return its ID, set the session timeout to <code><em>timeout</em></code> in seconds (set <code>0</code> for no expire)  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>list</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>” }</code> </td><td class="col3"> Dump session info specified by <code><em>sid</em></code>, if no ID is given, list all sessions </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>grant</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”, “scope”: “<em>scope</em>”,
  “objects”: [ [ “path”, “func” ], ... ] }</code> </td><td class="col3"> Within the session identified by <code><em>sid</em></code> grant access to all specified procedures <code><em>func</em></code> in the namespace <code><em>path</em></code> listed in the <code><em>objects</em></code> array </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>revoke</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”, “scope”: “<em>scope</em>”,
  “objects”: [ [ “path”, “func” ], ... ] }</code> </td><td class="col3"> Within the session identified by <code><em>sid</em></code> revoke access to all specified procedures <code><em>func</em></code> in the namespace <code><em>path</em></code> listed in the <code><em>objects</em></code> array. If <code><em>objects</em></code> is unset, revoke all access </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>access</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”, “scope”: “<em>scope</em>”,
  “object”: “<em>path</em>”, “function”: “<em>function</em>” }</code> </td><td class="col3"> Query whether access to the specified <code><em>function</em></code> in the namespace <code><em>path</em></code> is allowed </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>set</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”,
  “values”: { “<em>key</em>”: <em>value</em>, ... } }</code> </td><td class="col3"> Within the session identified by <code><em>sid</em></code> store the given arbitrary values under their corresponding keys specified in the <code><em>values</em></code> object </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>get</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”,
  “keys”: [ “<em>key</em>”, ... ] }</code> </td><td class="col3"> Within the session identified by <code><em>sid</em></code> retrieve all values associated with the given keys listed in the <code><em>keys</em></code> array. If the key array is unset, dump all key/value pairs </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>unset</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>”,
  “keys”: [ “<em>key</em>”, ... ] }</code> </td><td class="col3"> Within the session identified by <code><em>sid</em></code> unset all keys listed in the <code><em>keys</em></code> array. If the key list is unset, clear all keys </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>destroy</code> </td><td class="col2"> <code>{ “ubus_rpc_session”: “<em>sid</em>” }</code> </td><td class="col3"> Terminate the session identified by the given ID <code><em>sid</em></code> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>session</code> </td><td class="col1"> <code>login</code> </td><td class="col2"> <code>{ “username”: “<em>username</em>”,
  “password”: “<em>password</em>”,
  “timeout”: <em>timeout</em> }</code> </td><td class="col3"> Authenticate with rpcd and create a new session with access rights as specified in the ACLs </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table6&quot;,&quot;secid&quot;:44,&quot;range&quot;:&quot;29-2421&quot;} -->
<p>
<strong>Note:</strong> When using ubus over <abbr title="Hypertext Transfer Protocol">HTTP</abbr>, setting <code>ubus_rpc_session</code> isn&#039;t allowed, it&#039;s automatically set to the calling session.
</p>

<p>
<strong>Note:</strong> Sessions are stored in memory so they will persist as long as <code>rpcd</code> is running
</p>

</div>

<h5 id="login_call_description">login call description</h5>
<div class="level5">

<p>
Use <code>session.login</code> to authorize and create a new session. The <code>timeout</code> argument is optional, it is set in seconds and by default is 5 minutes (300 seconds).
The session timeout is automatically reset on every use.
</p>

<p>
Return example:
</p>
<pre class="code yaml"><span class="br0">&#123;</span><span class="co3">
        &quot;ubus_rpc_session&quot;</span><span class="sy2">: </span><span class="st0">&quot;948abf19b632c5460384315d69010e09&quot;</span>,<span class="co3">
        &quot;timeout&quot;</span><span class="sy2">: </span>300,<span class="co3">
        &quot;expires&quot;</span><span class="sy2">: </span>299,<span class="co3">
        &quot;acls&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;access-group&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;uci-access&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span>
                                <span class="st0">&quot;read&quot;</span>,
                                <span class="st0">&quot;write&quot;</span>
                        <span class="br0">&#93;</span>,<span class="co3">
                        &quot;unauthenticated&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span>
                                <span class="st0">&quot;read&quot;</span>
                        <span class="br0">&#93;</span>
                <span class="br0">&#125;</span>,<span class="co3">
                &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;file&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span>
                                <span class="st0">&quot;*&quot;</span>
                        <span class="br0">&#93;</span>,<span class="co3">
                        &quot;session&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span>
                                <span class="st0">&quot;access&quot;</span>,
                                <span class="st0">&quot;login&quot;</span>
                        <span class="br0">&#93;</span>
                <span class="br0">&#125;</span>,<span class="co3">
                &quot;uci&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;*&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span>
                                <span class="st0">&quot;read&quot;</span>,
                                <span class="st0">&quot;write&quot;</span>
                        <span class="br0">&#93;</span>
                <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>,<span class="co3">
        &quot;data&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;username&quot;</span><span class="sy2">: </span><span class="st0">&quot;root&quot;</span>
        <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
To list all active sessions call <code>session list</code>.
</p>

</div>

<h5 id="example_of_manual_session_creation">Example of manual session creation</h5>
<div class="level5">

<p>
Create a session then grant access to all functions of <code>file</code> and to the <code>board</code> object function of <code>system</code> object.
Also set a custom attribute <code>username</code> to <code>alice</code> then check if the sid have an access to <code>system.reboot</code> function (and there is npo such access)
</p>
<pre class="code">root@OpenWrt:~# ubus call session create &#039;{&quot;timeout&quot;: 3600}&#039;
{
        &quot;ubus_rpc_session&quot;: &quot;8c1af812b4b148fcbb92434c74cf61c1&quot;,
        &quot;timeout&quot;: 3600,
        &quot;expires&quot;: 3600,
        &quot;acls&quot;: {

        },
        &quot;data&quot;: {

        }
}
root@OpenWrt:~# ubus call session grant &#039;{&quot;ubus_rpc_session&quot;: &quot;bf11e5cd01cd262ae692600a6a45ccfc&quot;, &quot;scope&quot;: &quot;write&quot;, &quot;objects&quot;: [[&quot;file&quot;, &quot;*&quot;], [&quot;system&quot;, &quot;board&quot;]]}&#039;
root@OpenWrt:~# ubus call session set &#039;{&quot;ubus_rpc_session&quot;: &quot;bf11e5cd01cd262ae692600a6a45ccfc&quot;, &quot;values&quot;: { &quot;username&quot;: &quot;alice&quot; } }&#039;
root@OpenWrt:~# ubus call session list &#039;{&quot;ubus_rpc_session&quot;: &quot;bf11e5cd01cd262ae692600a6a45ccfc&quot;}&#039;
{
        &quot;ubus_rpc_session&quot;: &quot;bf11e5cd01cd262ae692600a6a45ccfc&quot;,
        &quot;timeout&quot;: 3600,
        &quot;expires&quot;: 3600,
        &quot;acls&quot;: {
                &quot;ubus&quot;: {
                        &quot;file&quot;: [
                                &quot;*&quot;
                        ],
                        &quot;system&quot;: [
                                &quot;board&quot;
                        ]
                }
        },
        &quot;data&quot;: {
                &quot;username&quot;: &quot;alice&quot;
        }
}
root@OpenWrt:~# ubus call session access &#039;{ &quot;ubus_rpc_session&quot;: &quot;bf11e5cd01cd262ae692600a6a45ccfc&quot;, &quot;scope&quot;: &quot;ubus&quot;, &quot;object&quot;: &quot;system&quot;, &quot;function&quot;: &quot;reboot&quot; }&#039;
{
        &quot;access&quot;: false
}</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:session&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__session&quot;,&quot;secid&quot;:45,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:session&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:43,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:uci&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:46,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__docs:guide-developer:ubus:uci" id="plugin_include__docs__guide-developer__ubus__uci">

<h4 id="ubus_uci">ubus uci</h4>
<div class="level4">

<p>
<strong>Package: rpcd</strong>
</p>
<pre class="code"># ubus -v list uci
&#039;uci&#039; @4eb774a8
	&quot;configs&quot;:{}
	&quot;get&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;section&quot;:&quot;String&quot;,&quot;option&quot;:&quot;String&quot;,&quot;type&quot;:&quot;String&quot;,&quot;match&quot;:&quot;Table&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;state&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;section&quot;:&quot;String&quot;,&quot;option&quot;:&quot;String&quot;,&quot;type&quot;:&quot;String&quot;,&quot;match&quot;:&quot;Table&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;add&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;type&quot;:&quot;String&quot;,&quot;name&quot;:&quot;String&quot;,&quot;values&quot;:&quot;Table&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;set&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;section&quot;:&quot;String&quot;,&quot;type&quot;:&quot;String&quot;,&quot;match&quot;:&quot;Table&quot;,&quot;values&quot;:&quot;Table&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;delete&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;section&quot;:&quot;String&quot;,&quot;type&quot;:&quot;String&quot;,&quot;match&quot;:&quot;Table&quot;,&quot;option&quot;:&quot;String&quot;,&quot;options&quot;:&quot;Array&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;rename&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;section&quot;:&quot;String&quot;,&quot;option&quot;:&quot;String&quot;,&quot;name&quot;:&quot;String&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;order&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;sections&quot;:&quot;Array&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;changes&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;revert&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;commit&quot;:{&quot;config&quot;:&quot;String&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;apply&quot;:{&quot;rollback&quot;:&quot;Boolean&quot;,&quot;timeout&quot;:&quot;Integer&quot;,&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;confirm&quot;:{&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;rollback&quot;:{&quot;ubus_rpc_session&quot;:&quot;String&quot;}
	&quot;reload_config&quot;:{}</pre>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:48,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_warning plugin_wrap">
<p>
The “ubus uci” section of this documentation is severely outdated and incomplete.  It is only useful nowadays as a starting point for someone to actually rewrite it to match reality.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:49,&quot;range&quot;:&quot;0-&quot;} --><div class="table sectionedit50"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0"> Path </th><th class="col1"> Procedure </th><th class="col2"> Signature </th><th class="col3"> Description </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>configs</code> </td><td class="col2"> <code>{ }</code> </td><td class="col3"> <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:51,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
List all available configs
</p>

<p>
Example:
</p>
<pre class="code"># ubus call uci configs &#039;{&quot;ubus_rpc_session&quot;:&quot;2db687f321a60414e77677bbb5dd6d6f&quot;}&#039;
{
	&quot;configs&quot;: [
		&quot;dhcp&quot;,
		&quot;dropbear&quot;,
		&quot;firewall&quot;,
		&quot;luci&quot;,
		&quot;network&quot;,
		&quot;radius&quot;,
		&quot;rpcd&quot;,
		&quot;system&quot;,
		&quot;ubootenv&quot;,
		&quot;ucitrack&quot;,
		&quot;uhttpd&quot;,
		&quot;wireless&quot;
	]
}</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:52,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>get</code> </td><td class="col2"> <code>{ “config”: “<em>config</em>”,
  “section”: “<em>sname</em>”,
  “type”:    “<em>type</em>”,
  “option”:  “<em>oname</em>” }</code> </td><td class="col3"> <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:53,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Return the requested uci value(s), all arguments are optional.
</p>
<ol>
<li class="level1"><div class="li"> When called without argument or with empty object: return an array of package names in the <code>configs</code> field</div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> set: return an object containing all sections containing all options in a field named after the package</div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>type</em></code> set: return an object containing all sections of type <code><em>type</em></code> containing all options in a field named after the package</div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>sname</em></code> set: return an object containing all options of the section in a field named after the section</div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>type</em></code> and <code><em>oname</em></code> set: return an object containing the value of each option named <code><em>oname</em></code> within a section of type <code><em>type</em></code> in a field named after the matched section</div>
</li>
<li class="level1"><div class="li"> When called with <code><em>package</em></code> and <code><em>sname</em></code> and <code><em>oname</em></code> set: return the result string in a field named <code><em>oname</em></code> in case of options or an array of result strings in a field named <code><em>oname</em></code> in case of list options</div>
</li>
</ol>

<p>
Return messages:
</p>
<ol>
<li class="level1"><div class="li"> <code>{ “<em>config</em>”: {
  “sname1”: {
    “.type”:   “type1”,
    “option1”: “value1”,
    “option2”: [ “value2.1”, ... ],
    ... }, ... } }</code></div>
</li>
<li class="level1"><div class="li"> <code>{ “<em>config</em>”: {
  “sname1”: {
    “.type”:   “<em>type</em>”,
    “option1”: “value1”,
    “option2”: [ “value2.1”, ... ],
    ... }, ... } }</code></div>
</li>
<li class="level1"><div class="li"> <code>{ “<em>sname</em>”: {
    “.type”:   “type”,
    “option1”: “value1”,
    “option2”: [ “value2.1”, ... ],
    ... } }</code></div>
</li>
<li class="level1"><div class="li"> <code>{ “sectionname1”: “value1”,
  “sectionname2”: [ “value2.1”, ... ],
  ... }</code></div>
</li>
<li class="level1 node"><div class="li"></div>
<ol>
<li class="level2"><div class="li"> <code>{ “<em>oname</em>”: “value1” }</code></div>
</li>
<li class="level2"><div class="li"> <code>{ “<em>oname</em>”: [ “value1.1”, ... ] }</code></div>
</li>
</ol>
</li>
</ol>

<p>
Example:
</p>
<pre class="code"># ubus call uci get &#039;{&quot;ubus_rpc_session&quot;:&quot;2db687f321a60414e77677bbb5dd6d6f&quot;, &quot;config&quot;:&quot;wireless&quot;, &quot;section&quot;:&quot;wifinet2&quot;}&#039;
{
	&quot;values&quot;: {
		&quot;.anonymous&quot;: false,
		&quot;.type&quot;: &quot;wifi-iface&quot;,
		&quot;.name&quot;: &quot;wifinet2&quot;,
		&quot;device&quot;: &quot;radio0&quot;,
		&quot;mode&quot;: &quot;ap&quot;,
		&quot;ssid&quot;: &quot;ilwf-guest&quot;,
		&quot;encryption&quot;: &quot;sae-mixed&quot;,
		&quot;key&quot;: &quot;XXXX&quot;,
		&quot;network&quot;: &quot;lan&quot;,
		&quot;disabled&quot;: &quot;0&quot;
	}</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:54,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>state</code> </td><td class="col2"> <code>{ “config”: “<em>config</em>”,
  “section”: “<em>sname</em>”,
  “type”:    “<em>tname</em>”,
  “option”:  “<em>oname</em>” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>set</code> </td><td class="col2"> <code>{ “config”: “<em>config</em>”,
  “section”: “<em>sname</em>”,
  “type”:  “<em>tname</em>”,
  “values”:   “<em>array_of_values</em>” }</code> </td><td class="col3"> <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:55,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Set the given value(s), the option argument is optional.
</p>
<ol>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>sname</em></code> and <code><em>array_of_values</em></code> set: add a new section <code><em>sname</em></code> in <code><em>config</em></code> and set it to the type given in <code><em>tname</em></code></div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>sname</em></code>, <code><em>oname</em></code> and <code><em>array_of_values</em></code> set <code>array_of_values</code> as values in <code><em>sname</em></code></div>
</li>
</ol>

<p>
The call does not produce any data, instead it returns with the following status codes:
</p>
<ol>
<li class="level1"><div class="li"> If there already is a section called <code><em>sname</em></code>: <code>UBUS_STATUS_INVALID_ARGUMENT</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
<li class="level1"><div class="li"> If there is no section <code><em>sname</em></code> or if <code><em>value</em></code> is neither a string nor an array: <code>UBUS_STATUS_INVALID_ARGUMENT</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
</ol>

<p>
Example:
</p>
<pre class="code"># ubus call uci set &#039;{&quot;ubus_rpc_session&quot;:&quot;2db687f321a60414e77677bbb5dd6d6f&quot;, &quot;config&quot;:&quot;wireless&quot;, &quot;section&quot;:&quot;wifinet2&quot;, &quot;values&quot;:{&quot;disabled&quot;:&quot;1&quot;}}&#039;
# ubus call uci get &#039;{&quot;ubus_rpc_session&quot;:&quot;2db687f321a60414e77677bbb5dd6d6f&quot;, &quot;config&quot;:&quot;wireless&quot;, &quot;section&quot;:&quot;wifinet2&quot;}&#039;
{
	&quot;values&quot;: {
		&quot;.anonymous&quot;: false,
		&quot;.type&quot;: &quot;wifi-iface&quot;,
		&quot;.name&quot;: &quot;wifinet2&quot;,
		&quot;device&quot;: &quot;radio0&quot;,
		&quot;mode&quot;: &quot;ap&quot;,
		&quot;ssid&quot;: &quot;ilwf-guest&quot;,
		&quot;encryption&quot;: &quot;sae-mixed&quot;,
		&quot;key&quot;: &quot;XXXXXXXX&quot;,
		&quot;network&quot;: &quot;lan&quot;,
		&quot;disabled&quot;: &quot;1&quot;
	}
}</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:56,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>add</code> </td><td class="col2"> <code>{ “config”: “<em>config</em>”,
  “type”:    “<em>type</em>” }</code> </td><td class="col3"> <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:57,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Add new anonymous section of given type.
</p>
<ol>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>type</em></code> set: Add a new anonymous section of type <code><em>type</em></code>.</div>
</li>
</ol>

<p>
Return message:
</p>
<ol>
<li class="level1"><div class="li"> <code>{ “section”: “sectionname” }</code></div>
</li>
</ol>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:58,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>delete</code> </td><td class="col2"> <code>{ “config”: “<em>config</em>”,
  “section”: “<em>sname</em>”,
  “type”:    “<em>type</em>”,
  “option”:  “<em>oname</em>” }</code> </td><td class="col3"> <!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:59,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_wrap">
<p>
Delete the given value(s) or section(s), the option and type arguments are optional.
</p>
<ol>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>type</em></code> set: delete all sections of type <code><em>type</em></code> in <code><em>config</em></code></div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code> and <code><em>sname</em></code> set: delete the section named <code><em>sname</em></code> in <code><em>config</em></code></div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code>, <code><em>type</em></code> and <code><em>oname</em></code> set: delete the option named <code><em>oname</em></code> within each section of type <code><em>type</em></code> in <code><em>package</em></code></div>
</li>
<li class="level1"><div class="li"> When called with <code><em>config</em></code>, <code><em>sname</em></code> and <code><em>oname</em></code> set: delete the option named <code><em>oname</em></code> in section <code><em>sname</em></code> of <code><em>package</em></code></div>
</li>
</ol>

<p>
The call does not result in any data, instead it returns the following status codes:
</p>
<ol>
<li class="level1"><div class="li"> If no section of type <code><em>type</em></code> was found: <code>UBUS_STATUS_NOT_FOUND</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
<li class="level1"><div class="li"> If no section named <code><em>sname</em></code> was found: <code>UBUS_STATUS_NOT_FOUND</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
<li class="level1"><div class="li"> If no options named <code><em>oname</em></code> within sections of type <code><em>type</em></code> where found: <code>UBUS_STATUS_NOT_FOUND</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
<li class="level1"><div class="li"> If the option named <code><em>oname</em></code> within named section <code><em>sname</em></code> was not found: <code>UBUS_STATUS_NOT_FOUND</code> else: <code>UBUS_STATUS_OK</code></div>
</li>
</ol>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:60,&quot;range&quot;:&quot;0-&quot;} --></td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>rename</code> </td><td class="col2"> <code>{“config”:“String”,“section”:“String”,“option”:“String”,“name”:“String” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>order</code> </td><td class="col2"> <code>{“config”:“String”,“sections”:“Array” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>changes</code> </td><td class="col2"> <code>{“config”:“String” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>revert</code> </td><td class="col2"> <code>{“config”:“String” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>commit</code> </td><td class="col2"> <code>{“config”:“String” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>apply</code> </td><td class="col2"> <code>{“rollback”:“Boolean”,“timeout”:“Integer” }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>confirm</code> </td><td class="col2"> <code>{ }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>rollback</code> </td><td class="col2"> <code>{ }</code> </td><td class="col3"> </td>
	</tr>
	<tr class="row15">
		<td class="col0"> <code>uci</code> </td><td class="col1"> <code>reload_config</code> </td><td class="col2"> <code>{ }</code> </td><td class="col3"> </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table7&quot;,&quot;secid&quot;:50,&quot;range&quot;:&quot;1482-7896&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_editbtn&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:uci&quot;,&quot;hid&quot;:&quot;plugin_include__docs__guide-developer__ubus__uci&quot;,&quot;secid&quot;:61,&quot;range&quot;:&quot;0-&quot;} --><!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;docs:guide-developer:ubus:uci&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:47,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;rpcd&quot;,&quot;hid&quot;:&quot;rpcd&quot;,&quot;codeblockOffset&quot;:24,&quot;secid&quot;:33,&quot;range&quot;:&quot;19304-20063&quot;} -->
<h2 class="sectionedit62" id="what_s_the_difference_between_ubus_vs_dbus">What&#039;s the difference between ubus vs dbus?</h2>
<div class="level2">

<p>
<a href="https://en.wikipedia.org/wiki/D-Bus" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/D-Bus">D-Bus</a> is bloated, its C <abbr title="Application Programming Interface">API</abbr> is very annoying to use and requires writing large amounts of boilerplate code.
In fact, the pure C <abbr title="Application Programming Interface">API</abbr> is so annoying that its own <abbr title="Application Programming Interface">API</abbr> documentation states: “If you use this low-level <abbr title="Application Programming Interface">API</abbr> directly, you&#039;re signing up for some pain.”
</p>

<p>
<code>ubus</code> is tiny and has the advantage of being easy to use from regular C code, as well as automatically making all exported <abbr title="Application Programming Interface">API</abbr> functionality also available to shell scripts with no extra effort.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;What&#039;s the difference between ubus vs dbus?&quot;,&quot;hid&quot;:&quot;what_s_the_difference_between_ubus_vs_dbus&quot;,&quot;codeblockOffset&quot;:30,&quot;secid&quot;:62,&quot;range&quot;:&quot;20064-20593&quot;} -->
<h2 class="sectionedit63" id="examples1">Examples</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples1&quot;,&quot;codeblockOffset&quot;:30,&quot;secid&quot;:63,&quot;range&quot;:&quot;20594-20614&quot;} -->
<h3 class="sectionedit64" id="fhem">FHEM</h3>
<div class="level3">

</div>

<h4 id="user_mapping">User mapping</h4>
<div class="level4">

<p>
In this example we map username <code>root</code> to <code>fhem_acl</code> for <a href="/docs/guide-user/services/automation/fhem" class="wikilink1" title="docs:guide-user:services:automation:fhem" data-wiki-id="docs:guide-user:services:automation:fhem">FHEM</a> server.
Edit <code>/etc/config/rpcd</code>:
</p>
<dl class="code">
<dt><a href="/_export/code/docs/techref/ubus?codeblock=30" title="Download Snippet" class="mediafile mf_">/etc/config/rpcd</a></dt>
<dd><pre class="code bash"><span class="co0"># /etc/config/rpcd</span>
config <span class="kw2">login</span>
	option username <span class="st_h">'root'</span>
	option password <span class="st_h">'$p$root'</span>
	list <span class="kw3">read</span> <span class="st_h">'*'</span>
	list <span class="kw2">write</span> <span class="st_h">'*'</span>
&nbsp;
config <span class="kw2">login</span>
	option username <span class="st_h">'fhem'</span>
        <span class="co0">#</span>
        <span class="co0"># '$p$&lt;username&gt; =&gt; reference to user passowrd on /etc/shadow</span>
        <span class="co0"># '$1$&lt;hash&gt;' =&gt; crypt() hash, using SHA1. generate via 'uhttpd -m fhem'</span>
        <span class="co0">#</span>
        <span class="co0"># password: fhem</span>
        <span class="co0">#</span>
	option password <span class="st_h">'$1$$xEODf2fNSQ0ArfkJu4L2i1'</span>
	<span class="co0">#</span>
        <span class="co0"># map username to rpcd acl name &quot;fhem_acl&quot;</span>
        <span class="co0">#</span>
        list <span class="kw3">read</span> <span class="st_h">'fhem_acl'</span>
	list <span class="kw2">write</span> <span class="st_h">''</span></pre>
</dd></dl>

<p>
Then reload rpcd config:
</p>
<pre class="code bash">uci commit rpcd</pre>

</div>

<h4 id="user_acl">User ACL</h4>
<div class="level4">

<p>
All files under <code>/usr/share/rpcd/acl.d/</code> will be merge by <code>rpcd</code> to one config file!!
</p>
<pre class="code bash">ubus call hostapd.wlan0 get_clients
ubus call hostapd.wlan1 get_clients</pre>

<p>
Example permissions to run ubus calls remote by fhem over http/json.
</p>
<dl class="code">
<dt><a href="/_export/code/docs/techref/ubus?codeblock=33" title="Download Snippet" class="mediafile mf_json">/usr/share/rpcd/acl.d/fhem.json</a></dt>
<dd><pre class="code yaml"><span class="br0">&#123;</span><span class="co3">
        &quot;fhem_acl&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                &quot;description&quot;</span><span class="sy2">: </span><span class="st0">&quot;FHEM PRESENCE Module User.. https://github.com/janLo/OpenWRT-Wifi-Clients-POC&quot;</span>,<span class="co3">
                &quot;read&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                        &quot;ubus&quot;</span><span class="sy2">: </span><span class="br0">&#123;</span><span class="co3">
                                &quot;hostapd.wlan0&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;get_clients&quot;</span> <span class="br0">&#93;</span>,<span class="co3">
                                &quot;hostapd.wlan1&quot;</span><span class="sy2">: </span><span class="br0">&#91;</span> <span class="st0">&quot;get_clients&quot;</span> <span class="br0">&#93;</span>
                        <span class="br0">&#125;</span>
                <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
FHEM Server - show all connected wireless clients:
</p>
<pre class="code bash">$ python wifi_clients.py
Usage: wifi_clients.py.orig <span class="sy0">&lt;</span>OpenWrt_Host<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>User<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>Pass<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>WiFi_1<span class="sy0">&gt;</span> <span class="br0">&#91;</span><span class="sy0">&lt;</span>WiFi2<span class="sy0">&gt;</span> ...<span class="br0">&#93;</span>
$ python wifi_clients.py 192.168.1.71 fhem fhem wlan0 wlan1
c8:f6:<span class="nu0">50</span>:e1:a9:<span class="nu0">10</span>, 2c:f0:a2:e2:c0:<span class="nu0">15</span>, 8c:a9:<span class="nu0">82</span>:f1:9c:2a, 7c:c3:a1:b8:d2:1e, <span class="nu0">64</span>:9a:be:6a:6c:<span class="nu0">13</span>, 00:1d:<span class="nu0">63</span>:a3:8f:4a</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;FHEM&quot;,&quot;hid&quot;:&quot;fhem&quot;,&quot;codeblockOffset&quot;:30,&quot;secid&quot;:64,&quot;range&quot;:&quot;20615-22472&quot;} -->
<h3 class="sectionedit65" id="getting_firmware_version">Getting firmware version</h3>
<div class="level3">

<p>
Get firmware version with <a href="https://github.com/openwrt/luci/wiki/JsonRpcHowTo" class="urlextern" title="https://github.com/openwrt/luci/wiki/JsonRpcHowTo" rel="ugc nofollow">JSON RPC</a>.
</p>
<pre class="code bash">luci_rpc<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
<span class="kw3">local</span> <span class="re2">LIB</span>=<span class="st0">&quot;<span class="es3">${1}</span>&quot;</span>
<span class="kw3">local</span> <span class="re2">DATA</span>=<span class="st0">&quot;<span class="es3">${2}</span>&quot;</span>
<span class="kw3">local</span> <span class="re2">URL</span>=<span class="st0">&quot;https://<span class="es3">${HOST}</span>/<span class="es1">\
</span>cgi-bin/luci/rpc/<span class="es3">${LIB}</span>?auth=<span class="es3">${TOKEN}</span>&quot;</span>
curl <span class="re5">-s</span> <span class="re5">-k</span> <span class="re5">-d</span> <span class="st0">&quot;<span class="es3">${DATA}</span>&quot;</span> <span class="st0">&quot;<span class="es3">${URL}</span>&quot;</span> \
<span class="sy0">|</span> jsonfilter <span class="re5">-e</span> <span class="st0">&quot;$['result']&quot;</span>
<span class="br0">&#125;</span>
<span class="re2">HOST</span>=<span class="st0">&quot;localhost&quot;</span>
<span class="re2">USER</span>=<span class="st0">&quot;root&quot;</span>
<span class="re2">PASS</span>=<span class="st0">&quot;&quot;</span>
<span class="re2">DATA</span>=<span class="st0">&quot;{ <span class="es1">\&quot;</span>id<span class="es1">\&quot;</span>: 1, <span class="es1">\&quot;</span>method<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>login<span class="es1">\&quot;</span>,
<span class="es1">\&quot;</span>params<span class="es1">\&quot;</span>: [ <span class="es1">\&quot;</span><span class="es3">${USER}</span><span class="es1">\&quot;</span>, <span class="es1">\&quot;</span><span class="es3">${PASS}</span><span class="es1">\&quot;</span> ] }&quot;</span>
<span class="re2">TOKEN</span>=<span class="st0">&quot;<span class="es4">$(luci_rpc auth &quot;${DATA}&quot;)</span>&quot;</span>
<span class="re2">DATA</span>=<span class="st0">&quot;{ <span class="es1">\&quot;</span>id<span class="es1">\&quot;</span>: 2, <span class="es1">\&quot;</span>method<span class="es1">\&quot;</span>: <span class="es1">\&quot;</span>exec<span class="es1">\&quot;</span>,
<span class="es1">\&quot;</span>params<span class="es1">\&quot;</span>: [ <span class="es1">\&quot;</span>ubus call system board<span class="es1">\&quot;</span> ] }&quot;</span>
<span class="re2">VERSION</span>=<span class="st0">&quot;$(luci_rpc sys &quot;</span><span class="co1">${DATA}</span><span class="st0">&quot; <span class="es1">\
</span>| jsonfilter -e &quot;</span>$<span class="br0">&#91;</span><span class="st_h">'release'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'version'</span><span class="br0">&#93;</span><span class="st0">&quot;)&quot;</span>
<span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${VERSION}</span>&quot;</span></pre>

<p>
Get firmware version with ubus RPC.
</p>
<pre class="code bash">ubus_rpc<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
<span class="kw3">local</span> <span class="re2">DATA</span>=<span class="st0">&quot;<span class="es3">${1}</span>&quot;</span>
<span class="kw3">local</span> <span class="re2">URL</span>=<span class="st0">&quot;https://<span class="es3">${HOST}</span>/ubus&quot;</span>
curl <span class="re5">-s</span> <span class="re5">-k</span> <span class="re5">-d</span> <span class="st0">&quot;<span class="es3">${DATA}</span>&quot;</span> <span class="st0">&quot;<span class="es3">${URL}</span>&quot;</span> \
<span class="sy0">|</span> jsonfilter <span class="re5">-e</span> <span class="st0">&quot;$['result']&quot;</span>
<span class="br0">&#125;</span>
<span class="re2">HOST</span>=<span class="st0">&quot;localhost&quot;</span>
<span class="re2">USER</span>=<span class="st0">&quot;root&quot;</span>
<span class="re2">PASS</span>=<span class="st0">&quot;&quot;</span>
<span class="re2">DATA</span>=<span class="st0">&quot;{ 'jsonrpc': '2.0', 'id': 1, 'method': 'call',
'params': [ '00000000000000000000000000000000', 'session',
'login', { 'username': '<span class="es3">${USER}</span>', 'password': '<span class="es3">${PASS}</span>' } ] }&quot;</span>
<span class="re2">SESSION</span>=<span class="st0">&quot;$(ubus_rpc &quot;</span><span class="co1">${DATA}</span><span class="st0">&quot; <span class="es1">\
</span>| jsonfilter -e &quot;</span>$<span class="br0">&#91;</span><span class="sy0">*</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'ubus_rpc_session'</span><span class="br0">&#93;</span><span class="st0">&quot;)&quot;</span>
<span class="re2">DATA</span>=<span class="st0">&quot;{ 'jsonrpc': '2.0', 'id': 2, 'method': 'call',
'params': [ '<span class="es3">${SESSION}</span>', 'system', 'board', {} ] }&quot;</span>
<span class="re2">VERSION</span>=<span class="st0">&quot;$(ubus_rpc &quot;</span><span class="co1">${DATA}</span><span class="st0">&quot; <span class="es1">\
</span>| jsonfilter -e &quot;</span>$<span class="br0">&#91;</span><span class="sy0">*</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'release'</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st_h">'version'</span><span class="br0">&#93;</span><span class="st0">&quot;)&quot;</span>
<span class="kw3">echo</span> <span class="st0">&quot;<span class="es3">${VERSION}</span>&quot;</span></pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Getting firmware version&quot;,&quot;hid&quot;:&quot;getting_firmware_version&quot;,&quot;codeblockOffset&quot;:35,&quot;secid&quot;:65,&quot;range&quot;:&quot;22473-&quot;} -->