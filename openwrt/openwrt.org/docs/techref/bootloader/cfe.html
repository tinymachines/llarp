
<h1 class="sectionedit1" id="cfe">CFE</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_start&quot;,&quot;name&quot;:&quot;meta:infobox:wip&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="plugin_include_content plugin_include__meta:infobox:wip" id="plugin_include__meta__infobox__wip">
<div class="level1">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:4,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_wip plugin_wrap" style="width: 70%;">
<p>
<strong>Work in Progress!</strong><br/>

This page is a continuous work in progress. You can edit this page to contribute information. 
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;plugin_include_end&quot;,&quot;name&quot;:&quot;meta:infobox:wip&quot;,&quot;hid&quot;:&quot;&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} --></div>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="https://en.wikipedia.org/wiki/Common Firmware Environment" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Common Firmware Environment">Common Firmware Environment</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.linux-mips.org/wiki/Common_Firmware_Environment" class="urlextern" title="http://www.linux-mips.org/wiki/Common_Firmware_Environment" rel="ugc nofollow">http://www.linux-mips.org/wiki/Common_Firmware_Environment</a> (registration dead)</div>
</li>
<li class="level1 node"><div class="li"> Broadcom CFE sources for some test boards</div>
<ul>
<li class="level2"><div class="li"> <a href="https://web.archive.org/web/20090510103115if_/http://www.broadcom.com/docs/SiByte/README-1.4.2.txt" class="urlextern" title="https://web.archive.org/web/20090510103115if_/http://www.broadcom.com/docs/SiByte/README-1.4.2.txt" rel="ugc nofollow">README-1.4.2.txt</a> (readme)</div>
</li>
<li class="level2"><div class="li"> <a href="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/cfe-1.4.2-src.tar.bz2" class="urlextern" title="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/cfe-1.4.2-src.tar.bz2" rel="ugc nofollow">cfe-1.4.2-src.tar.bz2</a> <code>1.9M</code> (source)</div>
</li>
<li class="level2"><div class="li"> <a href="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/samplesw-1.3.tar.bz2" class="urlextern" title="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/samplesw-1.3.tar.bz2" rel="ugc nofollow">samplesw-1.3.tar.bz2</a> <code>0.3M</code> (examples in C and <a href="/docs/techref/instructionset/mips64_mips64" class="wikilink1" title="docs:techref:instructionset:mips64_mips64" data-wiki-id="docs:techref:instructionset:mips64_mips64">MIPS64</a> assembly)</div>
</li>
<li class="level2"><div class="li"> <a href="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/broadcom_2006a_410_RELEASE-NOTES.txt" class="urlextern" title="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/broadcom_2006a_410_RELEASE-NOTES.txt" rel="ugc nofollow">broadcom_2006a_410_RELEASE-NOTES.txt</a> (tool readme)</div>
</li>
<li class="level2"><div class="li"> <a href="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/broadcom_2006a_410.src.tar.bz2" class="urlextern" title="https://docs.broadcom.com/docs-and-downloads/docs/eula_download/broadcom_2006a_410.src.tar.bz2" rel="ugc nofollow">broadcom_2006a_410.src.tar.bz2</a> <code>69.2M</code> (tool source)</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CFE&quot;,&quot;hid&quot;:&quot;cfe&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1036&quot;} -->
<h2 class="sectionedit6" id="using_the_cfe">Using the CFE</h2>
<div class="level2">

<p>
<a href="https://web.archive.org/web/20071114051120if_/http://melbourne.wireless.org.au/files/wrt54/cfe.pdf" class="urlextern" title="https://web.archive.org/web/20071114051120if_/http://melbourne.wireless.org.au/files/wrt54/cfe.pdf" rel="ugc nofollow">CFE Functional Specification</a>
</p>

<p>
<a href="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/docs/customerDocs/BCM963XX_bootloader_appnote-963XX-AN102-SWRDS.pdf" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/docs/customerDocs/BCM963XX_bootloader_appnote-963XX-AN102-SWRDS.pdf" rel="ugc nofollow">BCM963XX Bootloader Appnote</a>
</p>

<p>
<a href="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/docs/customerDocs/NAND_Flash-CPE-AN1102-SWRDS.pdf" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/docs/customerDocs/NAND_Flash-CPE-AN1102-SWRDS.pdf" rel="ugc nofollow">BCM63XX/BCM68XX NAND Flash Support</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using the CFE&quot;,&quot;hid&quot;:&quot;using_the_cfe&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;1037-1552&quot;} -->
<h2 class="sectionedit7" id="bcm47xx_cfe">bcm47xx CFE</h2>
<div class="level2">

<p>
CFE on bcm47xx devices allows running/installing firmware using a lot of different methods. Usually only few of them are available, depending on the choice of manufacturer who compiled and installed CFE. Most of the methods require access to the CFE console which means you need to attach a <a href="/docs/techref/hardware/port.serial" class="wikilink1" title="docs:techref:hardware:port.serial" data-wiki-id="docs:techref:hardware:port.serial">serial</a> console. To get a prompt just keep CTRL+C pressed (or ESC for some models) while powering the device up.
</p>

<p>
Below is the (hopefully) completed list of methods. The best idea is to find a one looking the best/easiest and check if it works on your device.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;bcm47xx CFE&quot;,&quot;hid&quot;:&quot;bcm47xx_cfe&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;1553-2165&quot;} -->
<h3 class="sectionedit8" id="using_auto-starting_cfe_tftp_server">Using auto-starting CFE TFTP server</h3>
<div class="level3">

<p>
Some CFEs start <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server for few seconds right after hardware initialization. This is probably the only method of installing firmware with CFE that doesn&#039;t require serial console. You simply have to give CFE 1-3 seconds to initialize the switch and then set your <abbr title="Internet Protocol">IP</abbr> and start sending the firmware. If you have a serial console, you can identify <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server running with the following messages:
</p>
<pre class="code">_tftpd_open(): retries=0/3
_tftpd_open(): retries=1/3
_tftpd_open(): retries=2/3</pre>

<p>
Unfortunately even if this method is available for you, it may not work. For example on Linksys E900 it fails after uploading firmware with the:
</p>
<pre class="code">CMD: [boot -raw -z -addr=0x80001000 -max=0x1851e50 -fs=memory :0x807ae1b0]
Loader:raw Filesys:memory Dev:eth0 File::0x807ae1b0 Options:(null)
Loading: PANIC: out of memory!</pre>

<p>
Please note that CFE may require a device specific firmware image (with a special header), otherwise (when using a generic .trx) it may fail with the:
</p>
<pre class="code">CMD: [flash -ctheader -mem -size=0x4c1000 0x807ae1b0 flash1.trx]
Reading from 0x807ae1b0: CODE Pattern is incorrect! (E900)
The file transferred is not a valid firmware image.</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using auto-starting CFE TFTP server&quot;,&quot;hid&quot;:&quot;using_auto-starting_cfe_tftp_server&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;2166-3384&quot;} -->
<h3 class="sectionedit9" id="using_cfe_tftp_manually">Using CFE TFTP manually</h3>
<div class="level3">

<p>
CFE almost always contains <code>flash</code> command that may behave like both: <abbr title="Trivial File Transfer Protocol">TFTP</abbr> client and server. The generic usage is following:
</p>
<pre class="code">flash [options] source-file [destination-device]</pre>

<p>
This is very important to pass <code>[destination-device]</code> argument or CFE will write to the <code>flash0</code> device overwriting the CFE! To see a list of available devices try <code>show devices</code> command.
</p>

<p>
Regarding <code>[options]</code> there is one important one called <code>-noheader</code> and if you happen to be Linksys owner, there is also <code>-ctheader</code>:
</p>
<pre class="code">-noheader    Override header verification, flash binary without checking
-ctheader    Check header of CyberTAN</pre>

<p>
By default CFE validates received firmwares checking if they contain a device-specific header. That won&#039;t allow installing firmware created for a different device. If you want to install <code>trx</code> firmware directly (image without an extra device-specific header), you may use <code>-noheader</code> option.
</p>

</div>

<h4 id="tftp_client">TFTP client</h4>
<div class="level4">

<p>
In this scenario we will tell CFE to connect to the remote <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server, download firmware and install it on the flash. This means that <code>source-file</code> should be set to <code>host:path/firmware.bin</code> format. Example usage:
</p>
<pre class="code">flash -noheader 192.168.1.2:bin/brcm47xx/openwrt-brcm47xx-squashfs.trx flash0.trx
flash -ctheader 192.168.1.2:bin/brcm47xx/openwrt-e900_v1-squashfs.bin flash0.trx</pre>

<p>
Unfortunately on some devices this method makes CFE hang right after downloading the firmware and it gets never written to the flash.
</p>

</div>

<h4 id="tftp_server">TFTP server</h4>
<div class="level4">

<p>
It&#039;s also possible to make <code>flash</code> start a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server that will accept firmware for few seconds. The trick is to put <code>:</code> as a <code>source-file</code>. Example usage:
</p>
<pre class="code">					Example file to send:
flash -noheader : flash0.trx		openwrt-brcm47xx-squashfs.trx
flash -ctheader : flash0.trx		openwrt-e900_v1-squashfs.bin</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using CFE TFTP manually&quot;,&quot;hid&quot;:&quot;using_cfe_tftp_manually&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:9,&quot;range&quot;:&quot;3385-5266&quot;} -->
<h3 class="sectionedit10" id="using_upgrade_command">Using upgrade command</h3>
<div class="level3">

<p>
Some manufacturers provide an <code>upgrade</code> command that is usually just an alias to the parametrized <code>flash</code> executed in a loop. Of course it&#039;s much less flexible that the <code>flash</code> command, but also has some advantages like:
</p>
<ul>
<li class="level1"><div class="li"> Setting parameters automatically</div>
</li>
<li class="level1"><div class="li"> Running in a loop, so you have much more time to start sending the firmware (not only few seconds)</div>
</li>
</ul>

<p>
The most common (and probably safe) usage is to call it with <code>code.bin</code> parameter:
</p>
<pre class="code">CFE&gt; upgrade code.bin
CMD: [upgrade code.bin]
CMD: [flash -ctheader : flash1.trx]
Reading :: _tftpd_open(): retries=0/3</pre>

<p>
Another possible parameters:
</p>
<pre class="code">boot.bin		Usually works the same way as code.bin
linux.bin		Doesn&#039;t always work (&quot;flash0.0: Device not found&quot;)
cfe.bin			WARNING! Writes to the flash1.boot, you don&#039;t want to use it!</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using upgrade command&quot;,&quot;hid&quot;:&quot;using_upgrade_command&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:10,&quot;range&quot;:&quot;5267-6117&quot;} -->
<h3 class="sectionedit11" id="using_web_http_server">Using web (http) server</h3>
<div class="level3">

<p>
Unfortunately only few manufacturers decide to enable it, but it&#039;s probably the most user friendly way of installing firmware.
<a href="/_detail/media/cfe.miniweb.server.png?id=docs%3Atechref%3Abootloader%3Acfe" class="media" title="media:cfe.miniweb.server.png"><img src="/_media/media/cfe.miniweb.server.png" class="media" loading="lazy" alt="" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using web (http) server&quot;,&quot;hid&quot;:&quot;using_web_http_server&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:11,&quot;range&quot;:&quot;6118-6314&quot;} -->
<h3 class="sectionedit12" id="changing_cfe_defaults">Changing CFE defaults</h3>
<div class="level3">

<p>
Every bcm47xx CFE has a small NVRAM backup that is used to restore the main NVRAM when it gets deleted or corrupted. If you want to modify that backup NVRAM, see <a href="/docs/techref/bootloader/cfe/changing.defaults" class="wikilink1" title="docs:techref:bootloader:cfe:changing.defaults" data-wiki-id="docs:techref:bootloader:cfe:changing.defaults">changing defaults</a> page.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Changing CFE defaults&quot;,&quot;hid&quot;:&quot;changing_cfe_defaults&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:12,&quot;range&quot;:&quot;6315-6583&quot;} -->
<h2 class="sectionedit13" id="bcm63xx_cfe">bcm63xx CFE</h2>
<div class="level2">

<p>
bcm63xx CFE is totally different to bcm47xx. The NVRAM is different, with no settings stored outside the CFE partition, they are embedded into CFE. The CLI has different commands, probably with fewer options. And almost always there is a web server available for flashing. Fewer options but more fool-proof.
</p>

<p>
To access CFE you need to attach a <a href="/docs/techref/hardware/port.serial" class="wikilink1" title="docs:techref:hardware:port.serial" data-wiki-id="docs:techref:hardware:port.serial">serial</a> console. To get a prompt just press any key while powering the device up.
</p>

<p>
This is a typical output when starting up the CFE and entering the CLI:
</p>
<pre class="code">DGND3700 Boot Code V1.0.8
CFE version 1.0.37-104.4 for BCM96368 (32bit,SP,BE)
Build Date: Mon Feb 21 17:59:46 CST 2011 (finerain@moonlight)
Copyright (C) 2000-2009 Broadcom Corporation.

Parallel flash device: name AM29LV320MT, id 0x2201 size 32768KB
Total Flash size: 32768K with 256 sectors
ethsw: found bcm53115!
Chip ID: BCM6368B2, MIPS: 400MHz
Main Thread: TP0
Total Memory: 134217728 bytes (128MB)
Boot Address: 0xb8000000

Board IP address                  : 192.168.1.1:ffffff00  
Host IP address                   : 192.168.1.2  
Gateway IP address                :   
Run from flash/host (f/h)         : f  
Default host run file name        : vmlinux  
Default host flash file name      : bcm963xx_fs_kernel  
Boot delay (0-9 seconds)          : 1  
Board Id (0-11)                   : 96368MVWG  
Number of MAC Addresses (1-32)    : 10  
Base MAC Address                  : 20:4e:7f:c0:b5:4c  
PSI Size (1-64) KBytes            : 24  
Enable Backup PSI [0|1]           : 0  
System Log Size (0-256) KBytes    : 0  
Main Thread Number [0|1]          : 0  

*** Press any key to stop auto run (1 seconds) ***
Auto run second count down: 1
CFE&gt; 
CFE&gt;</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;bcm63xx CFE&quot;,&quot;hid&quot;:&quot;bcm63xx_cfe&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:13,&quot;range&quot;:&quot;6584-8318&quot;} -->
<h3 class="sectionedit14" id="using_cfe_web_http_server">Using CFE web (http) server</h3>
<div class="level3">

<p>
It&#039;s probably the most user friendly way of installing firmware. But sometimes some manufacturers decide to disable it (very uncommon). 
</p>

<p>
<a href="/_detail/media/doc/cfe63xx_web-upgrade.png?id=docs%3Atechref%3Abootloader%3Acfe" class="media" title="media:doc:cfe63xx_web-upgrade.png"><img src="/_media/media/doc/cfe63xx_web-upgrade.png" class="media" loading="lazy" alt="" /></a>
</p>

<p>
The default <abbr title="Internet Protocol">IP</abbr> address of CFE is almost always 192.168.1.1. You should use a static <abbr title="Internet Protocol">IP</abbr> in your PC since there isn&#039;t <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> server available when running CFE.
</p>

<p>
For accessing this web interface:
</p>
<ol>
<li class="level1"><div class="li"> Unplug the power source</div>
</li>
<li class="level1"><div class="li"> <span style='color:crimson; '>Press</span> the <strong>RESET</strong> button at the router, don&#039;t release it yet!</div>
</li>
<li class="level1"><div class="li"> Plug the power source</div>
</li>
<li class="level1"><div class="li"> Wait some seconds</div>
</li>
<li class="level1"><div class="li"> <span style='color:green; '>Release</span> the <strong>RESET</strong> button</div>
</li>
<li class="level1"><div class="li"> Browse to <code>http://192.168.1.1</code></div>
</li>
<li class="level1"><div class="li"> Send the new firmware and wait some minutes until the firmware upgrade finish.</div>
</li>
</ol>

<p>
<strong>Note</strong>: The RESET button doesn&#039;t work in some routers. There are some alternatives to stop CFE before loading the current firmware when the RESET button didn&#039;t work:
</p>
<ul>
<li class="level1"><div class="li"> Attach a <a href="/docs/techref/hardware/port.serial" class="wikilink1" title="docs:techref:hardware:port.serial" data-wiki-id="docs:techref:hardware:port.serial">serial</a> console (serial <abbr title="Time To Live">TTL</abbr> cable adapter required). Press any key at the console when starting up the router. This is the better choice.</div>
</li>
<li class="level1"><div class="li"> Shortcircuit TX and RX serial pins some seconds when powering on the router to simulate keyboard buttons pressing; this is ugly but it should work.</div>
</li>
<li class="level1"><div class="li"> Delete existing firmware, if the current firmware allows to delete partitions. </div>
</li>
<li class="level1"><div class="li"> Or upgrade the router with a new fake firmware (filled with zeroes). This will force CFE to stop for requesting a new firmware.</div>
</li>
<li class="level1"><div class="li"> Download tftp by <a href="http://tftpd32.jounin.net" class="urlextern" title="http://tftpd32.jounin.net" rel="ugc nofollow">http://tftpd32.jounin.net</a> and connect the ethernet and give static ip, default gateway usually 192.168.1.1 after that open tftp.exe by downloading and in the tftp client put the openwrt firmware then after some second click break, then in the browser keep on hitting default gateway by powering off and pressing reset while powering on, it goes on cfe.Worked for me.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using CFE web (http) server&quot;,&quot;hid&quot;:&quot;using_cfe_web_http_server&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:14,&quot;range&quot;:&quot;8319-10185&quot;} -->
<h3 class="sectionedit15" id="cfe_secure_boot">CFE Secure Boot</h3>
<div class="level3">

<p>
In modern SoC releases, Broadcom is integrating a <a href="/docs/techref/bootloader/wp_unified_extensible_firmware_interface#secure_boot" class="wikilink2" title="docs:techref:bootloader:wp_unified_extensible_firmware_interface" rel="nofollow" data-wiki-id="docs:techref:bootloader:wp_unified_extensible_firmware_interface">Secure Boot</a> system based in a <a href="/docs/techref/bootloader/wp_chain_of_trust" class="wikilink2" title="docs:techref:bootloader:wp_chain_of_trust" rel="nofollow" data-wiki-id="docs:techref:bootloader:wp_chain_of_trust">chain of trust</a>.
</p>

<p>
The following information is deduced from the sources available and therefore must be taken with caution.
</p>

<p>
Up to date, there are three generations of Secure Boot that embraces the following models:
</p>
<ul>
<li class="level1"><div class="li"> GEN1: 63268</div>
</li>
<li class="level1"><div class="li"> GEN2: 63138, 63148, 63381, 6838 and 6848</div>
</li>
<li class="level1"><div class="li"> GEN3: 63158, 4908, 6858, 6856, 6846, 6878, 63178 and 47622</div>
</li>
</ul>

</div>

<h4 id="mechanism">Mechanism</h4>
<div class="level4">
<ol>
<li class="level1"><div class="li"> The SoC has as factory settings, most probably in the OTP fuses, the private key unique per each model and also 2 keys AES CBC (ek &amp; iv). This is the Root of Trust which is known by OEM.</div>
</li>
<li class="level1"><div class="li"> During boot, the <em>PBL</em> (Primary Boot Loader coded in the SoC) will search for storage peripherals e.g. NAND or NOR SPI. If found then loads a small portion from start of storage into memory. Exact amount may depend on model and storage but most typically 64kb. In the sources this chunk is called CFEROM.</div>
</li>
<li class="level1"><div class="li"> Once loaded the CFEROM, the PBL will analyse the structure, which is a compound of different chunks: valid header, magic numbers, signed credentials, CRC32, actual compiled code, etc. In the end, the PBL will decide if CFEROM meets the structure required and it is properly signed. If this is so, then the PBL will execute the compiled code encapsulated. Note that this code is usually not encrypted and therefore can be detected with naked eyes.</div>
</li>
<li class="level1"><div class="li"> Typically, CFEROM will start PLL&#039;s and full memory span. Most probably doesn&#039;t need to run a storage driver since it is already working. Then it will jump to CFERAM location as coded</div>
</li>
<li class="level1"><div class="li"> CFERAM binary is encoded in JFFS2 filesystem. It must meet a certain structure as CFEROM. The compiled code is usually LZMA compressed and AES CBC encrypted, rendering the resulting binary absolutely meaningless.</div>
</li>
</ol>

</div>

<h4 id="secure_modes">Secure modes</h4>
<div class="level4">

<p>
Several modes can be chosen inside the CFEROM, putting appropiate headers:
</p>
<ul>
<li class="level1"><div class="li"> UNSECURE. The chain of trust is consciously dropped. The compiled code will be executed as trusted. <strong>This is potentially very interesting in order to develop other bootloaders like U-Boot</strong></div>
</li>
<li class="level1 node"><div class="li"> SECURE. This sets the kind of encryption and keys used, which in turn can be:</div>
<ul>
<li class="level3"><div class="li"> GEN2 = MFG</div>
</li>
<li class="level3"><div class="li"> GEN3 = MFG or FLD</div>
</li>
</ul>
</li>
</ul>

</div>

<h4 id="cferom_structure">CFEROM structure</h4>
<div class="level4">

<p>
The actual implementation differs depending on the generation and the storage media, but roughly this guidelines are true:
</p>

</div>

<h5 id="gen1">GEN1</h5>
<div class="level5">

<p>
WIP
</p>

</div>

<h5 id="gen2">GEN2</h5>
<div class="level5">
<div class="table sectionedit16"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Offset    </th><th class="col1 leftalign"> Length   </th><th class="col2 leftalign"> Chunk         </th><th class="col3 leftalign"> Element        </th><th class="col4 leftalign"> Value      </th><th class="col5"> Comments </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> 0x0       </td><td class="col1 leftalign"> 0x14     </td><td class="col2" rowspan="6"> Unauth header </td><td class="col3 leftalign">                </td><td class="col4 leftalign">            </td><td class="col5 leftalign">                                                                                                      </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 0x0       </td><td class="col1 leftalign"> 0x4      </td><td class="col2"> Magic number 1 </td><td class="col3"> 0x0001B669 </td><td class="col4 leftalign"> In decimal = 112233                                                                                                    </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 0x4       </td><td class="col1 leftalign"> 0x4      </td><td class="col2"> Magic number 2 </td><td class="col3"> 0x0006CC7E </td><td class="col4 leftalign"> In decimal = 445566                                                                                                     </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 0x8       </td><td class="col1 leftalign"> 0x4      </td><td class="col2 leftalign"> Version        </td><td class="col3"> 0x00000001 </td><td class="col4 leftalign">                                                                                                      </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 0x0c      </td><td class="col1 leftalign"> 0x4      </td><td class="col2 leftalign"> SBI_length     </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> Length in bytes of Unauth Header + SBI                                                                     </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 0x10      </td><td class="col1 leftalign"> 0x4      </td><td class="col2 leftalign"> JAM CRC32      </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> JAM CRC32 of all the previous elements                                                               </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> 0x14      </td><td class="col1"> variable </td><td class="col2 centeralign" rowspan="12">      SBI      </td><td class="col3 leftalign">                </td><td class="col4 leftalign">            </td><td class="col5 leftalign">                                                                                                      </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> 0x14      </td><td class="col1 leftalign"> 0x2      </td><td class="col2 leftalign"> type           </td><td class="col3 leftalign"> 0x00       </td><td class="col4 leftalign"> This seems a legacy field                                                                            </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> 0x16      </td><td class="col1 leftalign"> 0x2      </td><td class="col2 leftalign"> ver            </td><td class="col3 leftalign"> 0x00       </td><td class="col4 leftalign"> This seems a legacy field                                                                            </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> 0x18      </td><td class="col1 leftalign"> 0x2      </td><td class="col2 leftalign"> len            </td><td class="col3 leftalign"> 0x00       </td><td class="col4 leftalign"> This seems a legacy field                                                                            </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> 0x1a      </td><td class="col1 leftalign"> 0x2      </td><td class="col2 leftalign"> config         </td><td class="col3 leftalign"> 0x00       </td><td class="col4 leftalign"> This seems a legacy field                                                                            </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> 0x1c      </td><td class="col1 leftalign"> 0x180    </td><td class="col2 leftalign"> mfg.oem.bin    </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> Actual structure has been reversed.                                                                  </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> 0x19c     </td><td class="col1 leftalign"> 0x100    </td><td class="col2 leftalign"> mfg.oem.sig    </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> SHA256 signature of mfg.oem.bin. Key must be in SoC                                                  </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> 0x29c     </td><td class="col1 leftalign"> 0x180    </td><td class="col2 leftalign"> op.cot.bin     </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> Unknown meaning “OP”                                                                                 </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> 0x41c     </td><td class="col1 leftalign"> 0x100    </td><td class="col2 leftalign"> op.cot.sig     </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> SHA256 signature of op.cot.bin. Key must be in SoC                                                                       </td>
	</tr>
	<tr class="row16">
		<td class="col0 leftalign"> 0x51c     </td><td class="col1"> variable </td><td class="col2 leftalign"> cferom.bin     </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> This is the actual machine code that will be executed                                                </td>
	</tr>
	<tr class="row17">
		<td class="col0"> SBI_length-0x104 </td><td class="col1 leftalign"> 0x100    </td><td class="col2 leftalign"> SHA256 sig     </td><td class="col3 leftalign"> variable   </td><td class="col4"> This is the SHA256 signature of all the previous SBI elements. Key is the one declared in mfg.oem.bin </td>
	</tr>
	<tr class="row18">
		<td class="col0 leftalign"> SBI_length-0x4   </td><td class="col1 leftalign"> 0x4      </td><td class="col2 leftalign"> JAM CRC32      </td><td class="col3 leftalign"> variable   </td><td class="col4 leftalign"> This is the JAM CRC32 of all the previous SBI elements except SHA256 sig.                            </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:16,&quot;range&quot;:&quot;12684-16134&quot;} -->
<p>
From the sources, we can reverse the structure of mfg.oem.bin:
</p>
<div class="table sectionedit17"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Offset    </th><th class="col1 leftalign"> Length   </th><th class="col2 leftalign"> Chunk         </th><th class="col3 leftalign"> Element        </th><th class="col4 leftalign"> Value      </th><th class="col5"> Comments </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> 0x0    </td><td class="col1 leftalign"> 0x148  </td><td class="col2" rowspan="6"> mfg.oem.bin </td><td class="col3 leftalign">                  </td><td class="col4 leftalign">                </td><td class="col5 leftalign">                                                                                        </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 0x0    </td><td class="col1 leftalign"> 0x6    </td><td class="col2"> Signature header </td><td class="col3"> 0x000000010242 </td><td class="col4 leftalign"> This seems like a magic word                                                           </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 0x6    </td><td class="col1 leftalign"> 0x2    </td><td class="col2 leftalign"> Mid              </td><td class="col3 leftalign"> 0x1234         </td><td class="col4 leftalign"> This value must match the SoC. We know for instance that bcm68380 has 0xffd0              </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 0x8    </td><td class="col1 leftalign"> 0x100  </td><td class="col2 leftalign"> KrsaMfgPub.bin   </td><td class="col3 leftalign"> variable       </td><td class="col4 leftalign"> Modulus of the new public key that we want to use                                      </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 0x108  </td><td class="col1 leftalign"> 0x20   </td><td class="col2 leftalign"> mfg.ek.enc       </td><td class="col3 leftalign">                </td><td class="col4"> This is an encrypted file of the new AES CBC key. The encryption key must be in SoC </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 0x128  </td><td class="col1 leftalign"> 0x20   </td><td class="col2 leftalign"> mfg.iv.enc       </td><td class="col3 leftalign">                </td><td class="col4"> This is an encrypted file of the new AES CBC key. The encryption key must be in SoC </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:17,&quot;range&quot;:&quot;16199-17247&quot;} -->
</div>

<h5 id="gen3">GEN3</h5>
<div class="level5">

<p>
WIP
</p>

<p>
<br/>

</p>

</div>

<h4 id="in_the_search_of_the_rot_password">In the search of the RoT password</h4>
<div class="level4">

<p>
If the PBL password was known, <strong>we could develop any bootloader</strong> with or without the CoT characteristic. It is most likely that this will never be exposed being Broadcom so obscure with their products.
</p>

<p>
However, we must remain attentive to the <abbr title="GNU General Public License">GPL</abbr> bundles that pop up from time to time.
</p>

<p>
More precisely, in the following repo <a href="https://github.com/blackfuel/asuswrt-rt-ax88u/tree/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/tree/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot" rel="ugc nofollow">RoT</a> lies a capital piece of information.
</p>

<p>
Basically the <a href="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot/readme.txt" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot/readme.txt" rel="ugc nofollow">readme.txt</a> file is saying that at least for GEN3:
</p>
<pre class="code">The file Krot-mfg-encrypted.pem is aes-128-cbc encrypted with the same pass-phrase that encrypts the files bcm63xx_encr*.c located in the cfe/cfe/board/bcm63xx_btrm/src direcotry. After the file is decrypted, the pem file contains both the private and public portion of the RSA key Krot-mfg.</pre>

<p>
This means:
</p>
<ul>
<li class="level1"><div class="li"> The PBL MFG password is encrypted in the file Krot-mfg-encrypted.pem</div>
</li>
<li class="level1"><div class="li"> The password must be declared in the files bcm63xx_encr*.c, lying in /src</div>
</li>
<li class="level1"><div class="li"> Analysing the script <a href="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot/make_new_target.sh" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/blob/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot/make_new_target.sh" rel="ugc nofollow">make_new_target.sh</a>, a possible name for this file is “bcm63xx_encr3_clr.c”</div>
</li>
</ul>

<p>
Therefore <strong>we must focus on finding “bcm63xx_encr3_clr.c”</strong> in order to support GEN3 CoT. We might think that there must be a file “bcm63xx_encr2_clr.c” for GEN2 and so on.
</p>

<p>
<br/>

</p>

</div>

<h4 id="sources">Sources</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <a href="https://github.com/RMerl/asuswrt-merlin.ng/tree/master/release/src-rt-5.02axhnd.675x/hostTools/SecureBootUtils" class="urlextern" title="https://github.com/RMerl/asuswrt-merlin.ng/tree/master/release/src-rt-5.02axhnd.675x/hostTools/SecureBootUtils" rel="ugc nofollow">Secure Boot folder</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/RMerl/asuswrt-merlin.ng/tree/master/release/src-rt-5.02axhnd.675x/hostTools/PerlLib/BRCM" class="urlextern" title="https://github.com/RMerl/asuswrt-merlin.ng/tree/master/release/src-rt-5.02axhnd.675x/hostTools/PerlLib/BRCM" rel="ugc nofollow">BCM Perl library folder</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/blackfuel/asuswrt-rt-ax88u/tree/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot" class="urlextern" title="https://github.com/blackfuel/asuswrt-rt-ax88u/tree/master/release/src-rt-5.02axhnd/cfe/cfe/board/bcm63xx_btrm/data/gen3_common/mfg_creds_req/rot" rel="ugc nofollow">RoT</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CFE Secure Boot&quot;,&quot;hid&quot;:&quot;cfe_secure_boot&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:15,&quot;range&quot;:&quot;10186-19424&quot;} -->
<h3 class="sectionedit18" id="using_cfe_tftp_client">Using CFE TFTP client</h3>
<div class="level3">

<p>
If you want to install a firmware using <abbr title="Trivial File Transfer Protocol">TFTP</abbr>, follow these steps (as an alternative to the above install process).
</p>
<ul>
<li class="level1"><div class="li"> Connect a <a href="/docs/techref/hardware/port.serial" class="wikilink1" title="docs:techref:hardware:port.serial" data-wiki-id="docs:techref:hardware:port.serial">serial</a> <abbr title="Time To Live">TTL</abbr> cable to send commands to CFE via serial console software, for loading the firmware via <abbr title="Trivial File Transfer Protocol">TFTP</abbr>.</div>
</li>
<li class="level1"><div class="li"> Start a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server in your PC. Copy the <em><strong>firmware.bin</strong></em> file to the <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server&#039;s directory.</div>
</li>
<li class="level1"><div class="li"> Set the <abbr title="Internet Protocol">IP</abbr> at your pc to 192.168.1.35 (or any compatible), and connect the ethernet cable to the router.</div>
</li>
<li class="level1"><div class="li"> Power ON the router, press any key in the serial console to break into the CFE command line interpreter.</div>
</li>
<li class="level1"><div class="li"> Execute the command: <code>f 192.168.1.35:firmware.bin</code></div>
</li>
</ul>

<p>
This is a session of flashing via <abbr title="Trivial File Transfer Protocol">TFTP</abbr>:
</p>
<pre class="code">CFE&gt; f 192.168.1.35:firmware.bin
Loading 192.168.1.35:firmware.bin ...
Finished loading 2686980 bytes

Flashing root file system and kernel at 0xbfc10000: ..........................................

.
*** Image flash done *** !
Resetting board...\0xff</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Using CFE TFTP client&quot;,&quot;hid&quot;:&quot;using_cfe_tftp_client&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:18,&quot;range&quot;:&quot;19425-20415&quot;} -->
<h3 class="sectionedit19" id="cfe_header">CFE HEADER</h3>
<div class="level3">

<p>
At the begining of CFE, outside the NVRAM area there exist three interesting parameters:
</p>
<div class="table sectionedit20"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Offsets      </th><th class="col1 leftalign"> parameter                           </th><th class="col2 leftalign" colspan="2"> possible values                                                                                                                                         </th><th class="col4 leftalign"> size                       </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> 0x010-0x013  </td><td class="col1 leftalign"> <strong>BpGetSdramSize</strong>                  </td><td class="col2 leftalign"> 8MB 1 CHIP<br/>
16MB 1 CHIP<br/>
32MB 1 CHIP<br/>
64MB 2 CHIP<br/>
32MB 2 CHIP<br/>
16MB 2 CHIP<br/>
64MB 1 CHIP  </td><td class="col3 leftalign"> <strong>0</strong><br/>
<strong>1</strong><br/>
<strong>2</strong><br/>
<strong>3</strong><br/>
<strong>4</strong><br/>
<strong>5</strong><br/>
<strong>6</strong>  </td><td class="col4 leftalign"> 4 bytes<br/>
(unsigned long)  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 0x014-0x017  </td><td class="col1 leftalign"> <strong>BpGetCMTThread</strong><br/>
(Main Thread)  </td><td class="col2 leftalign"> core0<br/>
core1                                                                                   </td><td class="col3 leftalign"> <strong>0</strong><br/>
<strong>1</strong>                                          </td><td class="col4 leftalign"> 4 bytes<br/>
(unsigned long)  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 0x570        </td><td class="col1 leftalign"> <strong>CFE Version</strong>                     </td><td class="col2 leftalign"> any e.g. “cfe-v”                                                                                </td><td class="col3 leftalign">                                                        </td><td class="col4 leftalign"> 5                          </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 0x575        </td><td class="col1 leftalign"> <strong>CFE Version Number</strong>              </td><td class="col2 leftalign"> any                                                                                             </td><td class="col3 leftalign"> 1.0.38-114.101                                         </td><td class="col4 leftalign"> 5                          </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 0x57A        </td><td class="col1 leftalign"> <strong>unused</strong>                          </td><td class="col2 leftalign">                                                                                                 </td><td class="col3 leftalign">                                                        </td><td class="col4 leftalign"> 6                          </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table2&quot;,&quot;secid&quot;:20,&quot;range&quot;:&quot;20526-21959&quot;} -->
</div>

<h4 id="nvram">NVRAM</h4>
<div class="level4">

<p>
The NVRAM is located between offsets 0x580 to 0x97F. The size is 1KB (1024 bytes). 
</p>

<p>
In this pic you can see the NVRAM highlighted: <br/>

<a href="/_detail/doc/techref/bootloader/cfe_nvram-bcm63xx_2.png?id=docs%3Atechref%3Abootloader%3Acfe" class="media" title="doc:techref:bootloader:cfe_nvram-bcm63xx_2.png"><img src="/_media/doc/techref/bootloader/cfe_nvram-bcm63xx_2.png?w=300&amp;tok=bc4c02" class="media" loading="lazy" alt="" width="300" /></a>
</p>
<div class="table sectionedit21"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0" colspan="4"> NVRAM version&lt;5 (usually found in BCM6338, BCM6348, BCM6358) </th>
	</tr>
	<tr class="row1">
		<th class="col0"> Offsets </th><th class="col1" colspan="2"> parameter </th><th class="col3"> size </th>
	</tr>
	</thead>
	<tr class="row2">
		<td class="col0"> 0x580 </td><td class="col1" colspan="2"> <strong>NVRAM Version</strong> </td><td class="col3"> 4 bytes </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 0x584 </td><td class="col1"> <strong>BOOT LINE</strong> </td><td class="col2"> e=192.168.1.1 (Board <abbr title="Internet Protocol">IP</abbr>)<br/>
h=192.168.1.100 (Host <abbr title="Internet Protocol">IP</abbr>)<br/>
g=  (Gateway <abbr title="Internet Protocol">IP</abbr>)<br/>
 r=f/h (run from flash/host)<br/>
f=vmlinux (if r=h)<br/>
i=bcm963xx_fs_kernel<br/>
d=3 (delay, 0=forever prompt)<br/>
p=0 (boot image, 0=latest, 1=previous) </td><td class="col3"> 256 bytes </td>
	</tr>
	<tr class="row4">
		<td class="col0"> 0x684 </td><td class="col1" colspan="2"> <strong>Board ID</strong> </td><td class="col3"> 16 bytes </td>
	</tr>
	<tr class="row5">
		<td class="col0"> 0x694 </td><td class="col1" colspan="2"> <strong>reserved</strong> </td><td class="col3"> 8 bytes </td>
	</tr>
	<tr class="row6">
		<td class="col0"> 0x69C </td><td class="col1" colspan="2"> <strong>Number MAC Addresses</strong> </td><td class="col3"> 4 bytes </td>
	</tr>
	<tr class="row7">
		<td class="col0"> 0x6A0 </td><td class="col1" colspan="2"> <strong>Base MAC Address</strong> </td><td class="col3"> 6 bytes </td>
	</tr>
	<tr class="row8">
		<td class="col0"> 0x6A6 </td><td class="col1" colspan="2"> <strong>reserved</strong> </td><td class="col3"> 2 bytes </td>
	</tr>
	<tr class="row9">
		<td class="col0"> 0x6A8 </td><td class="col1" colspan="2"> <strong>CheckSum</strong> </td><td class="col3"> 4 bytes </td>
	</tr>
	<tr class="row10">
		<td class="col0"> 0x6AC </td><td class="col1" colspan="2"> <strong>--- EMPTY ---</strong> </td><td class="col3"> 724 bytes </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table3&quot;,&quot;secid&quot;:21,&quot;range&quot;:&quot;22167-22847&quot;} --><div class="table sectionedit22"><table class="inline">
	<tr class="row0">
		<td class="col0"> <a href="/_detail/meta/48px-dialog-warning.svg.png?id=docs%3Atechref%3Abootloader%3Acfe" class="media" title="meta:48px-dialog-warning.svg.png"><img src="/_media/meta/48px-dialog-warning.svg.png" class="media" loading="lazy" alt="" /></a> </td><td class="col1"> Not all bcm63xx CFEs share this structure, some CFEs seem to have additional parameters like <strong>PsiSize</strong>, <strong>Country</strong>, <strong>SerialNumber</strong>, etc. As a result of this the CheckSum maybe located at different offsets and therefore the calculation is different. The <strong>EMPTY</strong> space isn&#039;t used to calculate the CheckSum </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table4&quot;,&quot;secid&quot;:22,&quot;range&quot;:&quot;22849-23204&quot;} --><div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign" colspan="4"> NVRAM version&gt;=5 (usually found in BCM6328, BCM6362, BCM6368, BCM6816)                                                                                                                                                                                                                                                                                        </th>
	</tr>
	<tr class="row1">
		<th class="col0 leftalign"> Offsets                                                                 </th><th class="col1 leftalign" colspan="2"> parameter                                                                                                                                                                                                                                                             </th><th class="col3 leftalign"> size (bytes)  </th>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 0x580                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>NVRAM Version</strong>                                                                                                                                                                                                                                                     </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 0x584                                                                   </td><td class="col1 leftalign"> <strong>BOOT LINE</strong>                           </td><td class="col2 leftalign"> e=192.168.1.1 (Board <abbr title="Internet Protocol">IP</abbr>)<br/>
h=192.168.1.100 (Host <abbr title="Internet Protocol">IP</abbr>)<br/>
g=  (Gateway <abbr title="Internet Protocol">IP</abbr>)<br/>
 r=f/h (run from flash/host)<br/>
f=vmlinux (if r=h)<br/>
i=bcm963xx_fs_kernel<br/>
d=3 (delay, 0=forever prompt)<br/>
p=0 (boot image, 0=latest, 1=previous)  </td><td class="col3 leftalign"> 256           </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 0x684                                                                   </td><td class="col1 leftalign"> <strong>Board ID</strong>                            </td><td class="col2 leftalign"> e.g. “96328avng”                                                                                                                                                                                                             </td><td class="col3 leftalign"> 16            </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 0x694                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Main Thread</strong>                                                                                                                                                                                                                                                       </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 0x698                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Psi size</strong>                                                                                                                                                                                                                                                          </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> 0x69C                                                                   </td><td class="col1 leftalign"> <strong>Number MAC Addresses</strong>                </td><td class="col2 leftalign"> 1-32                                                                                                                                                                                                                         </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> 0x6A0                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Base MAC Address</strong>                                                                                                                                                                                                                                                  </td><td class="col3 leftalign"> 6             </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> 0x6A6                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>is default set flag</strong>                                                                                                                                                                                                                                               </td><td class="col3 leftalign"> 1             </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> 0x6A7                                                                   </td><td class="col1 leftalign"> <strong>allocate space for backup PSI flag</strong>  </td><td class="col2 leftalign">                                                                                                                                                                                                                              </td><td class="col3 leftalign"> 1             </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> 0x6A8                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>old v4 CheckSum</strong>                                                                                                                                                                                                                                                   </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> 0x6AC                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>gpon Serial Number</strong>                                                                                                                                                                                                                                                </td><td class="col3 leftalign"> 13            </td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> 0x6B9                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>gpon Password</strong>                                                                                                                                                                                                                                                     </td><td class="col3 leftalign"> 11            </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> 0x6C4                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>WPS Device Pin</strong>                                                                                                                                                                                                                                                    </td><td class="col3 leftalign"> 8             </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> 0x6CC                                                                   </td><td class="col1 leftalign" colspan="2"> <strong><abbr title="Wireless Local Area Network">WLAN</abbr> Params</strong>                                                                                                                                                                                                                                                       </td><td class="col3 leftalign"> 256           </td>
	</tr>
	<tr class="row16">
		<td class="col0 leftalign"> 0x7CC                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Syslog Size</strong>                                                                                                                                                                                                                                                       </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row17">
		<td class="col0 leftalign"> 0x7D0                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>NAND Part Ofs Kb</strong>                                                                                                                                                                                                                                                  </td><td class="col3 leftalign"> 20            </td>
	</tr>
	<tr class="row18">
		<td class="col0 leftalign"> 0x7E4                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>NAND Part Size Kb</strong>                                                                                                                                                                                                                                                 </td><td class="col3 leftalign"> 20            </td>
	</tr>
	<tr class="row19">
		<td class="col0 leftalign"> 0x7F8                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Voice Board ID</strong>                                                                                                                                                                                                                                                    </td><td class="col3 leftalign"> 16            </td>
	</tr>
	<tr class="row20">
		<td class="col0 leftalign"> 0x808                                                                   </td><td class="col1 leftalign"> <strong>AFE ID</strong>                              </td><td class="col2 leftalign"> Primary AFE ID + Bonding AFE ID (4+4)                                                                                                                                                                                        </td><td class="col3 leftalign"> 8             </td>
	</tr>
	<tr class="row21">
		<td class="col0 leftalign"> 0x810                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>OptoRxPower Reading</strong>                                                                                                                                                                                                                                               </td><td class="col3 leftalign"> 2             </td>
	</tr>
	<tr class="row22">
		<td class="col0 leftalign"> 0x812                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>OptoRxPower Offset</strong>                                                                                                                                                                                                                                                </td><td class="col3 leftalign"> 2             </td>
	</tr>
	<tr class="row23">
		<td class="col0 leftalign"> 0x814                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>OptoTxPower Reading</strong>                                                                                                                                                                                                                                               </td><td class="col3 leftalign"> 2             </td>
	</tr>
	<tr class="row24">
		<td class="col0 leftalign"> 0x816                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>unused</strong>                                                                                                                                                                                                                                                            </td><td class="col3 leftalign"> 58            </td>
	</tr>
	<tr class="row25">
		<td class="col0 leftalign"> 0x850                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Flash Block Size</strong>                                                                                                                                                                                                                                                  </td><td class="col3 leftalign"> 1             </td>
	</tr>
	<tr class="row26">
		<td class="col0 leftalign"> 0x851                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>AuxFS Size Percentage</strong>                                                                                                                                                                                                                                             </td><td class="col3 leftalign"> 1             </td>
	</tr>
	<tr class="row27">
		<td class="col0 leftalign"> 0x852                                                                   </td><td class="col1 leftalign"> <strong>unused</strong>                              </td><td class="col2 leftalign">                                                                                                                                                                                                                              </td><td class="col3 leftalign"> 169           </td>
	</tr>
	<tr class="row28">
		<td class="col0 leftalign"> 0x8FB                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Reset to Default CFG Flag</strong>                                                                                                                                                                                                                                         </td><td class="col3 leftalign"> 1             </td>
	</tr>
	<tr class="row29">
		<td class="col0 leftalign"> 0x8FC                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>Model Name</strong>                                                                                                                                                                                                                                                        </td><td class="col3 leftalign"> 32            </td>
	</tr>
	<tr class="row30">
		<td class="col0 leftalign"> 0x91C                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>DES Key</strong>                                                                                                                                                                                                                                                           </td><td class="col3 leftalign"> 32            </td>
	</tr>
	<tr class="row31">
		<td class="col0 leftalign"> 0x93C                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>WEP Key</strong>                                                                                                                                                                                                                                                           </td><td class="col3 leftalign"> 32            </td>
	</tr>
	<tr class="row32">
		<td class="col0 leftalign"> 0x95C                                                                   </td><td class="col1 leftalign"> <strong>Serial Number</strong>                       </td><td class="col2 leftalign"> e.g. “684624H153031359”                                                                                                                                                                                                      </td><td class="col3 leftalign"> 32            </td>
	</tr>
	<tr class="row33">
		<td class="col0 leftalign"> 0x97C                                                                   </td><td class="col1 leftalign" colspan="2"> <strong>CheckSum</strong>                                                                                                                                                                                                                                                          </td><td class="col3 leftalign"> 4             </td>
	</tr>
	<tr class="row34">
		<td class="col0 leftalign"> 0x980                                                                   </td><td class="col1 leftalign" colspan="2"> --end--                                                                                                                                                                                                                                                               </td><td class="col3 leftalign"> Total: 1024   </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table5&quot;,&quot;secid&quot;:23,&quot;range&quot;:&quot;23206-35700&quot;} -->
<p>
NVRAM versions &gt;=5 always have the checksum placed at the end of the NVRAM.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;CFE HEADER&quot;,&quot;hid&quot;:&quot;cfe_header&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:19,&quot;range&quot;:&quot;20416-35778&quot;} -->
<h3 class="sectionedit24" id="psi">PSI</h3>
<div class="level3">

<p>
At the end of the flash outside the CFE, there exists a PSI partition (Profile Storage Information), about 16KB size. In Openwrt this area is <strong>protected with a partition called nvram</strong>. Do not confuse with the CFE NVRAM!!
</p>

<p>
There isn&#039;t any interaction between CFE and PSI except for restoring it to defaults or erasing this area. The settings present in this area are only used by the OEM firmware.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;PSI&quot;,&quot;hid&quot;:&quot;psi&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:24,&quot;range&quot;:&quot;35779-&quot;} -->