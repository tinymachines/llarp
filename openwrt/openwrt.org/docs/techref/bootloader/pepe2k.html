
<h1 class="sectionedit1" id="pepe2k-u-boot_mod">pepe2k-u-boot_mod</h1>
<div class="level1">

<p>
U-Boot 1.1.4 modification for routers. Github : <a href="https://github.com/pepe2k/u-boot_mod" class="urlextern" title="https://github.com/pepe2k/u-boot_mod" rel="ugc nofollow">https://github.com/pepe2k/u-boot_mod</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;pepe2k-u-boot_mod&quot;,&quot;hid&quot;:&quot;pepe2k-u-boot_mod&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-123&quot;} -->
<h3 class="sectionedit2" id="introduction">Introduction</h3>
<div class="level3">

<p>
In short, this project is a deep modification of U-Boot 1.1.4 sources, mostly from TP-Link, but some code fragments were taken also from D-Link, Netgear, ZyXEL and Belkin. All these companies are using SDK from Qualcomm/Atheros which includes modified version of U-Boot 1.1.4.
</p>

<p>
The concept for this project came from another U-Boot modification, dedicated to a small and very popular TP-Link router - model TL-WR703N, which includes web fail safe mode: wr703n-uboot-with-web-failsafe. I was using it and decided to make my own version, which could have some improvements, additional capabilities, support for different models and work with all modern web browsers.
</p>

<p>
First version of this modification was introduced on OpenWrt forum in this thread, at the end of March 2013 and was dedicated only for TP-Link routers with Atheros AR9331 SoC. Now, it supports also models from different manufacturers, devices with Atheros AR934x, Qualcomm Atheros QCA953x, Qualcomm Atheros QCA955x and other (in the near future Qualcomm Atheros QCA956x and MediaTek MT762x) are under development.
</p>

<p>
You can find some information about previous versions of this project also on my blog, in <a href="https://web.archive.org/web/20210731175218/http://www.tech-blog.pl/2013/03/29/zmodyfikowany-u-boot-dla-routerow-tp-link-z-atheros-ar9331-z-trybem-aktualizacji-oprogramowania-przez-www-i-konsola-sieciowa-netconsole/" class="urlextern" title="https://web.archive.org/web/20210731175218/http://www.tech-blog.pl/2013/03/29/zmodyfikowany-u-boot-dla-routerow-tp-link-z-atheros-ar9331-z-trybem-aktualizacji-oprogramowania-przez-www-i-konsola-sieciowa-netconsole/" rel="ugc nofollow">this article (web archive)</a>. It is in Polish, but Google Translator will help you to understand it.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Introduction&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;124-1637&quot;} -->
<h3 class="sectionedit3" id="bootloader_access">Bootloader Access</h3>
<div class="level3">

<p>
<strong>Web server</strong>
</p>

<p>
The most important change is an inclusion of a web server, based on uIP 0.9 <abbr title="Transmission Control Protocol">TCP</abbr>/<abbr title="Internet Protocol">IP</abbr> stack. It allows to upgrade firmware, U-Boot and ART (Atheros Radio Test) images, directly from your web browser, without need to access serial console and running a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server. You can find similar firmware recovery mode, also based on uIP 0.9 <abbr title="Transmission Control Protocol">TCP</abbr>/<abbr title="Internet Protocol">IP</abbr> stack, in D-Link routers.
</p>

<p>
Web server contains 7 pages:
index.html (allows to upgrade firmware image, screenshot below)
uboot.html (allows to upgrade U-Boot image)
art.html (allows to upgrade ART image)
flashing.html
404.html
fail.html
style.css
</p>

<p>
<strong>Network Console</strong>
Second, very useful modification is a network console (it is a part of original U-Boot sources, but none of the manufacturers included it). It allows you to communicate with U-Boot console over the Ethernet, using <abbr title="User Datagram Protocol">UDP</abbr> protocol (default <abbr title="User Datagram Protocol">UDP</abbr> port: 6666, router <abbr title="Internet Protocol">IP</abbr>: 192.168.1.1).
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Bootloader Access&quot;,&quot;hid&quot;:&quot;bootloader_access&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1638-2562&quot;} -->
<h3 class="sectionedit4" id="how_to_buildcompile">How to build/compile</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Build toolchain for your device, while building your firmware</div>
</li>
<li class="level1"><div class="li"> Find the toolchain at /home/openwrt/bin/target/&lt;arch&gt;/OpenWrt-Toolchain-*</div>
</li>
<li class="level1"><div class="li"> Download repo git clone <a href="https://github.com/pepe2k/u-boot_mod" class="urlextern" title="https://github.com/pepe2k/u-boot_mod" rel="ugc nofollow">https://github.com/pepe2k/u-boot_mod</a> in the same build dir /home/openwrt/</div>
</li>
<li class="level1"><div class="li"> Extract u-boo-mod and make directory “toolchain” inside u-boot_mod</div>
</li>
<li class="level1"><div class="li"> Extract /home/openwrt/bin/target/&lt;arch&gt;/OpenWrt-Toolchain-* to above u-boot_mod/toolchain/ directory</div>
</li>
<li class="level1"><div class="li"> cd to u-boot-mod</div>
</li>
<li class="level1 node"><div class="li"> “Makefile” here contains all names of the supported board</div>
<ul>
<li class="level2 node"><div class="li"> Edit the path of your u-boot-mod at </div>
<ul>
<li class="level4"><div class="li"> export BUILD_TOPDIR = “/home/openwrt/u-boot-mod”</div>
</li>
</ul>
</li>
<li class="level2 node"><div class="li"> Edit the Toolchain path</div>
<ul>
<li class="level4"><div class="li"> export TOOLCHAIN_DIR:=$(BUILD_TOPDIR)/toolchain</div>
</li>
<li class="level4"><div class="li"> export PATH:=$(TOOLCHAIN_DIR)/bin:$(PATH)</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Make sure your board is present in this file; e.g. tp-link_tl-mr10u_v1</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> cd u-boot, is another directory inside u-boot-mod; contains another Makefile</div>
</li>
<li class="level1"><div class="li"> vi Makefile</div>
</li>
<li class="level1"><div class="li"> This Makefile is important contains commands for final board build; e.g.   #@$(call config_init,board-name,hostname,flash size,reset gpio,1 if reset button is active low,SOC)</div>
</li>
<li class="level1"><div class="li"> You can edit flashsize and gpio</div>
</li>
<li class="level1"><div class="li"> cd out from u-boot</div>
</li>
<li class="level1"><div class="li"> make &lt;target board&gt;; e.g. make tp-link_tl-mr10u_v1</div>
</li>
<li class="level1"><div class="li"> get your compiled bootloader in bin/</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;How to build\/compile&quot;,&quot;hid&quot;:&quot;how_to_buildcompile&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2563-3854&quot;} -->
<h3 class="sectionedit5" id="credits_and_contributors">Credits And Contributors</h3>
<div class="level3">

<p>
Thanks to M-K O&#039;Connell for donating a router with QCA9563
</p>

<p>
Thanks to Krzysztof M. for donating a TL-WDR3600 router
</p>

<p>
Thanks to pupie from OpenWrt forum for his great help
</p>

<p>
Thanks for all donators and for users who contributed in code development
</p>

<p>
Github : <a href="https://github.com/pepe2k/u-boot_mod/graphs/contributors" class="urlextern" title="https://github.com/pepe2k/u-boot_mod/graphs/contributors" rel="ugc nofollow">https://github.com/pepe2k/u-boot_mod/graphs/contributors</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Credits And Contributors&quot;,&quot;hid&quot;:&quot;credits_and_contributors&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;3855-&quot;} -->