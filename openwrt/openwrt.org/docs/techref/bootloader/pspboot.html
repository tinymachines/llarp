
<h1 class="sectionedit1" id="pspboot">PSPBoot</h1>
<div class="level1">

<p>
<a href="http://wikibin.org/articles/pspboot.html" class="urlextern" title="http://wikibin.org/articles/pspboot.html" rel="ugc nofollow">PSPboot</a> is the successor of <a href="/docs/techref/bootloader/adam2" class="wikilink1" title="docs:techref:bootloader:adam2" data-wiki-id="docs:techref:bootloader:adam2">adam2</a> but only slightly backwards compatible with it. See <a href="http://wikibin.org/articles/adam2.html" class="urlextern" title="http://wikibin.org/articles/adam2.html" rel="ugc nofollow">Adam2_versus_PSP_bootloader</a>.
It is the bootloader used e.g. on the Linksys WAG354G, WRTP54G and <a href="http://www.linux-mips.org/wiki/ADSL2MUE" class="urlextern" title="http://www.linux-mips.org/wiki/ADSL2MUE" rel="ugc nofollow">ADSL2MUE</a> as well as the <a href="https://oldwiki.archive.openwrt.org/toh/netgear/sc101" class="urlextern" title="https://oldwiki.archive.openwrt.org/toh/netgear/sc101" rel="ugc nofollow">https://oldwiki.archive.openwrt.org/toh/netgear/sc101</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;PSPBoot&quot;,&quot;hid&quot;:&quot;pspboot&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-448&quot;} -->
<h2 class="sectionedit2" id="user_guide">User Guide</h2>
<div class="level2">

<p>
Here is the user guide of PSPBoot version 1.2: 
</p>
<ul>
<li class="level1"><div class="li"> <a href="/_media/media/doc/pspboot-user-guide.pdf" class="media mediafile mf_pdf" title="media:doc:pspboot-user-guide.pdf (185.7 KB)">pspboot-user-guide.pdf</a></div>
</li>
</ul>

<p>
What the guide is not saying is that the “boot” command supports placing a kernel command line. Every argument after “boot” gets passed.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;User Guide&quot;,&quot;hid&quot;:&quot;user_guide&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;449-704&quot;} -->
<h2 class="sectionedit3" id="startup_sequence">Startup sequence</h2>
<div class="level2">
<pre class="code">free space start: 0xb0020000
free space end: 0xb0400000

Minimal POST completed...     Success.
Last reset cause: Hardware reset (Power-on reset)

PSPBoot1.2 rev: 0.22.17
(c) Copyright 2002-2004 Texas Instruments, Inc. All Rights Reserved.
FlashType:

mac_init(): Find mac [00:13:10:F9:E2:CE] in location 0
Find mac [00:13:10:F9:E2:CE] in location 0
mac_value: 00:13:10:F9:E2:CE

Press ESC for monitor... 1
(psbl)</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Startup sequence&quot;,&quot;hid&quot;:&quot;startup_sequence&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;705-1164&quot;} -->
<h2 class="sectionedit4" id="available_commands">Available commands</h2>
<div class="level2">
<pre class="code">(psbl) help
reboot            version           info              fa
printenv          setenv            unsetenv          defragenv
fmt               boot              dm                oclk
help</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Available commands&quot;,&quot;hid&quot;:&quot;available_commands&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;1165-1409&quot;} -->
<h2 class="sectionedit5" id="information_on_commands">Information on commands</h2>
<div class="level2">
<pre class="code">(psbl) help reboot
reboot: Warm reboot the system
(psbl) help version
version: Dump build information and optional modules supported
(psbl) help info
info: Gives SoC specific information.
(psbl) help fa
fa: Displays flash allocation information
(psbl) help printenv
printenv: Print all configured system environment variables.
Usage: printenv [envlist]
(psbl) help setenv
setenv: Set a system environment variable
(psbl) help unsetenv
unsetenv: Delete a system environment variable
(psbl) help defragenv
defragenv: Defragment the system environment space
(psbl) help fmt
fmt: Erase a given area on Flash memory
Usage: fmt -a 
       fmt 

(psbl) help boot
boot: Boot the OS image according to settings in &#039;BOOTCFG&#039;
(psbl) help dm
dm: Dump memory from a given address
Usage: dm [ [num words]]
(psbl) help oclk
oclk: Configure/Dump the frequencies for CPU and System</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Information on commands&quot;,&quot;hid&quot;:&quot;information_on_commands&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:5,&quot;range&quot;:&quot;1410-2326&quot;} -->
<h2 class="sectionedit6" id="version">Version</h2>
<div class="level2">
<pre class="code">(psbl) version

PSPBoot 1.2.1.5
Compiled gcc rev: 2.95.3 20010315 (release/MontaVista) [May 17 2005 18:36:51]
Built for AR7WRD board in Little Endian mode.

Optional modules included (+) or not (-):
 +tibinary -elf -gzip -ffs -tftp -ftp -dhcp -pcapp
(psbl) boot
boot order: f
boot file: mtd1</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Version&quot;,&quot;hid&quot;:&quot;version&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:6,&quot;range&quot;:&quot;2327-2655&quot;} -->
<h2 class="sectionedit7" id="info">Info</h2>
<div class="level2">
<pre class="code">(psbl) info

CHIP ID: TNETD73XX (0x5), REV: 0x21

MIPS Processor   : 4KEc rev: 2.2.0
Cache mode       : write-back, write-allocate.
Instruction cache: Associativity: 4, Line size: 16, Total size: 16KB
Data cache       : Associativity: 4, Line size: 16, Total size: 16KB

Last reset cause: Software reset (memory controller also reset)

EMIF is running at the same speed of the processor.
Processor running in little endian mode.
Processor clock is asynchronous to internal bus clock.</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Info&quot;,&quot;hid&quot;:&quot;info&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:7,&quot;range&quot;:&quot;2656-3173&quot;} -->
<h2 class="sectionedit8" id="environment">Environment</h2>
<div class="level2">
<pre class="code">(psbl) printenv

bootloaderVersion       1.2.1.5
ProductID       AR7WRD
HWRevision      Unknown
SerialNumber    none
IPA             192.168.1.1
MAC_PORT        1
SwRev           0.22.17
MEMSZ           0x1000000
FLASHSZ         0x400000
MODETTY0        38400,n,8,1,hw
MODETTY1        38400,n,8,1,hw
CPUFREQ         150000000
SYSFREQ         125000000
PROMPT          (psbl)
mtd0            0x900e0000,0x903f0000
mtd1            0x90020000,0x903f0000
mtd2            0x90000000,0x90020000
mtd3            0x903f0000,0x90400000
mtd4            0x90020000,0x903f0000
pair_selection  0
HWA_0           00:13:10:F9:E2:CE
BOOTCFG         m:f:mtd1</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Environment&quot;,&quot;hid&quot;:&quot;environment&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:8,&quot;range&quot;:&quot;3174-3856&quot;} -->
<h2 class="sectionedit9" id="flash_allocation">Flash Allocation</h2>
<div class="level2">
<pre class="code">(psbl) fa
Current Flash Allocation:

section :   PSBL, base : 0xb0000000, size :      51616 bytes
section :    ENV, base : 0xb0010000, size :      65536 bytes

unallocated Space Start: 0xb0020000
unallocated Space End  : 0xb0400000</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Flash Allocation&quot;,&quot;hid&quot;:&quot;flash_allocation&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:9,&quot;range&quot;:&quot;3857-4134&quot;} -->
<h2 class="sectionedit10" id="tftp_flashing">TFTP flashing</h2>
<div class="level2">

<p>
PSPBoot accepts a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> upload of a new firmware while beeing in command line mode or during the boot wait. The boot wait is 3 seconds by default. This creates a very narrow windows for uploading. <abbr title="Trivial File Transfer Protocol">TFTP</abbr> is possible at about 2 seconds after powerup for about 1 second.
</p>

<p>
With a serial console attached, it is also possible to stop the boot process by pressing ESC. The bootloader will then continue to accept uploads. The uploaded file has to be called upgrade_code.bin .
</p>

<p>
Without serial console, this procedure was successful on wag354g:
</p>
<ul>
<li class="level1"><div class="li">unplug the router</div>
</li>
<li class="level1"><div class="li">set static a configuration to the nic, with ip 192.168.1.xx(2-254) and netmask 255.255.255.0</div>
</li>
<li class="level1"><div class="li">launch tftp:</div>
</li>
</ul>
<pre class="code">        tftp&gt; verbose           (for debugging purpose)
        tftp&gt; trace             ( &quot;     &quot;       &quot;     )
        tftp&gt; rexmt 1
        tftp&gt; timeout 5
        tftp&gt; binary
        tftp&gt; connect 192.168.1.1</pre>
<ul>
<li class="level1"><div class="li"> plug the power to the router</div>
</li>
<li class="level1"><div class="li"> wait until the led switch turns on, and immediately enter:</div>
</li>
</ul>
<pre class="code">tftp&gt; put upgrade_code.bin</pre>
<ul>
<li class="level1"><div class="li">alternatively, just dont wait to press enter, and do some try till the right timing is guessed.</div>
</li>
</ul>

<p>
If transfer starts, the tftp output is like this:
</p>
<pre class="code">....
sent DATA 
		received ACK 
...</pre>
<ul>
<li class="level1"><div class="li"> wait until router reboots</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;TFTP flashing&quot;,&quot;hid&quot;:&quot;tftp_flashing&quot;,&quot;codeblockOffset&quot;:7,&quot;secid&quot;:10,&quot;range&quot;:&quot;4135-&quot;} -->