
<h1 class="sectionedit1" id="redboot">RedBoot</h1>
<div class="level1">

<p>
<a href="https://en.wikipedia.org/wiki/RedBoot" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/RedBoot">RedBoot</a> is an open source application that uses the <a href="https://en.wikipedia.org/wiki/eCos" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/eCos">eCos</a> real-time operating system Hardware Abstraction Layer to provide bootstrap firmware for embedded systems.
</p>

<p>
RedBoot allows download and execution of embedded applications via serial or Ethernet, including embedded Linux and eCos applications. It provides debug support in conjunction with GDB to allow development and debugging of embedded applications. It also provides an interactive command line interface to allow management of the Flash images, image download, RedBoot configuration, etc., accessible via serial or ethernet. For unattended or automated startup, boot scripts can be stored in Flash allowing for example loading of images from Flash, hard disk, or a <abbr title="Trivial File Transfer Protocol">TFTP</abbr> server.
</p>

<p>
It is <abbr title="Free &amp; Open-Source Software">FOSS</abbr> and has an <a href="http://sources.redhat.com/ecos/docs-latest/redboot/redboot-guide.html" class="urlextern" title="http://sources.redhat.com/ecos/docs-latest/redboot/redboot-guide.html" rel="ugc nofollow">online manual</a>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;RedBoot&quot;,&quot;hid&quot;:&quot;redboot&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-889&quot;} -->
<h2 class="sectionedit2" id="available_patches">Available Patches</h2>
<div class="level2">

<p>
If somebody writes a patche for the bootloader implementation of a particular device, you will find links to this on the wiki-page for that device. Yet we additionally accumulate all the patches wrote for a particular bootloader on his own page. Hopefully you can get a better comprehension of the functionality of the bootloader by having a look at them.
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://drive.google.com/uc?export=download&amp;id=0B-EMoBe-_OdBa1BNajBvaGhEZU0" class="urlextern" title="https://drive.google.com/uc?export=download&amp;id=0B-EMoBe-_OdBa1BNajBvaGhEZU0" rel="ugc nofollow">REDBOOT-sourcecode-blue5g.tar.gz</a> : BCM6348 modded Redboot</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Available Patches&quot;,&quot;hid&quot;:&quot;available_patches&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;890-1419&quot;} -->
<h2 class="sectionedit3" id="configuration">Configuration</h2>
<div class="level2">

<p>
The RedBoot configuration is stored as ordered pairs in an mtd block.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration&quot;,&quot;hid&quot;:&quot;configuration&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;1420-1515&quot;} -->
<h3 class="sectionedit4" id="within_openwrt">Within OpenWrt</h3>
<div class="level3">

<p>
The fconfig package can read from and write to the RedBoot.  To determine which block to use, look at the output of 
</p>
<pre class="code">dmesg</pre>

<p>
 or 
</p>
<pre class="code">cat /proc/mtd</pre>

<p>
, or listing each block with 
</p>
<pre class="code">fconfig</pre>

<p>
, e.g. 
</p>
<pre class="code">fconfig -l -d /dev/mtdX</pre>

<p>
.  The configuration has either a magic number or a checksum, so provided the mtd block has already been initialized, the command will only work on a block with a RedBoot configuration.
</p>

<p>
To list all ordered pairs, use this:
</p>
<pre class="code">fconfig -l -d /dev/mtdX</pre>

<p>
To read a single ordered pair, use this:
</p>
<pre class="code">fconfig -r -d /dev/mtd3 -n bootp</pre>

<p>
To write an ordered pair, do this:
</p>
<pre class="code">fconfig -w -d /dev/mtd3 -n bootp -x TRUE</pre>

<p>
Caveat: 
</p>
<pre class="code">mtd</pre>

<p>
 and the library it uses might not let you write to that mtd device.  The lock is a software lock, implemented to prevent the mtd block following the RedBoot config from being erased as <a href="http://forum.openwrt.org/viewtopic.php?pid=72704#p72704" class="urlextern" title="http://forum.openwrt.org/viewtopic.php?pid=72704#p72704" rel="ugc nofollow">the config spans only a partial flash erase block</a>.  There is a patch that removes this limitation, but it requires replacing the kernel.
</p>

<p>
The 
</p>
<pre class="code">-v</pre>

<p>
 flag increased verbosity.
</p>

<p>
<strong>Warning:</strong> for some (maybe all?) devices, <em>/dev/mtdblockX</em> needs to be used in the commands above instead of <em>/dev/mtdX</em>, especially when changing RedBoot configuration. The reason is that “the mtd device can only be used by nand/nor aware tools/filesystems. Otherwise you can only flip ones to zero and not the other way around” as it was explained in <a href="https://dev.openwrt.org/ticket/7530" class="urlextern" title="https://dev.openwrt.org/ticket/7530" rel="ugc nofollow">this ticket</a>. It&#039;s strongly recommended to create a backup of the RedBoot configuration partition before making any changes with the fconfig tool. In case the configuration is broken already without any backups it&#039;s vital to know that RedBoot usually defaults to ask for an <abbr title="Internet Protocol">IP</abbr> address through BOOTP. This <abbr title="Internet Protocol">IP</abbr> address might be looked up easily on the BOOTP server using the device&#039;s MAC address. Connecting to this <abbr title="Internet Protocol">IP</abbr> on port 9000 using a telnet client should help to gain access to the RedBoot shell and recover the configuration.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Within OpenWrt&quot;,&quot;hid&quot;:&quot;within_openwrt&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1516-3630&quot;} -->
<h3 class="sectionedit5" id="within_redboot">Within RedBoot</h3>
<div class="level3">

<p>
RedBoot, itself, also uses the 
</p>
<pre class="code">fconfig</pre>

<p>
 command, albeit a bit differently.
</p>
<pre class="code">RedBoot&gt; fconfig    //Press enter//
Run script at boot: true    //Press enter//
Boot script:
.. fis load -l vmlinux.bin.l7
.. exec
Enter script, terminate with empty line
&gt;&gt; fis load -l linux    //Enter command and press enter//
&gt;&gt; exec    //Enter command and press enter//
&gt;&gt;    //Press enter//
Boot script timeout (1000ms resolution): 10    //Press enter//
Use BOOTP for network configuration: false    //Press enter//
Gateway IP address:    //Press enter//
Local IP address: 192.168.1.254    //Press enter//
Local IP address mask: 255.255.255.0    //Press enter//
Default server IP address:    //Press enter//
Console baud rate: 9600    //Press enter//
GDB connection port: 9000    //Press enter//
Force console for special debug messages: false    //Press enter//
Network debug at boot time: false    //Press enter//
Update RedBoot non-volatile configuration - continue (y/n)? y    //Enter &#039;y&#039; and press enter//
… Erase from 0xa87e0000-0xa87f0000: .
… Program from 0×80ff0000-0×81000000 at 0xa87e0000: .</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Within RedBoot&quot;,&quot;hid&quot;:&quot;within_redboot&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:5,&quot;range&quot;:&quot;3631-4774&quot;} -->
<h3 class="sectionedit6" id="configuration_variables">Configuration variables</h3>
<div class="level3">

<p>
I&#039;m guessing, here.
</p>
<div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<td class="col0 centeralign">  value               </td><td class="col1 centeralign">  description                                 </td><td class="col2 rightalign">  reasonable setting </td>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  boot_script         </td><td class="col1 centeralign">  Use a boot script to boot the device?       </td><td class="col2 centeralign">  true               </td>
	</tr>
	<tr class="row2">
		<td class="col0 centeralign">  boot_script_data    </td><td class="col1 centeralign">  The script                                  </td><td class="col2 rightalign">  .. fis load -l vmlinux.bin.l7 .. exec </td>
	</tr>
	<tr class="row3">
		<td class="col0 rightalign">  boot_script_timeout </td><td class="col1 centeralign">  How long to wait before booting; boot_wait  </td><td class="col2 rightalign">  3 </td>
	</tr>
	<tr class="row4">
		<td class="col0 centeralign">  bootp               </td><td class="col1 centeralign">  Obtain an <abbr title="Internet Protocol">IP</abbr> address from bootp?            </td><td class="col2 rightalign">  false </td>
	</tr>
	<tr class="row5">
		<td class="col0 rightalign">  bootp_my_gateway_ip </td><td class="col1 leftalign">  </td><td class="col2 rightalign">  0.0.0.0 </td>
	</tr>
	<tr class="row6">
		<td class="col0 centeralign">  bootp_my_ip  </td><td class="col1 rightalign">  <abbr title="Internet Protocol">IP</abbr> address to listen on for telnet connections? </td><td class="col2 rightalign">  192.168.1.1 </td>
	</tr>
	<tr class="row7">
		<td class="col0 centeralign">  bootp_my_ip_mask    </td><td class="col1 centeralign">  Subnet mask of above address                    </td><td class="col2 rightalign">  255.255.255.0 </td>
	</tr>
	<tr class="row8">
		<td class="col0 centeralign">  bootp_server_ip     </td><td class="col1 leftalign">                                                  </td><td class="col2 rightalign">  0.0.0.0 </td>
	</tr>
	<tr class="row9">
		<td class="col0 centeralign">  console_baud_rate   </td><td class="col1 centeralign">  Baud rate of the serial console                 </td><td class="col2 rightalign">  9600 </td>
	</tr>
	<tr class="row10">
		<td class="col0 centeralign">  gdb_port            </td><td class="col1 centeralign">  Port to listen on for a telnet connection       </td><td class="col2 rightalign">  9000 </td>
	</tr>
	<tr class="row11">
		<td class="col0 centeralign">  info_console_force  </td><td class="col1 leftalign">  </td><td class="col2 rightalign">  false </td>
	</tr>
	<tr class="row12">
		<td class="col0 centeralign">  net_debug           </td><td class="col1 leftalign">  </td><td class="col2 rightalign">  false </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;4830-5846&quot;} --><pre class="code">fconfig boot_script true
fconfig boot_script_timeout 10
fconfig bootp false
fconfig bootp_my_gateway_ip 192.168.1.1
fconfig bootp_my_ip 192.168.1.1
fconfig bootp_my_ip_mask 255.255.255.0
fconfig bootp_server_ip 192.168.1.254
fconfig console_baud_rate 9600
fconfig gdb_port 9000
fconfig info_console_force false
fconfig net_debug false
</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Configuration variables&quot;,&quot;hid&quot;:&quot;configuration_variables&quot;,&quot;codeblockOffset&quot;:11,&quot;secid&quot;:6,&quot;range&quot;:&quot;4775-6198&quot;} -->
<h2 class="sectionedit8" id="connecting_to_redboot">Connecting to RedBoot</h2>
<div class="level2">

<p>
RedBoot supports an internal serial connection and telnet sessions, though telnet sessions aren&#039;t always enabled (see above sections for how to enable it).
</p>

<p>
The default telnet login seems to be 192.168.1.254:9000, and serial connections might use 9600 baud, 8 bit, no parity, no flow control.
</p>

<p>
For both telnet and serial, reset the device.  RedBoot needs to receive Ctrl+c to pause the boot process.  For telnet connections, once a connection is established following the reset (a few seconds), hit Ctrl+c.  For serial connections, hit Ctrl+c until you see this:
</p>
<pre class="code">== Executing boot script in 8.530 seconds - enter ^C to abort
^C
RedBoot&gt;</pre>
<ul>
<li class="level1"><div class="li"> <a href="/toh/d-link/dir-300" class="wikilink1" title="toh:d-link:dir-300" data-wiki-id="toh:d-link:dir-300">dir-300</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Connecting to RedBoot&quot;,&quot;hid&quot;:&quot;connecting_to_redboot&quot;,&quot;codeblockOffset&quot;:12,&quot;secid&quot;:8,&quot;range&quot;:&quot;6199-&quot;} -->